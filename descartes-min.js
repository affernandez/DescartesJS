/*
 Joel Espinosa Longi
 joel.espinosa@amite.mx
 j.longi@gmail.com
 LGPL - http://www.gnu.org/licenses/lgpl.html
 2013-01-31
*/
var descartesJS=function(a){if(a.loadLib)return a;var d=2*Math.PI,c=360/d,f=d/360,e=Math.floor;a.rangeOK=1;a.radToDeg=function(a){return a*c};a.degToRad=function(a){return a*f};a.extend=function(a,d){if(a.prototype.__proto__)a.prototype.__proto__=d.prototype;else for(var c in d.prototype)d.prototype.hasOwnProperty(c)&&(a.prototype[c]=d.prototype[c]);a.prototype.uber=d.prototype};a.convertFont=function(a){if(""==a)return a;var d=a.split(",");a="";"bold"==d[1].toLowerCase()?a+="Bold ":"italic"==d[1].toLowerCase()||
"italics"==d[1].toLowerCase()?a+="Italic ":"bold+italic"==d[1].toLowerCase()&&(a+="Italic Bold ");a+=d[2]+"px ";d=d[0].split(" ")[0].toLowerCase();return"serif"==d||"times new roman"==d||"timesroman"==d?a+"'Times New Roman'":"sansserif"==d||"arial"==d||"helvetica"==d?a+"Arial":a+"'Courier New'"};a.drawLine=function(a,d,c,f,l,m,q){a.lineWidth=q||1;a.strokeStyle=m||"black";m=a.lineWidth%2?0.5:0;a.beginPath();a.moveTo(e(d)+m,e(c)+m);a.lineTo(e(f)+m,e(l)+m);a.stroke()};a.getColor=function(a,d){if("string"==
typeof d)return d;var c=a.evalExpression(d),f=e(255*c[0][0]),l=e(255*c[0][1]),m=e(255*c[0][2]);return"rgba("+f+","+l+","+m+","+(1-c[0][3])+")"};a.getFeatures=function(){a.hasJavaSupport=navigator.javaEnabled();var d=navigator.appVersion.toLowerCase();a.hasTouchSupport=window.hasOwnProperty&&window.hasOwnProperty("ontouchstart")||d.match("android")&&!0;a.hasTouchSupport=navigator.userAgent.toLowerCase().match("qt")?!1:a.hasTouchSupport;var c=document.createElement("canvas");a.hasCanvasSupport=c.getContext&&
c.getContext("2d");a.hasCanvasSupport&&(a.ctx=document.createElement("canvas").getContext("2d"));d.match("chrome")&&(Number.prototype.toFixed=function(a){a=0>a?0:parseInt(a);var d=this.toString(),c=d.indexOf("."),e="";if(-1===c){0<a&&(e=".");for(c=0;c<a;c++)e+="0";return d+e}var f=d.length-c-1;if(f>=a)return d.substring(0,c+1+a);for(c=0;c<a-f;c++)e+="0";return d+e})};a.openExternalFile=function(a){var d=null,c;c=!1;if(window.XMLHttpRequest)try{c=new XMLHttpRequest}catch(e){c=!1}else if(window.ActiveXObject)try{c=
new ActiveXObject("Msxml2.XMLHTTP")}catch(f){try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(m){c=!1}}c.open("GET",a,!1);try{c.send(null),d=c.responseText,d.match(String.fromCharCode(65533))&&(c.open("GET",a,!1),c.overrideMimeType("text/plain; charset=ISO-8859-1"),c.send(null),d=c.responseText)}catch(q){console.log("El archivo ",a," no se pudo abrir"),d=null}return d};a.getCursorPosition=function(a){var d;a.touches?(a=a.touches[0],d=a.pageX,a=a.pageY):void 0!=a.pageX&&void 0!=a.pageY?(d=a.pageX,
a=a.pageY):(d=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);return{x:d,y:a}};a.buildSimpleRegularExpressionPattern=function(a){var d=a.trim();a={ignoreAcents:!1,ignoreCaps:!1,regExp:null};d[0]==d[d.length-1]&&"'"==d[0]&&(a.ignoreCaps=!0,d=d.substring(1,d.length-1),"`"==d[0]&&"\u00b4"==d[d.length-1]&&(a.ignoreAcents=!0,d=d.substring(1,d.length-1)));"`"==d[0]&&"\u00b4"==d[d.length-1]&&(a.ignoreAcents=!0,
d=d.substring(1,d.length-1),d[0]==d[d.length-1]&&"'"==d[0]&&(a.ignoreCaps=!0,d=d.substring(1,d.length-1)));"*"==d[0]&&"*"!=d[d.length-1]&&(d=d.substring(1)+"$");"*"!=d[0]&&"*"==d[d.length-1]&&(d="^"+d.substring(0,d.length-1));"*"==d[0]&&"*"==d[d.length-1]&&(d=d.substring(1,d.length-1));d=d.replace(/\?/g,"[\\S\\s]{1}");a.regExp=d;return a};a.buildRegularExpresionsPatterns=function(d){d=d.replace(/&squot;/g,"'").replace(/&amp;/g,"&").split("|");for(var c,e,f=0,l=d.length;f<l;f++){c=d[f].split("&");
e=[];for(var m=0,q=c.length;m<q;m++)e.push(a.buildSimpleRegularExpressionPattern(c[m]));d[f]=e}return d};removeAcents=function(a){a=a.toString();return a.replace(/\u00e1/g,"a").replace(/\u00e9/g,"e").replace(/\u00ed/g,"i").replace(/\u00f3/g,"o").replace(/\u00fa/g,"u").replace(/\u00c1/g,"A").replace(/\u00c9/g,"E").replace(/\u00cd/g,"I").replace(/\u00d3/g,"O").replace(/\u00da/g,"U").replace(/\u00f1/g,"n").replace(/\u00d1/g,"N")};a.escorrecto=function(d,c){var e=a.buildRegularExpresionsPatterns(d),f,
l;c=removeAcents(c).toLowerCase();for(var m=0,q=e.length;m<q;m++){f=e[m];l=!0;for(var p=0,n=f.length;p<n;p++)f[p].regExp=removeAcents(f[p].regExp).toLowerCase(),l=l&&!!c.match(f[p].regExp);if(l)return 1}return 0};a.esCorrecto=function(d,c){for(var e=a.buildRegularExpresionsPatterns(d),f,l,m=0,q=e.length;m<q;m++){f=e[m];l=!0;for(var p=0,n=f.length;p<n;p++)f[p].ignoreAcents&&(c=removeAcents(c),f[p].regExp=removeAcents(f[p].regExp)),f[p].ignoreCaps&&(c=c.toLowerCase(),f[p].regExp=f[p].regExp.toLowerCase()),
l=l&&!!c.match(f[p].regExp);if(l)return 1}return 0};a.getTextWidth=function(d,c){a.ctx.font=c;return a.ctx.measureText(d).width};a.getFieldFontSize=function(a){return 14>=a?8:14<a&&16>=a?9:16<a&&19>=a?10:19<a&&22>=a?11:22<a?parseInt(a-11):Math.floor(a-0.25*a)};a.getCreativeCommonsLicenseImage=function(){var a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAAfCAYAAABjyArgAAAABHNCSVQICAgIfAhkiAAACpVJREFUaIHtWm1sU9cZfu61iUYnPP/bJgdhhDbFkVYcCrR0tLHXrVNL01wvgUJDh820tivrkpQQtpEvA4HGhDoe/dCmNfbaVa1WKszX2oUO3xC0OHESm9Hi/FhloyQq1aY5OGgq8ce7H9f3xI7txKFsdKyPdHSPz8dzz33Oe77eY46IVBzHXcUXuOkgIo4DQABwuucUeJ4Hz/NQKBTgeQUUPA9ekXryPDiOB89x4DgO4DiZBQQCJQlJSiKZlEIikZCeyQQSiSSSyQTLS1KSlSciuTEsfjtgY+UmAAAHgGRxFQqFFHjFTFyhkPJ4RUpkDhzHp+ubEiclbFISM5FIhfR4IlPkZDLJhE0X+nbBxspNUALIFFehhDLjKYWTx0/B4/FgcHAQU9GpDKIlqiVYu3YtjN8xouLRR5BIKsDzcalDEjw4cJD6cgaUJGkkANIY4iRxR3x+uN9xIxgMZpTX6XQQqgSsWlNW0Md9Xng4APSns+9BqVQyUZVKpRQUSvSK52B73oaJiYmCGqTRaND4i0aUl9+PeCKBRCKOeDwVEnHE4wlm4emW/PHExzjS9SJGg6MAAIPBAL1eDwAIBAIQRREAUKIrwY7aHfja17+a8/1XPv4ELzle+lzwbKzcJAn8fu8ZKBXKGWGVi7BIqURrcxvcx9ysglqthiAI0Gq1KC8vBwD09vYiHA7D7XZjcnKSlRVMAhoad2LxHYsRj8cRi8cRj8cQj8czpwxK4mrkKn769LOIRqMQBAF2ux1arTajseFwGPX19XC73VCpVGi3tWd91LXoNdTuqPvc8MjzMJ3tO0t9/eeo39dPQwEfXfggQIJJIEiDl9RqNbW1tVEkEqG54HQ6Sa1Ws3oluhI6399HQ4Eh8g71U1//OfL0naUzYg+99+d36XTPKTrx7nHS6XQEgMxmcwafzDP7HTL328f/kBFKdCU5eRx2Oz3+2ObPxDM2Nkbe/n7y9vfT2NhYQTwAiAcARWoOVioUUCoyLVev18Pv96O1tRVqtTprGKTDbDYjFAqxoTQaHEWn7XDGXM6zHYm0G/F5fQgGgxAEAY27ds3JL79DEASMBkcx4vOz9BGfH6PBUawqK8O996xj6b/q6sLzNhtOnj6N3Q27MD4+XhBPent+/9prMKy/DzWbt6Bm8xYY1t+HMz09c/Kkg/q8feQd8tLIhWFyHHEwy9Hr9fNabS5EIhHS6/WMx/Gig0b+OkIDw1467+0jz3nJit99/4+kK5WsNxQKFcwfCoUIAOl0OmYt8igo+cY3acUyLZV/ez09/eMnCQC1tbXRwQMHCQAdffvtgnjk9nj7+yW+u9fRj7ZZqHFnA61YpqUVy7TksNvz8uSwYMmKbc/bAEjzrdPpnNdqc0GtVsPj8bC6toO21F46ZcFcak/N8wheCsJgMGTNcRaLhVm5xWLJyNNqtTAYDBkrezAo8VRUVGDjpk0YHx/HmZ4erFimxb+mrmHrE1tx6cMPUVVdXRCPVqtFNBpF0H8RAFAp/AC/dXWjo/MQ9rQ0AwBc3c68PDJ4AKlhK23F5N1CXV0dG+o3ArVaDbvdDgCYmJjAyROn2IFFEplj27Rc73G5XDnjMnLV0ev1sB3uxEFbB954601UVVfjo8th2A53YunSpXB1OxG8dKkgHhntL0gG95vfvcrSvvfggwCAaDSKT65cycsDpASWrcnj8QCQxKmtrWWFRFGEyWSC0WiE0WiE1WrNm9fV1cXyzGYzs2LPWU+a9XLg+BmB/xO4+5570NF5CGNjY2jc2YCyb92Jd44eRcXDG1CzeQubQ+eCSqWCw+HAHaoleOWVV3KW+fTT63NySAcNjgPPcRgcHAQACILAhBFFEUajMaOSKIoQRRG1tbUwmUxZeRcuXIDT6WRcLpcLg4OD0gkwJawkriRwIBDIapjZbGaWazabs/Jz1ZmdFo1GcaanBx2dh2C+ZEHFwxsAAANeLwa8XhQXF4NbpJyTZ5FSicaGBtyxeDFLG/B6WXyZdlne9gDMgqUPlk9oK1euZAXq6+sBSPNMKBSCx+OBVqvFtm3bmCXr9XqEQiEcO3YsY48MgMWnolPSe8ClPYHS0lKIoohwOJzRMLmDZscBaQ8qiiJ0Oh1L0+l0WTw/efIptO/dh1V3rkTN5i346HIYVdXV6Og8hJqtWwviGR8fR1tLKx5/bDPa9+5D+959aGlqAgDs2r07b3syBAaHjOGaPp/IPWM2m9lkHgqFYDabWZ58+BAEgeXJSF+8JKPNPDZvfExadOSOLARyWaFKYGlyPJ2no/MQLNu348o//o6/hUJw2O3Y09KMqupqWPfvQ9ma1fPyWLZvh2X7dgCAs7sbzu5uXP/0OjZUPIItNY/nbY+M7PHxX8a69eugK9XB7XbDYrFkWetsyKenEl1Jhh9g1ZoylOhKMniKi4uxp6UZX1q8GCPDw/hZXd0N8expacb3H3oIly+HAUijTldaOiePDMmCKdOLlT6fyNbscrkwOTmJQCCA5cuXw2q1sjz5mJyeJyN9yEpnM3l7PIPmtmaoVCq4XC6YTCZWh9K8bOFwGCaTCV1dXVCpVNhRuyPrY3b/sjEnz85dDXjjrTc/E8/qNatRVV2Nqupq6EpLC+IBUs4e38ggioqKsP7e+zAVnYLZbGaW5Ha7sxYyQJoyKisr8+bJ9evr69HV1YUlqiU4/5c+TE9PYzo2jVg8hlgsLjmDEnFE/jmJA9YDbC+p1+uh1+uhVqshiiLr9PmcNNei19BxwMacNLeShzl7BoYHUFRUBGuLFe5jbqjVakQiEVZQFEU4HA7mzDEYDGhtbWUd4HA4WNn0PABYvnw5wuEwHvjuAzhs78T16WnEZgks+42TiSR8Az4cO3rr3Yw3g4cJ7B3qx6JFRTh/7jxqn5X2v3a7HXVpc9aNwOVysVPY/gP78fCGhzAdm8Z0LIZ4LIZYfJbAORzw/8vYWLlJmoPlKx2DsRwajQYAYLVas7ZOC8Hk5CRbXTUaTcoRn7rFSCaRTM3FlLpyul3BA0CSkkgkpHu0fe17AUgCmUymDB9voZicnITRaGR1G3/emHKwJ2ZETrsyYovsrMX2dgEBoKbWJvKNDFLgop+e+OETGR41v9+/IE9XuidNMAkUuOgn38gg7W3fy9L/j8LMj7rnamnI76PADTjcI5EItbW1ZTjc16xdQxc+CNBQwEdNrU23+kNvSWDX9jKaW5tQaRKgVCpx2HYYr7/2Ostb6JWRdV8b4vE4BgYG8cxTz2A+pE8P8smSiDJOmbN/5+PJV0d+R6GOpnxtWhDH7NDc2iRZ8kU/dbteJY1GU3CPaTQachxxUOCin4YCPnr51y8XXJeI5oynp83HM1/9QrhylVkoR5YFy6h7rhY1W2vYVY/o6cWJ4yfmvLZ/VHgUBkM5u9A8fvwE9lv3F9DHEnJZS3reQqyO47i8z4VgtrXOXoTn48srMACsuqsMza0tKF6qSbuNSHc3ImPfKv/xZGJ8HC902nGu99yCP+azTA35eABkCbxQsXN1UiEccwos4/7y+7GhYgPuWn0XvqJSpf46Jb9ZetHVaBTDQ8M4ffL0goVN/wjWsJtgwbl+L2T+nG9NuGkCf4EbB09EX77VjbhdQUTcvwFtwhQyXNo3TwAAAABJRU5ErkJggg==";
return a};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.addCSSrules=function(){var a=document.createElement("meta");a.setAttribute("name","viewport");a.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes");document.head.appendChild(a);(a=document.getElementById("StyleDescartesApps2"))&&a.parentNode.removeChild(a);a=document.createElement("style");a.type="text/css";a.id="StyleDescartesApps2";a.setAttribute("rel","stylesheet");
document.head.appendChild(a);a.innerHTML="div.DescartesAppContainer{ border: 0px solid black; position: relative; overflow: hidden; top: 0px; left: 0px; }\ndiv.DescartesLoader{ background-color : #efefef; position: absolute; overflow: hidden; -moz-box-shadow: 0px 0px 0px #888; -webkit-box-shadow: 0px 0px 100px #888; box-shadow: 0px 0px 100px #888; background-image: linear-gradient(bottom, rgb(187,187,187) 0%, rgb(239,239,239) 50%, rgb(187,187,187) 100%); background-image: -o-linear-gradient(bottom, rgb(187,187,187) 0%, rgb(239,239,239) 50%, rgb(187,187,187) 100%); background-image: -moz-linear-gradient(bottom, rgb(187,187,187) 0%, rgb(239,239,239) 50%, rgb(187,187,187) 100%); background-image: -webkit-linear-gradient(bottom, rgb(187,187,187) 0%, rgb(239,239,239) 50%, rgb(187,187,187) 100%); background-image: -ms-linear-gradient(bottom, rgb(187,187,187) 0%, rgb(239,239,239) 50%, rgb(187,187,                   187) 100%); top: 0px; left: 0px; }\ndiv.DescartesLoaderImage{ background-repeat: no-repeat; background-position: center; position: absolute; overflow: hidden; top: 0px; left: 0px; }\ncanvas.DescartesLoaderBar{ position: absolute; overflow: hidden; top: 0px; left: 0px; }\ncanvas.DescartesSpace2DCanvas, canvas.DescartesSpace3DCanvas, div.blocker{ position: absolute; overflow: hidden; left: 0px; top: 0px; }\ndiv.DescartesSpace2DContainer, div.DescartesSpace3DContainer{ position: absolute; overflow: hidden; line-height: 0px; }\ncanvas.DescartesButton{ position: absolute; cursor: pointer; }\ndiv.DescartesSpinnerContainer, div.DescartesTextFieldContainer{ background: lightgray; position: absolute; overflow: hidden; }\ninput.DescartesSpinnerField, input.DescartesTextFieldField, input.DescartesMenuField, input.DescartesScrollbarField{ font-family: Arial; padding: 0px; border: solid #666666 1px; position: absolute; top: 0px; }\nlabel.DescartesSpinnerLabel, label.DescartesMenuLabel, label.DescartesScrollbarLabel, label.DescartesTextFieldLabel{ font-family: Arial; font-weight: normal; text-align: center; text-overflow: ellipsis; white-space: nowrap; overflow: hidden; background-color: #e0e4e8; position: absolute; left: 0px; top: 0px; }\ndiv.DescartesGraphicControl{ border-style: none; position: absolute; }\ndiv.DescartesTextAreaContainer{ position: absolute; overflow: hidden; background: #c0d0d8; }\nselect.DescartesMenuSelect{ font-family: Arial; padding-top: 0%; text-align: center; text-overflow: ellipsis; white-space: nowrap; overflow: hidden; background-color: white; position: absolute; left: 0px; top: 0px; }\ndiv.DescartesScrollbarContainer{ background: #eeeeee; overflow: hidden; position: absolute; }\n"};
a.addCSSrules();return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.sin,c=Math.floor,f=Math.random,e=Math.round,h=String.fromCharCode;a.Krypto=function(a){this.key=(a||0).toString()};a.Krypto.prototype.getKey=function(a){for(var e=Array(256),f=0;256>f;f++)e[f]=h(this.alfanum(c(Math.abs(7.5*(d(1*f-a)+d(1.4*f+a)+d(0.6*f-a)+d(2.2*f+a))))));return e.join("")};a.Krypto.prototype.encode=function(a){var d=c(31*f());this.key=this.getKey(d);return h(this.alfanum(d))+this.encripta(a)};
a.Krypto.prototype.decode=function(a){var d=this.numalfa(a.charCodeAt(0));this.key=this.getKey(d);return this.desencripta(a.substring(1))};a.Krypto.prototype.encripta=function(a){return this.bytesToString(this.encriptaAux(this.stringToBytes(a)))};a.Krypto.prototype.encriptaAux=function(a){if(null==a||null==this.key)return null;for(var d=Array(3*a.length),h,l=0,m=a.length;l<m;l++)h=256*c(a[l]+128)+e(255*f())+65536*e(255*f()),h=c((h<<this.shift(l))/256),d[3*l]=this.alfanum(h%32),d[3*l+1]=this.alfanum(h/
32%32),d[3*l+2]=this.alfanum(h/1024%32);return d};a.Krypto.prototype.desencripta=function(a){return this.bytesToString(this.desencriptaAux(this.stringToBytes(a)))};a.Krypto.prototype.desencriptaAux=function(a){if(null==a||null==this.key)return null;for(var d=Array(a.length/3),f,e=0,h=d.length;e<h;e++)f=this.numalfa(a[3*e])+32*this.numalfa(a[3*e+1])+1024*this.numalfa(a[3*e+2]),f=c(256*f>>this.shift(e)),f=c(f/256)%256-128,0>f&&(f+=256),d[e]=f;return d};a.Krypto.prototype.alfanum=function(a){a=c(a);
return 10>a?48+a:87+a};a.Krypto.prototype.numalfa=function(a){return 58>a?a-48:a-87};a.Krypto.prototype.stringToBytes=function(a){for(var d=Array(a.length),c=0,f=a.length;c<f;c++)d[c]=a.charCodeAt(c);return d};a.Krypto.prototype.bytesToString=function(a){for(var d=0,c=a.length;d<c;d++)a[d]=h(a[d]);return a.join("")};a.Krypto.prototype.shift=function(a){a=this.key.charCodeAt(a%this.key.length);a=this.numalfa(a);a=c(a/2%8);0==a&&(a=4);return a};a.Krypto.prototype.parseByte=function(a){a=parseInt(a);
a=0>a?0:a;return 255<a?255:a};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Animation=function(d,c){this.parent=d;var f=d.evaluator,e=f.parser,h=new a.Auxiliary(d);this.delay=c.delay?e.parse(c.delay):e.parse("60");this.loop=c.loop?c.loop:!1;this.auto=void 0==c.auto&&2==this.parent.version?!0:c.auto;this.controls=c.controls;this.init=h.splitInstructions(e,c.init);this.doExpr=h.splitInstructions(e,c.doExpr);c.whileExpr&&(this.whileExpr=e.parse(c.whileExpr));var g=this;this.animationExec=
function(){for(var a=0,d=g.doExpr.length;a<d;a++)f.evalExpression(g.doExpr[a]);g.parent.update();g.playing&&(0<f.evalExpression(g.whileExpr)||g.loop)?g.timer=setTimeout(g.animationExec,f.evalExpression(g.delay)):(g.stop(),g.parent.update())};this.playing=!1;this.auto&&this.play()};a.Animation.prototype.play=function(){this.playing?this.stop():(this.reinit(),this.playing=!0,this.timer=setTimeout(this.animationExec,this.parent.evaluator.evalExpression(this.delay)))};a.Animation.prototype.stop=function(){this.playing=
!1;clearInterval(this.timer)};a.Animation.prototype.reinit=function(){for(var a=0,c=this.init.length;a<c;a++)this.parent.evaluator.evalExpression(this.init[a])};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Action=function(a){this.parent=a;this.evaluator=this.parent.evaluator};a.Action.prototype.execute=function(){};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Message=function(d,c){a.Action.call(this,d,c);this.parameter=c};a.extend(a.Message,
a.Action);a.Message.prototype.execute=function(){alert(this.parameter)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Calculate=function(d,c){a.Action.call(this,d,c);var f=this.evaluator,e=f.parser;this.parameter=c.replace(/&squot;/g,"'");this.parameter=this.parameter.replace(/;/g,"\\n");this.parameter=this.parameter.split("\\n")||[""];for(var h=[],g,j=0,k=this.parameter.length;j<k;j++)(g=e.parse(this.parameter[j],!0))&&h.push(g);this.parameter=h;this.actionExec=function(){for(var a=
0,d=this.parameter.length;a<d;a++)f.evalExpression(this.parameter[a])}};a.extend(a.Calculate,a.Action);a.Calculate.prototype.execute=function(){this.actionExec()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.OpenURL=function(d,c){a.Action.call(this,d,c);this.parameter=c;this.target="_blank";var f=this.parameter.indexOf("target");-1!=f&&(this.target=this.parameter.substring(f),this.target=this.target.substring(this.target.indexOf("=")+1),this.parameter=this.parameter.substring(0,
f-1));"javascript"==this.parameter.substring(0,10)?(this.javascript=!0,this.parameter=this.parameter.substring(11).replace(/&squot;/g,"'"),this.actionExec=function(){eval(this.parameter)}):("http://"!=this.parameter.substring(0,7)&&(this.parameter=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+this.parameter),this.actionExec=function(){window.open(this.parameter,this.target)})};a.extend(a.OpenURL,a.Action);a.OpenURL.prototype.execute=function(){this.actionExec()};return a}(descartesJS||
{}),descartesJS=function(a){if(a.loadLib)return a;a.OpenScene=function(d,c){a.Action.call(this,d,c);this.parameter=c;this.target="_blank";this.target="popup";var f=this.parameter.indexOf("target");-1!=f&&(this.target=this.parameter.substring(f),this.target=this.target.substring(this.target.indexOf("=")+1),this.parameter=this.parameter.substring(0,f-1));"javascript"==this.parameter.substring(0,10)?(this.javascript=!0,this.parameter=this.parameter.substring(11).replace(/&squot;/g,"'"),this.actionExec=
function(){eval(this.parameter)}):"http://"!=this.parameter.substring(0,7)?(this.parameter=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+this.parameter,this.actionExec=function(){this.window=window.open(this.parameter,this.target,"width="+this.parent.width+",height="+this.parent.height+",left="+(window.screen.width-this.parent.width)/2+", top="+(window.screen.height-this.parent.height)/2+"location=no,menubar=no,scrollbars=no,status=no,titlebar=no,toolbar=no");this.window.onload=
function(){try{var a=this.window.document,d=a.getElementsByTagName("applet");d&&0<d.length&&(this.window.innerWidth=d[0].width,this.window.height=d[0].height,a.style.margin="0px",a.style.padding="0px")}catch(c){}}}):this.actionExec=function(){this.window=window.open(this.parameter,this.target)}};a.extend(a.OpenScene,a.Action);a.OpenScene.prototype.execute=function(){this.actionExec()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.About=function(d,c){a.Action.call(this,
d,c);this.urlAbout=null;""!=c&&(this.urlAbout=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+c)};a.extend(a.About,a.Action);a.About.prototype.execute=function(){console.log(this.urlAbout);if(this.urlAbout)var a=window.open(this.urlAbout,"_blank","width=800px,height=600px,location=no,menubar=no,scrollbars=yes");else a=window.open("about:blank","_blank","width=800px,height=600px,location=no,menubar=no,scrollbars=yes"),a.document.write("<hmtl><head><title>Cr\u00e9ditos</title></head><body><h1>Aqu\u00ed van los cr\u00e9ditos</h1></body></html>")};
return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Config=function(d,c){a.Action.call(this,d,c)};a.extend(a.Config,a.Action);a.Config.prototype.execute=function(){window.open("about:blank","_blank","width=800px,height=600px,location=no,menubar=no,scrollbars=yes").document.write("<xmp style='width:100%; height:100%;'>"+this.parent.applet.outerHTML+"</xmp>")};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Init=function(d,c){a.Action.call(this,d,c)};
a.extend(a.Init,a.Action);a.Init.prototype.execute=function(){this.parent.init()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Clear=function(d,c){a.Action.call(this,d,c)};a.extend(a.Clear,a.Action);a.Clear.prototype.execute=function(){this.parent.clear()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Animate=function(d,c){a.Action.call(this,d,c)};a.extend(a.Animate,a.Action);a.Animate.prototype.execute=function(){this.parent.play()};return a}(descartesJS||
{}),descartesJS=function(a){if(a.loadLib)return a;a.InitAnimation=function(d,c){a.Action.call(this,d,c)};a.extend(a.InitAnimation,a.Action);a.InitAnimation.prototype.execute=function(){this.parent.reinitAnimation()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.PlayAudio=function(d,c){a.Action.call(this,d,c);this.filenameExpr=this.evaluator.parser.parse("'"+c.split(" ")[0].trim()+"'");this.filename=this.evaluator.evalExpression(this.filenameExpr);this.theAudio=this.parent.getAudio(this.filename)};
a.extend(a.PlayAudio,a.Action);a.PlayAudio.prototype.execute=function(){this.filename=this.evaluator.evalExpression(this.filenameExpr);theAudio=this.parent.getAudio(this.filename);theAudio.paused?theAudio.play():(theAudio.pause(),theAudio.currentTime=0.1)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Auxiliary=function(a,c){this.parent=a;this.evaluator=this.parent.evaluator;var f=a.evaluator.parser;this.expresion=this.id="";this.evaluate="onlyOnce";this.size=f.parse("3");
this.rows=f.parse("3");this.columns=f.parse("3");for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e])};a.Auxiliary.prototype.firstRun=function(){};a.Auxiliary.prototype.update=function(){};a.Auxiliary.prototype.splitInstructions=function(a,c){var f,e=[];c=c?c.split(";"):[""];for(var h=0,g=c.length;h<g;h++)(f=a.parse(c[h],!0))&&e.push(f);return e};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Variable=function(d,c){a.Auxiliary.call(this,d,c);var f=this.evaluator.parser;this.expresionString=
this.expresion;(this.expresion=f.parse(this.expresionString))&&f.setVariable(this.id,this.expresion);this.editable&&this.registerTextField()};a.extend(a.Variable,a.Auxiliary);a.Variable.prototype.registerTextField=function(){var a=document.createElement("div"),c=document.createElement("label");c.appendChild(document.createTextNode("_"+this.id+"=_"));var f=document.createElement("input");f.value=this.expresionString;f.disabled=!this.editable;a.appendChild(c);a.appendChild(f);var e=this;f.onkeydown=
function(a){13==a.keyCode&&(e.expresion=e.evaluator.parser.parse(this.value),e.evaluator.parser.setVariable(e.id,e.expresion),e.parent.update())};this.parent.editableRegion.textFields.push({container:a,type:"div"})};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Constant=function(d,c){a.Auxiliary.call(this,d,c);this.expresion=this.evaluator.parser.parse(this.expresion);this.update()};a.extend(a.Constant,a.Auxiliary);a.Constant.prototype.update=function(){this.evaluator.setVariable(this.id,
this.evaluator.evalExpression(this.expresion))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Vector=function(d,c){a.Auxiliary.call(this,d,c);var f=this.evaluator,e=f.parser;this.expresion=this.expresion.split(";");var h;if(this.file){var g=document.getElementById(this.file);g&&"descartes/vectorFile"==g.type?(h=g.text,"\n"==h[0]&&(h=h.substring(1))):h=a.openExternalFile(this.file);null!=h&&(h=h.split("\n"));null==h||1==h.length&&""==h[0]?(h=[],this.size=0):(this.expresion=
[],this.size=null);for(var j,k=0,g=0,l=h.length;g<l;g++)h[g].match(/./)&&(this.expresion[k]=this.id+"["+k+"]="+h[g],k++,(j=h[g].match(/[\w-//]*(.png|.jpg|.gif|.svg|.PNG|.JPG|.GIF|.SVG)/g))&&this.parent.getImage(j));null==this.size&&(this.size=e.parse(this.expresion.length+""))}g=0;for(l=this.expresion.length;g<l;g++)(h=e.parse(this.expresion[g],!0))&&"asign"!=h.type&&(h=e.parse(this.id+"["+g+"]="+this.expresion[g],!0)),this.expresion[g]=h;l=f.evalExpression(this.size);e=[];for(g=0;g<l;g++)e.push(0);
f.vectors[this.id]=e;this.update()};a.extend(a.Vector,a.Auxiliary);a.Vector.prototype.update=function(){var a=this.evaluator;a.setVariable(this.id+".long",a.evalExpression(this.size));for(var c=0,f=this.expresion.length;c<f;c++)a.evalExpression(this.expresion[c])};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Matrix=function(d,c){a.Auxiliary.call(this,d,c);var f=this.evaluator;this.expresion=this.splitInstructions(f.parser,this.expresion);var e=f.evalExpression(this.rows),
h=f.evalExpression(this.columns),g=[];g.type="matrix";for(var j,k=0;k<h;k++){j=[];for(var l=0,m=e;l<m;l++)j.push(0);g[k]=j}f.matrices[this.id]=g;this.update()};a.extend(a.Matrix,a.Auxiliary);a.Matrix.prototype.update=function(){var a=this.evaluator,c=a.evalExpression(this.rows),f=a.evalExpression(this.columns);a.setVariable(this.id+".filas",c);a.setVariable(this.id+".columnas",f);var e=a.matrices[this.id];e.rows=c;e.cols=f;c=0;for(f=this.expresion.length;c<f;c++)a.evalExpression(this.expresion[c])};
return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Function=function(d,c){a.Auxiliary.call(this,d,c);var f=this.evaluator,e=f.parser,h=this.id.indexOf("(");this.name=this.id.substring(0,h);this.params=this.id.substring(h+1,this.id.length-1);this.domain=this.range?e.parse(this.range):e.parse("1");this.params=""==this.params?[]:this.params.split(",");this.numberOfParams=this.params.length;this.init=this.splitInstructions(e,this.init);this.doExpr=this.splitInstructions(e,this.doExpr);
this.whileExpr&&(this.whileExpr=e.parse(this.whileExpr));this.expresion=e.parse(this.expresion);var g=this;this.functionExec=this.algorithm?function(){if(g.numberOfParams==arguments.length){for(var d=[],c=0,e=g.params.length;c<e;c++)d[c]=f.getVariable(g.params[c]),f.setVariable(g.params[c],arguments[c]);c=0;for(e=g.init.length;c<e;c++)f.evalExpression(g.init[c]);do{c=0;for(e=g.doExpr.length;c<e;c++)f.evalExpression(g.doExpr[c])}while(0<f.evalExpression(g.whileExpr));var h=f.evalExpression(g.expresion);
a.rangeOK=f.evalExpression(g.domain);c=0;for(e=g.params.length;c<e;c++)f.setVariable(g.params[c],d[c]);return h}return 0}:function(){if(g.numberOfParams==arguments.length){for(var d=[],c=0,e=g.params.length;c<e;c++)d[c]=f.getVariable(g.params[c]),f.setVariable(g.params[c],arguments[c]);var h=f.evalExpression(g.expresion);a.rangeOK=f.evalExpression(g.domain);c=0;for(e=g.params.length;c<e;c++)f.setVariable(g.params[c],d[c]);return h}return 0};f.setFunction(this.name,this.functionExec)};a.extend(a.Function,
a.Auxiliary);return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.AuxSequence=function(d,c){a.Auxiliary.call(this,d,c);var f=this.evaluator,e=f.parser,h=this.id.indexOf("(");this.name=this.id.substring(0,h);this.params=this.id.substring(h+1,this.id.length-1);this.domain=this.range?e.parse(this.range):e.parse("1");this.params=""==this.params?[]:this.params.split(",");this.numberOfParams=this.params.length;this.init=this.splitInstructions(e,this.init);this.doExpr=this.splitInstructions(e,
this.doExpr);this.whileExpr&&(this.whileExpr=e.parse(this.whileExpr));this.expresion=e.parse(this.expresion);var g=this;this.functionExec=this.algorithm?function(){if(g.numberOfParams==arguments.length){for(var d=[],c=0,e=g.params.length;c<e;c++)d[c]=f.getVariable(g.params[c]),f.setVariable(g.params[c],arguments[c]);c=0;for(e=g.init.length;c<e;c++)f.evalExpression(g.init[c]);do{c=0;for(e=g.doExpr.length;c<e;c++)f.evalExpression(g.doExpr[c])}while(0<f.evalExpression(g.whileExpr));var h=f.evalExpression(g.expresion);
a.rangeOK=f.evalExpression(g.domain);c=0;for(e=g.params.length;c<e;c++)f.setVariable(g.params[c],d[c]);return h}return 0}:function(){if(g.numberOfParams==arguments.length){for(var d=[],c=0,e=g.params.length;c<e;c++)d[c]=f.getVariable(g.params[c]),f.setVariable(g.params[c],arguments[c]);var h=f.evalExpression(g.expresion);a.rangeOK=f.evalExpression(g.domain);c=0;for(e=g.params.length;c<e;c++)f.setVariable(g.params[c],d[c]);return h}return 0};f.setFunction(this.name,this.functionExec)};a.extend(a.AuxSequence,
a.Auxiliary);return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Algorithm=function(d,c){a.Auxiliary.call(this,d,c);var f=this.evaluator,e=f.parser;this.init=this.splitInstructions(e,this.init);this.doExpr=this.splitInstructions(e,this.doExpr);this.whileExpr&&(this.whileExpr=e.parse(this.whileExpr));this.algorithmExec=function(){for(var a=0,d=this.init.length;a<d;a++)f.evalExpression(this.init[a]);do{a=0;for(d=this.doExpr.length;a<d;a++)f.evalExpression(this.doExpr[a])}while(0<
f.evalExpression(this.whileExpr))}};a.extend(a.Algorithm,a.Auxiliary);a.Algorithm.prototype.update=function(){this.algorithmExec();"onlyOnce"==this.evaluate&&(this.update=function(){})};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Event=function(d,c){a.Auxiliary.call(this,d,c);var f=this.evaluator;this.condition=f.parser.parse(this.condition);this.lastEvaluation=!1;this.action=this.parent.lessonParser.parseAction(this);"onlyOnce"==this.execution&&(this.eventExec=function(){0<
f.evalExpression(this.condition)&&!this.lastEvaluation&&(this.lastEvaluation=!0,this.action.execute())});"alternate"==this.execution&&(this.eventExec=function(){var a=0<f.evalExpression(this.condition);3==this.parent.version?a!=this.lastEvaluation&&(this.action.execute(),this.lastEvaluation=a?!0:!1):a&&!this.lastEvaluation?(this.action.execute(),this.lastEvaluation=!0):!a&&this.lastEvaluation&&(this.lastEvaluation=!1)});"always"==this.execution&&(this.eventExec=function(){0<f.evalExpression(this.condition)&&
this.action.execute()})};a.extend(a.Event,a.Auxiliary);a.Event.prototype.update=function(){this.eventExec()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Graphic=function(d,c){this.parent=d;var f=this.parent.evaluator.parser;this.evaluator=d.evaluator;this.spaceID="E0";this.type="";this.background=!1;2!=this.parent.version?(this.color="#20303a",this.parent.arquimedes&&(this.color="black")):this.color="blue";this.drawif=f.parse("1");this.abs_coord=!1;this.family=this.trace=
"";this.family_interval=f.parse("[0,1]");this.family_steps=f.parse("8");this.parameter="t";this.parameter_interval=f.parse("[0,1]");this.parameter_steps=f.parse("8");this.fillM=this.fillP=this.fill="";this.width=-1;this.editable=!1;this.info="";this.font="Monospaced,PLAIN,12";this.fixed=!0;this.size=f.parse("2");this.text="";this.decimals=f.parse("2");this.spear=f.parse("8");this.arrow="#ee0022";this.center=f.parse("(0,0)");this.radius=f.parse("1");this.init=f.parse("0");this.end=f.parse("90");this.file=
"";this.inirot=f.parse("0");for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e]);void 0==this.expresion&&"macro"!=this.type&&(this.expresion=f.parse("(0,0)"));this.space=this.getSpace();this.canvas=this.background?this.space.backgroundCanvas:this.space.canvas;this.ctx=this.canvas.getContext("2d");this.trace&&(this.traceCtx=this.space.backgroundCanvas.getContext("2d"));this.font=a.convertFont(this.font)};a.Graphic.prototype.getSpace=function(){for(var a=this.parent.spaces,c,f=0,e=a.length;f<e;f++)if(c=
a[f],c.id==this.spaceID)return c;return a[0]};a.Graphic.prototype.getFamilyValues=function(){var a=this.evaluator,c=a.evalExpression(this.family_interval);this.familyInf=c[0][0];this.familySup=c[0][1];this.fSteps=Math.round(a.evalExpression(this.family_steps));this.family_sep=0<this.fSteps?(this.familySup-this.familyInf)/this.fSteps:0};a.Graphic.prototype.drawFamilyAux=function(a,c,f){var e=this.evaluator;this.getFamilyValues();var h=e.getVariable(this.family);if(0<=this.fSteps)for(var g=0,j=this.fSteps;g<=
j;g++)e.setVariable(this.family,this.familyInf+g*this.family_sep),0<e.evalExpression(this.drawif)&&(this.update(),this.drawAux(a,c,f));e.setVariable("_Text_H_",0);e.setVariable(this.family,h)};a.Graphic.prototype.draw=function(a,c){""!=this.family?this.drawFamilyAux(this.ctx,a,c):0<this.evaluator.evalExpression(this.drawif)&&(this.update(),this.drawAux(this.ctx,a,c))};a.Graphic.prototype.drawTrace=function(a,c){""!=this.family?this.drawFamilyAux(this.traceCtx,a,c):0<this.evaluator.evalExpression(this.drawif)&&
(this.update(),this.drawAux(this.traceCtx,a,c))};a.Graphic.prototype.drawText=function(d,c,f,e,h,g,j,k,l,m){if("rtfNode"==c.type)d.fillStyle=h,d.strokeStyle=h,d.textBaseline="alphabetic",c.draw(d,f,e,l,m,j);else{"simpleText"===c.type&&(c=c.toString(l,m).split("\\n"));f+=g.match("Arial")?-2:g.match("Times")?-2:0;l=this.evaluator;d.fillStyle=a.getColor(l,h);d.font=g;d.textAlign=j;d.textBaseline=k;this.fontSize=(this.fontSize=g.match(/(\d+)px/))?this.fontSize[1]:"10";this.border&&(d.strokeStyle=a.getColor(l,
this.border),d.lineWidth=parseFloat(this.fontSize)/12);g=1.2*this.fontSize;j=0;for(k=c.length;j<k;j++)h=c[j],this.border&&d.strokeText(h,f,e+g*j),d.fillText(h,f,e+g*j)}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.SimpleText=function(a,c){this.text=a;this.textElements=[];this.textElementsMacros=[];this.parent=c;this.evaluator=c.evaluator;this.type="simpleText";for(var f="'",e=0,h=0,g=-1,j,k;e<a.length;)j=a.charAt(e),k=a.charAt(e-1),"["===j&&"\\"===k?(this.textElements.push(a.substring(h,
e-1)+"["),this.textElementsMacros.push("'"+a.substring(h,e-1)+"['"),h=e+1):"]"===j&&"\\"===k?(this.textElements.push(a.substring(h,e-1)+"]"),this.textElementsMacros.push("'"+a.substring(h,e-1)+"]'"),h=e+1):"["===j&&-1==g?(this.textElements.push(a.substring(h,e)),this.textElementsMacros.push("'"+a.substring(h,e)+"'"),h=e,g++):"["===j?g++:"]"===j&&0==g?(this.textElements.push(this.evaluator.parser.parse(a.substring(h,e+1))),this.textElementsMacros.push("["+a.substring(h,e+1)+"]"),h=e+1,g--):("]"==a.charAt(e)&&
(g=0>g?g:g-1),f+=a.charAt(e)),e++;this.textElements.push(a.substring(h,e));this.textElementsMacros.push("'"+a.substring(h,e)+"'")};a.SimpleText.prototype.toString=function(a,c){for(var f="",e,h=0,g=this.textElements.length;h<g;h++)"string"===typeof this.textElements[h]?f+=this.textElements[h]:(e=this.evaluator.evalExpression(this.textElements[h])[0][0],""!=e&&("string"==typeof e?f+=e:(e=parseFloat(e),e=c?e.toFixed(a):parseFloat(e.toFixed(a)),f+=e.toString().replace(".",this.parent.decimal_symbol))));
return f};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.floor,c=2*Math.PI;a.Equation=function(c,d){a.Graphic.call(this,c,d);this.width=-1==this.width?this.evaluator.parser.parse("1"):this.width;this.generateStroke();this.parseExpresion();(this.visible=2==this.parent.version&&void 0==this.visible?!0:!1)&&this.registerTextField()};a.extend(a.Equation,a.Graphic);a.Equation.prototype.parseExpresion=function(){if("compOperator"==this.expresion.type){var c=this.expresion.childs[0],
d=this.expresion.childs[1];"identifier"==c.type&&"y"==c.value&&!d.contains("y")?(this.funExpr=d,this.drawAux=this.drawAuxFunY):"identifier"==d.type&&"y"==d.value&&!c.contains("y")?(this.funExpr=c,this.drawAux=this.drawAuxFunY):"identifier"==c.type&&"x"==c.value&&!d.contains("x")?(this.funExpr=d,this.drawAux=this.drawAuxFunX):"identifier"==d.type&&("x"==d.value&&!c.contains("x"))&&(this.funExpr=d,this.drawAux=this.drawAuxFunX)}this.newt=new a.R2Newton(this.evaluator,this.expresion)};a.Equation.prototype.generateStroke=
function(){this.auxCanvas=document.createElement("canvas");var a=parseInt(this.evaluator.evalExpression(this.width));this.width_2=parseInt(a/2)||1;this.auxCanvas.setAttribute("width",a);this.auxCanvas.setAttribute("height",a);this.auxCtx=this.auxCanvas.getContext("2d");this.auxCtx.beginPath();this.auxCtx.arc(this.width_2,this.width_2,this.width_2,0,2*Math.PI,!1);this.auxCtx.fill()};a.Equation.prototype.update=function(){};a.Equation.prototype.draw=function(){""!=this.family?this.drawFamilyAux(this.ctx,
this.fill,this.color):(this.update(),this.drawAux(this.ctx,this.fill,this.color))};a.Equation.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.fill,this.trace)};var f,e,h,g,j,k,l,m,q,p,n,u,s,t,r,w,z,A,v,x,D,C,B;a.Equation.prototype.drawAux=function(c,y,G){c.lineWidth=1;f=this.evaluator;e=f.parser;h=this.space;a.getColor(f,this.color);c.fillStyle=G;g=f.evalExpression(this.width);g=d(g)/2;e.getVariable("x");e.getVariable("y");j=h.w;k=h.h;l=d(j/8);3>l&&(l=3);m=d(k/8);3>m&&(m=3);b=[];
q=new a.R2;p=new a.R2;n=new a.R2;for(B=d(m/2);B<k;B+=m)for(C=d(l/2);C<j;C+=l)if(this.abs_coord?(s=this.newt.findZero(new a.R2(C,B)),f.setVariable("x",s.x),f.setVariable("y",s.y),u=new a.R2(s.x,s.y)):(s=this.newt.findZero(new a.R2(h.getRelativeX(C),h.getRelativeY(B))),f.setVariable("x",s.x),f.setVariable("y",s.y),u=new a.R2(h.getAbsoluteX(s.x),h.getAbsoluteY(s.y))),t=d(u.ix()),r=d(u.iy()),!(0>t||t>=j||0>r||r>=k||b[t+r*h.w]))if(b[t+r*h.w]=!0,q.x=s.x,q.y=s.y,p.x=s.x,p.y=s.y,w=this.newt.getUnitNormal(),
!(0==w.x&&0==w.y)){w.rotL90();n.x=w.x;n.y=w.y;A=z=0;for(v=!1;2>A;){v&&(n.x=-w.x,n.y=-w.y,s.x=q.x,s.y=q.y,p.x=s.x,p.y=s.y,u=this.abs_coord?new a.R2(s.x,s.y):new a.R2(h.getAbsoluteX(s.x),h.getAbsoluteY(s.y)),t=u.ix(),r=u.iy(),v=!1,z=0);this.abs_coord?(s.x+=n.x,s.y+=n.y):(s.x+=n.x/h.scale,s.y+=n.y/h.scale);s=this.newt.findZero(s);f.setVariable("x",s.x);f.setVariable("y",s.y);n.x=s.x-p.x;n.y=s.y-p.y;n.normalize();if(0==n.x&&0==n.y)break;p.x=s.x;p.y=s.y;u=this.abs_coord?new a.R2(s.x,s.y):new a.R2(h.getAbsoluteX(s.x),
h.getAbsoluteY(s.y));x=d(u.ix());D=d(u.iy());if(x!=t||D!=r)if(t=x,r=D,0<=t&&t<j&&0<=r&&r<k)if(z=0,b[t+r*h.w])break;else b[t+r*h.w]=!0,a.rangeOK&&c.drawImage(this.auxCanvas,t-this.width_2,r-this.width_2);else v=!0,A++;else 4<++z&&(v=!0,A++)}}};a.Equation.prototype.drawAuxFunY=function(c){var d=this.evaluator,e=this.space,f=e.w,g=1/e.scale,h=e.getAbsoluteY(0),m=d.evalExpression(this.width),j=a.getColor(d,this.color),p=a.getColor(d,this.fillM),k=a.getColor(d,this.fillP);c.fillStyle=j;var n=e.getRelativeX(0),
q,l,u,s;d.setVariable("x",n);for(var r=e.getAbsoluteX(n),t=e.getAbsoluteY(d.evalExpression(this.funExpr)),v=0,w,z,x=1;x<f;x++){q=n+x*g;d.setVariable("x",q);l=d.evalExpression(this.funExpr);d.setVariable("y",l);u=e.getAbsoluteX(q);s=e.getAbsoluteY(l);w=Math.min(v,l);z=Math.max(v,l);w={min:w,max:z};if(void 0!==l&&(a.rangeOK&&d.evalExpression(this.drawif))&&!this.hasSingularity(g,q,"x",q-g,v,q,l,w)){if(this.fillM||this.fillP)c.lineWidth=1,c.strokeStyle=s>h?p:k,c.beginPath(),c.moveTo(u+0.5,s),c.lineTo(u+
0.5,h),c.stroke();c.lineWidth=m;c.strokeStyle=j;c.beginPath();c.moveTo(r,t);c.lineTo(u,s);c.stroke()}v=l||0;r=u;t=s}};a.Equation.prototype.drawAuxFunX=function(c){var d=this.evaluator,e=this.space,f=e.h,g=1/e.scale,h=e.getAbsoluteX(0),m=d.evalExpression(this.width),j=a.getColor(d,this.color),p=a.getColor(d,this.fillM),k=a.getColor(d,this.fillP);c.fillStyle=j;var n=e.getRelativeY(f),q,l,u,s;d.setVariable("y",n);for(var r=e.getAbsoluteX(d.evalExpression(this.funExpr)),t=e.getAbsoluteY(n),v=0,w,z,x=
1;x<f;x++){q=n+x*g;d.setVariable("y",q);l=d.evalExpression(this.funExpr);d.setVariable("x",l);u=e.getAbsoluteX(l);s=e.getAbsoluteY(q);w=Math.min(v,l);z=Math.max(v,l);w={min:w,max:z};if(void 0!==q&&(a.rangeOK&&d.evalExpression(this.drawif))&&!this.hasSingularity(g,q,"y",q-g,v,q,l,w)){if(this.fillM||this.fillP)c.lineWidth=1,c.strokeStyle=u>h?p:k,c.beginPath(),c.moveTo(u,s+0.5),c.lineTo(h,s+0.5),c.stroke();c.lineWidth=m;c.strokeStyle=j;c.beginPath();c.moveTo(r,t);c.lineTo(u,s);c.stroke()}v=l||0;r=u;
t=s}};a.Equation.prototype.hasSingularity=function(a,c,d,e,f,g,h,m){if(1E-12>Math.abs(g-e)||1E-8>Math.abs(g-e)&&Math.abs(h-f)>Math.abs(a))return!0;var j=!1,j=(e+g)/2;this.evaluator.setVariable(d,j);var p=this.evaluator.evalExpression(this.funExpr);m.min<=p&&p<=m.max?j=!1:(m.x=Math.min(m.min,p),m.y=Math.max(m.max,p),j=this.hasSingularity(a,c,d,e,f,j,p,m)||this.hasSingularity(a,c,d,j,p,g,h,m));this.evaluator.setVariable(d,c);return j};a.drawPixel=function(a,d,e,f){a.moveTo(d,e);a.arc(d,e,f,0,c,!1)};
a.Equation.prototype.registerTextField=function(){var a=document.createElement("input");a.value=this.expresionString;a.disabled=!this.editable;var c=this;a.onkeydown=function(a){13==a.keyCode&&(c.expresion=c.evaluator.parser.parse(this.value),c.parseExpresion(),c.parent.update())};this.parent.editableRegion.textFields.push(a)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Curve=function(d,c){a.Graphic.call(this,d,c);this.width=-1==this.width?this.evaluator.parser.parse("1"):
this.width;(this.visible=2==this.parent.version&&void 0==this.visible?!0:!1)&&this.registerTextField()};a.extend(a.Curve,a.Graphic);a.Curve.prototype.update=function(){var a=this.evaluator,c=a.evalExpression(this.parameter_interval);this.paraInf=c[0][0];this.paraSup=c[0][1];this.pSteps=a.evalExpression(this.parameter_steps);this.paraSep=0<this.pSteps?Math.abs(this.paraSup-this.paraInf)/this.pSteps:0};a.Curve.prototype.draw=function(){this.uber.draw.call(this,this.fill,this.color)};a.Curve.prototype.drawTrace=
function(){this.uber.drawTrace.call(this,this.fill,this.trace)};a.Curve.prototype.drawAux=function(d,c,f){var e=this.evaluator,h=this.space,g=this.evaluator.evalExpression(this.width);0>=g&&(g=1E-6);d.lineWidth=g;d.lineCap="round";d.lineJoin="round";d.fillStyle=a.getColor(e,c);d.strokeStyle=a.getColor(e,f);c=e.getVariable(this.parameter);d.beginPath();e.setVariable(this.parameter,this.paraInf);g=e.evalExpression(this.expresion);this.exprX=this.abs_coord?g[0][0]:h.getAbsoluteX(g[0][0]);this.exprY=
this.abs_coord?g[0][1]:h.getAbsoluteY(g[0][1]);var j,k,l;this.rotateExp&&(j=a.degToRad(this.evaluator.evalExpression(this.rotateExp)),k=Math.cos(j),j=Math.sin(j),g=this.exprX*k-this.exprY*j,l=this.exprX*j+this.exprY*k,this.exprX=g,this.exprY=l);d.moveTo(this.exprX+0.5,this.exprY+0.5);for(f=1;f<=this.pSteps;f++)e.setVariable(this.parameter,this.paraInf+f*this.paraSep),g=e.evalExpression(this.expresion),this.exprX=this.abs_coord?g[0][0]:h.getAbsoluteX(g[0][0]),this.exprY=this.abs_coord?g[0][1]:h.getAbsoluteY(g[0][1]),
this.rotateExp&&(g=this.exprX*k-this.exprY*j,l=this.exprX*j+this.exprY*k,this.exprX=g,this.exprY=l),d.lineTo(this.exprX+0.5,this.exprY+0.5);this.fill&&d.fill();d.stroke();e.setVariable(this.parameter,c)};a.Curve.prototype.registerTextField=function(){var a=document.createElement("input");a.value=this.expresionString;a.disabled=!this.editable;var c=this;a.onkeydown=function(a){13==a.keyCode&&(c.expresion=c.evaluator.parser.parse(this.value),c.parent.update())};this.parent.editableRegion.textFields.push(a)};
return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=2*Math.PI;a.Sequence=function(c,d){a.Graphic.call(this,c,d)};a.extend(a.Sequence,a.Graphic);a.Sequence.prototype.update=function(){var c=this.evaluator,d=c.evalExpression(this.expresion);this.exprX=d[0][0];this.exprY=d[0][1];if(this.rotateExp){var e=a.degToRad(c.evalExpression(this.rotateExp)),d=Math.cos(e),h=Math.sin(e),e=this.exprX*d-this.exprY*h,d=this.exprX*h+this.exprY*d;this.exprX=e;this.exprY=d}c=c.evalExpression(this.range);
this.rangeInf=c[0][0];this.rangeMax=c[0][1]};a.Sequence.prototype.draw=function(){this.uber.draw.call(this,this.color,this.color)};a.Sequence.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Sequence.prototype.drawAux=function(c,f){var e=this.evaluator,h,g,j,k=Math.ceil(e.evalExpression(this.size)-0.4);c.fillStyle=a.getColor(e,f);c.beginPath();this.rangeInf>this.rangeMax&&(j=this.rangeInf,this.rangeInf=this.rangeMax,this.rangeMax=j);for(var l=e.getVariable("n"),
m=this.rangeInf,q=this.rangeMax;m<=q;m++)e.setVariable("n",m),j=e.evalExpression(this.expresion),this.exprX=j[0][0],this.exprY=j[0][1],this.abs_coord?h=j[0][1]:(h=this.space.getAbsoluteX(j[0][0]),g=this.space.getAbsoluteY(j[0][1])),c.moveTo(h,g),c.arc(h,g,k,0,d,!0);e.setVariable("n",l);c.fill();this.text!=[""]&&this.uber.drawText.call(this,c,this.text,h+k,g-k,this.color,this.font,"start","alphabetic",e.evalExpression(this.decimals),this.fixed)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
var d=2*Math.PI,c=Math.round;a.Point=function(c,d){a.Graphic.call(this,c,d)};a.extend(a.Point,a.Graphic);var f,e,h,g,j,k,l,m,q,p,n;a.Point.prototype.update=function(){f=this.evaluator;h=f.evalExpression(this.expresion);this.exprX=h[0][0];this.exprY=h[0][1];this.rotateExp&&(g=a.degToRad(f.evalExpression(this.rotateExp)),j=Math.cos(g),k=Math.sin(g),l=this.exprX*j-this.exprY*k,m=this.exprX*k+this.exprY*j,this.exprX=l,this.exprY=m)};a.Point.prototype.draw=function(){this.uber.draw.call(this,this.color,
this.color)};a.Point.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Point.prototype.drawAux=function(g,h){f=this.evaluator;e=this.space;n=c(f.evalExpression(this.size));g.fillStyle=a.getColor(f,h);q=this.abs_coord?c(this.exprX):c(e.getAbsoluteX(this.exprX));p=this.abs_coord?c(this.exprY):c(e.getAbsoluteY(this.exprY));g.beginPath();g.arc(q,p,n,0,d,!0);g.fill();this.text!=[""]&&this.uber.drawText.call(this,g,this.text,q+n,p-n,this.color,this.font,"start","alphabetic",
f.evalExpression(this.decimals),this.fixed)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=2*Math.PI;a.Segment=function(c,d){a.Graphic.call(this,c,d);this.width=-1==this.width?this.evaluator.parser.parse("1"):this.width};a.extend(a.Segment,a.Graphic);a.Segment.prototype.update=function(){var c=this.evaluator,d=c.evalExpression(this.expresion);this.endPoints=[];for(var e=0,h=d.length;e<h;e++)this.endPoints[e]={x:d[e][0],y:d[e][1]};if(this.rotateExp)for(var e=a.degToRad(c.evalExpression(this.rotateExp)),
c=Math.cos(e),d=Math.sin(e),g,j,e=0,h=this.endPoints.length;e<h;e++)g=this.endPoints[e].x*c-this.endPoints[e].y*d,j=this.endPoints[e].x*d+this.endPoints[e].y*c,this.endPoints[e].x=g,this.endPoints[e].y=j};a.Segment.prototype.draw=function(){this.uber.draw.call(this,this.color,this.color)};a.Segment.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Segment.prototype.drawAux=function(c,f,e){var h=this.evaluator,g=h.evalExpression(this.width);0>=g&&(g=1E-6);c.lineWidth=
g;g=h.evalExpression(this.size);c.fillStyle=a.getColor(h,f);c.strokeStyle=a.getColor(h,e);c.lineCap="round";f=10+c.lineWidth;e=0==c.lineWidth%2?0:0.5;var j,k,l,m;this.abs_coord?(j=this.endPoints[0].x,k=this.endPoints[0].y,l=this.endPoints[1].x,m=this.endPoints[1].y):(j=this.space.getAbsoluteX(this.endPoints[0].x),k=this.space.getAbsoluteY(this.endPoints[0].y),l=this.space.getAbsoluteX(this.endPoints[1].x),m=this.space.getAbsoluteY(this.endPoints[1].y));g=h.evalExpression(this.size);0>g&&(g=0);c.beginPath();
c.moveTo(j+e,k+e);c.lineTo(l+e,m+e);this.text!=[""]&&this.uber.drawText.call(this,c,this.text,(j+l)/2+f,(k+m)/2-f,this.color,this.font,"start","alphabetic",h.evalExpression(this.decimals),this.fixed);c.stroke();c.beginPath();c.arc(j,k,g,0,d,!0);c.arc(l,m,g,0,d,!0);c.fill()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.floor;a.Arrow=function(c,d){a.Graphic.call(this,c,d);this.width=-1==this.width?this.evaluator.parser.parse("5"):this.width};a.extend(a.Arrow,a.Graphic);
a.Arrow.prototype.update=function(){var c=this.evaluator,d=c.evalExpression(this.expresion);this.endPoints=[];for(var e=0,h=d.length;e<h;e++)this.endPoints[e]={x:d[e][0],y:d[e][1]};if(this.rotateExp)for(var e=a.degToRad(c.evalExpression(this.rotateExp)),c=Math.cos(e),d=Math.sin(e),g,j,e=0,h=this.endPoints.length;e<h;e++)g=this.endPoints[e].x*c-this.endPoints[e].y*d,j=this.endPoints[e].x*d+this.endPoints[e].y*c,this.endPoints[e].x=g,this.endPoints[e].y=j};a.Arrow.prototype.draw=function(){this.uber.draw.call(this,
this.arrow,this.color)};a.Arrow.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.arrow,this.trace)};a.Arrow.prototype.drawAux=function(c,f,e){var h=this.evaluator,g=this.space;h.evalExpression(this.size);var j=h.evalExpression(this.width);1>j&&(j=1);var k=Math.ceil(j/2),l=g.scale;this.vect=new a.Vector2D(this.endPoints[1].x-this.endPoints[0].x,this.endPoints[1].y-this.endPoints[0].y);var m=this.vect.vectorLength();this.angle=this.vect.angleBetweenVectors(a.Vector2D.AXIS_X);c.fillStyle=
a.getColor(h,f);c.strokeStyle=a.getColor(h,e);c.lineWidth=1;var q,p,n;this.abs_coord?(f=this.endPoints[0].x,q=this.endPoints[0].y,p=this.endPoints[1].x,g=this.endPoints[1].y):(f=g.getAbsoluteX(this.endPoints[0].x),q=g.getAbsoluteY(this.endPoints[0].y),p=g.getAbsoluteX(this.endPoints[1].x),g=g.getAbsoluteY(this.endPoints[1].y));n=h.evalExpression(this.spear);0>n&&(n=0);c.save();c.translate(f,q,m);this.abs_coord?0<=this.vect.x&&0<=this.vect.y||0>=this.vect.x&&0<=this.vect.y?c.rotate(this.angle):c.rotate(-this.angle):
(m*=l,0<=this.vect.x&&0<=this.vect.y||0>=this.vect.x&&0<=this.vect.y?c.rotate(-this.angle):c.rotate(this.angle));c.beginPath();c.moveTo(-k+0.5,d(-k)+0.5);c.lineTo(d(m-n-j)+0.5,d(-k)+0.5);c.lineTo(d(m-2*n)+0.5,d(-n-k)+0.5);c.lineTo(d(m)+0.5,0);c.lineTo(d(m-2*n)+0.5,d(n+k)-0.5);c.lineTo(d(m-n-j)+0.5,d(k)-0.5);c.lineTo(-k+0.5,d(k)-0.5);c.closePath();c.stroke();c.fill();c.restore();this.text!=[""]&&this.uber.drawText.call(this,c,this.text,(f+p)/2,(q+g)/2,e,this.font,"start","alphabetic",h.evalExpression(this.decimals),
this.fixed)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.round;a.Polygon=function(c,d){a.Graphic.call(this,c,d);this.width=-1==this.width?this.evaluator.parser.parse("1"):this.width;this.endPoints=[]};a.extend(a.Polygon,a.Graphic);var c,f,e,h,g,j,k,l,m,q,p;a.Polygon.prototype.update=function(){c=this.evaluator;e=c.evalExpression(this.expresion);for(var d=0,f=e.length;d<f;d++)this.endPoints[d]={x:e[d][0],y:e[d][1]};if(this.rotateExp){h=a.degToRad(c.evalExpression(this.rotateExp));
g=Math.cos(h);j=Math.sin(h);d=0;for(f=this.endPoints.length;d<f;d++)k=this.endPoints[d].x*g-this.endPoints[d].y*j,l=this.endPoints[d].x*j+this.endPoints[d].y*g,this.endPoints[d].x=k,this.endPoints[d].y=l}};a.Polygon.prototype.draw=function(){this.uber.draw.call(this,this.fill,this.color)};a.Polygon.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Polygon.prototype.drawAux=function(e,g,h){c=this.evaluator;f=this.space;m=d(c.evalExpression(this.width));e.lineWidth=
0<m?m:1E-6;e.fillStyle=a.getColor(c,g);e.strokeStyle=a.getColor(c,h);e.lineCap="round";e.lineJoin="round";q=this.abs_coord?d(this.endPoints[0].x):d(f.getAbsoluteX(this.endPoints[0].x));p=this.abs_coord?d(this.endPoints[0].y):d(f.getAbsoluteY(this.endPoints[0].y));e.beginPath();e.moveTo(q+0.5,p+0.5);g=1;for(h=this.endPoints.length;g<h;g++)q=this.abs_coord?this.endPoints[g].x:f.getAbsoluteX(this.endPoints[g].x),p=this.abs_coord?this.endPoints[g].y:f.getAbsoluteY(this.endPoints[g].y),e.lineTo(q+0.5,
p+0.5);this.fill&&e.fill();e.stroke()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.floor;a.Arc=function(d,f){a.Graphic.call(this,d,f);this.width=-1==this.width?this.evaluator.parser.parse("1"):this.width};a.extend(a.Arc,a.Graphic);a.Arc.prototype.update=function(){var d=this.evaluator,f=d.evalExpression(this.center);this.exprX=f[0][0];this.exprY=f[0][1];if(this.rotateExp){var e=a.degToRad(d.evalExpression(this.rotateExp)),f=Math.cos(e),h=Math.sin(e),e=this.exprX*
f-this.exprY*h,f=this.exprX*h+this.exprY*f;this.exprX=e;this.exprY=f}e=d.evalExpression(this.init);f=d.evalExpression(this.end);if("(expr)"==this.init.type&&"(expr)"==this.end.type||"[expr]"==this.init.type&&"[expr]"==this.end.type||"(expr)"==this.init.type&&"[expr]"==this.end.type||"[expr]"==this.init.type&&"(expr)"==this.end.type){this.vectors=!0;var d=e[0][0],h=e[0][1],g=f[0][0],j=f[0][1],f=Math.acos((1*d+0*h)/Math.sqrt(d*d+h*h)),e=Math.acos((1*g+0*j)/Math.sqrt(g*g+j*j));0<d&&(0<h&&!this.abs_coord)&&
(f=2*Math.PI-f);0<d&&(0>h&&this.abs_coord)&&(f=2*Math.PI-f);0>d&&(0>h&&this.abs_coord)&&(f=2*Math.PI-f);0>d&&(0<h&&!this.abs_coord)&&(f=2*Math.PI-f);0<g&&(0<j&&!this.abs_coord)&&(e=2*Math.PI-e);0<g&&(0>j&&this.abs_coord)&&(e=2*Math.PI-e);0>g&&(0>j&&this.abs_coord)&&(e=2*Math.PI-e);0>g&&(0<j&&!this.abs_coord)&&(e=2*Math.PI-e);d=Math.min(f,e);h=Math.max(f,e);f=d;e=h;e-f>Math.PI&&this.abs_coord&&(f=h,e=d);e-f<=Math.PI&&!this.abs_coord&&(f=h,e=d);this.iniAng=f;this.endAng=e}else this.vectors=!1,this.iniAng=
a.degToRad(e),this.endAng=a.degToRad(f)};a.Arc.prototype.draw=function(){this.uber.draw.call(this,this.fill,this.color)};a.Arc.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.fill,this.trace)};a.Arc.prototype.drawAux=function(c,f,e){var h=this.evaluator,g=this.space,j=this.abs_coord?d(this.exprX)+0.5:d(g.getAbsoluteX(this.exprX))+0.5,k=this.abs_coord?d(this.exprY)+0.5:d(g.getAbsoluteY(this.exprY))+0.5,l=h.evalExpression(this.radius);if(!this.vectors&&this.iniAng>this.endAng){var m=
this.iniAng;this.iniAng=this.endAng;this.endAng=m}0>l&&(l=0);m=!1;this.abs_coord||(l*=g.scale,this.vectors||(this.iniAng=-this.iniAng,this.endAng=-this.endAng,m=!0));this.vectors&&(m=this.abs_coord?!1:!0);g=h.evalExpression(this.width);0>=g&&(g=1E-6);c.lineWidth=g;c.lineCap="round";c.fillStyle=a.getColor(h,f);c.strokeStyle=a.getColor(h,e);this.fill&&(c.beginPath(),c.moveTo(j,k),c.arc(j,k,l,this.iniAng,this.endAng,m),c.fill());c.beginPath();c.arc(j,k,l,this.iniAng,this.endAng,m);c.stroke();this.text!=
[""]&&this.uber.drawText.call(this,c,this.text,j+1,k-1,this.color,this.font,"start","alphabetic",h.evalExpression(this.decimals),this.fixed)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Fill=function(d,c){a.Graphic.call(this,d,c)};a.extend(a.Fill,a.Graphic);a.Fill.prototype.update=function(){};a.Fill.prototype.draw=function(){this.uber.draw.call(this,this.color,this.color)};a.Fill.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Fill.prototype.drawAux=
function(){};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Text=function(d,c){a.Graphic.call(this,d,c);this.align||(this.align="start");-1==this.width&&(this.width=this.evaluator.parser.parse("0"));this.abs_coord=!0};a.extend(a.Text,a.Graphic);a.Text.prototype.update=function(){var d=this.evaluator,c=d.evalExpression(this.expresion);this.exprX=c[0][0];this.exprY=c[0][1];if(this.rotateExp){var c=a.degToRad(d.evalExpression(this.rotateExp)),d=Math.cos(c),f=Math.sin(c),c=
this.exprX*d-this.exprY*f,d=this.exprX*f+this.exprY*d;this.exprX=c;this.exprY=d}};a.Text.prototype.draw=function(){this.uber.draw.call(this,this.color)};a.Text.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.color)};a.Text.prototype.drawAux=function(a,c){var f;f="rtfNode"===this.text.type?this.text:this.splitText(this.text.toString(this.evaluator.evalExpression(this.decimals),this.fixed).split("\\n"));this.text!=[""]&&this.uber.drawText.call(this,a,f,parseFloat(this.exprX)+5,parseFloat(this.exprY),
c,this.font,this.align,"hanging")};a.Text.prototype.splitText=function(a){var c=this.evaluator.evalExpression(this.width),f,e,h=[];this.ctx.font=this.font;this.fontSize=(this.fontSize=this.font.match(/(\d+)px/))?this.fontSize[1]:"10";if(20<=c&&"undefined"!=a.type){for(var g=0,j=a.length;g<j;g++)f=a[g],e=this.ctx.measureText(f).width,e>c?h=h.concat(this.splitWords(f,c)):h.push(f);a=Math.floor(1.2*this.fontSize)*h.length;this.evaluator.setVariable("_Text_H_",a);return h}this.evaluator.setVariable("_Text_H_",
0);this.evaluator.setVariable("_Text_W_",1E3);return a};a.Text.prototype.splitWords=function(a,c){var f=a,e=[],h,g,j,k,l=!1;do j=Math.floor(f.length*(c/this.ctx.measureText(f).width))+1,h=f.slice(0,j),""!=h&&" "==h[0]&&(f=f.slice(1),h=f.slice(0,j)),l=f[j-1]&&f[j]&&" "!=f[j-1]&&" "!=f[j],k=h.lastIndexOf(" "),g=this.ctx.measureText(h).width,g>=c?(j=-1!=k?k:j-1,h=f.slice(0,j)):l&&-1!=k&&(j=k,h=f.slice(0,j)),e.push(h),f=f.slice(j);while(""!=f);return e};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
a.Image=function(d,c){a.Graphic.call(this,d,c);this.img=new Image;this.scaleY=this.scaleX=1;this.update()};a.extend(a.Image,a.Graphic);a.Image.prototype.update=function(){var d=this.evaluator,c=d.evalExpression(this.expresion);this.exprX=c[0][0];this.exprY=c[0][1];if(this.rotateExp){var f=a.degToRad(d.evalExpression(this.rotateExp)),e=Math.cos(f),h=Math.sin(f),f=this.exprX*e-this.exprY*h,e=this.exprX*h+this.exprY*e;this.exprX=f;this.exprY=e}4==c[0].length&&(this.centered=!0,this.scaleX=c[0][2],0==
this.scaleX&&(this.scaleX=1E-5),this.scaleY=c[0][3],0==this.scaleY&&(this.scaleY=1E-5));c[1]&&2==c[1].length&&(this.centered=!0,this.scaleX=c[1][0],0==this.scaleX&&(this.scaleX=1E-5),this.scaleY=c[1][1],0==this.scaleY&&(this.scaleY=1E-5));if((d=d.evalExpression(this.file))||""==d)this.img=this.parent.getImage(d)};a.Image.prototype.draw=function(){this.uber.draw.call(this)};a.Image.prototype.drawTrace=function(){this.uber.drawTrace.call(this)};a.Image.prototype.drawAux=function(d){var c=this.evaluator;
if(this.img&&this.img.ready&&this.img.complete){var f=this.centered?0:this.img.width/2,e=this.centered?0:this.img.height/2,h=this.abs_coord?this.exprX:this.space.getAbsoluteX(this.exprX),g=this.abs_coord?this.exprY:this.space.getAbsoluteY(this.exprY),j=a.degToRad(-c.evalExpression(this.inirot));d.translate(h+f,g+e);d.rotate(j);d.scale(this.scaleX,this.scaleY);this.opacity&&(d.globalAlpha=c.evalExpression(this.opacity));d.drawImage(this.img,-this.img.width/2,-this.img.height/2);d.setTransform(1,0,
0,1,0,0);d.globalAlpha=1}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Fill=function(d,c){a.Graphic.call(this,d,c)};a.extend(a.Fill,a.Graphic);a.Fill.prototype.update=function(){};a.Fill.prototype.draw=function(){this.uber.draw.call(this,this.color,this.color)};a.Fill.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Fill.prototype.drawAux=function(){};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Macro=
function(d,c){a.Graphic.call(this,d,c);this.graphics=[];var f=d.lessonParser,e=new a.Tokenizer,h;for(h in c)c.hasOwnProperty(h)&&(this[h]=c[h]);if(void 0!=this.expresion){this.expresion.match("'")||(this.expresion="'"+this.expresion+"'");this.expresion=this.evaluator.parser.parse(this.expresion);h=this.expresion.value;var g,j=2;h&&((g=document.getElementById(h))&&"descartes/macro"==g.type?(g=g.text,j=3):(g=a.openExternalFile(h),g.match("tipo_de_macro")||(g=null)));var k="|";if(g){g=g.replace(/&aacute;/g,
"\u00e1").replace(/&eacute;/g,"\u00e9").replace(/&iacute;/g,"\u00ed").replace(/&oacute;/g,"\u00f3").replace(/&uacute;/g,"\u00fa").replace(/&Aacute;/g,"\u00c1").replace(/&Eacute;/g,"\u00c9").replace(/&Iacute;/g,"\u00cd").replace(/&Oacute;/g,"\u00d3").replace(/&Uacute;/g,"\u00da").replace(/&ntilde;/g,"\u00f1").replace(/&Ntilde;/g,"\u00d1").replace(/\&gt;/g,">").replace(/\&lt;/g,"<").replace(/\&amp;/g,"&").split("\n").slice(j);var l,m;h=0;for(j=g.length;h<j;h++)g[h]&&(g[h]=f.split(g[h]),g[h]&&(g[h][0]&&
g[h][0][0]&&"id"==g[h][0][0])&&(l=g[h][0][1],m=l.indexOf("("),-1!=m&&(l=l.substring(0,m)),k+=l+"|"));var q,p,n,u;h=0;for(j=g.length;h<j;h++){q=g[h]||[];l=0;for(m=q.length;l<m;l++)if(p=babel[q[l][0]],n=q[l][0].indexOf("."),-1!=n&&(p=babel[q[l][0].substring(n+1)]),!("id"!=p&&"text"!=p&&"expresion"!=p&&"interval"!=p&&"steps"!=p&&"drawif"!=p&&"size"!=p&&"width"!=p&&"center"!=p&&"radius"!=p&&"init"!=p&&"end"!=p&&"inirot"!=p&&"do"!=p&&"while"!=p&&"file"!=p&&"fill"!=p&&"color"!=p))if("text"==p)if(q[l][1].match(/\{\\rtf1/)){p=
q[l][1];var s=this;u=function(a,d){for(var c=e.tokenize(d.replace(/\&squot;/g,"'")),f=0,g=c.length;f<g;f++)if("identifier"==c[f].type&&k.match("\\|"+c[f].value+"\\|"))c[f].value=s.name+"."+c[f].value;else if("identifier"==c[f].type&&-1!=(n=c[f].value.indexOf("."))&&k.match("\\|"+c[f].value.substring(0,n)+"\\|"))c[f].value=s.name+"."+c[f].value;return(a.match(/^\\expr/)?"\\expr ":"\\decimals ")+e.flatTokens(c)};p=p.replace(/\\expr ([a-zA-Z_0-9\u00C0-\u021B+*/%|&^#!?:()><.']*)/gi,u);p=p.replace(/\\decimals ([a-zA-Z_0-9\u00C0-\u021B+*/%|&^#!?:()><.']*)/gi,
u);q[l][1]=p}else{u=f.parseText(q[l][1]).textElementsMacros;for(var t=0,r=u.length;t<r;t++){p=e.tokenize(u[t].replace(/\&squot;/g,"'"));for(var w=0,z=p.length;w<z;w++)"identifier"==p[w].type&&k.match("\\|"+p[w].value+"\\|")&&(p[w].value=this.name+"."+p[w].value);p=e.flatTokens(p).replace(/&squot;/g,"'").replace(/'\+\(/g,"[").replace(/\)\+'/g,"]");u[t]=p.substring(1,p.length-1)}q[l][1]=u.join("")}else{p=e.tokenize(q[l][1].replace(/\&squot;/g,"'"));u=0;for(t=p.length;u<t;u++)if("identifier"==p[u].type&&
k.match("\\|"+p[u].value+"\\|"))p[u].value=this.name+"."+p[u].value;else if("identifier"==p[u].type&&-1!=(n=p[u].value.indexOf("."))&&k.match("\\|"+p[u].value.substring(0,n)+"\\|"))p[u].value=this.name+"."+p[u].value;q[l][1]=e.flatTokens(p)}}h=0;for(j=g.length;h<j;h++)if(g[h][0]){q="";l=0;for(m=g[h].length;l<m;l++)g[h][l]="type"!=babel[g[h][l][0]]?g[h][l][0]+"='"+g[h][l][1]+"' ":"espacio='"+this.spaceID+"' "+g[h][l][0]+"='"+g[h][l][1]+"' ",q+=g[h][l];g[h]=q;q.match(/^espacio/)?this.graphics.push(f.parseGraphic(g[h],
this.abs_coord,this.background,this.inirot)):f.parseAuxiliar(g[h])}}}};a.extend(a.Macro,a.Graphic);a.Macro.prototype.update=function(){if(this.inipos){var a=this.evaluator.evalExpression(this.inipos);this.iniPosX=a[0][0];this.iniPosY=a[0][1]}};a.Macro.prototype.drawAux=function(a){for(var c=0,f=this.graphics.length;c<f;c++)this.inipos&&(this.graphics[c].abs_coord?a.translate(this.iniPosX,this.iniPosY):a.translate(this.iniPosX*this.space.scale,-this.iniPosY*this.space.scale)),this.graphics[c].draw(),
a.setTransform(1,0,0,1,0,0)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.RenderMath={};a.RenderMath.inverseSqrt=function(){return 1/Math.sqrt(number)};a.Vector2D=function(a,c){this.x=a||0;this.y=c||0};a.Vector2D.prototype.clone=function(){return new a.Vector2D(this.x,this.y)};a.Vector2D.prototype.add=function(d){return new a.Vector2D(this.x+d.x,this.y+d.y)};a.Vector2D.prototype.substract=function(d){return new a.Vector2D(this.x-d.x,this.y-d.y)};a.Vector2D.prototype.multiply=
function(d){return new a.Vector2D(this.x*d.x,this.y*d.y)};a.Vector2D.prototype.divide=function(d){return new a.Vector2D(this.x/d.x,this.y/d.y)};a.Vector2D.prototype.scale=function(d){return new a.Vector2D(this.x*d,this.y*d)};a.Vector2D.prototype.dist=function(a){var c=a.x-this.x;a=a.y-this.y;return Math.sqrt(c*c+a*a)};a.Vector2D.prototype.negate=function(){return new a.Vector2D(-this.x,-this.y)};a.Vector2D.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.Vector2D.prototype.squaredLength=
function(){return this.x*this.x+this.y*this.y};a.Vector2D.prototype.normalize=function(){var d=this.squaredLength();return 0<d?(d=Math.sqrt(d),new a.Vector2D(this.x/d,this.y/d)):new a.Vector2D(0,0)};a.Vector2D.prototype.crossProduct=function(a){return this.x*a.y-this.y*a.x};a.Vector2D.prototype.dot=function(a){return this.x*a.x+this.y*a.y};a.Vector2D.prototype.direction=function(d){var c=this.x-d.x;d=this.y-d.y;var f=c*c+d*d;if(!f)return new a.Vector2D(0,0);f=1/Math.sqrt(f);return new a.Vector2D(c*
f,d*f)};a.Vector2D.prototype.lerp=function(d,c){return new a.Vector2D(this.x+c*(d.x-this.x),this.y+c*(d.y-this.y))};a.Vector3D=function(a,c,f){this.x=a||0;this.y=c||0;this.z=f||0};a.Vector3D.prototype.set=function(a,c,f){this.x=a;this.y=c;this.z=f;return this};a.Vector3D.prototype.toVector4D=function(){return new a.Vector4D(this.x,this.y,this.z,1)};a.Vector3D.prototype.copy=function(){return new a.Vector3D(this.x,this.y,this.z)};a.Vector3D.prototype.add=function(d){return new a.Vector3D(this.x+d.x,
this.y+d.y,this.z+d.z)};a.Vector3D.prototype.substract=function(d){return new a.Vector3D(this.x-d.x,this.y-d.y,this.z-d.z)};a.Vector3D.prototype.multiply=function(d){return new a.Vector3D(this.x*d.x,this.y*d.y,this.z*d.z)};a.Vector3D.prototype.negate=function(){return new a.Vector3D(-this.x,-this.y,-this.z)};a.Vector3D.prototype.scale=function(d){return new a.Vector3D(this.x*d,this.y*d,this.z*d)};a.Vector3D.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};a.Vector3D.prototype.squaredLength=
function(){return this.x*this.x+this.y*this.y+this.z*this.z};a.Vector3D.prototype.normalize=function(){var d=this.length();if(0==d)return new a.Vector3D(0,0,0);if(1==d)return new a.Vector3D(this.x,this.y,this.z);d=1/d;return new a.Vector3D(this.x*d,this.y*d,this.z*d)};a.Vector3D.prototype.crossProduct=function(d){return new a.Vector3D(this.y*d.z-this.z*d.y,this.z*d.x-this.x*d.z,this.x*d.y-this.y*d.x)};a.Vector3D.prototype.dotProduct=function(d){return new a.Vector3D(this.x*d.x+this.y*d.y+this.z*d.z)};
a.Vector3D.prototype.direction=function(d){var c=this.x-d.x,f=this.y-d.y;d=this.z-d.z;var e=Math.sqrt(c*c+f*f+d*d);if(0==e)return new a.Vector3D(0,0,0);e=1/e;return new a.Vector3D(c*e,f*e,d*e)};a.Vector3D.prototype.lerp=function(d,c){return new a.Vector3D(this.x+c*(d.x-this.x),this.y+c*(d.y-this.y),this.z+c*(d.z-this.z))};a.Vector3D.prototype.distance=function(a){var c=a.x-this.x,f=a.y-this.y;a=a.z-this.z;return Math.sqrt(c*c+f*f+a*a)};a.Vector3D.prototype.unproject=function(d,c,f){var e=new a.Vector4D(2*
(this.x-f.x)/f.width-1,2*(this.y-f.y)/f.height-1,2*this.z-1,e[3]=1);d=c.multiply(d);if(!d.inverse())return null;e=d.multiplyVector4(e);return 0==e.w?null:new a.Vector3D(e.x/e.w,e.y/e.w,e.z/e.w)};a.Vector3D.prototype.rotationTo=function(d){var c=new a.Vector3D(1,0,0),f=new a.Vector3D(0,1,0),e=new a.Vector3D(0,0,1),h=this.dotProduct(d),g=new a.Quaternion;1<=h?g.setIdentity():-0.999999>h?(axis=c.crossProduct(this),1E-6>axis.length()&&(axis=f.crossProduct(this)),1E-6>axis.length()&&(axis=e.crossProduct(this)),
axis=axis.normalize(),g=Quaternion.fromAngleAxis(Math.PI,axis)):(c=Math.squrt(2*(1+h)),f=1/c,axis=this.crossProduct(d),g.x=axis.x*f,g.y=axis.y*f,g.z=axis.z*f,g.w=0.5*c,g=Quaternion.normalize());1<g.w?g.w=1:-1>g.w&&(g.w=-1);return g};a.Vector4D=function(a,c,f,e){this.x=a||0;this.y=c||0;this.z=f||0;this.w=e||0};a.Vector4D.prototype.set=function(a,c,f,e){this.x=a;this.y=c;this.z=f;this.w=e;return this};a.Vector4D.prototype.toVector3D=function(){var d=0!==this.w?1/this.w:0;return new a.Vector3D(this.x*
d,this.y*d,this.z*d)};a.Vector4D.prototype.clone=function(){return new a.Vector4D(this.x,this.y,this.z,this.w)};a.Vector4D.prototype.add=function(d){return new a.Vector4D(this.x+d.x,this.y+d.y,this.z+d.z,this.w+d.w)};a.Vector4D.prototype.substract=function(d){return new a.Vector4D(this.x-d.x,this.y-d.y,this.z-d.z,this.w-d.w)};a.Vector4D.prototype.multiply=function(d){return new a.Vector4D(this.x*d.x,this.y*d.y,this.z*d.z,this.w*d.w)};a.Vector4D.prototype.divide=function(d){return new a.Vector4D(this.x/
d.x,this.y/d.y,this.z/d.z,this.w/d.w)};a.Vector4D.prototype.scale=function(d){return new a.Vector4D(this.x*d,this.y*d,this.z*d,this.w*d)};a.Vector4D.prototype.negate=function(){return new a.Vector4D(-this.x,-this.y,-this.z,-this.w)};a.Vector4D.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)};a.Vector4D.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w};a.Vector4D.prototype.lerp=function(d,c){return new a.Vector4D(this.x+
c*(d.x-this.x),this.y+c*(d.y-this.y),this.z+c*(d.z-this.z),this.w+c*(d.w-this.w))};a.Matrix2x2=function(a,c,f,e){this.a00=a||0;this.a01=c||0;this.a10=f||0;this.a11=e||0};a.Matrix2x2.prototype.clone=function(){return new a.Matrix2x2(this.a00,this.a01,this.a10,this.a11)};a.Matrix2x2.prototype.setIdentity=function(){this.a00=1;this.a10=this.a01=0;this.a11=1;return this};a.Matrix2x2.prototype.transpose=function(){return new a.Matrix2x2(this.a00,this.a10,this.a01,this.a11)};a.Matrix2x2.prototype.determinant=
function(){return this.a00*this.a11-this.a10*this.a01};a.Matrix2x2.prototype.inverse=function(){var d=this.determinant();if(!d)return null;d=1/d;return new a.Matrix2x2(this.a11*d,-this.a10*d,-this.a01*d,this.a00*d)};a.Matrix2x2.prototype.multiply=function(d){return new a.Matrix2x2(this.a00*d.a00+this.a01*d.a10,this.a00*d.a01+this.a01*d.a11,this.a10*d.a00+this.a11*d.a10,this.a10*d.a01+this.a11*d.a11)};a.Matrix2x2.prototype.rotate=function(d){var c=Math.sin(d);d=Math.cos(d);return new a.Matrix2x2(this.a00*
d+this.a01*c,this.a00*-c+this.a01*d,this.a10*d+this.a11*c,this.a10*-c+this.a11*d)};a.Matrix2x2.prototype.multiplyVector2=function(d){return new a.Vector2D(d.x*this.a00+d.y*this.a01,d.x*this.a10+d.y*this.a11)};a.Matrix2x2.prototype.scale=function(d){return new a.Matrix2x2(this.a00*d.x,this.a01*d.y,this.a10*d.x,this.a11*d.y)};a.Matrix3x3=function(a,c,f,e,h,g,j,k,l){this.a00=a||0;this.a01=c||0;this.a02=f||0;this.a10=e||0;this.a11=h||0;this.a12=g||0;this.a20=j||0;this.a21=k||0;this.a22=l||0};a.Matrix3x3.prototype.copy=
function(){return new a.Matrix3x3(this.a00,this.a01,this.a02,this.a10,this.a11,this.a12,this.a20,this.a21,this.a22)};a.Matrix3x3.prototype.determinant=function(){var a=this.a10,c=this.a11,f=this.a12,e=this.a20,h=this.a21,g=this.a22;return this.a00*(g*c-f*h)+this.a01*(-g*a+f*e)+this.a02*(h*a-c*e)};a.Matrix3x3.prototype.inverse=function(){var d=this.a00,c=this.a01,f=this.a02,e=this.a10,h=this.a11,g=this.a12,j=this.a20,k=this.a21,l=this.a22,m=l*h-g*k,q=-l*e+g*j,p=k*e-h*j,n=d*m+c*q+f*p;if(!n)return null;
n=1/n;return new a.Matrix3x3(m*n,(-l*c+f*k)*n,(g*c-f*h)*n,q*n,(l*d-f*j)*n,(-g*d+f*e)*n,p*n,(-k*d+c*j)*n,(h*d-c*e)*n)};a.Matrix3x3.prototype.multply=function(d){var c=this.a00,f=this.a01,e=this.a02,h=this.a10,g=this.a11,j=this.a12,k=this.a20,l=this.a21,m=this.a22,q=d.a00,p=d.a01,n=d.a02,u=d.a10,s=d.a11,t=d.a12,r=d.a20,w=d.a21;d=d.a22;return new a.Matrix3x3(q*c+p*h+n*k,q*f+p*g+n*l,q*e+p*j+n*m,u*c+s*h+t*k,u*f+s*g+t*l,u*e+s*j+t*m,r*c+w*h+d*k,r*f+w*g+d*l,r*e+w*j+d*m)};a.Matrix3x3.prototype.multiplyVector2=
function(d){return new a.Vector2D(d.x*this.a00+d.y*this.a10+this.a20,d.x*this.a01+d.y*this.a11+this.a21)};a.Matrix3x3.prototype.multiplyVector3=function(d){return new a.Vector3D(d.x*this.a00+d.y*this.a10+d.z*this.a20,d.x*this.a01+d.y*this.a11+d.z*this.a21,d.x*this.a02+d.y*this.a12+d.z*this.a22)};a.Matrix3x3.prototype.setIdentity=function(){this.a00=1;this.a10=this.a02=this.a01=0;this.a11=1;this.a21=this.a20=this.a12=0;this.a22=1;return this};a.Matrix3x3.prototype.transpose=function(){return new a.Matrix3x3(this.a00,
this.a10,this.a20,this.a01,this.a11,this.a21,this.a02,this.a12,this.a22)};a.Matrix3x3.prototype.toMatrix4x4=function(){return new a.Matrix4x4(this.a00,this.a01,this.a02,0,this.a10,this.a11,this.a12,0,this.a20,this.a21,this.a22,0,0,0,0,1)};a.Matrix4x4=function(a,c,f,e,h,g,j,k,l,m,q,p,n,u,s,t){this.a00=a||0;this.a01=c||0;this.a02=f||0;this.a03=e||0;this.a10=h||0;this.a11=g||0;this.a12=j||0;this.a13=k||0;this.a20=l||0;this.a21=m||0;this.a22=q||0;this.a23=p||0;this.a30=n||0;this.a31=u||0;this.a32=s||
0;this.a33=t||0};a.Matrix4x4.prototype.copy=function(){return new a.Matrix4x4(this.a00,this.a01,this.a02,this.a03,this.a10,this.a11,this.a12,this.a13,this.a20,this.a21,this.a22,this.a23,this.a30,this.a31,this.a32,this.a33)};a.Matrix4x4.prototype.setIdentity=function(){this.a00=1;this.a10=this.a03=this.a02=this.a01=0;this.a11=1;this.a21=this.a20=this.a13=this.a12=0;this.a22=1;this.a32=this.a31=this.a30=this.a23=0;this.a33=1;return this};a.Matrix4x4.prototype.transpose=function(){return new a.Matrix3x3(this.a00,
this.a10,this.a20,this.a30,this.a01,this.a11,this.a21,this.a31,this.a02,this.a12,this.a22,this.a32,this.a03,this.a13,this.a23,this.a33)};a.Matrix4x4.prototype.determinant=function(){var a=this.a00,c=this.a01,f=this.a02,e=this.a03,h=this.a10,g=this.a11,j=this.a12,k=this.a13,l=this.a20,m=this.a21,q=this.a22,p=this.a23,n=this.a30,u=this.a31,s=this.a32,t=this.a33;return n*m*j*e-l*u*j*e-n*g*q*e+h*u*q*e+l*g*s*e-h*m*s*e-n*m*f*k+l*u*f*k+n*c*q*k-a*u*q*k-l*c*s*k+a*m*s*k+n*g*f*p-h*u*f*p-n*c*j*p+a*u*j*p+h*c*
s*p-a*g*s*p-l*g*f*t+h*m*f*t+l*c*j*t-a*m*j*t-h*c*q*t+a*g*q*t};a.Matrix4x4.prototype.inverse=function(){var d=this.a00,c=this.a01,f=this.a02,e=this.a03,h=this.a10,g=this.a11,j=this.a12,k=this.a13,l=this.a20,m=this.a21,q=this.a22,p=this.a23,n=this.a30,u=this.a31,s=this.a32,t=this.a33,r=d*g-c*h,w=d*j-f*h,z=d*k-e*h,A=c*j-f*g,v=c*k-e*g,x=f*k-e*j,D=l*u-m*n,C=l*s-q*n,B=l*t-p*n,E=m*s-q*u,y=m*t-p*u,G=q*t-p*s,F=r*G-w*y+z*E+A*B-v*C+x*D;if(!F)return null;F=1/F;return new a.Matrix4x4((g*G-j*y+k*E)*F,(-c*G+f*y-
e*E)*F,(u*x-s*v+t*A)*F,(-m*x+q*v-p*A)*F,(-h*G+j*B-k*C)*F,(d*G-f*B+e*C)*F,(-n*x+s*z-t*w)*F,(l*x-q*z+p*w)*F,(h*y-g*B+k*D)*F,(-d*y+c*B-e*D)*F,(n*v-u*z+t*r)*F,(-l*v+m*z-p*r)*F,(-h*E+g*C-j*D)*F,(d*E-c*C+f*D)*F,(-n*A+u*w-s*r)*F,(l*A-m*w+q*r)*F)};a.Matrix4x4.prototype.toRotationMat=function(){return new a.Matrix4x4(this.a00,this.a01,this.a02,this.a03,this.a10,this.a11,this.a12,this.a13,this.a20,this.a21,this.a22,this.a23,0,0,0,1)};a.Matrix4x4.prototype.toMatrix3x3=function(){return new a.Matrix4x4(this.a00,
this.a01,this.a02,this.a10,this.a11,this.a12,this.a20,this.a21,this.a22)};a.Matrix4x4.prototype.toInverseMat3=function(){var d=this.a00,c=this.a01,f=this.a02,e=this.a10,h=this.a11,g=this.a12,j=this.a20,k=this.a21,l=this.a22,m=l*h-g*k,q=-l*e+g*j,p=k*e-h*j;return!(d*m+c*q+f*p)?null:new a.Matrix3x3(m*id,(-l*c+f*k)*id,(g*c-f*h)*id,q*id,(l*d-f*j)*id,(-g*d+f*e)*id,p*id,(-k*d+c*j)*id,(h*d-c*e)*id)};a.Matrix4x4.prototype.multiply=function(d){var c=this.a00,f=this.a01,e=this.a02,h=this.a03,g=this.a10,j=this.a11,
k=this.a12,l=this.a13,m=this.a20,q=this.a21,p=this.a22,n=this.a23,u=this.a30,s=this.a31,t=this.a32,r=this.a33,w=d.a00,z=d.a01,A=d.a02,v=d.a03,x=d.a10,D=d.a11,C=d.a12,B=d.a13,E=d.a20,y=d.a21,G=d.a22,F=d.a23,H=d.a30,I=d.a31,J=d.a32;d=d.a33;return new a.Matrix4x4(w*c+z*g+A*m+v*u,w*f+z*j+A*q+v*s,w*e+z*k+A*p+v*t,w*h+z*l+A*n+v*r,x*c+D*g+C*m+B*u,x*f+D*j+C*q+B*s,x*e+D*k+C*p+B*t,x*h+D*l+C*n+B*r,E*c+y*g+G*m+F*u,E*f+y*j+G*q+F*s,E*e+y*k+G*p+F*t,E*h+y*l+G*n+F*r,H*c+I*g+J*m+d*u,H*f+I*j+J*q+d*s,H*e+I*k+J*p+d*t,
H*h+I*l+J*n+d*r)};a.Matrix4x4.prototype.multiplyVector3=function(d){return new a.Vector3D(d.x*this.a00+d.y*this.a10+d.z*this.a20+this.a30,d.x*this.a01+d.y*this.a11+d.z*this.a21+this.a31,d.x*this.a02+d.y*this.a12+d.z*this.a22+this.a32)};a.Matrix4x4.prototype.multiplyVector4=function(d){return new a.Vector4D(d.x*this.a00+d.y*this.a10+d.z*this.a20+d.w*this.a30,d.x*this.a01+d.y*this.a11+d.z*this.a21+d.w*this.a31,d.x*this.a02+d.y*this.a12+d.z*this.a22+d.w*this.a32,d.x*this.a03+d.y*this.a13+d.z*this.a23+
d.w*this.a33)};a.Matrix4x4.prototype.translate=function(d){return new a.Matrix4x4(this.a00,this.a01,this.a02,this.a03,this.a10,this.a11,this.a12,this.a13,this.a20,this.a21,this.a22,this.a23,this.a00*d.x+this.a10*d.y+this.a20*d.z+this.a30,this.a01*d.x+this.a11*d.y+this.a21*d.z+this.a31,this.a02*d.x+this.a12*d.y+this.a22*d.z+this.a32,this.a03*d.x+this.a13*d.y+this.a23*d.z+this.a33)};a.Matrix4x4.prototype.scale=function(d){return new a.Matrix4x4(this.a00*d.x,this.a01*d.x,this.a02*d.x,this.a03*d.x,this.a10*
d.y,this.a11*d.y,this.a12*d.y,this.a13*d.y,this.a20*d.z,this.a21*d.z,this.a22*d.z,this.a23*d.z,this.a30,this.a31,this.a32,this.a33)};a.Matrix4x4.prototype.rotate=function(d,c){var f=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z);if(!f)return null;1!==f&&(f=1/f,c.x*=f,c.y*=f,c.z*=f);var e=Math.sin(d),h=Math.cos(d),g=1-h,f=this.a00,j=this.a01,k=this.a02,l=this.a03,m=this.a10,q=this.a11,p=this.a12,n=this.a13,u=this.a20,s=this.a21,t=this.a22,r=this.a23,w=c.x*c.x*g+h,z=c.y*c.x*g+c.z*e,A=c.z*c.x*g-c.y*e,v=c.x*c.y*
g-c.z*e,x=c.y*c.y*g+h,D=c.z*c.y*g+c.x*e,C=c.x*c.z*g+c.y*e,e=c.y*c.z*g-c.x*e,h=c.z*c.z*g+h;return new a.Matrix4x4(f*w+m*z+u*A,j*w+q*z+s*A,k*w+p*z+t*A,l*w+n*z+r*A,f*v+m*x+u*D,j*v+q*x+s*D,k*v+p*x+t*D,l*v+n*x+r*D,f*C+m*e+u*h,j*C+q*e+s*h,k*C+p*e+t*h,l*C+n*e+r*h,this.a30,this.a31,this.a32,this.a33)};a.Matrix4x4.prototype.rotateX=function(d){var c=Math.sin(d);d=Math.cos(d);var f=this.a10,e=this.a11,h=this.a12,g=this.a13,j=this.a20,k=this.a21,l=this.a22,m=this.a23;return new a.Matrix4x4(this.a00,this.a01,
this.a02,this.a03,f*d+j*c,e*d+k*c,h*d+l*c,g*d+m*c,f*-c+j*d,e*-c+k*d,h*-c+l*d,g*-c+m*d,this.a30,this.a31,this.a32,this.a33)};a.Matrix4x4.prototype.rotateY=function(d){var c=Math.sin(d);d=Math.cos(d);var f=this.a00,e=this.a01,h=this.a02,g=this.a03,j=this.a20,k=this.a21,l=this.a22,m=this.a23;return new a.Matrix4x4(f*d+j*-c,e*d+k*-c,h*d+l*-c,g*d+m*-c,this.a10,this.a11,this.a12,this.a13,f*c+j*d,e*c+k*d,h*c+l*d,g*c+m*d,this.a30,this.a31,this.a32,this.a33)};a.Matrix4x4.prototype.rotateZ=function(d){var c=
Math.sin(d);d=Math.cos(d);var f=this.a00,e=this.a01,h=this.a02,g=this.a03,j=this.a10,k=this.a11,l=this.a12,m=this.a13;return new a.Matrix4x4(f*d+j*c,e*d+k*c,h*d+l*c,g*d+m*c,f*-c+j*d,e*-c+k*d,h*-c+l*d,g*-c+m*d,this.a20,this.a21,this.a22,this.a23,this.a30,this.a31,this.a32,this.a33)};a.Matrix4x4.prototype.frustum=function(d,c,f,e,h,g){var j=c-d,k=e-f,l=g-h;return new a.Matrix4x4(2*h/j,0,0,0,0,2*h/k,0,0,(c+d)/j,(e+f)/k,-(g+h)/l,-1,0,0,-(2*g*h)/l,0)};a.Matrix4x4.prototype.perspective=function(a,c,f,e){a=
f*Math.tan(a*Math.PI/360);c*=a;return this.frustum(-c,c,-a,a,f,e)};a.Matrix4x4.prototype.ortho=function(d,c,f,e,h,g){var j=c-d,k=e-f,l=g-h;return new a.Matrix4x4(2/j,0,0,0,0,2/k,0,0,0,0,-2/l,0,-(d+c)/j,-(e+f)/k,-(g+h)/l,1)};a.Matrix4x4.prototype.lookAt=function(d,c,f){if(d.x===c.x&&d.y===c.y&&d.z===c.z)return(new a.Matrix4x4).setIdentity();var e=d.x-c.x,h=d.y-c.y;c=d.z-c.z;var g=1/Math.sqrt(e*e+h*h+c*c),e=e*g,h=h*g;c*=g;var j=f.y*c-f.z*h,k=f.z*e-f.x*c;f=f.x*h-f.y*e;(g=Math.sqrt(j*j+k*k+f*f))?(g=1/
g,j*=g,k*=g,f*=g):f=k=j=0;var l=h*f-c*k,m=c*j-e*f,q=e*k-h*j;(g=Math.sqrt(l*l+m*m+q*q))?(g=1/g,l*=g,m*=g,q*=g):q=m=l=0;return new a.Matrix4x4(j,l,e,0,k,m,h,0,f,q,c,0,-(j*d.x+k*d.y+f*d.z),-(l*d.x+m*d.y+q*d.z),-(e*d.x+h*d.y+c*d.z),1)};a.Matrix4x4.prototype.fromRotationTranslation=function(d){var c=2*this.x,f=2*this.y,e=2*this.z,h=this.x*c,g=this.x*f,j=this.x*e,k=this.y*f,l=this.y*e,m=this.z*e,c=this.w*c,f=this.w*f,e=this.w*e;return new a.Matrix4x4(1-(k+m),g+e,j-f,0,g-e,1-(h+m),l+c,0,j+f,l-c,1-(h+k),
0,d.x,d.y,d.z,1)};a.Quaternion=function(a,c,f,e){this.x=a||0;this.y=c||0;this.z=f||0;this.w=e||0};a.Quaternion.prototype.clone=function(){return new a.Quaternion(this.x,this.y,this.z,this.w)};a.Quaternion.prototype.setIdentity=function(){this.z=this.y=this.x=0;this.w=1;return this};a.Quaternion.prototype.calculateW=function(){return new a.Quaternion(this.x,this.y,this.z,-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)))};a.Quaternion.prototype.dot=function(a){return this.x*a.x+this.y*
a.y+this.z*a.z+this.w*a.w};a.Quaternion.prototype.inverse=function(){var d=this.dot(this),c=0;0!=d&&(c=1/d);return new a.Quaternion(-this.x*c,-this.y*c,-this.z*c,this.w*c)};a.Quaternion.prototype.conjugate=function(){return new a.Quaternion(-this.x,-this.y,-this.z,this.w)};a.Quaternion.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)};a.Quaternion.prototype.normalize=function(){var d=this.length();if(0===d)return new a.Quaternion;d=1/d;return new a.Quaternion(this.x*
d,this.y*d,this.z*d,this.w*d)};a.Quaternion.prototype.add=function(d){return new a.Quaternion(this.x+d.x,this.y+d.y,this.z+d.z,this.w+d.w)};a.Quaternion.prototype.multiply=function(d){return new a.Quaternion(this.x*d.w+this.w*d.x+this.y*d.z-this.z*d.y,this.y*d.w+this.w*d.y+this.z*d.x-this.x*d.z,this.z*d.w+this.w*d.z+this.x*d.y-this.y*d.x,this.w*d.w-this.x*d.x-this.y*d.y-this.z*d.z)};a.Quaternion.prototype.multiplyVector3=function(d){var c=this.w*d.x+this.y*d.z-this.z*d.y,f=this.w*d.y+this.z*d.x-this.x*
d.z,e=this.w*d.z+this.x*d.y-this.y*d.x;d=-this.x*d.x-this.y*d.y-this.z*d.z;return new a.Vector3D(c*this.w+d*-this.x+f*-this.z-e*-this.y,f*this.w+d*-this.y+e*-this.x-c*-this.z,e*this.w+d*-this.z+c*-this.y-f*-this.x)};a.Quaternion.prototype.scale=function(d){return new a.Quaternion(this.x*d,this.y*d,this.z*d,this.w*d)};a.Quaternion.prototype.toMatrix3x3=function(){var d=this.x+this.x,c=this.y+this.y,f=this.z+this.z,e=this.x*d,h=this.x*c,g=this.x*f,j=this.y*c,k=this.y*f,l=this.z*f,d=this.w*d,c=this.w*
c,f=this.w*f;return new a.Matrix3x3(1-(j+l),h+f,g-c,h-f,1-(e+l),k+d,g+c,k-d,1-(e+j))};a.Quaternion.prototype.toMat4=function(){var d=this.x+this.x,c=this.y+this.y,f=this.z+this.z,e=this.x*d,h=this.x*c,g=this.x*f,j=this.y*c,k=this.y*f,l=this.z*f,d=this.w*d,c=this.w*c,f=this.w*f;return new a.Matrix4x4(1-(j+l),h+f,g-c,0,h-f,1-(e+l),k+d,0,g+c,k-d,1-(e+j),0,0,0,0,1)};a.Quaternion.prototype.slerp=function(d,c){var f=this.x*d.x+this.y*d.y+this.z*d.z+this.w*d.w;if(1<=Math.abs(f))return new a.Quaternion(this.x,
this.y,this.z,this.w);var e=Math.acos(f),h=Math.sqrt(1-f*f);if(0.0010>Math.abs(h))return new a.Quaternion(0.5*this.x+0.5*d.x,0.5*this.y+0.5*d.y,0.5*this.z+0.5*d.z,0.5*this.w+0.5*d.w);f=Math.sin((1-c)*e)/h;e=Math.sin(c*e)/h;return new a.Quaternion(this.x*f+d.x*e,this.y*f+d.y*e,this.z*f+d.z*e,this.w*f+d.w*e)};a.Quaternion.prototype.fromRotationMatrix=function(d){var c=new a.Quaternion;fTrace=d.a00+d.a11+d.a22;var f;if(0<fTrace)f=Math.sqrt(fTrace+1),c.w=0.5*f,f=0.5/f,c.x=(d.a21-d.a12)*f,c.y=(d.a02-d.a20)*
f,c.z=(d.a10-d.a01)*f;else{f=[1,2,0];var e=0;d=[d.a00,d.a01,d.a02,d.a10,d.a11,d.a12,d.a20,d.a21,d.a22];d[4]>d[0]&&(e=1);d[8]>d[3*e+e]&&(e=2);var h=f[e],g=f[h];f=Math.sqrt(d[3*e+e]-d[3*h+h]-d[3*g+g]+1);0==e?c.x=0.5*f:1==e?c.y=0.5*f:c.z=0.5*f;f=0.5/f;c.w=(d[3*g+h]-d[3*h+g])*f;0==h?c.x=(d[3*h+e]+d[3*e+h])*f:1==h?c.y=(d[3*h+e]+d[3*e+h])*f:c.z=(d[3*h+e]+d[3*e+h])*f;0==h?c.x=(d[3*g+e]+d[3*e+g])*f:1==h?c.y=(d[3*g+e]+d[3*e+g])*f:c.z=(d[3*g+e]+d[3*e+g])*f}return c};a.Quaternion.prototype.setIdentity=function(){this.z=
this.y=this.x=0;this.w=1;return this};a.Quaternion.prototype.fromAngleAxis=function(d,c){var f=0.5*d,e=Math.sin(f);return new a.Quaternion(Math.cos(f),e*c.x,e*c.y,e*c.z)};a.Quaternion.prototype.toAngleAxis=function(){var d=this.x*this.x+this.y*this.y+this.z*this.z,c=new a.Vector4D;0<d?(c.w=2*Math.acos(this.w),d=a.RenderMath.inverseSqrt(d),c.x=this.x*d,c.y=this.y*d,c.z=this.z*d):(c.x=1,c.y=0,c.z=0,c.w=0);return c};a.Matrix4x4.prototype.toArray=function(){return[this.a00,this.a01,this.a02,this.a03,
this.a10,this.a11,this.a12,this.a13,this.a20,this.a21,this.a22,this.a23,this.a30,this.a31,this.a32,this.a33]};return a}(descartesJS||{}),descartesJS=function(a){function d(a,c){return c.depth-a.depth}if(a.loadLib)return a;a.Scene=function(a){this.parent=a;this.graphics=[]};a.Scene.prototype.add=function(a){this.graphics.push(a)};a.Scene.prototype.draw=function(){for(var a=0,c=this.graphics.length;a<c;a++)this.graphics[a].transformVertices(this.parent);this.graphics=this.graphics.sort(d);a=0;for(c=
this.graphics.length;a<c;a++)this.graphics[a].draw()};a.Primitive3D=function(d,j,k,l,m){this.vertices=d;this.type=j;this.style=k;this.mvMatrix=l;this.ctx=m;this.transformedVertices=[];this.centroid=new a.Vector4D(0,0,0,1);"vertex"===j?this.draw=c:"triangle"===j?this.draw=drawTriangle:"face"===j?this.draw=f:"text"===j?this.draw=e:"segment"===j&&(this.draw=h)};a.Primitive3D.prototype.transformVertices=function(a){for(var c=this.depth=0,d=this.vertices.length;c<d;c++)this.transformedVertices[c]=a.perspectiveMatrix.multiplyVector4(this.vertices[c]).toVector3D(),
this.depth+=this.transformedVertices[c].z,this.transformedVertices[c].x=a.transformCoordinateX(this.transformedVertices[c].x),this.transformedVertices[c].y=a.transformCoordinateY(this.transformedVertices[c].y);this.depth/=d};a.Primitive3D.prototype.setStyle=function(){for(var a in this.style)this.ctx[a]=this.style[a]};var c=function(){},f=function(){var a=this.ctx;this.setStyle();a.beginPath();a.moveTo(this.transformedVertices[0].x,this.transformedVertices[0].y);for(var c=1,d=this.transformedVertices.length;c<
d;c++)a.lineTo(this.transformedVertices[c].x,this.transformedVertices[c].y);a.closePath();"wire"==this.style.model?(a.lineWidth=1,a.strokeStyle=this.fillStyle,a.stroke()):this.style.edges&&a.stroke();a.fill()},e=function(){},h=function(){};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Graphic3D=function(d,c){this.parent=d;var f=this.parent.evaluator.parser;this.evaluator=d.evaluator;this.spaceID="E0";this.type="";this.background=!1;this.color="#eeffaa";this.backcolor=
"#6090a0";this.Nu=this.evaluator.parser.parse("7");this.Nv=this.evaluator.parser.parse("7");this.drawif=f.parse("1");this.abs_coord=!1;this.family=this.trace="";this.family_interval=f.parse("[0,1]");this.family_steps=f.parse("8");this.parameter="t";this.parameter_interval=f.parse("[0,1]");this.parameter_steps=f.parse("8");this.fillM=this.fillP=this.fill="";this.length=this.width=-1;this.editable=!1;this.info="";this.font="Monospaced,PLAIN,12";this.fixed=!0;this.size=f.parse("2");this.text="";this.decimals=
f.parse("2");this.spear=f.parse("8");this.arrow="#ee0022";this.center=f.parse("(0,0)");this.radius=f.parse("1");this.init=f.parse("0");this.end=f.parse("90");this.file="";this.inirot=f.parse("0");for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e]);void 0==this.expresion&&"macro"!=this.type&&(this.expresion=f.parse("(0,0)"));this.space=this.getSpace();this.canvas=this.background?this.space.backgroundCanvas:this.space.canvas;this.ctx=this.canvas.getContext("2d");this.trace&&(this.traceCtx=this.space.backgroundCanvas.getContext("2d"));
this.font=a.convertFont(this.font)};a.Graphic3D.prototype.getSpace=function(){for(var a=this.parent.spaces,c,f=0,e=a.length;f<e;f++)if(c=a[f],c.id==this.spaceID)return c;return a[0]};a.Graphic3D.prototype.getFamilyValues=function(){var a=this.evaluator,c=a.evalExpression(this.family_interval);this.familyInf=c[0][0];this.familySup=c[0][1];this.fSteps=Math.round(a.evalExpression(this.family_steps));this.family_sep=0<this.fSteps?(this.familySup-this.familyInf)/this.fSteps:0};a.Graphic3D.prototype.drawFamilyAux=
function(a,c,f){var e=this.evaluator;this.getFamilyValues();var h=e.getVariable(this.family);if(0<=this.fSteps)for(var g=0,j=this.fSteps;g<=j;g++)e.setVariable(this.family,this.familyInf+g*this.family_sep),e.evalExpression(this.drawif)&&(this.update(),this.drawAux(a,c,f));e.setVariable("_Text_H_",0);e.setVariable(this.family,h)};a.Graphic3D.prototype.draw=function(a,c){""!=this.family?this.drawFamilyAux(this.ctx,a,c):this.evaluator.evalExpression(this.drawif)&&(this.update(),this.drawAux(this.ctx,
a,c))};a.Graphic3D.prototype.drawTrace=function(a,c){""!=this.family?this.drawFamilyAux(this.traceCtx,a,c):this.evaluator.evalExpression(this.drawif)&&(this.update(),this.drawAux(this.traceCtx,a,c))};a.Graphic3D.prototype.drawText=function(d,c,f,e,h,g,j,k,l,m){if("rtfNode"==c.type)d.fillStyle=h,d.strokeStyle=h,d.textBaseline="alphabetic",c.draw(d,f,e,l,m,j);else{f+=g.match("Arial")?-2:g.match("Times")?-2:0;var q=this.evaluator;d.fillStyle=a.getColor(q,h);d.font=g;d.textAlign=j;d.textBaseline=k;this.fontSize=
(this.fontSize=g.match(/(\d+)px/))?this.fontSize[1]:"10";this.border&&(d.strokeStyle=a.getColor(q,this.border),d.lineWidth=parseFloat(this.fontSize)/12);g=1.2*this.fontSize;if(c[0]&&c[0].type){j=0;for(k=c.length;j<k;j++)h=q.evalExpression(c[j],l,m),this.border&&d.strokeText(h,f,e+g*j),d.fillText(h,f,e+g*j)}else{j=0;for(k=c.length;j<k;j++)h=c[j],this.border&&d.strokeText(h,f,e+g*j),d.fillText(h,f,e+g*j)}}};a.Graphic3D.prototype.findExpresionX=function(a){return(a=a.split(/x=/)[1])?(a=a.split(/y=/)[0],
a=a.split(/z=/)[0]):""};a.Graphic3D.prototype.findExpresionY=function(a){return(a=a.split(/y=/)[1])?(a=a.split(/x=/)[0],a=a.split(/z=/)[0]):""};a.Graphic3D.prototype.findExpresionZ=function(a){return(a=a.split(/z=/)[1])?(a=a.split(/x=/)[0],a=a.split(/y=/)[0]):""};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Surface3D=function(c,d){a.Graphic3D.call(this,c,d);var e=this.evaluator.parser;this.width=-1==this.width?e.parse("1"):this.width;this.mvMatrix=(new a.Matrix4x4).setIdentity();
this.exprX=e.parse(this.findExpresionX(this.expresion));this.exprY=e.parse(this.findExpresionY(this.expresion));this.exprZ=e.parse(this.findExpresionZ(this.expresion))};a.extend(a.Surface3D,a.Graphic3D);var d,c,f,e,h,g,j,k,l;a.Surface3D.prototype.update=function(){d=this.evaluator;d.getVariable("u");d.getVariable("v");d.setVariable("u",0);d.setVariable("v",0);c=d.evalExpression(this.Nu);f=d.evalExpression(this.Nv);l=a.getColor(d,this.color);j=[];for(var m=0;m<=c;m++){d.setVariable("u",m/c);for(var q=
0;q<=f;q++)d.setVariable("v",q/f),e=d.evalExpression(this.exprX),h=d.evalExpression(this.exprY),d.setVariable("x",e),d.setVariable("y",h),g=d.evalExpression(this.exprZ),j.push(new a.Vector4D(e,h,g,1))}for(m=0;m<c;m++)for(q=0;q<f;q++)k=[],k.push(j[q+m*f+m]),k.push(j[q+1+m*f+m]),k.push(j[q+2+(m+1)*f+m]),k.push(j[q+1+(m+1)*f+m]),this.space.scene.add(new a.Primitive3D(k,"face",{lineWidth:2,fillStyle:l,strokeStyle:"#808080",lineCap:"round",lineJoin:"round",edges:this.edges},this.mvMatrix,this.ctx))};return a}(descartesJS||
{}),descartesJS=function(a){if(a.loadLib)return a;a.Mesh3D=function(c,d){a.Graphic3D.call(this,c,d);var h=this.evaluator.parser;this.width=-1==this.width?h.parse("1"):this.width;this.mvMatrix=(new a.Matrix4x4).setIdentity();h=a.openExternalFile(this.evaluator.evalExpression(this.file)).split(/\r/);this.vertices=[];this.faces=[];for(var g=function(a){return parseInt(a)},j=0,k=h.length;j<k;j++)h[j].match(/^V\(/)?this.vertices.push(this.evaluator.parser.parse(h[j].substring(1),!1,this.name)):h[j].match(/^F\(/)?
this.faces.push(h[j].substring(2,h[j].length-1).split(",").map(g)):h[j].match(/^VAR\(/)&&this.evaluator.evalExpression(this.evaluator.parser.parse(h[j].substring(4,h[j].length-1),!0,this.name))};a.extend(a.Mesh3D,a.Graphic3D);var d,c;a.Mesh3D.prototype.update=function(){d=this.evaluator;c=a.getColor(d,this.color);for(var f,e,h=0,g=this.faces.length;h<g;h++){f=[];for(var j=0,k=this.faces[h].length;j<k;j++)e=this.evaluator.evalExpression(this.vertices[this.faces[h][j]])[0],f.push(new a.Vector4D(e[0],
e[1],e[2],1));this.space.scene.add(new a.Primitive3D(f,"face",{lineWidth:2,fillStyle:c,strokeStyle:"#808080",lineCap:"round",lineJoin:"round",edges:this.edges},this.mvMatrix,this.ctx))}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.max,c=Math.min;a.R2=function(a,c){this.x=a||0;this.y=c||0};a.R2.prototype.copy=function(){return new a.R2(this.x,this.y)};a.R2.prototype.ix=function(){return Math.round(d(c(this.x,32E3),-32E3))};a.R2.prototype.iy=function(){return Math.round(d(c(this.y,
32E3),-32E3))};a.R2.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};a.R2.prototype.norm2=function(){return this.x*this.x+this.y*this.y};a.R2.prototype.norm=function(){return Math.sqrt(this.norm2())};a.R2.prototype.distance=function(a){var c=this.copy();c.sub(a);return c.norm()};a.R2.prototype.dot=function(a){return this.x*a.x+this.y*a.y};a.R2.prototype.det=function(a){return this.x*a.y-this.y*a.x};a.R2.prototype.mul=function(a){this.x*=a;this.y*=a};a.R2.prototype.div=function(a){this.x/=
a;this.y/=a};a.R2.prototype.add=function(a){this.x+=a.x;this.y+=a.y};a.R2.prototype.sub=function(a){this.x-=a.x;this.y-=a.y};a.R2.prototype.normalize=function(){var a=this.norm();0!=a&&this.div(a)};a.R2.prototype.rotR90=function(){var a=this.x;this.x=this.y;this.y=-a};a.R2.prototype.rotL90=function(){var a=this.x;this.x=-this.y;this.y=a};a.R2.prototype.rot=function(a){var c=this.copy(),d=Math.cos(a);a=Math.sin(a);this.x=c.x*d-c.y*a;this.y=c.x*a+c.y*d};a.R2.prototype.rot=function(a){this.rot(a*Math.PI/
180)};a.R2.prototype.intersection=function(f,e,h,g){var j=e.x-f.x,k=h.x-g.x,l=h.x-f.x,m=e.y-f.y,q=h.y-g.y,p=h.y-f.y,n=j*q-k*m;return 1E-6<Math.abs(n)?(e=(l*q-p*k)/n,h=(-l*m+p*j)/n,0<=e&&1>=e&&0<=h&&1>=h?new a.R2(f.x+j*e,f.y+m*e):null):(e.x-h.x)*p!=(e.y-h.y)*l?null:f.x!=e.x?(j=c(f.x,e.x),f=d(f.x,e.x),j<=h.x&&h.x<=f?h:j<=g.x&&g.x<=f?g:null):h.x!=g.x?(j=c(h.x,g.x),h=d(h.x,g.x),j<=f.x&&f.x<=h?f:j<=e.x&&e.x<=h?e:null):f.y!=e.y?(j=c(f.y,e.y),f=d(f.y,e.y),j<=h.y&&h.y<=f?h:j<=g.y&&g.y<=f?g:null):h.y!=g.y?
(j=c(h.y,g.y),h=d(h.y,g.y),j<=f.y&&f.y<=h?f:j<=e.y&&e.y<=h?e:null):f.x==h.x&&f.y==h.y?f:null};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.R2Newton=function(a,c){this.evaluator=a;this.constraint=c;if("=="==this.constraint.value||"<"==this.constraint.value||"<="==this.constraint.value||">"==this.constraint.value||">="==this.constraint.value)this.sign="<"==this.constraint.value||"<="==this.constraint.value?"menor":">"==this.constraint.value||">="==this.constraint.value?
"mayor":"igual",this.constraint=this.constraint.equalToMinus(),this.constraint=this.constraint.childs[0]};a.R2Newton.prototype.getUnitNormal=function(){this.normal.normalize();return this.normal.copy()};a.R2Newton.prototype.gradient=function(d){var c=this.evaluator,f=new a.R2(0,0),e=c.getVariable("x"),h=c.getVariable("y");c.setVariable("x",d.x);c.setVariable("y",d.y);this.f0=c.evalExpression(this.constraint);c.setVariable("x",c.getVariable("x")+1E-12);d=c.evalExpression(this.constraint);f.x=(d-this.f0)/
1E-12;f.x=!isNaN(f.x)?f.x:Infinity;c.setVariable("x",c.getVariable("x")-1E-12);c.setVariable("y",c.getVariable("y")+1E-12);d=c.evalExpression(this.constraint);f.y=(d-this.f0)/1E-12;f.y=!isNaN(f.y)?f.y:Infinity;c.setVariable("x",e);c.setVariable("y",h);return f};a.R2Newton.prototype.findZero=function(a){var c=this.evaluator,f=a.copy(),e=c.getVariable("x"),h=c.getVariable("y");c.setVariable("x",a.x);c.setVariable("y",a.y);this.f0=c.evalExpression(this.constraint);if("menor"==this.sign&&0>=this.f0||
"mayor"==this.sign&&0<=this.f0)return f;c.setVariable("x",e);c.setVariable("y",h);for(h=0;256>h;h++)if(c=f.x,e=f.y,this.normal=this.gradient(f),0!=this.normal.norm2()&&this.normal.mul(-this.f0/this.normal.norm2()),f.x=c+this.normal.x,f.y=e+this.normal.y,1E-6>this.normal.norm()){0==this.normal.x&&0==this.normal.y&&(this.normal.x=f.x-a.x,this.normal.y=f.y-a.y);break}return f};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=2*Math.PI;a.GraphicControl=function(c,d){this.parent=
c;this.evaluator=c.evaluator;var e=this.evaluator.parser;this.id="G";this.type="";this.spaceID="E0";this.text="";this.expresion=e.parse("(0,0)");this.y=this.x=0;this.size=e.parse("4");this.fixed=2!=this.parent.version?!1:!0;this.color="#0000ff";this.colorInt="#ff0000";this.font="Monospaced,PLAIN,12";this.image=new Image;this.image.onload=function(){this.ready=1};this.imageSrc="";this.drawif=e.parse("1");this.activeif=e.parse("1");this.tooltip="";this.tooltipFont="Monospace 12px";this.Explanation=
"";this.ExplanationFont="Monospace 12px";this.decimals=e.parse("2");this.zIndex=-1;for(var h in d)d.hasOwnProperty(h)&&(this[h]=d[h]);this.font=a.convertFont(this.font);this.constraintExpr&&(this.constraint=e.parse(this.constraintExpr),"(expr)"==this.constraint.type&&(this.constraint=e.parse(this.constraintExpr.substring(1,this.constraintExpr.length-1))),"compOperator"==this.constraint.type?this.newt=new a.R2Newton(this.evaluator,this.constraint):this.constraint=null);this.container=this.getContainer();
this.space=this.getSpace();this.mouseCacher=document.createElement("div");this.mouseCacher.setAttribute("class","DescartesGraphicControl");this.mouseCacher.setAttribute("id",this.id);this.mouseCacher.setAttribute("tabindex","-1");this.ctx=this.space.ctx;this.container.appendChild(this.mouseCacher);this.init();this.registerMouseEvents()};a.GraphicControl.prototype.init=function(){var c=this.evaluator;this.mouseCacher.style.display=0<c.evalExpression(this.drawif)?"block":"none";var d=c.evalExpression(this.expresion);
this.x=d[0][0];this.y=d[0][1];c.setVariable(this.id+".x",this.x);c.setVariable(this.id+".y",this.y);""!=this.imageSrc&&!this.imageSrc.toLowerCase().match(/vacio.gif$/)?(this.image=this.parent.getImage(this.imageSrc),this.width=this.image.width,this.height=this.image.height):(this.width=2*c.evalExpression(this.size),this.height=2*c.evalExpression(this.size));this._w=a.hasTouchSupport&&70>this.width?70:this.width;this._h=a.hasTouchSupport&&70>this.height?70:this.height;this.constraint&&(d=this.newt.findZero(new a.R2(this.x,
this.y)),this.x=d.x,this.y=d.y,c.setVariable(this.id+".x",this.x),c.setVariable(this.id+".y",this.y));this.mouseCacher.setAttribute("style","background-color: rgba(255, 255, 255, 0); width: "+this._w+"px; height: "+this._h+"px; z-index: "+this.zIndex+";");this.mouseCacher.style.left=parseInt(this.space.getAbsoluteX(this.x)-this._w/2)+"px";this.mouseCacher.style.top=parseInt(this.space.getAbsoluteY(this.y)-this._h/2)+"px";c.setVariable(this.id+".activo",0)};a.GraphicControl.prototype.update=function(){var c=
this.evaluator;this.x=c.getVariable(this.id+".x");this.y=c.getVariable(this.id+".y");var d=this.space.getAbsoluteX(this.x),e=this.space.getAbsoluteY(this.y);this.mouseCacher.style.left=d-this._w/2+"px";this.mouseCacher.style.top=e-this._h/2+"px";this.mouseCacher.style.display=0<c.evalExpression(this.activeif)?"block":"none";this.constraint&&(d=this.newt.findZero(new a.R2(this.x,this.y)),this.x=d.x,this.y=d.y,c.setVariable(this.id+".x",this.x),c.setVariable(this.id+".y",this.y));this.draw()};a.GraphicControl.prototype.draw=
function(){var c=this.evaluator;if(0<c.evalExpression(this.drawif)){var f=this.ctx,e=this.space.backgroundCtx,h=this.space.getAbsoluteX(this.x),g=this.space.getAbsoluteY(this.y);""!=this.text&&this.drawText(h,g);this.image.ready?(this.image.complete&&f.drawImage(this.image,h-this.image.width/2,g-this.image.height/2),this.trace&&(e.save(),e.translate(h,g),e.scale(this.image.width/2,this.image.height/2),e.beginPath(),e.arc(0,0,1,0,d,!1),e.restore(),e.lineWidth=1,e.strokeStyle=a.getColor(c,this.trace),
e.stroke())):(f.beginPath(),f.arc(h,g,this.width/2,0,d,!1),f.fillStyle=a.getColor(c,this.colorInt),f.fill(),f.lineWidth=1,f.strokeStyle=a.getColor(c,this.color),f.stroke(),this.active&&(f.beginPath(),f.arc(h,g,this.width/2-2,0,d,!1),f.strokeStyle="black",f.stroke()),this.trace&&(e.lineWidth=1,e.strokeStyle=a.getColor(c,this.trace),e.beginPath(),e.arc(h,g,this.width/2,0,d,!1),e.stroke()))}};a.GraphicControl.prototype.drawText=function(c,d){var e=this.ctx,h=this.evaluator;e.fillStyle=a.getColor(h,this.color);
e.font=this.font;e.textBaseline="alphabetic";h=h.evalExpression(this.text[0],h.evalExpression(this.decimals),this.fixed);e.fillText(h,c+1+this.width/2,d-1-this.height/2)};a.GraphicControl.prototype.getContainer=function(){for(var a=this.parent.spaces,d,e=0,h=a.length;e<h;e++)if(d=a[e],d.id==this.spaceID)return d.addCtr(this),this.zIndex=d.zIndex,d.graphicControlContainer;a[0].addCtr(this);this.zIndex=a[0].zIndex;return a[0].graphicControlContainer};a.GraphicControl.prototype.getSpace=function(){for(var a=
this.parent.spaces,d=0,e=a.length;d<e;d++)if(a[d].id==this.spaceID)return a[d];return a[0]};a.GraphicControl.prototype.deactivate=function(){this.active=!1;this.evaluator.setVariable(this.id+".activo",0)};a.GraphicControl.prototype.registerMouseEvents=function(){function c(c){c.preventDefault();k.whichButton=null==c.which?2>c.button?"LEFT":4==c.button?"MIDDLE":"RIGHT":2>c.which?"LEFT":2==c.which?"MIDDLE":"RIGHT";"LEFT"==k.whichButton&&(0<k.evaluator.evalExpression(k.activeif)&&k.over)&&(k.parent.deactivateGraphiControls(),
k.click=!0,k.active=!0,k.evaluator.setVariable(k.id+".activo",1),k.posAnte=k.getCursorPosition(c),k.prePos={x:k.space.getAbsoluteX(k.x),y:k.space.getAbsoluteY(k.y)},a.hasTouchSupport?(window.addEventListener("touchmove",h,!1),window.addEventListener("touchend",e,!1)):(window.addEventListener("mouseup",e,!1),window.addEventListener("mousemove",h,!1)))}function d(c){c.preventDefault();0<k.evaluator.evalExpression(k.activeif)&&(k.parent.deactivateGraphiControls(),k.click=!0,k.active=!0,k.posAnte=k.getCursorPosition(c),
k.prePos={x:k.space.getAbsoluteX(k.x),y:k.space.getAbsoluteY(k.y)},a.hasTouchSupport?(window.addEventListener("touchmove",h,!1),window.addEventListener("touchend",e,!1)):(window.addEventListener("mouseup",e,!1),window.addEventListener("mousemove",h,!1)))}function e(c){c.preventDefault();if(0<k.evaluator.evalExpression(k.activeif)||k.active)k.click=!1,a.hasTouchSupport?(window.removeEventListener("touchmove",h,!1),window.removeEventListener("touchend",e,!1)):(window.removeEventListener("mouseup",e,
!1),window.removeEventListener("mousemove",h,!1)),k.parent.update(),k.mouseCacher.style.left=k.space.getAbsoluteX(k.x)-k._w/2+"px",k.mouseCacher.style.top=k.space.getAbsoluteY(k.y)-k._h/2+"px"}function h(c){c.preventDefault();c=k.getCursorPosition(c);k.posX=k.prePos.x-(k.posAnte.x-c.x);k.posY=k.prePos.y-(k.posAnte.y-c.y);if(k.constraint){c=k.space.getRelativeX(k.posX);var d=k.space.getRelativeY(k.posY);c=k.newt.findZero(new a.R2(c,d));k.x=c.x;k.y=c.y;k.evaluator.setVariable(k.id+".x",k.x);k.evaluator.setVariable(k.id+
".y",k.y)}else k.evaluator.setVariable(k.id+".x",k.space.getRelativeX(k.posX)),k.evaluator.setVariable(k.id+".y",k.space.getRelativeY(k.posY));k.parent.updateControls();k.parent.update()}function g(){k.over=!0;k.mouseCacher.style.cursor="pointer"}function j(){k.over=!1;k.mouseCacher.style.cursor="";k.click=!1}this.active=this.over=this.click=!1;this.mouseCacher.oncontextmenu=function(){return!1};var k=this;a.hasTouchSupport?this.mouseCacher.addEventListener("touchstart",d,!1):(this.mouseCacher.addEventListener("mousedown",
c,!1),this.mouseCacher.addEventListener("mouseover",g,!1),this.mouseCacher.addEventListener("mouseout",j,!1));this.mouseCacher.addEventListener("blur",function(){console.log("en blur")},!1)};a.GraphicControl.prototype.getCursorPosition=function(c){c=a.getCursorPosition(c);return{x:c.x-(this.space.container.offsetLeft+this.space.container.parentNode.offsetLeft),y:c.y-(this.space.container.offsetTop+this.space.container.parentNode.offsetTop)}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
a.Control=function(a,c){this.parent=a;this.evaluator=a.evaluator;var f=this.parser=a.evaluator.parser;this.id="C";this.gui=this.type="";this.region="south";this.y=this.x=0;this.w=100;this.h=23;"text"!=c.type?this.expresion=f.parse("(0,0,100,23)"):(this.expresion=f.parse("(0,0,300,200)"),this.w=300,this.h=200);this.fixed=2!=this.parent.version?!1:!0;this.visible=!0;this.color="#222222";this.colorInt="#f0f8ff";this.underlined=this.italics=this.bold="";this.font_size=f.parse("12");this.image=new Image;
this.image.onload=function(){this.ready=1};this.imageSrc="";this.imageOver=new Image;this.imageOver.onload=function(){this.ready=1};this.imageDown=new Image;this.imageDown.onload=function(){this.ready=1};this.parameter=this.action="";this.parameterFont="Monospace 12px";this.drawif=f.parse("1");this.activeif=f.parse("1");this.tooltip="";this.tooltipFont="Monospace 12px";this.Explanation="";this.ExplanationFont="Monospace 12px";this.cID=this.msg_pos="";this.valueExpr=f.parse("0");this.decimals=f.parse("2");
this.min=f.parse("-Infinity");this.max=f.parse("Infinity");this.incr=f.parse("0.1");this.exponentialif=this.discrete=!1;this.zIndex=-1;for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e]);void 0==this.name&&(this.name=2==this.parent.version?this.id:"_nada_");f=this.evaluator.evalExpression(this.expresion);this.x=f[0][0];this.y=f[0][1];4==f[0].length&&(this.w=f[0][2],this.h=f[0][3]);this.name="_._"==this.name||"_nada_"==this.name||"_void_"==this.name?"":this.name;this.actionExec=this.parent.lessonParser.parseAction(this)};
a.Control.prototype.init=function(){};a.Control.prototype.update=function(){};a.Control.prototype.draw=function(){};a.Control.prototype.getContainer=function(){var a=this.parent.spaces,c;if("interior"==this.region)for(var f=0,e=a.length;f<e;f++){if(c=a[f],c.id==this.spaceID)return c.addCtr(this),this.zIndex=c.zIndex,c.numericalControlContainer}else{if("external"==this.region)return this.parent.externalSpace.container;if("scenario"==this.region)return this.cID?(this.expresion=this.evaluator.parser.parse("(0,-1000,"+
this.w+","+this.h+")"),this.parent.scenarioRegion.scenarioSpace.addCtr(this),this.zIndex=this.parent.scenarioRegion.scenarioSpace.zIndex,this.parent.scenarioRegion.scenarioSpace.numericalControlContainer):this.parent.externalSpace.container;if("north"==this.region)return this.parent.northSpace.controls.push(this),this.parent.northSpace.container;if("south"==this.region)return this.parent.southSpace.controls.push(this),this.parent.southSpace.container;if("east"==this.region)return this.parent.eastSpace.controls.push(this),
this.parent.eastSpace.container;if("west"==this.region)return this.parent.westSpace.controls.push(this),this.parent.westSpace.container;if("special"==this.region)return this.parent.specialSpace.controls.push(this),this.parent.specialSpace.container}a[0].addCtr(this);this.zIndex=a[0].zIndex;return a[0].numericalControlContainer};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.floor;a.Button=function(c,d){a.Control.call(this,c,d);this.name="["==this.name.charAt(0)&&
this.name.charAt(this.name.length-1)?this.parser.parse(this.name.substring(1,this.name.length-1)):this.parser.parse("'"+this.name+"'");var e;this.imageSrc.match("_COLORES_")&&(e=this.imageSrc.split("_"),this.colorInt=e[2],this.color=e[3],this.font_size=this.parser.parse(e[5]),this.imageSrc="");this.imageSrc="["==this.imageSrc.charAt(0)&&this.imageSrc.charAt(this.imageSrc.length-1)?this.parser.parse(this.imageSrc.substring(1,this.imageSrc.length-1)):this.parser.parse("'"+this.imageSrc+"'");e=this.evaluator.evalExpression(this.imageSrc).trim();
if(""!=e){var h=e.substr(0,e.lastIndexOf(".")),g=e.substr(e.lastIndexOf("."));e.toLowerCase().match(/vacio.gif$/)?(this.image.ready=1,3==this.parent.version&&(this.name=this.parser.parse("")),this.parser.parse("'vacio.gif'")):(this.image=this.parent.getImage(e),this.imageOver=this.parent.getImage(h+"_over"+g),this.imageDown=this.parent.getImage(h+"_down"+g))}e=this.getContainer();this.canvas=document.createElement("canvas");this.canvas.setAttribute("class","DescartesButton");this.canvas.setAttribute("id",
this.id);this.canvas.setAttribute("width",this.w+"px");this.canvas.setAttribute("height",this.h+"px");this.canvas.setAttribute("style","left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.canvas.style.display=0<this.evaluator.evalExpression(this.drawif)?"block":"none";this.ctx=this.canvas.getContext("2d");e.childNodes[0]?e.insertBefore(this.canvas,e.childNodes[0]):e.appendChild(this.canvas);this.registerMouseEvents();this.init()};a.extend(a.Button,a.Control);a.Button.prototype.init=
function(){var a=this.canvas,d=this.evaluator.evalExpression(this.expresion);this.x=d[0][0];this.y=d[0][1];4==d[0].length&&(this.w=parseInt(d[0][2]),this.h=parseInt(d[0][3]));a.setAttribute("width",this.w+"px");a.setAttribute("height",this.h+"px");a.setAttribute("style","left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.createGradient(this.w,this.h);this.draw()};a.Button.prototype.update=function(){var a=!1,d=!1,e=!1,h=!1;0<this.evaluator.evalExpression(this.drawif)?(this.canvas.style.display=
"block",this.draw()):(this.click=!1,this.canvas.style.display="none");this.evaluator.evalExpression(this.activeif);var g=this.evaluator.evalExpression(this.expresion),a=this.x!=g[0][0],d=this.y!=g[0][1];this.x=g[0][0];this.y=g[0][1];4==g[0].length&&(e=this.w!=g[0][2],h=this.h!=g[0][3],this.w=g[0][2],this.h=g[0][3]);(e||h)&&this.createGradient(this.canvas.width,this.canvas.height);if(e||h||a||d)this.canvas.setAttribute("width",this.w+"px"),this.canvas.setAttribute("height",this.h+"px"),this.canvas.setAttribute("style",
"left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";"),this.draw()};a.Button.prototype.createGradient=function(a,f){this.linearGradient=this.ctx.createLinearGradient(0,0,0,f);for(var e=f*f,h,g=0;g<f;g++)h=d(g-35*f/100),this.linearGradient.addColorStop(g/f,"rgba(0,0,0,"+192*h*h/e/255+")")};a.Button.prototype.draw=function(){var c=this.evaluator.evalExpression(this.font_size),f=this.evaluator.evalExpression(this.name),e=this.evaluator.evalExpression(this.imageSrc),h;h="vacio.gif"==e?{ready:!0}:
this.parent.getImage(e);var g=this.ctx;g.clearRect(0,0,this.w,this.h);var j=0,k=0;this.click&&(k=j=1);h&&h.ready?(""!=h.src||!e.toLowerCase().match(/vacio.gif$/))&&h.complete&&g.drawImage(h,(this.w-h.width)/2+j,(this.h-h.height)/2+k):(g.fillStyle=a.getColor(this.evaluator,this.colorInt),g.fillRect(0,0,this.w,this.h),this.click||(a.drawLine(g,this.w-1,0,this.w-1,this.h,"rgba(0,0,0,"+128/255+")"),a.drawLine(g,0,0,0,this.h,"rgba(0,0,0,"+24/255+")"),a.drawLine(g,1,0,1,this.h,"rgba(0,0,0,"+8/255+")")),
g.fillStyle=this.linearGradient,g.fillRect(0,0,this.w,this.h));""!=this.imageOver.src&&(this.imageOver.ready&&this.over)&&g.drawImage(this.imageOver,(this.w-h.width)/2+j,(this.h-h.height)/2+k);""!=this.imageDown.src&&this.imageDown.ready&&this.click?g.drawImage(this.imageDown,(this.w-h.width)/2+j,(this.h-h.height)/2+k):this.click&&(g.save(),a.drawLine(g,0,0,0,this.h-2,"gray"),a.drawLine(g,0,0,this.w-1,0,"gray"),g.fillStyle="rgba(0, 0, 0,"+24/255+")",g.fillRect(0,0,this.w,this.h),g.restore());g.fillStyle=
a.getColor(this.evaluator,this.color);g.font=this.italics+" "+this.bold+" "+c+"px Arial";g.textAlign="center";g.textBaseline="middle";g.strokeStyle=a.getColor(this.evaluator,this.colorInt);g.lineWidth=c/12;this.stroke!=this.fillStyle&&g.strokeText(f,d(this.w/2+j)+0.5,d(this.h/2+k)+0.5);g.fillText(f,d(this.w/2+j)+0.5,d(this.h/2+k)+0.5);this.underlined&&(f=g.measureText(f).width,g.strokeStyle=a.getColor(this.evaluator,this.color),g.lineWidth=d(c/10),g.lineCap="round",g.beginPath(),g.moveTo((this.w-
f)/2+j,d(this.h+c)/2+g.lineWidth/2-1.5+k),g.lineTo((this.w+f)/2+j,d(this.h+c)/2+g.lineWidth/2-1.5+k),g.stroke());this.evaluator.evalExpression(this.activeif)||(g.fillStyle="rgba(240,240,240,"+160/255+")",g.fillRect(0,0,this.w,this.h))};a.Button.prototype.bottonPressed=function(){this.parent.updateControls();"init"==this.action&&(this.click=!1);this.actionExec.execute();this.parent.updateControls();"animate"!=this.action&&this.parent.update()};a.Button.prototype.registerMouseEvents=function(){function c(a,
d,e){k.click?(d.call(k),a=e?a:30,m=setTimeout(function(){c(a,d)},a)):clearInterval(m)}function d(a){a.preventDefault();k.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==k.whichButton&&0<k.evaluator.evalExpression(k.activeif)&&(k.click=!0,k.draw(),k.evaluator.setVariable(k.id,k.evaluator.evalExpression(k.valueExpr)),"calculate"==k.action&&c(l,k.bottonPressed,!0),j?window.addEventListener("touchend",e,!1):window.addEventListener("mouseup",
e,!1))}function e(a){if(0<k.evaluator.evalExpression(k.activeif)||k.click)k.click=!1,k.draw(),"calculate"!=k.action&&k.bottonPressed(),a.preventDefault(),j?window.removeEventListener("touchend",e,!1):window.removeEventListener("mouseup",e,!1)}function h(){k.over=!0;k.draw()}function g(){k.over=!1;k.click=!1;k.draw()}var j=a.hasTouchSupport;this.canvas.oncontextmenu=function(){return!1};var k=this,l=900,m;this.over=this.click=!1;j?this.canvas.addEventListener("touchstart",d,!1):(this.canvas.addEventListener("mousedown",
d,!1),this.canvas.addEventListener("mouseover",h,!1),this.canvas.addEventListener("mouseout",g,!1))};return a}(descartesJS||{}),descartesJS=function(a){function d(a,c,d,e){a.fillStyle=e||"black";a.beginPath();a.moveTo(c[0],d[0]);e=1;for(var f=c.length;e<f;e++)a.lineTo(c[e],d[e]);a.fill()}if(a.loadLib)return a;var c;a.Spinner=function(c,d){a.Control.call(this,c,d);this.tabindex=++this.parent.tabindex;var e=this.getContainer();this.containerControl=document.createElement("div");this.canvas=document.createElement("canvas");
this.divUp=document.createElement("div");this.divDown=document.createElement("div");this.field=document.createElement("input");this.label=document.createElement("label");this.txtLabel=document.createTextNode(this.name);this.label.appendChild(this.txtLabel);""!=this.name.trim()&&this.containerControl.appendChild(this.label);this.containerControl.appendChild(this.field);this.containerControl.appendChild(this.canvas);this.containerControl.appendChild(this.divUp);this.containerControl.appendChild(this.divDown);
e.childNodes[0]?e.insertBefore(this.containerControl,e.childNodes[0]):e.appendChild(this.containerControl);this.originalIncr=this.incr;0>=this.evaluator.evalExpression(this.decimals)&&(e=this.evaluator.evalExpression(this.incr),0<e?this.originalIncr=this.incr=this.evaluator.parser.parse(parseInt(e).toString()):this.incr=this.evaluator.parser.parse("1"));this.init();this.registerMouseEvents();this.draw()};a.extend(a.Spinner,a.Control);a.Spinner.prototype.init=function(){var c=this.evaluator;this.value=
this.validateValue(c.evalExpression(this.valueExpr));var d=this.formatOutputValue(this.value);this.fieldFontSize=2!=this.parent.version?a.getFieldFontSize(this.h):10;var e=2!=this.parent.version?"":"mmmmm",f=a.getTextWidth(d+"m",this.fieldFontSize+"px Arial"),g=2+this.h/2,h=this.w/2-g/2,e=a.getTextWidth(this.name+e,this.fieldFontSize+"px Arial");this.visible||(h=this.w-g,f=0);h<e&&(h=e);""==this.name&&(h=0);this.w-h-g<f&&(h=this.w-g-f);0>h&&(h=0);e=this.w-(h+g);this.containerControl.setAttribute("class",
"DescartesSpinnerContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=0<c.evalExpression(this.drawif)?"block":"none";this.canvas.setAttribute("width",g+"px");this.canvas.setAttribute("height",this.h+"px");this.canvas.setAttribute("style","position: absolute; left: "+h+"px; top: 0px;");this.ctx=this.canvas.getContext("2d");this.divUp.setAttribute("style",
"background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+g+"px; height : "+this.h/2+"px; left: "+h+"px; top: 0px;");this.divDown.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+g+"px; height : "+this.h/2+"px; left: "+h+"px; top: "+this.h/2+"px;");this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"_spinner");this.field.value=d;this.field.setAttribute("class","DescartesSpinnerField");
this.field.setAttribute("style","font-family: Arial; font-size: "+this.fieldFontSize+"px; width : "+(e-2)+"px; height : "+(this.h-2)+"px; left: "+(g+h)+"px;");this.field.setAttribute("tabindex",this.tabindex);this.field.disabled=j?!1:!0;this.label.setAttribute("class","DescartesSpinnerLabel");this.label.setAttribute("style","font-size:"+this.fieldFontSize+"px; width: "+h+"px; height: "+this.h+"px; line-height: "+this.h+"px;");c.setVariable(this.id,this.value);this.createGradient(this.h/2,this.h)};
var f,e,h,g,j=0;a.Spinner.prototype.update=function(){var a=this.evaluator;if(0>=a.evalExpression(this.decimals)){var c=this.evaluator.evalExpression(this.incr);0<c?this.originalIncr=this.incr=this.evaluator.parser.parse(parseInt(c).toString()):this.incr=this.evaluator.parser.parse("1")}else this.incr=this.originalIncr;g=h=e=f=!1;j=0<a.evalExpression(this.activeif);this.field.disabled=j?!1:!0;0<a.evalExpression(this.drawif)?(this.containerControl.style.display="block",this.draw()):(this.click=!1,
this.containerControl.style.display="none");c=a.evalExpression(this.expresion);f=this.x!=c[0][0];e=this.y!=c[0][1];this.x=c[0][0];this.y=c[0][1];4==c[0].length&&(h=this.w!=c[0][2],g=this.h!=c[0][3],this.w=c[0][2],this.h=c[0][3]);(h||g)&&this.createGradient(this.canvas.width,this.canvas.height);var c=this.field.value,d=this.value;this.value=this.validateValue(a.getVariable(this.id));this.field.value=this.formatOutputValue(this.value);this.value==d&&this.field.value!=c&&(this.value=this.validateValue(c),
this.field.value=this.formatOutputValue(this.value));if(h||g||f||e)this.init(),this.draw();a.setVariable(this.id,this.value)};a.Spinner.prototype.createGradient=function(a,c){this.linearGradient=this.ctx.createLinearGradient(0,0,0,c);for(var d=c*c,e,f=0;f<c;f++)e=Math.floor(f-40*c/100),this.linearGradient.addColorStop(f/c,"rgba(0,0,0,"+192*e*e/d/255+")")};a.Spinner.prototype.draw=function(){var c=this.ctx,e=this.canvas.width,f=this.canvas.height;c.save();c.fillStyle="#f0f8ff";c.fillRect(0,0,e,f);
c.fillStyle=this.linearGradient;c.fillRect(0,0,e,f);var g,h;this.up?(g="gray",h="#f0f8ff"):(g="#f0f8ff",h="gray");a.drawLine(c,0,0,e,0,g);a.drawLine(c,0,0,0,f/2,g);a.drawLine(c,0,f/2,e,f/2,h);this.down?(g="gray",h="#f0f8ff"):(g="#f0f8ff",h="gray");a.drawLine(c,0,f/2+1,e,f/2+1,g);a.drawLine(c,0,f/2+1,0,f,g);a.drawLine(c,0,f-1,e,f-1,h);g=[e/2,e/5-1,e-e/5+1];h=[f/8+1,f/8+1+f/4,f/8+1+f/4];d(c,g,h,j?"#2244cc":"#8888aa");h=[f-f/8,f-f/8-f/4,f-f/8-f/4];d(c,g,h,j?"#d00018":"#aa8888");c.fillStyle="rgba(0,0,0,"+
24/255+")";this.up&&c.fillRect(0,0,e,f/2);this.down&&c.fillRect(0,f/2,e,f)};a.Spinner.prototype.validateValue=function(a){var d=this.evaluator;(a=parseFloat(d.evalExpression(d.parser.parse(a.toString().replace(this.parent.decimal_symbol,".")))))||(a=0);a<d.evalExpression(this.min)&&(a=d.evalExpression(this.min));a>d.evalExpression(this.max)&&(a=d.evalExpression(this.max));if(this.discrete){var e=d.evalExpression(this.incr);a=0==e?0:e*Math.round(a/e)}c=d.evalExpression(this.decimals);0>=c&&(c=0);return a=
parseFloat(parseFloat(a).toFixed(c))};a.Spinner.prototype.formatOutputValue=function(a){var d=a+"",e=d.indexOf(".");-1!=e&&d.substring(e+1).length>c&&(d=parseFloat(d).toFixed(c));if(this.fixed&&(2!=this.parent.version||2==this.parent.version&&!this.exponentialif))d=parseFloat(a).toFixed(c);this.exponentialif&&0!=parseFloat(d)&&(d=this.fixed&&2!=this.parent.version?parseFloat(d).toExponential(c):parseFloat(d).toExponential(),d=d.toUpperCase(),d=d.replace("+",""));return d=d.replace(".",this.parent.decimal_symbol)};
a.Spinner.prototype.increase=function(){this.changeValue(parseFloat(this.value)+this.evaluator.evalExpression(this.incr))};a.Spinner.prototype.decrease=function(){this.changeValue(parseFloat(this.value)-this.evaluator.evalExpression(this.incr))};a.Spinner.prototype.changeValue=function(a){j&&(this.value=this.validateValue(a),this.field.value=this.formatOutputValue(this.value),this.evaluator.setVariable(this.id,this.value),this.parent.updateControls(),"init"==this.action&&(this.click=!1),this.actionExec.execute(),
this.parent.updateControls(),"animate"!=this.action&&this.parent.update())};a.Spinner.prototype.registerMouseEvents=function(){function c(a,d,e){t.up||t.down?(d.call(t),a=e?a:30,w=setTimeout(function(){c(a,d)},a)):clearInterval(w)}function d(a){a.preventDefault();t.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==t.whichButton&&j&&(t.up=!0,c(r,t.increase,!0),t.draw())}function e(a){a.preventDefault();t.whichButton=null==
a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==t.whichButton&&j&&(t.down=!0,c(r,t.decrease,!0),t.draw())}function f(a){t.up=!1;clearInterval(w);t.draw();a.preventDefault()}function g(a){t.down=!1;clearInterval(w);t.draw();a.preventDefault()}function h(a){t.up=!1;clearInterval(w);t.draw();a.preventDefault()}function u(a){t.down=!1;clearInterval(w);t.draw();a.preventDefault()}var s=a.hasTouchSupport;this.divUp.oncontextmenu=function(){return!1};
this.divDown.oncontextmenu=function(){return!1};var t=this,r=s?500:200,w;this.label.oncontextmenu=function(){return!1};s?this.label.addEventListener("touchstart",function(a){a.preventDefault();return!1}):this.label.addEventListener("mousedown",function(a){a.preventDefault();return!1});this.field.addEventListener("keydown",function(a){13==a.keyCode&&t.changeValue(t.field.value)},!1);s?this.divUp.addEventListener("touchstart",d,!1):this.divUp.addEventListener("mousedown",d,!1);s?this.divDown.addEventListener("touchstart",
e,!1):this.divDown.addEventListener("mousedown",e,!1);s||this.divUp.addEventListener("mouseout",f,!1);s||this.divDown.addEventListener("mouseout",g,!1);s?(this.divUp.addEventListener("touchend",h,!1),window.addEventListener("touchend",h,!1)):(this.divUp.addEventListener("mouseup",h,!1),window.addEventListener("mouseup",h,!1));s?(this.divDown.addEventListener("touchend",u,!1),window.addEventListener("touchend",u,!1)):(this.divDown.addEventListener("mouseup",u,!1),window.addEventListener("mouseup",
u,!1))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.TextField=function(d,c){a.Control.call(this,d,c);void 0===this.valueExprString&&(this.valueExprString="");this.emptyString=!1;this.ok=0;this.tabindex=++this.parent.tabindex;if(this.answer)if(this.answer.match("krypto_")&&(this.answer=(new a.Krypto).decode(this.answer.substring(7))),this.answerPattern=this.answer,this.onlyText){this.answer=a.buildRegularExpresionsPatterns(this.answer);var f=this.answerPattern.indexOf("|");
this.firstAnswer=-1==f?this.answerPattern:this.answerPattern.substring(0,f)}else this.buildRangeExpresions(),this.firstAnswer=this.parser.parse(this.answerPattern.substring(1,this.answerPattern.indexOf(",")));if(this.onlyText){if(!this.valueExprString.match(/^'/)||!this.valueExprString.match(/^'/))this.valueExpr=this.evaluator.parser.parse("'"+this.valueExprString+"'");this.validateValue=function(a){return"''"==a||"'"==a?"":a};this.formatOutputValue=function(a){return a.toString()};this.evaluateAnswer=
this.evaluateTextualAnswer}f=this.getContainer();""==this.name.trim()&&(this.name="");this.containerControl=document.createElement("div");this.field=document.createElement("input");this.label=document.createElement("label");this.txtLabel=document.createTextNode(this.name);this.label.appendChild(this.txtLabel);this.containerControl.appendChild(this.label);this.containerControl.appendChild(this.field);f.childNodes[0]?f.insertBefore(this.containerControl,f.childNodes[0]):f.appendChild(this.containerControl);
this.init();this.registerMouseEvents();this.draw()};a.extend(a.TextField,a.Control);a.TextField.prototype.init=function(){evaluator=this.evaluator;this.value=evaluator.evalExpression(this.valueExpr);this.value=this.validateValue(this.value);var d=this.formatOutputValue(this.value);this.fieldFontSize=a.getFieldFontSize(this.h);var c=a.getTextWidth(d+"0",this.fieldFontSize+"px Arial"),f=this.w/2,e=a.getTextWidth(this.name,this.fieldFontSize+"px Arial");f<e&&(f=e);""==this.name&&(f=0);this.w-f<c&&(f=
this.w-c);0>f&&(f=0);c=this.w-f;this.containerControl.setAttribute("class","DescartesTextFieldContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=0<evaluator.evalExpression(this.drawif)?"block":"none";this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"TextField");this.field.value=d;this.field.setAttribute("class","DescartesTextFieldField");
this.field.setAttribute("style","font-size: "+this.fieldFontSize+"px; width : "+(c-2)+"px; height : "+(this.h-2)+"px; left: "+f+"px;");this.field.setAttribute("tabindex",this.tabindex);this.field.disabled=0<evaluator.evalExpression(this.activeif)?!1:!0;this.label.setAttribute("class","DescartesTextFieldLabel");this.label.setAttribute("style","font-size:"+this.fieldFontSize+"px; width: "+f+"px; height: "+this.h+"px; line-height: "+this.h+"px;");evaluator.setVariable(this.id,this.value);this.oldValue=
this.value};a.TextField.prototype.update=function(){evaluator=this.evaluator;var a=!1,c=!1,f=!1,e=!1;this.field.disabled=0<evaluator.evalExpression(this.activeif)?!1:!0;0<evaluator.evalExpression(this.drawif)?(this.containerControl.style.display="block",this.draw()):this.containerControl.style.display="none";var h=evaluator.evalExpression(this.expresion),a=this.x!=h[0][0],c=this.y!=h[0][1];this.x=h[0][0];this.y=h[0][1];4==h[0].length&&(f=this.w!=h[0][2],e=this.h!=h[0][3],this.w=h[0][2],this.h=h[0][3]);
(f||e||a||c)&&this.init();a=this.field.value;c=this.value;this.value=this.validateValue(evaluator.getVariable(this.id));this.field.value=this.formatOutputValue(this.value);this.value===c&&this.field.value!=a&&(this.value=this.validateValue(a),this.field.value=this.formatOutputValue(this.value));evaluator.setVariable(this.id,this.value)};a.TextField.prototype.validateValue=function(a){if(""===a||"''"==a)return"";var c=this.evaluator;(a=parseFloat(c.evalExpression(c.parser.parse(a.toString().replace(this.parent.decimal_symbol,
".")))))||(a=0);a<c.evalExpression(this.min)&&(a=c.evalExpression(this.min));a>c.evalExpression(this.max)&&(a=c.evalExpression(this.max));if(this.discrete){var f=c.evalExpression(this.incr);a=0==f?0:f*Math.round(a/f)}return a=parseFloat(parseFloat(a).toFixed(c.evalExpression(this.decimals)))};a.TextField.prototype.formatOutputValue=function(a){if(""===a)return"";var c=a+"",f=this.evaluator.evalExpression(this.decimals),e=c.indexOf(".");-1!=e&&c.substring(e+1).length>f&&(c=parseFloat(c).toFixed(f));
this.fixed&&(c=parseFloat(a).toFixed(f));this.exponentialif&&(c=c.toExponential(f),c=c.toUpperCase(),c=c.replace("+",""));return c=c.replace(".",this.parent.decimal_symbol)};a.TextField.prototype.changeValue=function(a){0<this.evaluator.evalExpression(this.activeif)&&(this.value=this.validateValue(a),this.field.value=this.formatOutputValue(this.value),this.evaluate&&(this.ok=this.evaluateAnswer()),this.evaluator.setVariable(this.id,this.value),this.evaluator.setVariable(this.id+".ok",this.ok),this.parent.updateControls(),
"init"==this.action&&(this.click=!1),this.actionExec.execute(),this.parent.updateControls(),"animate"!=this.action&&this.parent.update())};a.TextField.prototype.evaluateAnswer=function(){var a=this.evaluator;parseFloat(this.value);for(var c,f,e,h,g,j,k,l=0,m=this.answer.length;l<m;l++)if(h=this.answer[l][0],j=this.answer[l][1],c=a.evalExpression(h.expression),f=a.evalExpression(j.expression),e="("==h.type,h="["==h.type,g=")"==j.type,j="]"==j.type,k=this.value,e&&g&&k>c&&k<f||e&&j&&k>c&&k<=f||h&&g&&
k>=c&&k<f||h&&j&&k>=c&&k<=f)return 1;return 0};a.TextField.prototype.buildRangeExpresions=function(){var a;this.answer=this.answer.split("|");for(var c=0,f=this.answer.length;c<f;c++)this.answer[c]=this.answer[c].trim(),this.answer[c]=this.answer[c].split(","),a=this.answer[c][0].trim(),this.answer[c][0]={type:a[0],expression:this.evaluator.parser.parse(a.substring(1))},a=this.answer[c][1].trim(),this.answer[c][1]={type:a[a.length-1],expression:this.evaluator.parser.parse(a.substring(0,a.length-1))}};
a.TextField.prototype.evaluateTextualAnswer=function(){for(var d=this.value,c,f,e,h=0,g=this.answer.length;h<g;h++){f=this.answer[h];e=!0;for(var j=0,k=f.length;j<k;j++)c=f[j],c.ignoreAcents&&(d=a.replaceAcents(d),c.regExp=a.replaceAcents(c.regExp)),c.ignoreCaps&&(d=d.toLowerCase(),c.regExp=c.regExp.toLowerCase()),e=e&&!!d.match(c.regExp);if(e)return 1}return 0};a.TextField.prototype.getFirstAnswer=function(){return this.answer?this.onlyText?this.firstAnswer:this.evaluator.evalExpression(this.firstAnswer):
""};a.TextField.prototype.registerMouseEvents=function(){var d=a.hasTouchSupport,c=this;this.label.oncontextmenu=function(){return!1};d?this.label.addEventListener("touchstart",function(a){a.preventDefault();return!1}):this.label.addEventListener("mousedown",function(a){a.preventDefault();return!1});this.field.addEventListener("blur",function(){c.update()},!1);this.field.addEventListener("keydown",function(a){0<c.evaluator.evalExpression(c.activeif)&&13==a.keyCode&&c.changeValue(c.field.value,!0)},
!1)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Menu=function(d,c){a.Control.call(this,d,c);var f=this.parser;this.options=this.options?this.options.split(","):[];this.menuOptions=[];this.strValue=[];for(var e,h=0,g=this.options.length;h<g;h++)e=this.options[h].split(/[\[\]]/,2),1==e.length?(this.menuOptions.push(e[0]),this.strValue.push(h.toString())):2==e.length&&(this.menuOptions.push(e[0]),""==e[1]?this.strValue.push(h.toString()):this.strValue.push(e[1]));h=0;
for(g=this.strValue.length;h<g;h++)this.strValue[h]=f.parse(this.strValue[h]);f=this.getContainer();this.containerControl=document.createElement("div");this.label=document.createElement("label");this.txtLabel=document.createTextNode(this.name);this.label.appendChild(this.txtLabel);this.select=document.createElement("select");h=0;for(g=this.menuOptions.length;h<g;h++)e=document.createElement("option"),e.innerHTML=this.menuOptions[h],this.select.appendChild(e);this.field=document.createElement("input");
this.init();this.containerControl.appendChild(this.label);this.containerControl.appendChild(this.select);this.visible&&this.containerControl.appendChild(this.field);f.childNodes[0]?f.insertBefore(this.containerControl,f.childNodes[0]):f.appendChild(this.containerControl);this.registerMouseEvents()};a.extend(a.Menu,a.Control);a.Menu.prototype.init=function(){var d=this.evaluator;this.fieldFontSize=2!=this.parent.version?a.getFieldFontSize(this.h):10;var c=0,f=0,e=0;this.value=d.evalExpression(this.valueExpr);
this.indexValue=this.getIndex(this.value);for(var h=0,g=this.menuOptions.length;h<g;h++)e=a.getTextWidth(this.menuOptions[h],this.fieldFontSize+"px Arial"),e>c&&(c=e,f=h);c+=25;e=a.getTextWidth(this.formatOutputValue(d.evalExpression(this.strValue[f])),this.fieldFontSize+"px Arial")+7;f=a.getTextWidth(this.name,this.fieldFontSize+"px Arial")+10;""==this.name&&(f=0);this.visible||(e=0);for(h=this.w-e-f;h<c&&0<f;)f--,h++;for(;h<c&&0<e;)e--,h++;for(;f+h+e+1<this.w;)h++,e++;var c=f,g=c+h,e=this.w-g,j=
this.formatOutputValue(d.evalExpression(this.strValue[this.indexValue]));this.containerControl.setAttribute("class","DescartesSpinnerContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=0<d.evalExpression(this.drawif)?"block":"none";this.label.setAttribute("class","DescartesMenuLabel");this.label.setAttribute("style","font-size:"+this.fieldFontSize+"px; width: "+
f+"px; height: "+this.h+"px;  line-height: "+this.h+"px;");this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"menu");this.field.value=j;this.field.setAttribute("class","DescartesMenuField");this.field.setAttribute("style","font-size: "+this.fieldFontSize+"px; width : "+(e-2)+"px; height : "+(this.h-2)+"px; left: "+g+"px;");this.field.disabled=0<d.evalExpression(this.activeif)?!1:!0;this.select.setAttribute("id",this.id+"menuSelect");this.select.setAttribute("class","DescartesMenuSelect");
this.select.setAttribute("style","text-align: left; font-size: "+this.fieldFontSize+"px; width : "+h+"px; height : "+this.h+"px; left: "+c+"px; border-color: #7a8a99; border-width: 1.5px; border-style: solid; background-color: #eeeeee;");this.select.selectedIndex=this.indexValue;this.select.disabled=0<d.evalExpression(this.activeif)?!1:!0;d.setVariable(this.id,parseFloat(j))};a.Menu.prototype.update=function(){var a=this.evaluator,c=!1,f=!1,e=!1,h=!1,c=0<a.evalExpression(this.activeif);this.field.disabled=
c?!1:!0;this.select.disabled=c?!1:!0;0<a.evalExpression(this.drawif)?(this.containerControl.style.display="block",this.draw()):(this.click=!1,this.containerControl.style.display="none");var g=a.evalExpression(this.expresion),c=this.x!=g[0][0],f=this.y!=g[0][1];this.x=g[0][0];this.y=g[0][1];4==g[0].length&&(e=this.w!=g[0][2],h=this.h!=g[0][3],this.w=g[0][2],this.h=g[0][3]);if(e||h||c||f)this.init(),this.draw();this.value=a.getVariable(this.id);this.field.value=this.formatOutputValue(this.value);a.setVariable(this.id,
parseFloat(this.value));this.select.selectedIndex=parseFloat(this.getIndex(this.value))};a.Menu.prototype.getIndex=function(a){a=parseFloat(a.toString().replace(this.parent.decimal_symbol,"."));for(var c=-1,f=Infinity,e,h=0,g=this.strValue.length;h<g;h++)e=Math.abs(a-parseFloat(this.evaluator.evalExpression(this.strValue[h]))),e<=f&&(f=e,c=h);return c};a.Menu.prototype.formatOutputValue=function(a){var c=a+"",f=this.evaluator.evalExpression(this.decimals),e=c.indexOf(".");-1!=e&&c.substring(e+1).length>
f&&(c=parseFloat(c).toFixed(f));this.fixed&&(c=parseFloat(a).toFixed(f));this.exponentialif&&(c=c.toExponential(f),c=c.toUpperCase(),c=c.replace("+",""));return c=c.replace(".",this.parent.decimal_symbol)};a.Menu.prototype.changeValue=function(){0<this.evaluator.evalExpression(this.activeif)&&(this.evaluator.setVariable(this.id,this.value),this.parent.updateControls(),this.actionExec.execute(),this.parent.updateControls(),"animate"!=this.action&&this.parent.update())};a.Menu.prototype.registerMouseEvents=
function(){var d=a.hasTouchSupport,c=this;this.select.oncontextmenu=function(){return!1};this.label.oncontextmenu=function(){return!1};d?this.label.addEventListener("touchstart",function(a){a.preventDefault();return!1}):this.label.addEventListener("mousedown",function(a){a.preventDefault();return!1});this.select.addEventListener("change",function(a){c.value=c.evaluator.evalExpression(c.strValue[this.selectedIndex]);c.field.value=c.formatOutputValue(c.value);c.evaluator.setVariable(c.id,c.field.value);
c.changeValue();a.preventDefault()},!1);this.field.addEventListener("keydown",function(a){13==a.keyCode&&(c.indexValue=c.getIndex(c.field.value),c.value=c.evaluator.evalExpression(c.strValue[c.indexValue]),c.field.value=c.formatOutputValue(c.indexValue),c.select.selectedIndex=c.indexValue,c.changeValue())},!1)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.floor;a.Scrollbar=function(c,d){a.Control.call(this,c,d);this.orientation=this.w>=this.h?"horizontal":"vertical";
var e=this.getContainer();this.containerControl=document.createElement("div");this.canvas=document.createElement("canvas");this.divUp=document.createElement("div");this.divDown=document.createElement("div");this.field=document.createElement("input");this.label=document.createElement("label");this.scrollManipulator=document.createElement("div");this.txtLabel=document.createTextNode(this.name);this.label.appendChild(this.txtLabel);this.containerControl.appendChild(this.label);this.containerControl.appendChild(this.canvas);
this.containerControl.appendChild(this.divUp);this.containerControl.appendChild(this.divDown);this.containerControl.appendChild(this.field);this.containerControl.appendChild(this.scrollManipulator);e.childNodes[0]?e.insertBefore(this.containerControl,e.childNodes[0]):e.appendChild(this.containerControl);this.init();this.registerMouseEvents();this.draw()};a.extend(a.Scrollbar,a.Control);a.Scrollbar.prototype.init=function(){var a=this.evaluator;this.incr=0==a.evalExpression(this.decimals)?1:(a.evalExpression(this.max)-
a.evalExpression(this.min))/100;this.value=this.validateValue(a.evalExpression(this.valueExpr));var d=this.formatOutputValue(this.value),e=this.evaluator.evalExpression(this.expresion);this.x=e[0][0];this.y=e[0][1];4==e[0].length&&(this.w=e[0][2],this.h=e[0][3]);this.orientation=this.w>=this.h?"horizontal":"vertical";"vertical"==this.orientation?this.initVertical(d):this.initHorizontal(d);a.setVariable(this.id,this.value);a=this.value;this.value=null;this.changeValue(a);this.prePos=this.pos;this.draw()};
a.Scrollbar.prototype.initVertical=function(c){this.fieldFontSize=d(this.w-0.25*this.w);this.fieldFontSize=17.25;a.getTextWidth(c+"0",this.fieldFontSize+"px Arial");var f=this.parent.getSpaceById(this.spaceID).h;this.labelHeight=""==this.name?0:23;var e=""==this.visible?0:23;this.canvasHeight=this.h-this.labelHeight-e;18<=this.canvasHeight+this.y-f&&(this.canvasHeight=f);f=e+this.canvasHeight;this.upHeight=this.downHeight=15;this.scrollManipulatorHeight=parseInt((this.canvasHeight-this.upHeight-this.downHeight-
this.labelHeight)/10);this.scrollManipulatorHeight=15>this.scrollManipulatorHeight?15:this.scrollManipulatorHeight;this.scrollManipulatorLimInf=f-this.downHeight-this.scrollManipulatorHeight;this.scrollManipulatorLimSup=e+this.downHeight;this.containerControl.setAttribute("class","DescartesScrollbarContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=
0<this.evaluator.evalExpression(this.drawif)?"block":"none";this.canvas.setAttribute("width",this.w+"px");this.canvas.setAttribute("height",this.canvasHeight+"px");this.canvas.setAttribute("style","position: absolute; left: 0px; top: "+e+"px;");this.ctx=this.canvas.getContext("2d");this.divDown.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+this.w+"px; height : "+this.upHeight+"px; left: 0px; top: "+(f-this.downHeight)+"px;");this.divUp.setAttribute("style",
"background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+this.w+"px; height : "+this.downHeight+"px; left: 0px; top: 0px;");this.scrollManipulator.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+this.w+"px; height : "+this.scrollManipulatorHeight+"px; left: 0px; top: "+this.scrollManipulatorLimInf+"px;");this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"scrollbar");this.field.value=
c;this.field.setAttribute("class","DescartesScrollbarField");this.field.setAttribute("style","font-size: "+this.fieldFontSize+"px; width : "+this.w+"px; height : "+e+"px; left: 0px; top: 0px;");this.field.disabled=0<this.evaluator.evalExpression(this.activeif)?!1:!0;this.label.setAttribute("class","DescartesScrollbarLabel");this.label.setAttribute("style","font-size:"+this.fieldFontSize+"px; width: "+this.w+"px; height: "+this.labelHeight+"px; left: 0px; top: "+f+"px;");this.txtLabel=document.createTextNode(this.name)};
a.Scrollbar.prototype.initHorizontal=function(c){this.fieldFontSize=d(this.h-0.25*this.h);var f=a.getTextWidth(c+"0",this.fieldFontSize+"px Arial");this.labelWidth=a.getTextWidth(this.name,this.fieldFontSize+"px Arial");""==this.name&&(this.labelWidth=0);this.visible||(f=0);for(var e=this.w-f-this.labelWidth;58>e&&0<this.labelWidth;)this.labelWidth--,e++;for(;58>e&&0<f;)f--,e++;var h=this.labelWidth,g=h+e,f=this.w-g;this.canvasWidth=e;this.upWidth=this.downWidth=15;this.scrollManipulatorWidth=parseInt((this.canvasWidth-
this.upWidth-this.downWidth)/10);this.scrollManipulatorWidth=15>this.scrollManipulatorWidth?15:this.scrollManipulatorWidth;this.scrollManipulatorLimInf=h+this.downWidth;this.scrollManipulatorLimSup=h+this.canvasWidth-this.downWidth-this.scrollManipulatorWidth;this.containerControl.setAttribute("class","DescartesScrollbarContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=
0<this.evaluator.evalExpression(this.drawif)?"block":"none";this.canvas.setAttribute("width",this.canvasWidth+"px");this.canvas.setAttribute("height",this.h+"px");this.canvas.setAttribute("style","position: absolute; left: "+h+"px; top: 0px;");this.ctx=this.canvas.getContext("2d");this.divUp.setAttribute("style","cursor: pointer; position: absolute; width : "+this.upWidth+"px; height : "+this.h+"px; left: "+(g-this.downWidth)+"px; top: 0px;");this.divDown.setAttribute("style","cursor: pointer; position: absolute; width : "+
this.downWidth+"px; height : "+this.h+"px; left: "+this.labelWidth+"px; top: 0px;");this.scrollManipulator.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+this.scrollManipulatorWidth+"px; height : "+this.h+"px; left: "+this.scrollManipulatorLimInf+"px; top: 0px;");this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"scrollbar");this.field.value=c;this.field.setAttribute("class","DescartesScrollbarField");this.field.setAttribute("style",
"font-size: "+this.fieldFontSize+"px; width : "+f+"px; height : "+(this.h-2)+"px; left: "+(this.canvasWidth+this.labelWidth)+"px;");this.field.disabled=0<this.evaluator.evalExpression(this.activeif)?!1:!0;this.label.setAttribute("class","DescartesScrollbarLabel");this.label.setAttribute("style","font-size:"+this.fieldFontSize+"px; width: "+this.labelWidth+"px; height: "+this.h+"px;");this.txtLabel=document.createTextNode(this.name)};a.Scrollbar.prototype.update=function(){var a=this.evaluator,d=!1,
e=!1,h=!1,g=!1;this.incr=0==a.evalExpression(this.decimals)?1:(a.evalExpression(this.max)-a.evalExpression(this.min))/100;this.field.disabled=0<a.evalExpression(this.activeif)?!1:!0;0<a.evalExpression(this.drawif)?(this.containerControl.style.display="block",this.draw()):this.containerControl.style.display="none";var j=a.evalExpression(this.expresion),d=this.x!=j[0][0],e=this.y!=j[0][1];this.x=j[0][0];this.y=j[0][1];4==j[0].length&&(h=this.w!=j[0][2],g=this.h!=j[0][3],this.w=j[0][2],this.h=j[0][3]);
this.value=this.validateValue(a.getVariable(this.id));this.field.value=this.formatOutputValue(this.value);if(h||g||d||e)this.init(),this.draw();a.setVariable(this.id,this.value);this.draw()};a.Scrollbar.prototype.createGradient=function(a,f){this.linearGradient=this.ctx.createLinearGradient(0,0,0,f);for(var e=f*f,h,g=0;g<f;g++)h=d(g-40*f/100),this.linearGradient.addColorStop(g/f,"rgba(0,0,0,"+192*h*h/e/255+")")};a.Scrollbar.prototype.draw=function(){var a=this.ctx;if("horizontal"==this.orientation){var f=
d(this.h),e=d(this.upWidth),h=d(this.canvasWidth-this.upWidth);a.clearRect(0,0,this.canvasWidth,this.h);a.strokeStyle="#7a8a99";a.strokeRect(0,0,e+0.5,f);a.strokeRect(h+0.5,0,e,f);var g=4;a.fillStyle=this.up?"black":"#333333";a.beginPath();a.moveTo(g,f/2);a.lineTo(e-g,f/2-7);a.lineTo(e-g,f/2+7);a.closePath();a.moveTo(h+1+e-g,f/2);a.lineTo(h+1+g,f/2-7);a.lineTo(h+1+g,f/2+7);a.closePath();a.fill();a.strokeRect(0,0.5,this.canvasWidth+0.5,f-1);g=d(this.pos-this.labelWidth);a.fillStyle="#ccdcec";a.fillRect(g+
0.5,0,d(this.scrollManipulatorWidth),f);a.strokeStyle="#6382bf";a.strokeRect(g+0.5,0,d(this.scrollManipulatorWidth),f);e=d(this.scrollManipulatorWidth/2);a.beginPath();a.moveTo(g+e+0.5-2,3);a.lineTo(g+e+0.5-2,f-3);a.moveTo(g+e+0.5,3);a.lineTo(g+e+0.5,f-3);a.moveTo(g+e+0.5+2,3);a.lineTo(g+e+0.5+2,f-3)}else f=d(this.w),e=d(this.upHeight),h=d(this.canvasHeight-this.upHeight),a.clearRect(0,0,this.w,this.canvasHeight),a.strokeStyle="#7a8a99",a.strokeRect(0.5,2.5,f-0.5,e),a.strokeRect(0.5,h-0.5,f-0.5,e),
g=4,a.fillStyle=this.down?"black":"#333333",a.beginPath(),a.moveTo(f/2,g+2),a.lineTo(f/2-7,e-g+2),a.lineTo(f/2+7,e-g+2),a.closePath(),a.moveTo(f/2,h+e-g),a.lineTo(f/2-7,h+g),a.lineTo(f/2+7,h+g),a.closePath(),a.fill(),a.strokeRect(0.5,1.5,f-0.5,this.canvasHeight-1.5),g=d(this.pos),a.fillStyle="#ccdcec",a.fillRect(0,g+0.5,this.w,d(this.scrollManipulatorHeight)),a.strokeStyle="#6382bf",a.strokeRect(0,g+0.5,this.w,d(this.scrollManipulatorHeight)),e=d(this.scrollManipulatorHeight/2),a.beginPath(),a.moveTo(3,
g+e+0.5-2),a.lineTo(f-3,g+e+0.5-2),a.moveTo(3,g+e+0.5),a.lineTo(f-3,g+e+0.5),a.moveTo(3,g+e+0.5+2),a.lineTo(f-3,g+e+0.5+2);a.stroke()};a.Scrollbar.prototype.validateValue=function(a){var d=this.evaluator;a=a.toString();(a=parseFloat(a.replace(this.parent.decimal_symbol,".")))||(a=0);this.minimo=d.evalExpression(this.min);a<this.minimo&&(this.value=null,a=this.minimo);this.maximo=d.evalExpression(this.max);a>this.maximo&&(this.value=null,a=this.maximo);var e=this.incr;a=0!=e?a*e/e:0;this.fixed&&(a=
parseFloat(parseFloat(a).toFixed(d.evalExpression(this.decimals))));return a};a.Scrollbar.prototype.formatOutputValue=function(a){var d=a+"",e=this.evaluator.evalExpression(this.decimals),h=d.indexOf(".");-1!=h&&d.substring(h+1).length>e&&(d=parseFloat(d).toFixed(e));this.fixed&&(d=parseFloat(a).toFixed(e));this.exponentialif&&(d=d.toExponential(e),d=d.toUpperCase(),d=d.replace("+",""));return d=d.replace(".",this.parent.decimal_symbol)};a.Scrollbar.prototype.increase=function(){this.changeValue(parseFloat(this.value)+
this.incr)};a.Scrollbar.prototype.decrease=function(){this.changeValue(parseFloat(this.value)-this.incr)};a.Scrollbar.prototype.increase10=function(){var a=(this.evaluator.evalExpression(this.max)-this.evaluator.evalExpression(this.min))/10;"horizontal"==this.orientation?this.clickPos.x>this.prePos&&this.changeValue(parseFloat(this.value)+a):this.clickPos.y<this.prePos&&this.changeValue(parseFloat(this.value)+a)};a.Scrollbar.prototype.decrease10=function(){var a=(this.evaluator.evalExpression(this.max)-
this.evaluator.evalExpression(this.min))/10;"horizontal"==this.orientation?this.clickPos.x<this.prePos&&this.changeValue(parseFloat(this.value)-a):this.clickPos.y>this.prePos&&this.changeValue(parseFloat(this.value)-a)};a.Scrollbar.prototype.changeValue=function(a){0<this.evaluator.evalExpression(this.activeif)&&(a=this.validateValue(a),a!=this.value&&(this.value=a,this.field.value=this.formatOutputValue(a),this.changeScrollPositionFromValue(),this.prePos=this.pos,this.evaluator.setVariable(this.id,
this.value),this.parent.updateControls(),this.actionExec.execute(),this.parent.updateControls(),"animate"!=this.action&&this.parent.update()))};a.Scrollbar.prototype.changeValueForScrollMovement=function(){var a=this.evaluator,f=this.scrollManipulatorLimInf,e=this.scrollManipulatorLimSup,h=a.evalExpression(this.min),g=a.evalExpression(this.max),j=this.incr,f=d((this.pos-f)*(g-h)/(e-f)/j)*j+h;f!=this.value&&(this.value=f,this.field.value=this.formatOutputValue(f),a.setVariable(this.id,this.value),
this.parent.updateControls(),this.actionExec.execute(),this.parent.update())};a.Scrollbar.prototype.changeScrollPositionFromValue=function(){var a=this.evaluator,d=this.scrollManipulatorLimInf,e=this.scrollManipulatorLimSup,h=a.evalExpression(this.min),a=a.evalExpression(this.max);this.pos=(this.value-h)*(e-d)/(a-h)+d;"horizontal"==this.orientation?this.scrollManipulator.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+this.scrollManipulatorWidth+
"px; height : "+this.h+"px; left: "+this.pos+"px; top: 0px;"):this.scrollManipulator.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+this.w+"px; height : "+this.scrollManipulatorHeight+"px; left: 0px; top: "+this.pos+"px;")};a.Scrollbar.prototype.registerMouseEvents=function(){function d(a,e,f,g){(r.up||r.down||r.canvasClick)&&1E-7<Math.abs(r.value-g)?(e.call(r),a=f?a:30,A=setTimeout(function(){d(a,e,!1,g)},a)):clearInterval(A)}function f(a){a.preventDefault();
r.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==r.whichButton&&0<r.evaluator.evalExpression(r.activeif)&&(r.clickPos=r.getCursorPosition(a),r.canvasClick=!0,"horizontal"==r.orientation?r.clickPos.x<r.prePos?d(z,r.decrease10,!0,r.minimo):d(z,r.increase10,!0,r.maximo):r.clickPos.y<r.prePos?d(z,r.increase10,!0,r.maximo):d(z,r.decrease10,!0,r.minimo))}function e(a){r.canvasClick=!1;clearInterval(A);a.preventDefault()}function h(a){!0==
r.canvasClick&&(r.clickPos=r.getCursorPosition(a),a.preventDefault())}function g(a){0<r.evaluator.evalExpression(r.activeif)&&(r.scrollClick=!0,r.initPos=r.getCursorPosition(a),window.addEventListener("mouseup",k,!1),window.addEventListener("mousemove",m,!1),a.preventDefault())}function j(a){0<r.evaluator.evalExpression(r.activeif)&&(r.scrollClick=!0,r.initPos=r.getCursorPosition(a),window.addEventListener("touchend",l,!1),window.addEventListener("touchmove",onToucheMove_scrollManipulator,!1),a.preventDefault())}
function k(a){r.scrollClick=!1;r.prePos=r.pos;window.removeEventListener("mouseup",k,!1);window.removeEventListener("mousemove",m,!1);a.preventDefault()}function l(a){r.scrollClick=!1;r.prePos=r.pos;window.removeEventListener("touchend",l,!1);window.removeEventListener("touchmove",m,!1);a.preventDefault()}function m(a){var d=r.getCursorPosition(a);"horizontal"==r.orientation?(r.pos=r.prePos-(r.initPos.x-d.x),r.pos<r.scrollManipulatorLimInf&&(r.pos=r.scrollManipulatorLimInf),r.pos>r.scrollManipulatorLimSup&&
(r.pos=r.scrollManipulatorLimSup),r.scrollManipulator.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+r.scrollManipulatorWidth+"px; height : "+r.h+"px; left: "+r.pos+"px; top: 0px;")):(r.pos=r.prePos-(r.initPos.y-d.y),r.pos>r.scrollManipulatorLimInf&&(r.pos=r.scrollManipulatorLimInf),r.pos<r.scrollManipulatorLimSup&&(r.pos=r.scrollManipulatorLimSup),r.scrollManipulator.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+
r.w+"px; height : "+r.scrollManipulatorHeight+"px; left: 0px; top: "+r.pos+"px;"));r.changeValueForScrollMovement();a.preventDefault()}function q(a){a.preventDefault();r.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==r.whichButton&&0<r.evaluator.evalExpression(r.activeif)&&(r.up=!0,d(z,r.increase,!0,r.maximo))}function p(a){a.preventDefault();r.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>
a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==r.whichButton&&0<r.evaluator.evalExpression(r.activeif)&&(r.down=!0,d(z,r.decrease,!0,r.minimo))}function n(a){r.up=!1;clearInterval(A);a.preventDefault()}function u(a){r.down=!1;clearInterval(A);a.preventDefault()}function s(a){r.up=!1;clearInterval(A);a.preventDefault()}function t(a){r.down=!1;clearInterval(A);a.preventDefault()}var r=this,w=a.hasTouchSupport,z=w?500:200,A;this.canvas.oncontextmenu=function(){return!1};this.divUp.oncontextmenu=
function(){return!1};this.divDown.oncontextmenu=function(){return!1};this.field.addEventListener("keydown",function(a){13==a.keyCode&&r.changeValue(r.field.value)},!1);w?this.canvas.addEventListener("touchstart",f,!1):this.canvas.addEventListener("mousedown",f,!1);w||this.divDown.addEventListener("mouseout",u,!1);w?window.addEventListener("touchend",e,!1):window.addEventListener("mouseup",e,!1);w?this.canvas.addEventListener("touchmove",h,!1):this.canvas.addEventListener("mousemove",h,!1);w?this.scrollManipulator.addEventListener("touchstart",
j,!1):this.scrollManipulator.addEventListener("mousedown",g,!1);w?this.divUp.addEventListener("touchstart",q,!1):this.divUp.addEventListener("mousedown",q,!1);w?this.divDown.addEventListener("touchstart",p,!1):this.divDown.addEventListener("mousedown",p,!1);w||this.divUp.addEventListener("mouseout",n,!1);w||this.divDown.addEventListener("mouseout",u,!1);w?window.addEventListener("touchend",s,!1):window.addEventListener("mouseup",s,!1);w?window.addEventListener("touchend",t,!1):window.addEventListener("mouseup",
t,!1)};a.Scrollbar.prototype.getCursorPosition=function(d){d=a.getCursorPosition(d);return{x:d.x-(this.containerControl.offsetLeft+this.containerControl.parentNode.offsetLeft+this.containerControl.parentNode.parentNode.offsetLeft),y:d.y-(this.containerControl.offsetTop+this.containerControl.parentNode.offsetTop+this.containerControl.parentNode.parentNode.offsetTop)}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Audio=function(d,c){a.Control.call(this,d,c);var f=this.getContainer(),
e=this.evaluator.evalExpression(this.expresion);4==e[0].length?(this.w=e[0][2],this.h=e[0][3]):(this.w=100,this.h=28);if(e=navigator.userAgent.toLowerCase().match("firefox")&&!0)this.audioContainer=document.createElement("div"),this.audioContainer.setAttribute("style","overflow: hidden; position: absolute; width: "+this.w+"px; height: 35px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.audio=this.parent.getAudio(this.file);this.autoplay&&(this.audio.setAttribute("autoplay",
"autoplay"),this.audio.play());this.loop&&this.audio.setAttribute("loop","loop");this.audio.setAttribute("controls","controls");e?(this.audio.setAttribute("style","position: absolute; width: "+this.w+"px; height: 100px; left: 0px; top: -65px;"),this.audioContainer.appendChild(this.audio)):this.audio.setAttribute("style","position: absolute; width: "+this.w+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");f.childNodes[0]?e?f.insertBefore(this.audioContainer,f.childNodes[0]):
f.insertBefore(this.audio,f.childNodes[0]):e?f.appendChild(this.audioContainer):f.appendChild(this.audio)};a.extend(a.Audio,a.Control);a.Audio.prototype.update=function(){var a=this.evaluator;0<a.evalExpression(this.drawif)?this.audio.style.display="block":(this.audio.style.display="none",this.audio.pause());a=a.evalExpression(this.expresion);this.x=a[0][0];this.y=a[0][1];4==a[0].length&&(this.w=a[0][2],this.h=a[0][3])};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Video=
function(d,c){a.Control.call(this,d,c);var f=this.evaluator,e=this.getContainer(),h=this.evaluator.evalExpression(this.expresion);4==h[0].length?(this.w=h[0][2],this.h=h[0][3]):this.h=this.w=null;this.video=document.createElement("video");0<f.evalExpression(this.drawif)?this.video.style.display="block":(this.video.style.display="none",this.video.pause());this.autoplay&&this.video.setAttribute("autoplay","autoplay");this.loop&&this.video.setAttribute("loop","loop");this.video.setAttribute("controls",
"controls");this.poster&&this.video.setAttribute("poster",this.poster);this.w&&(this.video.setAttribute("width",this.w),this.video.setAttribute("height",this.h));this.video.setAttribute("style","position: absolute; overflow: hidden; left: "+this.x+"px; top: "+this.y+"px;");f=this.file;h=this.file.lastIndexOf(".");-1!=h&&(f=this.file.substring(0,h));h=document.createElement("source");h.setAttribute("src",f+".ogg");h.setAttribute("type","video/ogg");this.video.appendChild(h);h=document.createElement("source");
h.setAttribute("src",f+".mp4");h.setAttribute("type","video/mp4");this.video.appendChild(h);h=document.createElement("source");h.setAttribute("src",f+".webm");h.setAttribute("type","video/webm");this.video.appendChild(h);e.childNodes[0]?e.insertBefore(this.video,e.childNodes[0]):e.appendChild(this.video)};a.extend(a.Video,a.Control);a.Video.prototype.update=function(){var a=this.evaluator;0<a.evalExpression(this.drawif)?this.video.style.display="block":(this.video.style.display="none",this.video.pause());
a=a.evalExpression(this.expresion);this.x=a[0][0];this.y=a[0][1];4==a[0].length&&(this.w=a[0][2],this.h=a[0][3])};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.floor;a.TextArea=function(d,f){a.Control.call(this,d,f);this.region="interior";this.tabindex=++this.parent.tabindex;this.answer&&this.answer.match("krypto_")&&(this.answer=(new a.Krypto).decode(this.answer.substring(7)));var e=this.getContainer();this.containerControl=document.createElement("div");this.textArea=
document.createElement("div");this.textAreaAnswer=document.createElement("div");this.showButton=document.createElement("div");this.activeCover=document.createElement("div");this.containerControl.appendChild(this.textArea);this.containerControl.appendChild(this.textAreaAnswer);this.containerControl.appendChild(this.showButton);this.containerControl.appendChild(this.activeCover);e.childNodes[0]?e.insertBefore(this.containerControl,e.childNodes[0]):e.appendChild(this.containerControl);this.showAnswer=
!1;this.text=void 0==this.text.type?this.rawText:this.text.hasFormula?this.rawText:this.text.toHTML();e=this.parent.lessonParser.parseText(this.answer);void 0!=e.type&&!this.text.hasFormula&&(this.answer=e.toHTML());this.evaluator.setVariable(this.id,this.text);this.drawButton();this.init();this.registerMouseEvents()};a.extend(a.TextArea,a.Control);a.TextArea.prototype.init=function(){var d=this.answer?28:8;evaluator=this.evaluator;this.text=evaluator.getVariable(this.id);this.containerControl.setAttribute("class",
"DescartesTextAreaContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=0<evaluator.evalExpression(this.drawif)?"block":"none";this.containerControl.setAttribute("spellcheck","false");this.textArea.setAttribute("class","DescartesTextAreaContainer");this.textArea.setAttribute("style","width: "+(this.w-8)+"px; height: "+(this.h-d)+"px; left: 4px; top: 4px; background-color: white; text-align: left; font: "+
a.convertFont(this.font)+";");this.textArea.setAttribute("contenteditable","true");this.textArea.innerHTML="<span style='position: relative; top: 10px; left: 10px; white-space: nowrap;' >"+this.text+"</span>";this.textAreaAnswer.setAttribute("class","DescartesTextAreaContainer");this.textAreaAnswer.setAttribute("style","width: "+(this.w-8)+"px; height: "+(this.h-d)+"px; left: 4px; top: 4px; background-color: white; text-align: left; font: "+a.convertFont(this.font)+";");this.textAreaAnswer.style.display=
this.showAnswer?"block":"none";this.textAreaAnswer.innerHTML="<span style='position: relative; top: 10px; left: 10px; white-space: nowrap;'>"+this.answer+"</span>";this.showButton.setAttribute("style","width: 20px; height: 16px; position: absolute; bottom: 4px; right: 4px; cursor: pointer;");this.showButton.style.backgroundImage="url("+this.imageUnPush+")";this.showButton.innerHTML="<span style='position: relative; top: 2px; text-align: center; font: 9px Arial'> S </span>";this.activeCover.setAttribute("style",
"position: absolute; width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px;");this.activeCover.style.display=0<evaluator.evalExpression(this.activeif)?"none":"block"};a.TextArea.prototype.drawButton=function(){var c=document.createElement("canvas");c.setAttribute("width",20);c.setAttribute("height",16);for(var f=c.getContext("2d"),e=f.createLinearGradient(0,0,0,16),h,g=0;16>g;g++)h=d(g-5.6),e.addColorStop(g/16,"rgba(0,0,0,"+192*h*h/256/255+")");f.lineWidth=1;f.fillStyle=
"white";f.fillRect(0,0,20,16);f.fillStyle=e;f.fillRect(0,0,20,16);a.drawLine(f,19,0,19,16,"rgba(0,0,0,"+128/255+")");a.drawLine(f,0,0,0,16,"rgba(0,0,0,"+24/255+")");a.drawLine(f,1,0,1,16,"rgba(0,0,0,"+8/255+")");this.imageUnPush=c.toDataURL();f.fillStyle="white";f.fillRect(0,0,20,16);f.fillStyle=e;f.fillRect(0,0,20,16);a.drawLine(f,0,0,0,14,"gray");a.drawLine(f,0,0,19,0,"gray");f.fillStyle="rgba(0, 0, 0,"+24/255+")";f.fillRect(0,0,this.w,this.h);this.imagePush=c.toDataURL()};a.TextArea.prototype.update=
function(){evaluator=this.evaluator;evaluator.setVariable(this.id,this.text);var a=!1,d=!1,e=!1,h=!1;this.activeCover.style.display=0<evaluator.evalExpression(this.activeif)?"none":"block";this.containerControl.style.display=0<evaluator.evalExpression(this.drawif)?"block":"none";var g=evaluator.evalExpression(this.expresion),a=this.x!=g[0][0],d=this.y!=g[0][1];this.x=g[0][0];this.y=g[0][1];4==g[0].length&&(e=this.w!=g[0][2],h=this.h!=g[0][3],this.w=g[0][2],this.h=g[0][3]);(e||h||a||d)&&this.init()};
a.TextArea.prototype.registerMouseEvents=function(){function a(c){c.preventDefault();d.showButton.style.backgroundImage="url("+d.imageUnPush+")"}var d=this;this.showButton.addEventListener("mousedown",function(a){a.preventDefault();d.showAnswer=!d.showAnswer;d.textAreaAnswer.style.display=d.showAnswer?"block":"none";d.showButton.childNodes[0].childNodes[0].textContent=d.showAnswer?"T":"S";d.showButton.style.backgroundImage="url("+d.imagePush+")"});this.showButton.addEventListener("mouseup",a);this.showButton.addEventListener("mouseout",
a)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.LessonParser=function(a){this.parent=a;this.parser=this.parent.evaluator.parser};a.LessonParser.prototype.parseButtonsConfig=function(a){var c={rowsNorth:0,rowsSouth:0,widthEast:125,widthWest:125,height:23};a=this.split(a);for(var f,e,h=0,g=a.length;h<g;h++)switch(f=a[h][0],e=a[h][1],babel[f]){case "rowsNorth":c.rowsNorth=parseInt(e);break;case "rowsSouth":c.rowsSouth=parseInt(e);break;case "widthEast":c.widthEast=parseInt(e);
break;case "widthWest":c.widthWest=parseInt(e);break;case "height":c.height=parseInt(e);break;case "about":c.about="true"==babel[e];break;case "config":c.config="true"==babel[e];break;case "init":c.init="true"==babel[e];break;case "clear":c.clear="true"==babel[e];break;default:console.log("----- attributo de Espacio no identificado: <"+f+"> valor: <"+e+"> -----")}return c};a.LessonParser.prototype.parseSpace=function(d){var c={},f;d=this.split(d);for(var e,h=0,g=d.length;h<g;h++)switch(f=d[h][0],
e=d[h][1],babel[f]){case "type":c.type=e;break;case "id":c.id=e;break;case "x":f=e;f="%"==f[f.length-1]?(this.parent.container.width*parseFloat(f)/100).toString():e;c.xExpr=this.parser.parse(f);break;case "y":f=e;f="%"==f[f.length-1]?(this.parent.container.height*parseFloat(f)/100).toString():e;c.yExpr=this.parser.parse(f);break;case "width":f=e;"%"==f[f.length-1]?f=this.parent.container.width*parseFloat(f)/100:(f=parseFloat(e),f!=e&&(f=this.parent.container.width));c.w=f;break;case "height":f=e;
"%"==f[f.length-1]?f=this.parent.container.height*parseFloat(f)/100:(f=parseFloat(e),f!=e&&(f=this.parent.container.height));c.h=f;break;case "drawif":c.drawif=this.parser.parse(e);break;case "fixed":c.fixed="true"==babel[e];break;case "scale":f=parseFloat(e);f!=e&&(f=48);c.scale=f;break;case "O.x":c.OxExpr=e;break;case "O.y":c.OyExpr=e;break;case "image":c.imageSrc=e;break;case "bg_display":c.bg_display=babel[e];break;case "background":c.background=this.convertColor(e);break;case "net":c.net="false"==
babel[e]?"":this.convertColor(e);break;case "net10":c.net10="false"==babel[e]?"":this.convertColor(e);break;case "axes":c.axes="false"==babel[e]?"":this.convertColor(e);break;case "text":c.text="false"==babel[e]?"":this.convertColor(e);break;case "numbers":c.numbers="true"==babel[e];break;case "x-axis":c.x_axis="false"==babel[e]?"":e;break;case "y-axis":c.y_axis="false"==babel[e]?"":e;break;case "sensitive_to_mouse_movements":c.sensitive_to_mouse_movements="true"==babel[e];break;case "cID":c.cID=
e;break;case "R3":c.R3="true"==babel[e];break;case "render":c.render=babel[e];break;case "split":c.split="true"==babel[e];break;case "file":c.file=e;break;default:console.log("----- attributo de Espacio no identificado: <"+f+"> valor: <"+e+"> -----")}if("R2"==c.type||2==this.parent.version)return new a.Space2D(this.parent,c);if("R3"==c.type)return new a.Space3D(this.parent,c);if("AP"==c.type)return new a.SpaceAP(this.parent,c);if("HTMLIFrame"==c.type)return new a.SpaceHTML_IFrame(this.parent,c)};
a.LessonParser.prototype.parseControl=function(d){var c={};d=this.split(d);for(var f,e,h=0,g=d.length;h<g;h++)switch(f=d[h][0],e=d[h][1],babel[f]){case "id":c.id=e;break;case "type":c.type=babel[e.trim()];break;case "gui":c.gui=babel[e];break;case "region":c.region=babel[e];break;case "space":c.spaceID=e;break;case "name":c.name=e;break;case "expresion":c.expresion=this.parser.parse(e.replace(")(",","));break;case "fixed":c.fixed="true"==babel[e];break;case "visible":c.visible="true"==babel[e];break;
case "color":c.color=this.convertColor(e);break;case "colorInt":c.colorInt=this.convertColor(e);break;case "bold":"false"!=babel[e]&&(c.bold="bold");break;case "italics":"false"!=babel[e]&&(c.italics="italic");break;case "underlined":"false"!=babel[e]&&(c.underlined=!0);break;case "font_size":c.font_size=this.parser.parse(e);break;case "image":c.imageSrc=e;break;case "action":c.action=babel[e];break;case "parameter":c.parameter=e;break;case "drawif":c.drawif=this.parser.parse(e);break;case "activeif":c.activeif=
this.parser.parse(e);break;case "tooltip":c.tooltip=e;break;case "tooltipFont":c.tooltipFont=e;break;case "Explanation":c.Explanation=e;break;case "ExplanationFont":c.ExplanationFont=e;break;case "msg_pos":c.msg_pos=babel[e];break;case "cID":c.cID=e;break;case "value":f=e.replace(/&squot;/g,"'");f.match(/^\|/)&&(f="'"+f.substring(1),f.match(/\|$/)&&(f=f.substring(0,f.length-1)+"'"));c.valueExpr=this.parser.parse(f);c.valueExprString=f;break;case "decimals":c.decimals=this.parser.parse(e);break;case "min":c.min=
this.parser.parse(e);break;case "max":c.max=this.parser.parse(e);break;case "incr":0!=e&&(c.incr=this.parser.parse(e));break;case "discrete":c.discrete="true"==babel[e];break;case "onlyText":c.onlyText="true"==babel[e];break;case "evaluate":c.evaluate="true"==babel[e];break;case "answer":c.answer=e;break;case "exponentialif":c.exponentialif=parseFloat(e);break;case "size":c.size=this.parser.parse(e);break;case "constraint":c.constraintExpr=e;break;case "text":c.rawText=e;f=this.parseText(e);e=0;for(var j=
f.length;e<j;e++)f[e]=this.parser.parse(f[e],!1);c.text=f;break;case "trace":c.trace=this.convertColor(e);break;case "options":c.options=e;break;case "font":c.font=e;break;case "file":c.file=e;break;case "autoplay":c.autoplay="true"==babel[e];break;case "loop":c.loop="true"==babel[e];break;case "controls":c.controls="true"==babel[e];break;case "poster":c.poster=babel[e];break;default:var k=f.indexOf("."),j=babel[f.substring(0,k)],k=babel[f.substring(k+1)];if("parameter"==j&&"font"==k){c.parameterFont=
e;break}else if("Explanation"==j&&"font"==k){c.ExplanationFont=e;break}else if("tooltip"==j&&"font"==k){c.tooltipFont=e;break}console.log("----- attributo de control no identificado: <"+f+"> valor: <"+e+"> -----")}if("numeric"==c.type){if(void 0==c.gui||"spinner"==c.gui)return new a.Spinner(this.parent,c);if("button"==c.gui)return new a.Button(this.parent,c);if("textfield"==c.gui)return new a.TextField(this.parent,c);if("menu"==c.gui)return new a.Menu(this.parent,c);if("scrollbar"==c.gui)return new a.Scrollbar(this.parent,
c)}else{if("video"==c.type)return new a.Video(this.parent,c);if("audio"==c.type)return new a.Audio(this.parent,c);if("graphic"==c.type)return new a.GraphicControl(this.parent,c);if("text"==c.type)return new a.TextArea(this.parent,c)}};a.LessonParser.prototype.parseGraphic=function(d,c,f,e){e={rotateExp:e,parameter:"t"};d=this.split(d);for(var h,g,j=0,k=d.length;j<k;j++)switch(h=d[j][0],g=d[j][1],babel[h]){case "space":e.spaceID=g;break;case "type":e.type=babel[g];break;case "background":e.background=
"true"==babel[g];break;case "color":e.color=this.convertColor(g);break;case "drawif":e.drawif=this.parser.parse(g);break;case "abs_coord":e.abs_coord="true"==babel[g];break;case "expresion":"macro"!=e.type?(e.expresion=this.parser.parse(g),e.expresionString=g):e.expresion=g;break;case "trace":e.trace=this.convertColor(g);break;case "family":e.family=g;break;case "parameter":e.parameter=g;break;case "fill":e.fill=this.convertColor(g);break;case "fillP":e.fillP=this.convertColor(g);break;case "fillM":e.fillM=
this.convertColor(g);break;case "width":e.width=this.parser.parse(g);break;case "visible":e.visible="true"==babel[g];break;case "editable":e.editable="true"==babel[g];break;case "info":e.info=g;break;case "text":e.text=this.parseText(g);break;case "font":e.font=g;break;case "fixed":e.fixed="true"==babel[g];break;case "decimals":e.decimals=this.parser.parse(g);break;case "size":e.size=this.parser.parse(g);break;case "spear":e.spear=this.parser.parse(g);break;case "arrow":e.arrow=this.convertColor(g);
break;case "center":e.center=this.parser.parse(g);break;case "radius":e.radius=this.parser.parse(g);break;case "init":e.init=this.parser.parse(g);break;case "end":e.end=this.parser.parse(g);break;case "vectors":e.vectors="true"==babel[g];break;case "file":h=g.replace(/&squot;/g,"'");"["==h.charAt(0)&&"]"==h.charAt(h.length-1)&&(h=h.substring(1,h.length-1));h.match(/.jpg$|.png$|.gif$|.svg$/)&&(h="'"+h+"'");e.file=this.parser.parse(h);break;case "inirot":e.inirot=this.parser.parse(g);break;case "opacity":e.opacity=
this.parser.parse(g);break;case "inipos":e.inipos=this.parser.parse(g);break;case "name":e.name=g;break;case "range":e.range=this.parser.parse(g);break;case "border":"false"!=babel[g]&&(e.border=this.convertColor(g));break;case "align":e.align=babel[g];break;default:if(void 0!=e.family&&h.substring(0,e.family.length+1)==e.family+"."){switch(babel[h.substring(e.family.length+1)]){case "interval":e.family_interval=this.parser.parse(g);break;case "steps":e.family_steps=this.parser.parse(g)}break}if(void 0!=
e.parameter&&h.substring(0,e.parameter.length+1)==e.parameter+"."){switch(babel[h.substring(e.parameter.length+1)]){case "interval":e.parameter_interval=this.parser.parse(g);break;case "steps":e.parameter_steps=this.parser.parse(g)}break}console.log("----- attributo del grafico no identificado: <"+h+"> valor: <"+g+"> -----")}c&&(e.abs_coord=c);f&&(e.background=f);if("equation"==e.type)return new a.Equation(this.parent,e);if("curve"==e.type)return new a.Curve(this.parent,e);if("sequence"==e.type)return new a.Sequence(this.parent,
e);if("point"==e.type)return new a.Point(this.parent,e);if("segment"==e.type)return new a.Segment(this.parent,e);if("arrow"==e.type)return new a.Arrow(this.parent,e);if("polygon"==e.type)return new a.Polygon(this.parent,e);if("arc"==e.type)return new a.Arc(this.parent,e);if("text"==e.type)return new a.Text(this.parent,e);if("image"==e.type)return new a.Image(this.parent,e);if("macro"==e.type)return new a.Macro(this.parent,e);if("fill"==e.type)return new a.Fill(this.parent,e)};a.LessonParser.prototype.parse3DGraphic=
function(d,c,f,e){c={rotateExp:e,parameter:"t"};d=this.split(d);var h,g;f=0;for(e=d.length;f<e;f++)switch(h=d[f][0],g=d[f][1],babel[h]){case "space":c.spaceID=g;break;case "type":c.type=babel[g];break;case "background":c.background="true"==babel[g];break;case "color":c.color=this.convertColor(g);break;case "drawif":c.drawif=this.parser.parse(g);break;case "expresion":"macro"!=c.type&&"curve"!=c.type&&"surface"!=c.type?(c.expresion=this.parser.parse(g),c.expresionString=g):c.expresion=g;break;case "family":c.family=
g;break;case "parameter":c.parameter=g;break;case "width":c.width=this.parser.parse(g);break;case "length":c.length=this.parser.parse(g);break;case "text":h=this.parseText(g);g=0;for(var j=h.length;g<j;g++)h[g]=this.parser.parse(h[g],!1);c.text=h;break;case "font":c.font=g;break;case "fixed":c.fixed="true"==babel[g];break;case "decimals":c.decimals=this.parser.parse(g);break;case "file":h=g.replace(/&squot;/g,"'");"["==h.charAt(0)&&"]"==h.charAt(h.length-1)&&(h=h.substring(1,h.length-1));h.match(/./)&&
(h="'"+h+"'");c.file=this.parser.parse(h);break;case "model":c.model=babel[g];break;case "edges":c.edges="true"==babel[g];break;case "Nu":c.Nu=this.parser.parse(g);break;case "Nv":c.Nv=this.parser.parse(g);break;case "name":c.name=g;break;case "backcolor":c.backcolor=this.convertColor(g);break;case "inirot":c.inirot=this.parser.parse(g);break;case "endrot":c.endrot=this.parser.parse(g);break;case "inipos":c.inipos=this.parser.parse(g);break;case "endpos":c.endpos=this.parser.parse(g);break;default:if(void 0!=
c.family&&h.substring(0,c.family.length+1)==c.family+"."){switch(babel[h.substring(c.family.length+1)]){case "interval":c.family_interval=this.parser.parse(g);break;case "steps":c.family_steps=this.parser.parse(g)}break}if(void 0!=c.parameter&&h.substring(0,c.parameter.length+1)==c.parameter+"."){switch(babel[h.substring(c.parameter.length+1)]){case "interval":c.parameter_interval=this.parser.parse(g);break;case "steps":c.parameter_steps=this.parser.parse(g)}break}console.log("----- attributo del grafico no identificado: <"+
h+"> valor: <"+g+"> -----")}if("point"==c.type)return new a.Point3D(this.parent,c);if("segment"==c.type)return new a.Segment3D(this.parent,c);if("polygon"==c.type)return new a.Polygon3D(this.parent,c);if("curve"==c.type)return new a.Curve3D(this.parent,c);if("triangle"==c.type)return new a.Triangle3D(this.parent,c);if("face"==c.type)return new a.Face3D(this.parent,c);if("polireg"==c.type)return new a.Polireg3D(this.parent,c);if("surface"==c.type)return new a.Surface3D(this.parent,c);if("text"==c.type)return new a.Text3D(this.parent,
c);if("mesh"==c.type)return new a.Mesh3D(this.parent,c);console.log(c.type)};a.LessonParser.prototype.parseAuxiliar=function(d){var c={};d=this.split(d);for(var f=0,e=d.length;f<e;f++)d[f][1]=d[f][1].replace(/&squot;/g,"'");for(var h,g,f=0,e=d.length;f<e;f++)switch(h=d[f][0],g=d[f][1],babel[h]){case "id":c.id=g;break;case "editable":c.editable="true"==babel[g];break;case "constant":c.constant="true"==babel[g];break;case "array":c.array="true"==babel[g];break;case "file":c.file=g;break;case "matrix":c.matrix=
"true"==babel[g];break;case "rows":c.rows=this.parser.parse(g);break;case "columns":c.columns=this.parser.parse(g);break;case "algorithm":c.algorithm="true"==babel[g];break;case "init":c.init=g;break;case "do":c.doExpr=g;break;case "while":c.whileExpr=g;break;case "range":c.range=g;break;case "expresion":c.expresion=g;break;case "size":c.size=this.parser.parse(g);break;case "evaluate":c.evaluate=babel[g];break;case "event":c.event=babel[g];break;case "condition":c.condition=g;break;case "execution":c.execution=
babel[g];break;case "msg_pos":c.msg_pos=babel[g];break;case "action":c.action=babel[g];break;case "parameter":c.parameter=g;break;case "sequence":c.sequence="true"==babel[g];break;default:var j=h.indexOf("."),k=babel[h.substring(0,j)],j=babel[h.substring(j+1)];if("parameter"==k&&"font"==j){c.parameterFont=g;break}console.log("----- attributo de auxiliar no identificado: <"+h+"> valor: <"+g+"> -----")}c.sequence?new a.AuxSequence(this.parent,c):c.constant?(d=new a.Constant(this.parent,c),c.evaluate&&
"always"==c.evaluate&&this.parent.auxiliaries.push(d)):c.algorithm&&c.evaluate?(c=new a.Algorithm(this.parent,c),this.parent.auxiliaries.push(c)):c.array&&!c.matrix&&")"!=c.id.charAt(c.id.length-1)?(d=new a.Vector(this.parent,c),c.evaluate&&"always"==c.evaluate&&this.parent.auxiliaries.push(d)):c.matrix&&")"!=c.id.charAt(c.id.length-1)?(d=new a.Matrix(this.parent,c),c.evaluate&&"always"==c.evaluate&&this.parent.auxiliaries.push(d)):c.event&&")"!=c.id.charAt(c.id.length-1)?(c=new a.Event(this.parent,
c),this.parent.events.push(c)):")"==c.id.charAt(c.id.length-1)?new a.Function(this.parent,c):new a.Variable(this.parent,c)};a.LessonParser.prototype.parseAction=function(d){var c=d.action,f=d.parent;d=d.parameter;if(c)switch(c){case "message":return new a.Message(f,d);case "calculate":return new a.Calculate(f,d);case "openURL":return new a.OpenURL(f,d);case "openScene":return new a.OpenScene(f,d);case "about":return new a.About(f,d);case "config":return new a.Config(f,d);case "init":return new a.Init(f,
d);case "clear":return new a.Clear(f,d);case "animate":return new a.Animate(f,d);case "initAnimation":return new a.InitAnimation(f,d);case "playAudio":return new a.PlayAudio(f,d);default:console.log("----- Accion no soportada aun: <"+c+"> -----")}else return{execute:function(){}}};a.LessonParser.prototype.parseAnimation=function(d){var c={};d=this.split(d);for(var f,e,h=0,g=d.length;h<g;h++)switch(f=d[h][0],e=d[h][1],babel[f]){case "delay":c.delay=e;break;case "controls":c.controls="true"==babel[e];
break;case "auto":c.auto="true"==babel[e];break;case "loop":c.loop="true"==babel[e];break;case "init":c.init=e;break;case "do":c.doExpr=e;break;case "while":c.whileExpr=e;break;case "id":c.id=e;break;case "algorithm":c.algorithm="true"==babel[e];break;case "evaluate":c.evaluate="true"==babel[e];break;default:console.log("----- attributo de la animacion no identificado: <"+f+">  <"+e+"> -----")}return new a.Animation(this.parent,c)};a.LessonParser.prototype.parsePleca=function(d,c){d=this.split(d);
var f,e,h,g,j,k,l,m,q;e=f="";h=0;g="#536891";j="white";k="left";l="";m="SansSerif,BOLD,20";q="SansSerif,PLAIN,18";for(var p,n,u=0,s=d.length;u<s;u++)switch(p=d[u][0],n=d[u][1],p){case "title":f=n;break;case "subtitle":e=n;break;case "subtitlines":h=n;break;case "bgcolor":""!==n&&(g="#"+a.getColor(this.evaluator,n));break;case "fgcolor":""!==n&&(j="#"+a.getColor(this.evaluator,n));break;case "align":""!==n&&(k=n);break;case "titleimage":l=n;break;case "titlefont":m=""!==n?a.convertFont(n):a.convertFont(m);
break;case "subtitlefont":q=""!==n?a.convertFont(n):a.convertFont(q);break;default:console.log("----- attributo de la pleca no identificado: <"+p+">  <"+n+"> -----")}p=q.substring(0,q.indexOf("px"));p=p.substring(p.lastIndexOf(" "));var t,r;""!=l&&(t=this.parent.getImage(l),r=t.height);l=document.createElement("div");l.setAttribute("id","descartesPleca");r?(l.setAttribute("style","position: absolute; left: 0px; top: 0px; text-align: "+k+"; width: "+(c-30)+"px; height: "+(r-16)+"px; background: "+
g+"; color: "+j+"; padding-top: 8px; padding-bottom: 8px; padding-left: 15px; padding-right: 15px; margin: 0px; overflow: hidden; z-index: 100;"),t.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: -1; width: 100%; height: 100%"),l.appendChild(t)):l.setAttribute("style","position: absolute; left: 0px; top: 0px; text-align: "+k+"; width: "+(c-30)+"px; background: "+g+"; color: "+j+"; padding-top: 8px; padding-bottom: 8px; padding-left: 15px; padding-right: 15px; margin: 0px; z-index: 100;");
g=document.createElement("div");g.setAttribute("style","padding: 0px; margin: 0px; font: "+m+"; overflow: hidden; white-space: nowrap;");g.innerHTML=f;f=document.createElement("div");if(1==parseInt(h)){j=0;h=document.createElement("div");h.innerHTML=e;document.body.appendChild(h);m=p;do m-=j,h.setAttribute("style","padding: 0px; margin: 0px; font: "+q+"; font-size: "+m+"px; width: "+(c-30)+"px; line-height: "+m+"px;"),j=h.offsetHeight,k=j/m,j=1;while(1<k&&8<m);document.body.removeChild(h);f.setAttribute("style",
"padding: 0px; margin: 0px; font: "+q+"; font-size: "+m+"px; line-height: 110%; overflow: hidden; white-space: nowrap;")}else f.setAttribute("style","padding: 0px; margin: 0px; font: "+q+"; line-height: 110%;");f.innerHTML=e;l.appendChild(g);l.appendChild(f);l.imageHeight=r;return l};a.LessonParser.prototype.split=function(a){if("string"!=typeof a)return[];a=(a||"").replace(/\\'/g,"\u2019");for(var c=[],f=0,e=0,h=!1,g=0,j=!1;f<a.length;){" "==a.charAt(f)&&!h&&f++;" "!=a.charAt(f)&&!h&&(h=!0,g=f);
"="==a.charAt(f)&&("'"==a.charAt(f+1)&&!j)&&(j=!0,c[e]=[a.substring(g,f)],g=f+2,f+=2);j&&"'"==a.charAt(f)&&(h=j=!1,c[e].push(a.substring(g,f)),e++);if("="==a.charAt(f)&&"'"!=a.charAt(f+1)&&!j){c[e]=[a.substring(g,f)];g=f+1;f++;var h=a.substring(f).indexOf("="),k;-1==h?k=a.length:(h+=f,k=a.substring(f,h).lastIndexOf(" "),k=-1==k?a.length:k+f);c[e].push(a.substring(g,k));e++;h=!1;f=k}f++}return c};a.LessonParser.prototype.splitComa=function(a){for(var c=[],f=[],e=0,h=0,g=a.length;h<g;h++)"("==a.charAt(h)?
f.push(h):")"==a.charAt(h)?f.pop():","==a.charAt(h)&&0==f.length&&(c.push(a.substring(e,h)),e=h+1);c.push(a.substring(e));return c};a.LessonParser.prototype.convertColor=function(a){if(babel[a])return"net"==babel[a]?"red":babel[a];if(6==a.length)return"#"+a;if(8==a.length)return"rgba("+parseInt("0x"+a.substring(2,4),16)+","+parseInt("0x"+a.substring(4,6),16)+","+parseInt("0x"+a.substring(6,8),16)+","+(1-parseInt("0x"+a.substring(0,2),16)/255)+")";if("("==a[0]){var c="(";a=this.splitComa(a.substring(1,
a.length-1));for(var f,e=0,h=a.length;e<h;e++)f=parseInt(a[e],16),a[e]!=f.toString(16)?("["==a[e].charAt(0)&&"]"==a[e].charAt(a[e].length-1)&&(a[e]=a[e].substring(1,a[e].length-1)),c=c+a[e]+(e<h-1?",":")")):c=c+f/255+(e<h-1?",":")");return this.parser.parse(c)}return"#aa0000"};a.LessonParser.prototype.parseText=function(d){return d.match(/^\{\\rtf1/)?(new a.RTFParser(this.parent.evaluator)).parse(d.substring(10,d.length-1)):new a.SimpleText(d,this.parent)};return a}(descartesJS||{}),descartesJS=function(a){function d(a,
c){j=[];j.type="matrix";j.rows=a;j.cols=c;var d;l=0;for(m=c;l<m;l++){d=[];k=0;for(q=a;k<q;k++)d.push(0);j[l]=d}return j}function c(a,c){h=a.rows;g=a.cols;j=d(h,g);var e;for(l=0;l<h;l++)for(k=0;k<g;k++){for(m=e=0;m<g;m++)e+=a[m][l]*c[k][m];j[k][l]=e}return j}function f(a,c,e){for(var f=d(e.length-1,e.length-1),g=0,h=f.length;g<h;g++)for(var j=0;j<h;j++)f[g][j]=g<a?j<c?e[g][j]:e[g][j+1]:g<c?e[g+1][j]:e[g+1][j+1];return f}function e(a){if(1<a.cols){for(var c=0,d=1,g=0,h=a.cols;g<h;g++)c+=d*a[0][g]*e(f(0,
g,a)),d=-d;return c}return a[0][0]}if(a.loadLib)return a;a.Node=function(a,c){this.sep="";this.type=a;this.value=c;this.parent=null;this.childs=[]};a.Node.prototype.getRoot=function(){return null===this.parent?this:this.parent.getRoot()};a.Node.prototype.addChild=function(a){a.parent=this;this.childs.push(a)};a.Node.prototype.replaceLastChild=function(a){var c=this.childs.length-1;this.childs[c].parent=null;this.childs[c]=a;a.parent=this;return a};a.Node.prototype.setAllEvaluateFunction=function(){this.setEvaluateFunction();
for(var a=0,c=this.childs.length;a<c;a++)this.childs[a].setAllEvaluateFunction()};a.Node.prototype.toString=function(){var a="tipo: "+this.type+", valor: "+this.value+"\n";this.sep="   "+(this.parent?this.parent.sep:"");for(var c=0,d=this.childs.length;c<d;c++)a+=this.sep+this.childs[c].toString();return a};a.Node.prototype.contains=function(a){if(this.value===a)return!0;for(var c=0,d=this.childs.length;c<d;c++)if(this.childs[c].contains(a))return!0;return!1};a.Node.prototype.equalToMinus=function(){var c;
if("compOperator"===this.type){this.type="operator";this.value="-";c=new a.Node("compOperator","==");var d=new a.Node("number","0");c.addChild(this);c.addChild(d);c=this.getRoot();c.setAllEvaluateFunction();return c}return this};a.Node.prototype.setEvaluateFunction=function(){if("number"===this.type)this.evaluate=function(){return parseFloat(this.value)};else if("string"===this.type)this.evaluate=function(){return this.value};else if("identifier"===this.type&&0===this.childs.length)this.evaluate=
"rnd"==this.value?function(){return Math.random()}:function(a,c){var d=a.variables[this.value];if("object"===typeof d)return d.evaluate(a);void 0==d&&c&&(d=a.matrices[this.value]);return d||0};else if("identifier"===this.type&&"square_bracket"===this.childs[0].type&&1===this.childs[0].childs.length)this.evaluate=function(a){var c=this.childs[0].childs[0].evaluate(a);try{return a.vectors[this.value][0>c?0:Math.floor(c)]||0}catch(d){return 0}};else if("identifier"===this.type&&"square_bracket"===this.childs[0].type&&
1<this.childs[0].childs.length)this.evaluate=function(a){var c=this.childs[0].childs[0].evaluate(a),d=this.childs[0].childs[1].evaluate(a);try{return a.matrices[this.value][0>c?0:Math.floor(c)][0>d?0:Math.floor(d)]||0}catch(e){return 0}};else if("identifier"===this.type&&"parentheses"===this.childs[0].type)this.evaluate=function(a){for(var c=[],d=0,e=this.childs[0].childs.length;d<e;d++)c.push(this.childs[0].childs[d].evaluate(a));return"_Eval_"===this.value?a.parser.parse(c[0]):a.functions[this.value].apply(a,
c)};else if("operator"===this.type){var a,m;"+"===this.value?this.evaluate=function(c){a=this.childs[0].evaluate(c,!0);m=this.childs[1].evaluate(c,!0);if("matrix"!==a.type||"matrix"!==m.type)return a+m;c=a;var e=m;h=c.rows;g=c.cols;j=d(h,g);for(l=0;l<h;l++)for(k=0;k<g;k++)j[k][l]=c[k][l]+e[k][l];return j}:"-"===this.value?this.evaluate=function(c){a=this.childs[0].evaluate(c,!0);m=this.childs[1].evaluate(c,!0);if("matrix"!==a.type||"matrix"!==m.type)return a-m;c=a;var e=m;h=c.rows;g=c.cols;j=d(h,
g);for(l=0;l<h;l++)for(k=0;k<g;k++)j[k][l]=c[k][l]-e[k][l];return j}:"*"===this.value?this.evaluate=function(d){a=this.childs[0].evaluate(d,!0);m=this.childs[1].evaluate(d,!0);return"matrix"!==a.type||"matrix"!==m.type?a*m:c(a,m)}:"/"===this.value?this.evaluate=function(g){a=this.childs[0].evaluate(g,!0);m=this.childs[1].evaluate(g,!0);if("matrix"!==a.type||"matrix"!==m.type)return a/m;g=a;var h;h=m;var j=d(h.length,h.length),k=e(h);if(0===k)h=0;else{var k=1/k,q;if(1<h.length)for(var l=0,A=h.length;l<
A;l++){q=k;for(var v=0;v<A;v++)j[v][l]=q*e(f(l,v,h)),q=-q;k=-k}else j[0][0]=k;h=j}g=0===h?d(g.rows,g.cols):c(g,h);return g}:"%"===this.value?this.evaluate=function(c){a=this.childs[0].evaluate(c);m=this.childs[1].evaluate(c);return a-Math.floor(a/m)*m}:"^"===this.value&&(this.evaluate=function(a){return Math.pow(this.childs[0].evaluate(a),this.childs[1].evaluate(a))})}else"compOperator"===this.type?"<"===this.value?this.evaluate=function(a){return(this.childs[0].evaluate(a)<this.childs[1].evaluate(a))+
0}:"<="===this.value?this.evaluate=function(a){return(this.childs[0].evaluate(a)<=this.childs[1].evaluate(a))+0}:">"===this.value?this.evaluate=function(a){return(this.childs[0].evaluate(a)>this.childs[1].evaluate(a))+0}:">="===this.value?this.evaluate=function(a){return(this.childs[0].evaluate(a)>=this.childs[1].evaluate(a))+0}:"=="===this.value?this.evaluate=function(a){return(this.childs[0].evaluate(a)===this.childs[1].evaluate(a))+0}:"!="===this.value&&(this.evaluate=function(a){return(this.childs[0].evaluate(a)!=
this.childs[1].evaluate(a))+0}):"boolOperator"===this.type?"&"===this.value?this.evaluate=function(a){return this.childs[0].evaluate(a)?this.childs[1].evaluate(a)?1:0:0}:"|"===this.value?this.evaluate=function(a){return this.childs[0].evaluate(a)?1:this.childs[1].evaluate(a)?1:0}:"!"===this.value&&(this.evaluate=function(a){return!this.childs[0].evaluate(a)+0}):"conditional"===this.type?this.evaluate=function(a){return 0<this.childs[0].evaluate(a)?this.childs[1].evaluate(a):this.childs[2].evaluate(a)}:
"sign"===this.type?this.evaluate="sign+"===this.value?function(a){return this.childs[0].evaluate(a)}:function(a){return-this.childs[0].evaluate(a)}:"parentheses"===this.type?this.evaluate=function(a,c){return this.childs[0].evaluate(a,c)}:"(expr)"===this.type||"[expr]"===this.type?this.evaluate=function(a){var c=this.childs.length,d=[];if(1===c&&1===this.childs[0].childs.length&&"(expr)"===this.type)d=this.childs[0].childs[0].evaluate(a);else for(var e,f=0;f<c;f++){e=[];for(var g=0,h=this.childs[f].childs.length;g<
h;g++)e.push(this.childs[f].childs[g].evaluate(a));d[f]=e}return d}:"asign"===this.type&&(this.evaluate=function(a){var c=this.childs[0],d=this.childs[1];if(1===c.childs.length&&"square_bracket"===c.childs[0].type){var e=c.childs[0].childs;if(1===e.length){var f=e[0].evaluate(a),f=0>f?0:Math.floor(f);a.vectors[c.value][f]=d.evaluate(a)}else 2===e.length&&(f=e[0].evaluate(a),e=e[1].evaluate(a),f=0>f?0:Math.floor(f),e=0>e?0:Math.floor(e),a.matrices[c.value][f][e]=d.evaluate(a))}else d=d.evaluate(a),
d.type?a.matrices[c.value]=d:a.variables[c.value]=d})};var h,g,j,k,l,m,q;return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Tokenizer=function(){};a.Tokenizer.prototype.tokenize=function(a){var c=a;a&&(a=a.replace(/\\u(\S+) /g,function(a,c){return String.fromCharCode(parseInt(c,16))}),a=a.replace(/\&sup(.+);/g,"^$1 "),a=a.replace(/&squot;/g,"'"),a.match(/\=\|\*/g)&&(a=a.replace("|*","'","g").replace("*|","'","g")));for(var f=[],e=!1,h=0,g,j=a,k=0,l="",m=function(a,c,d){f.push({type:a,
value:c});j=j.slice(d);h+=d;k++;l=a};a&&h<a.length;)if(e=h,"'"==j[0]){for(g=1;"'"!=j[g];)if(g<j.length)g++;else{console.log(">Error, simbolo no conocido: ["+j+"], en la cadena <<"+c+">>");return}g=j.substring(1,g);m("string",g,g.length+2)}else if(g=j.match(/^\s+/))j=j.slice(g[0].length),h+=g[0].length,k++;else if(g=j.match(/^[a-zA-Z_\u00C0-\u021B]+[a-zA-Z_0-9\u00C0-\u021B]*([.]*[0-9a-zA-Z_\u00C0-\u021B]+[0-9]*)*/))"number"===l&&f.push({type:"operator",value:"*"}),m("identifier",g[0],g[0].length);
else if(g=j.match(/^[0-9]+[.][0-9]+|^[.][0-9]+|^[0-9]+/))m("number",g[0],g[0].length);else if(g=j.match(/^==|^!=|^<=|^<|^>=|^>|^#/))e=g[0],"#"==e&&(e="!="),m("compOperator",e,g[0].length);else if(g=j.match(/^\!|^\~|^\&\&|^\&|^\|\||^\|/))e=g[0],"||"==e?e="|":"&&"==e?e="&":"~"==e&&(e="!"),m("boolOperator",e,g[0].length);else if((g=j.match(/^=/))&&!j.match(/^==/))m("asign",g[0],g[0].length);else if(g=j.match(/^[\?\:]/))m("conditional",g[0],g[0].length);else if(g=j.match(/^[\+\-\*\/\%\^]/))m("operator",
g[0],g[0].length);else if(g=j.match(/^\[|^\]/))m("square_bracket",g[0],g[0].length);else if(g=j.match(/^\(|^\)/))m("parentheses",g[0],g[0].length);else if(g=j.match(/^,/))m("separator",g[0],g[0].length);else if(g=j.match(/^;/))m("final_of_expresion",g[0],g[0].length);else if(e==h){console.log("Error, simbolo no conocido: ["+j+"], en la cadena <<"+c+">>");return}return f};a.Tokenizer.prototype.flatTokens=function(a){a=a||[];for(var c="",f=0,e=a.length;f<e;f++)c="string"==a[f].type?c+"&squot;"+a[f].value+
"&squot;":c+a[f].value;return c};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Parser=function(d){this.evaluator=d;this.tokenizer=new a.Tokenizer;this.vectors={};this.matrices={};this.variables={};this.functions={};this.variables.rnd=Math.random;this.variables.pi=Math.PI;this.variables.e=Math.E;this.variables.Infinity=Infinity;this.variables["-Infinity"]=-Infinity;this.functions.sqr=function(a){return a*a};this.functions.sqrt=this.functions["ra\u00edz"]=Math.sqrt;this.functions.exp=
Math.exp;this.functions.log=Math.log;this.functions.log10=function(a){return Math.log(a)/Math.log(10)};this.functions.abs=Math.abs;this.functions.ent=Math.floor;this.functions.sgn=function(a){return 0<a?1:0>a?-1:0};this.functions.ind=function(a){return a?1:0};this.functions.sin=this.functions.sen=Math.sin;this.functions.cos=Math.cos;this.functions.tan=Math.tan;this.functions.cot=function(a){return 1/Math.tan(a)};this.functions.sec=function(a){return 1/Math.cos(a)};this.functions.csc=function(a){return 1/
Math.sin(a)};this.functions.sinh=this.functions.senh=function(a){return(Math.exp(a)-Math.exp(-a))/2};this.functions.cosh=function(a){return(Math.exp(a)+Math.exp(-a))/2};this.functions.tanh=function(a){return(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))};this.functions.coth=function(a){return 1/this.functions.tanh(a)};this.functions.sech=function(a){return 1/this.functions.cosh(a)};this.functions.csch=function(a){return 1/this.functions.sinh(a)};this.functions.asin=this.functions.asen=Math.asin;
this.functions.acos=Math.acos;this.functions.atan=Math.atan;this.functions.min=Math.min;this.functions.max=Math.max;this.functions.esCorrecto=function(c,d){return a.esCorrecto(c,d)};this.functions.escorrecto=function(c,d){return a.escorrecto(c,d)};window.parent.location.href!==window.location.href&&(this.functions["parent.set"]=function(a,d){window.parent.postMessage({type:"set",name:a,value:d},"*")},this.functions["parent.update"]=function(){window.parent.postMessage({type:"update"},"*")},this.functions["parent.get"]=
function(a,d){window.parent.postMessage({type:"get",name:a,value:d},"*")},this.functions["parent.exec"]=function(a,d){window.parent.postMessage({type:"exec",name:a,value:d},"*")})};a.Parser.prototype.setVariable=function(a,c){this.variables[a]=c};a.Parser.prototype.getVariable=function(a){return this.variables[a]};a.Parser.prototype.setVector=function(a,c,f){this.vectors[a][c]=f};a.Parser.prototype.getVector=function(a){this.vectors.hasOwnProperty(a)||(this.vectors[a]=[0,0,0]);return this.vectors[a]};
a.Parser.prototype.setMatrix=function(a,c,f,e){this.matrices[a][c][f]=e};a.Parser.prototype.getMatrix=function(a){this.matrices.hasOwnProperty(a)||(this.matrices[a]=[[0,0,0],[0,0,0],[0,0,0]]);return this.matrices[a]};a.Parser.prototype.setFunction=function(a,c){this.functions[a]=c};a.Parser.prototype.getFunction=function(a){this.functions.hasOwnProperty(a)||(this.functions[a]=function(){return 0});return this.functions[a]};a.Parser.prototype.parse=function(d,c,f){f=f?f+".":"";var e=this.tokenizer.tokenize(d);
e||(e=[]);var h=null,g;c=!c||!1;for(var j=0,k=0,l=0,m,q,p=0,n=e.length;p<n;p++)if(g=e[p],m=g.value,q=g.type,"identifier"==q&&(p+1<n&&"parentheses"==e[p+1].type&&"("==e[p+1].value?this.getFunction(m):p+1<n&&"square_bracket"==e[p+1].type&&"["==e[p+1].value?e[p+3]&&"square_bracket"==e[p+3].type&&"]"==e[p+3].value?this.getVector(m):this.getMatrix(m):this.getVariable(f+m)),"asign"==q&&c&&(q="compOperator",m="=="),"asign"==q)if(g=new a.Node(q,m),null!=h)if("identifier"==h.type)h.parent&&h.parent.replaceLastChild(g),
g.addChild(h),h=g,c=!0;else if("square_bracket"==h.type)g.addChild(h.parent),h=g,c=!0;else{g.type="compOperator";g.value="==";for(c=!0;h.parent&&this.precedence(h.parent.value)>=this.precedence(g.value);)h=h.parent;h.parent&&h.parent.replaceLastChild(g);g.addChild(h);h=g}else{console.log("Error1: en la expresion <<"+d+">>, en el token {valor: "+m+", tipo: "+q+"}");break}else if("parentheses"==q&&"("==m||"square_bracket"==q&&"["==m)if(g=new a.Node(q,m),"("==m&&j++,"["==m&&k++,null==h)"("==m&&(h=new a.Node("(expr)",
"(expr)"),h.addChild(g)),"["==m&&(h=new a.Node("[expr]","[expr]"),h.addChild(g)),h=g;else if("operator"==h.type||"boolOperator"==h.type||"compOperator"==h.type||"conditional"==h.type||"asign"==h.type)h.addChild(g),h=g;else if("sign"==h.type)h.addChild(g),h=g;else if("parentheses"==h.type&&"("==h.value)h.addChild(g),h=g;else if("square_bracket"==h.type&&"["==h.value)h.addChild(g),h=g;else if("parentheses"==h.type&&"()"==h.value)h.parent.addChild(g),h=g;else if("square_bracket"==h.type&&"[]"==h.value)h.parent.addChild(g),
h=g;else if("identifier"==h.type)h.addChild(g),h=g;else{console.log("Error2: en la expresion <<"+d+">>, en el token ["+p+"] {valor: "+m+", tipo: "+q+"}");break}else if("parentheses"==q&&")"==m)if(j--,null==h)console.log("Error3: en la expresion <<"+d+">>, en el token (valor:"+m+", tipo:"+q);else{for(;h&&h.parent&&"("!=h.value;)h=h.parent;if(h&&"("==h.value)h.value="()";else{console.log("Error4: en la expresion <<"+d+">>, en el token {valor: "+m+", tipo: "+q+"}");break}}else if("square_bracket"==q&&
"]"==m)if(k--,null==h)console.log("Error5: en la expresion <<"+d+">>, en el token (valor:"+m+", tipo:"+q);else{for(;h&&h.parent&&"["!=h.value;)h=h.parent;if(h&&"["==h.value)h.value="[]";else{console.log("Error6: en la expresion <<"+d+">>, en el token {valor: "+m+", tipo: "+q+"}");break}}else if("number"==q||"string"==q||"identifier"==q)if(g="identifier"==q?new a.Node(q,f+m):new a.Node(q,m),null==h)h=g;else if("operator"==h.type||"compOperator"==h.type||"boolOperator"==h.type||"parentheses"==h.type&&
"("==h.value||"square_bracket"==h.type&&"["==h.value||"sign"==h.type||"conditional"==h.type||"asign"==h.type)h.addChild(g),h=g;else{console.log("Error7: en la expresion <<"+d+">>, en el token {valor: "+m+", tipo: "+q+"}");break}else if("operator"==q||"compOperator"==q||"boolOperator"==q)if(g=new a.Node(q,m),null==h)if("-"==m||"+"==m)g.type="sign",g.value="sign"+m,h=g;else if("!"==m)h=g;else{console.log("Error8: en la expresion <<"+d+">>, en el token {valor: "+m+", tipo: "+q+"}");break}else if("operator"==
h.type||"compOperator"==h.type||"boolOperator"==h.type||"asign"==h.type||"conditional"==h.type||"square_bracket"==h.type&&"["==h.value&&("-"==m||"+"==m||"!"==m)||"parentheses"==h.type&&"("==h.value&&("-"==m||"+"==m||"!"==m)){if("-"==m||"+"==m)g.type="sign",g.value="sign"+m;h.addChild(g);h=g}else if("number"==h.type||"parentheses"==h.type&&"()"==h.value||"square_bracket"==h.type&&"[]"==h.value||"string"==h.type||"identifier"==h.type||"conditional"==h.type||"asign"==h.type){for(;h.parent&&this.precedence(h.parent.value)>=
this.precedence(g.value);)h=h.parent;h.parent&&h.parent.replaceLastChild(g);g.addChild(h);h=g}else{console.log("Error9: en la expresion <<"+d+">>, en el token {valor: "+m+", tipo: "+q+"}");break}else if("conditional"==q)if(g=new a.Node(q,m),null!=h)if("?"==g.value){for(l++;h.parent&&this.precedence(h.parent.value)>this.precedence(g.value);)h=h.parent;h.parent&&h.parent.replaceLastChild(g);g.addChild(h);h=g}else{for(l--;h&&h.parent&&"?"!=h.value;)h=h.parent;if(h&&"?"==h.value)h.value="?:";else{console.log("Error10: en la expresion <<"+
d+">>, en el token {valor: "+m+", tipo: "+q+"}");break}}else{console.log("Error11: en la expresion <<"+d+">>, en el token {valor: "+m+", tipo: "+q+"}");break}else if("separator"==q)if(null!=h)for(;h.parent&&"("!=h.value&&"["!=h.value;)h=h.parent;else{console.log("Error12: en la expresion <<"+d+">>, en el token {valor: "+m+", tipo: "+q+"}");break}else{console.log("Error13: en la expresion <<"+d+">>, en el token {valor: "+m+", tipo: "+q+"}");break}0<j&&alert("Error, faltan parentesis por cerrar: "+
d);0>j&&alert("Error, faltan parentesis por abrir: "+d);0<k&&alert("Error, faltan corchetes por cerrar: "+d);0>k&&alert("Error, faltan corchetes por abrir: "+d);0!=l&&alert("Error, condicional incompleta: "+d);(d=h?h.getRoot():null)&&d.setAllEvaluateFunction();return d};a.Parser.prototype.precedence=function(a){switch(a){case "=":return 1;case "(":return 2;case "[":return 2;case "?":return 2;case ":":return 3;case "?:":return 3;case "&":return 6;case "|":return 6;case "<":return 4;case "<=":return 4;
case ">":return 4;case ">=":return 4;case "==":return 4;case "!=":return 4;case "+":return 5;case "-":return 5;case "/":return 6;case "*":return 6;case "sign-":return 6;case "sign+":return 6;case "!":return 7;case "^":return 7;case "%":return 7;default:return 8}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.floor;a.Evaluator=function(c){this.parent=c;this.parser=new a.Parser;this.variables=this.parser.variables;this.functions=this.parser.functions;this.vectors=
this.parser.vectors;this.matrices=this.parser.matrices};a.Evaluator.prototype.setVariable=function(a,d){this.variables[a]=d};a.Evaluator.prototype.getVariable=function(a){return this.variables[a]};a.Evaluator.prototype.setVector=function(a,f,e){f=0>f?0:d(f);this.vectors[a][f]=e};a.Evaluator.prototype.getVector=function(a,f){f=0>f?0:d(f);return this.vectors[a][f]};a.Evaluator.prototype.setMatrix=function(a,f,e,h){f=0>f?0:d(f);e=0>e?0:d(e);this.matrices[a][f][e]=h};a.Evaluator.prototype.getMatrix=function(a,
f,e){f=0>f?0:d(f);e=0>e?0:d(e);return this.matrices[a][f][e]};a.Evaluator.prototype.setFunction=function(a,d){this.functions[a]=d};a.Evaluator.prototype.getFunction=function(a){return this.functions[a]};a.Evaluator.prototype.evalExpression=function(a){return a?a.evaluate(this):0};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=2,c=!1;a.RTFNode=function(a,c,e,d){this.evaluator=a;this.type="rtfNode";this.value=c;this.nodeType=e;this.style=d;this.styleString=d.toString();
this.color=d.textColor;this.underline=d.textUnderline;this.overline=d.textOverline;this.parent=null;this.childs=[];"textBlock"==this.nodeType?this.draw=this.drawTextBlock:"textLineBlock"==this.nodeType?this.draw=this.drawTextLineBlock:"formula"==this.nodeType?this.draw=this.drawFormula:"superIndex"==this.nodeType?this.draw=this.drawSuperIndex:"subIndex"==this.nodeType?this.draw=this.drawSubIndex:"dynamicText"==this.nodeType?(this.draw=this.drawDynamicText,this.decimal_symbol=this.evaluator.parent.decimal_symbol):
"fraction"==this.nodeType?this.draw=this.drawFraction:"numerator"==this.nodeType||"denominator"==this.nodeType?this.draw=this.drawNumDen:"radical"==this.nodeType?this.draw=this.drawRadical:"limit"==this.nodeType?this.draw=this.drawLimit:"integral"==this.nodeType?this.draw=this.drawIntegral:"sum"==this.nodeType?this.draw=this.drawSum:"matrix"==this.nodeType?this.draw=this.drawMatrix:"defparts"==this.nodeType?this.draw=this.drawDefparts:"text"==this.nodeType||"newLine"==this.nodeType?this.draw=this.drawText:
"mathSymbol"==this.nodeType?this.draw=this.drawMathSymbol:"index"==this.nodeType||"radicand"==this.nodeType||"from"==this.nodeType||"to"==this.nodeType||"what"==this.nodeType||"element"==this.nodeType?this.draw=this.drawGenericBlock:"componentNumCtrl"==this.nodeType?this.draw=this.drawComponentNumCtrl:"componentSpace"==this.nodeType&&(this.draw=this.drawComponentSpace)};a.RTFNode.prototype.getRoot=function(){return null==this.parent?this:this.parent.getRoot()};a.RTFNode.prototype.addChild=function(a){a.parent=
this;this.childs.push(a)};var f=0,e=0,h=0;a.RTFNode.prototype.getTextMetrics=function(){if("textBlock"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);for(var g=0,j=this.childs.length;g<j;g++)this.childs[g].getTextMetrics()}else if("textLineBlock"==this.nodeType)this.spaceWidth=a.getTextWidth(" ",this.styleString),this.getBlockMetric();else if("newLine"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);var k=a.getFontMetrics(this.styleString);this.baseline=
k.baseline;this.descent=k.descent;this.ascent=k.ascent;this.width=k.width;this.height=k.height}else if("text"==this.nodeType||"dynamicText"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);k=a.getFontMetrics(this.styleString);this.baseline=k.baseline;this.descent=k.descent;this.ascent=k.ascent;var g=this.value,n;"string"!=typeof this.value&&(j=void 0==this.decimals?d:this.evaluator.evalExpression(this.decimals),n=void 0==this.fixed?c:this.fixed,g=this.evaluator.evalExpression(this.value,
j,n),parseFloat(g)==g&&(g=parseFloat(g).toFixed(j),g=n?g:parseFloat(g),g=g.toString().replace(".",this.decimal_symbol)),g+=" ");this.width=a.getTextWidth(g,this.styleString);this.height=k.height}else if("formula"==this.nodeType)this.spaceWidth=a.getTextWidth(" ",this.styleString),this.getBlockMetric();else if("superIndex"==this.nodeType)this.spaceWidth=a.getTextWidth(" ",this.styleString),j=f,k=e,j=h,g=a.getFontMetrics(this.styleString),this.getBlockMetric(),0>this.height&&(this.ascent=g.ascent,this.descent=
g.descent,this.height=this.ascent+this.descent,this.width=1.5*this.spaceWidth),g=j/2-k+this.height,this.superIndexPos=g-this.ascent,this.ascent=g,this.descent=k,this.baseline=this.ascent,this.height=this.ascent+this.descent;else if("subIndex"==this.nodeType)this.spaceWidth=a.getTextWidth(" ",this.styleString),j=f,k=e,g=a.getFontMetrics(this.styleString),this.getBlockMetric(),0>this.height&&(this.ascent=g.ascent,this.descent=g.descent,this.height=this.ascent+this.descent,this.width=1.5*this.spaceWidth),
this.subIndexPos=k+1,this.ascent=j,this.descent=this.subIndexPos+this.descent,this.baseline=this.ascent,this.height=this.ascent+this.descent;else if("fraction"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);k=e;j=h;n=this.childs[0];var l=this.childs[1],g=a.getFontMetrics(n.styleString);n.getBlockMetric();l.getBlockMetric();0>n.height&&(n.height=g.height,n.width=this.spaceWidth);0>l.height&&(l.height=g.height,l.width=this.spaceWidth);this.height=n.height+l.height-1;this.ascent=
n.height+j/2-k;this.descent=this.height-this.ascent;this.baseline=this.ascent;this.width=Math.max(n.width,l.width)+this.spaceWidth+8}else if("radical"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);k=this.childs[0].style.clone();if(1===this.childs.length)this.childs[1]=new a.RTFNode(this.evaluator,"","radicand",k),this.childs[1].addChild(this.childs[0]),this.childs[0]=new a.RTFNode(this.evaluator,"","index",k);else if("index"!==this.childs[0].nodeType||"radicand"!==this.childs[1].nodeType){n=
new a.RTFNode(this.evaluator,"","radicand",k);g=0;for(j=this.childs.length;g<j;g++)n.addChild(this.childs[g]);this.childs=[];this.childs[0]=new a.RTFNode(this.evaluator,"","index",k);this.childs[1]=n}k=this.childs[0];g=this.childs[1];k.getBlockMetric();g.getBlockMetric();this.ascent=g.height/2<k.height?g.height/2+k.height+2-g.descent:g.ascent+4;this.descent=g.descent;this.baseline=this.ascent;this.height=this.ascent+this.descent;this.width=k.width+g.width+4*this.spaceWidth}else if("sum"==this.nodeType)this.spaceWidth=
a.getTextWidth(" ",this.styleString),k=this.childs[0],j=this.childs[1],n=this.childs[2],k.getBlockMetric(),j.getBlockMetric(),n.getBlockMetric(),-1==k.ascent&&(l=a.getFontMetrics(k.styleString),k.ascent=l.ascent,k.descent=l.descent,k.height=l.height),-1==j.ascent&&(l=a.getFontMetrics(j.styleString),j.ascent=l.ascent,j.descent=l.descent,j.height=l.height),g=a.getFontMetrics(this.styleString),this.ascent=g.height+j.height>n.ascent?g.height-g.descent+j.height:n.ascent,this.descent=k.height>n.descent?
k.height+g.descent:n.descent,this.baseline=this.ascent,this.height=this.ascent+this.descent,g=this.style.clone(),g.fontType="Times New Roman",g.Bold="bold",g=g.toString(),g=a.getTextWidth(String.fromCharCode(8721),g),this.width=Math.max(k.width,j.width,g)+Math.max(n.width,this.spaceWidth)+this.spaceWidth;else if("integral"==this.nodeType)this.spaceWidth=a.getTextWidth(" ",this.styleString),k=this.childs[0],j=this.childs[1],n=this.childs[2],k.getBlockMetric(),j.getBlockMetric(),n.getBlockMetric(),
-1==k.ascent&&(l=a.getFontMetrics(k.styleString),k.ascent=l.ascent,k.descent=l.descent,k.height=l.height),-1==j.ascent&&(l=a.getFontMetrics(j.styleString),j.ascent=l.ascent,j.descent=l.descent,j.height=l.height),g=a.getFontMetrics(this.styleString),this.ascent=g.height+j.height>n.ascent?g.height-g.descent+j.height:n.ascent,this.descent=k.height>n.descent?k.height+g.descent:n.descent,this.baseline=this.ascent,this.height=this.ascent+this.descent,g=this.style.clone(),g.fontSize*=1.5,g.fontType="Times New Roman",
g.Bold="bold",g=g.toString(),g=a.getTextWidth(String.fromCharCode(8747),g),this.width=Math.max(k.width,j.width,g)+Math.max(n.width,this.spaceWidth)+2*this.spaceWidth;else if("limit"==this.nodeType)this.spaceWidth=a.getTextWidth(" ",this.styleString),k=this.childs[0],j=this.childs[1],n=this.childs[2],g=a.getFontMetrics(this.styleString),k.getBlockMetric(),j.getBlockMetric(),n.getBlockMetric(),-1==k.ascent&&(l=a.getFontMetrics(k.styleString),k.ascent=l.ascent,k.descent=l.descent,k.height=l.height),
-1==j.ascent&&(l=a.getFontMetrics(j.styleString),j.ascent=l.ascent,j.descent=l.descent,j.height=l.height),-1==n.ascent&&(l=a.getFontMetrics(n.styleString),n.ascent=l.ascent,n.descent=l.descent,n.height=l.height),this.ascent=n.ascent,this.descent=Math.max(g.height,n.descent),this.baseline=this.ascent,this.height=this.ascent+this.descent,g=a.getTextWidth(" "+String.fromCharCode(8594),this.styleString),0==k.width&&(k.width=this.spaceWidth),0==j.width&&(j.width=this.spaceWidth),0==n.width&&(n.width=this.spaceWidth),
this.width=j.width+k.width+n.width+g+this.spaceWidth;else if("matrix"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);g=a.getFontMetrics(this.styleString);k=e;n=g.ascent;for(var l=g.descent,s=g.height,t=this.spaceWidth,r,w,g=0,j=this.childs.length;g<j;g++)this.childs[g].getBlockMetric(),r=this.childs[g].height,w=this.childs[g].width,s<r&&(s=r,n=this.childs[g].ascent,l=this.childs[g].descent),t<w&&(t=w);this.childWidth=t+2*this.spaceWidth;this.childHeight=s;this.childAscent=n;
this.childDescent=l;this.height=this.rows*s;this.ascent=this.height/2+k;this.descent=this.height-this.ascent;this.width=this.columns*this.childWidth+this.spaceWidth}else if("defparts"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);g=a.getFontMetrics(this.styleString);k=e;n=g.ascent;l=g.descent;s=g.height;t=this.spaceWidth;g=0;for(j=this.childs.length;g<j;g++)this.childs[g].getBlockMetric(),r=this.childs[g].height,w=this.childs[g].width,s<r&&(s=r,n=this.childs[g].ascent,l=this.childs[g].descent),
t<w&&(t=w);this.childWidth=t+2*this.spaceWidth;this.childHeight=s;this.childAscent=n;this.childDescent=l;this.height=this.parts*s;this.ascent=this.height/2+k;this.descent=this.height-this.ascent;this.width=t+this.spaceWidth/2}else"mathSymbol"==this.nodeType?(this.spaceWidth=a.getTextWidth(" ",this.styleString),k=a.getFontMetrics(this.styleString),this.baseline=k.baseline,this.descent=k.descent,this.ascent=k.ascent,this.width=a.getTextWidth(this.value,this.styleString)+a.getTextWidth(" ",this.styleString),
this.height=k.height):"componentNumCtrl"==this.nodeType?(this.spaceWidth=a.getTextWidth(" ",this.styleString),this.componentNumCtrl=this.evaluator.parent.getControlByCId(this.value),this.height=this.ascent=this.descent=this.baseline=0,this.width=this.componentNumCtrl.w):"componentSpace"==this.nodeType?(this.spaceWidth=a.getTextWidth(" ",this.styleString),this.componentSpace=this.evaluator.parent.getSpaceByCId(this.value),this.height=this.ascent=this.descent=this.baseline=0,this.width=this.componentSpace.w):
console.log("elemento no conocido",this.nodeType)};a.RTFNode.prototype.getBlockMetric=function(){this.width=0;for(var a=-1,c=-1,d,g=0,j=this.childs.length;g<j;g++){d=this.childs[g];d.getTextMetrics();childAscent=d.ascent;childDescent=d.descent;this.width+=d.width;var k=childDescent;d=d.height;f=childAscent;e=k;h=d;c<childAscent&&(c=childAscent);a<childDescent&&(a=childDescent)}this.ascent=c;this.descent=a;this.baseline=this.ascent;this.height=this.ascent+this.descent};a.RTFNode.prototype.drawTextBlock=
function(a,e,f,g,h,j){this.stableWidth||(this.getTextMetrics(),d=g,c=h);for(var k=h=g=0,l=this.childs.length;k<l;k++)0<k&&(h+=this.childs[k-1].height),"center"==j?g=-this.childs[k].width/2:"right"==j&&(g=-this.childs[k].width),this.childs[k].draw(a,e+g,f+h)};a.RTFNode.prototype.drawTextLineBlock=function(c,d,e){for(var f=0,g=0,h=this.childs.length;g<h;g++)0<g&&(f+=this.childs[g-1].width,"formula"==this.childs[g-1].nodeType&&(f+=2*a.getTextWidth(" ",this.childs[g].styleString))),this.childs[g].draw(c,
d+f,e+this.baseline)};a.RTFNode.prototype.drawFormula=function(a,c,d){for(var e=0,f=0,g=this.childs.length;f<g;f++)0<f&&(e+=this.childs[f-1].width),this.childs[f].draw(a,c+this.spaceWidth+e,d)};a.RTFNode.prototype.drawText=function(a,c,d){null!=this.color&&(a.fillStyle=this.color);a.font=this.styleString;a.textAlign="start";a.textBaseline="alphabetic";a.fillText(this.value,c-1,d);if(this.underline){var e="bold"==this.style.textBold,f=e?1:0.5;a.lineWidth=e?2:1;null!=this.color&&(a.strokeStyle=this.color);
a.beginPath();a.moveTo(c-1,parseInt(d+this.descent/2)+f);a.lineTo(c-1+this.width,parseInt(d+this.descent/2)+f);a.stroke()}this.overline&&(f=(e="bold"==this.style.textBold)?2:1.5,a.lineWidth=e?2:1,null!=this.color&&(a.strokeStyle=this.color),a.beginPath(),a.moveTo(c-1,parseInt(d-this.ascent)+f),a.lineTo(c-1+this.width,parseInt(d-this.ascent)+f),a.stroke())};a.RTFNode.prototype.drawDynamicText=function(e,f,g){var h=Math.floor(0.5*this.spaceWidth),j=void 0==this.decimals?d:this.evaluator.evalExpression(this.decimals),
k=void 0==this.fixed?c:this.fixed,l=this.evaluator.evalExpression(this.value,j,k);parseFloat(l)==l&&(l=k?parseFloat(l).toFixed(j):parseFloat(parseFloat(l).toFixed(j)),l=(""+l).replace(".",this.decimal_symbol));null!=this.color&&(e.fillStyle=this.color);e.font=this.styleString;e.textAlign="start";e.textBaseline="alphabetic";this.width=a.getTextWidth(l,this.styleString);e.fillText(l,h+f,g);this.underline&&(k=(j="bold"==this.style.textBold)?1:0.5,e.lineWidth=j?2:1,null!=this.color&&(e.strokeStyle=this.color),
e.beginPath(),e.moveTo(h+f-1,parseInt(g+this.descent/2)+k),e.lineTo(h+f-1+this.width,parseInt(g+this.descent/2)+k),e.stroke());this.overline&&(k=(j="bold"==this.style.textBold)?2:1.5,e.lineWidth=j?2:1,null!=this.color&&(e.strokeStyle=this.color),e.beginPath(),e.moveTo(h+f-1,parseInt(g-this.ascent)+k),e.lineTo(h+f-1+this.width,parseInt(g-this.ascent)+k),e.stroke());this.width+=2*h};a.RTFNode.prototype.drawRadical=function(a,e,c){var d=Math.floor(this.spaceWidth);this.childs[0].draw(a,e,Math.floor(c+
this.childs[1].descent-this.childs[1].height/2-this.childs[0].descent));this.childs[1].draw(a,e+1.5*d+this.childs[0].width,c);a.lineWidth=1;null!=this.color&&(a.strokeStyle=this.color);a.beginPath();a.moveTo(e,Math.floor(c+this.childs[1].descent-this.childs[1].height/2));a.lineTo(e+this.childs[0].width,Math.floor(c+this.childs[1].descent-this.childs[1].height/2));a.lineTo(e+this.childs[0].width+0.5*d,c+this.childs[1].descent);a.lineTo(e+this.childs[0].width+1*d,c-this.childs[1].ascent);a.lineTo(e+
this.childs[0].width+2*d+this.childs[1].width,c-this.childs[1].ascent);a.stroke()};a.RTFNode.prototype.drawFraction=function(a,e,c){this.childs[0].draw(a,e+(this.width-this.childs[0].width)/2,c-this.ascent);this.childs[1].draw(a,e+(this.width-this.childs[1].width)/2,c-this.ascent+this.childs[0].height-1);var d=Math.floor(0.5*this.spaceWidth);a.lineWidth=1;null!=this.color&&(a.strokeStyle=this.color);a.beginPath();a.moveTo(e+d,parseInt(c-this.ascent+this.childs[0].height)+0.5);a.lineTo(e-d+this.width-
1,parseInt(c-this.ascent+this.childs[0].height)+0.5);a.stroke()};a.RTFNode.prototype.drawNumDen=function(a,e,c){for(var d=0,f=0,g=this.childs.length;f<g;f++)0<f&&(d+=this.childs[f-1].width),this.childs[f].draw(a,e+d,c+this.baseline)};a.RTFNode.prototype.drawSubIndex=function(a,e,c){for(var d=0,f=0,g=this.childs.length;f<g;f++)0<f&&(d+=this.childs[f-1].width),this.childs[f].draw(a,e+d,c+this.subIndexPos)};a.RTFNode.prototype.drawSuperIndex=function(a,e,c){for(var d=0,f=0,g=this.childs.length;f<g;f++)0<
f&&(d+=this.childs[f-1].width),this.childs[f].draw(a,e+d,c-this.superIndexPos)};a.RTFNode.prototype.drawLimit=function(e,c,d){var f=a.getFontMetrics(this.styleString),g=" "+String.fromCharCode(8594),h=a.getTextWidth(g,this.styleString);this.childs[0].draw(e,c,d+f.descent+this.childs[0].ascent);this.childs[1].draw(e,c+this.childs[0].width+h,d+f.descent+this.childs[1].ascent);this.childs[2].draw(e,c+h+this.childs[0].width+this.childs[1].width,d);null!=this.color&&(e.fillStyle=this.color);e.font=this.styleString;
e.textAlign="start";e.textBaseline="alphabetic";e.fillText("l\u00edm",c+this.childs[0].width,d);e.fillText(g,c+this.childs[0].width,d+f.descent+this.childs[0].ascent)};a.RTFNode.prototype.drawIntegral=function(e,c,d){var f=this.style.clone();f.fontSize*=1.5;f.fontType="Times New Roman";f.Bold="bold";var f=f.toString(),g=a.getTextWidth(String.fromCharCode(8747),f),h=a.getFontMetrics(f),j=Math.max(this.childs[0].width,this.childs[1].width,Math.floor(1.5*g));this.childs[0].draw(e,c+g,d+h.descent+this.childs[0].ascent);
this.childs[1].draw(e,c+g+this.spaceWidth/2,d-this.ascent+this.childs[1].ascent);this.childs[2].draw(e,c+j+g,d);null!=this.color&&(e.fillStyle=this.color);e.font=f;e.textAlign="start";e.textBaseline="alphabetic";e.fillText(String.fromCharCode(8747),c,d+h.descent/2)};a.RTFNode.prototype.drawSum=function(e,c,d){var f=this.style.clone();f.fontType="Times New Roman";f.Bold="bold";var f=f.toString(),g=a.getTextWidth(String.fromCharCode(8721),f),h=a.getFontMetrics(this.styleString),j=Math.max(this.childs[0].width,
this.childs[1].width,g);this.childs[0].draw(e,c+(j-this.childs[0].width)/2,d+h.descent+this.childs[0].ascent);this.childs[1].draw(e,c+(j-this.childs[1].width)/2,d-h.ascent-this.childs[1].descent);this.childs[2].draw(e,c+j,d);null!=this.color&&(e.fillStyle=this.color);e.font=f;e.textAlign="start";e.textBaseline="alphabetic";e.fillText(String.fromCharCode(8721),c+Math.floor((j-g)/2),d-5)};a.RTFNode.prototype.drawMatrix=function(a,e,c){for(var d,f,g=0,h=this.childs.length;g<h;g++)d=g%this.columns,f=
Math.floor(g/this.columns),this.childs[g].draw(a,2*this.spaceWidth+e+d*this.childWidth,c-this.ascent+this.childAscent+f*this.childHeight);a.lineWidth=1;null!=this.color&&(a.strokeStyle=this.color);a.beginPath();a.moveTo(Math.floor(e+this.spaceWidth)+0.5,c-this.ascent+0.5);a.lineTo(Math.floor(e+this.spaceWidth/2)+0.5,c-this.ascent+0.5);a.lineTo(Math.floor(e+this.spaceWidth/2)+0.5,c+this.descent+0.5);a.lineTo(Math.floor(e+this.spaceWidth)+0.5,c+this.descent+0.5);a.moveTo(Math.floor(e+this.width-this.spaceWidth)-
0.5,c-this.ascent+0.5);a.lineTo(Math.floor(e+this.width-this.spaceWidth/2)-0.5,c-this.ascent+0.5);a.lineTo(Math.floor(e+this.width-this.spaceWidth/2)-0.5,c+this.descent+0.5);a.lineTo(Math.floor(e+this.width-this.spaceWidth)-0.5,c+this.descent+0.5);a.stroke()};a.RTFNode.prototype.drawDefparts=function(a,e,c){for(var d=0,f=this.childs.length;d<f;d++)this.childs[d].draw(a,e+this.spaceWidth/4,c-this.ascent+this.childAscent+d%this.parts*this.childHeight);a.lineWidth=1;null!=this.color&&(a.strokeStyle=
this.color);a.beginPath();a.moveTo(Math.floor(e+this.spaceWidth/3)+0.5,c-this.ascent+0.5);a.lineTo(Math.floor(e+this.spaceWidth/6)+0.5,c-this.ascent+0.5+(this.spaceWidth/3-this.spaceWidth/6));a.lineTo(Math.floor(e+this.spaceWidth/6)+0.5,c+this.descent-this.height/2-(this.spaceWidth/3-this.spaceWidth/6));a.lineTo(e+0.5,c+this.descent-this.height/2);a.lineTo(Math.floor(e+this.spaceWidth/6)+0.5,c+this.descent-this.height/2+(this.spaceWidth/3-this.spaceWidth/6));a.lineTo(Math.floor(e+this.spaceWidth/
6)+0.5,c+this.descent+0.5-(this.spaceWidth/3-this.spaceWidth/6));a.lineTo(Math.floor(e+this.spaceWidth/3)+0.5,c+this.descent+0.5);a.stroke()};a.RTFNode.prototype.drawMathSymbol=function(a,e,c){a.lineWidth=1;null!=this.color&&(a.strokeStyle=this.color,a.fillStyle=this.color);a.beginPath();"("==this.value?(a.font=this.styleString,a.textAlign="start",a.textBaseline="alphabetic",a.fillText("(",e,c)):")"==this.value?(a.font=this.styleString,a.textAlign="start",a.textBaseline="alphabetic",a.fillText(")",
e+this.spaceWidth,c)):(a.font=this.styleString,a.textAlign="center",a.textBaseline="alphabetic",a.fillText(this.value,e+this.width/2,c))};a.RTFNode.prototype.drawGenericBlock=function(a,e,c){for(var d=0,f=0,g=this.childs.length;f<g;f++)0<f&&(d+=this.childs[f-1].width),this.childs[f].draw(a,e+d,c)};a.RTFNode.prototype.drawComponentNumCtrl=function(a,e,c){this.getTextMetrics();this.componentNumCtrl.expresion=this.evaluator.parser.parse("("+e+","+(c-this.parent.ascent)+","+this.componentNumCtrl.w+","+
this.componentNumCtrl.h+")")};a.RTFNode.prototype.drawComponentSpace=function(a,e,c){this.getTextMetrics();this.componentSpace.xExpr=this.evaluator.parser.parse(e+"");this.componentSpace.yExpr=this.evaluator.parser.parse(c-this.parent.ascent+"")};a.RTFNode.prototype.draw=function(a,e,c){console.log(">>> Dibujo desconocido ",this.nodeType);this.childs[0].draw(a,e,c)};var g=document.createElement("span");g.appendChild(document.createTextNode("\u00c1p Texto"));var j=document.createElement("div");j.setAttribute("style",
"display: inline-block; width: 1px; height: 0px;");var k=document.createElement("div");k.setAttribute("style","margin: 0; padding: 0;");k.appendChild(g);k.appendChild(j);var l={};a.getFontMetrics=function(a){if(l[a])return l[a];g.setAttribute("style","font: "+a+"; margin: 0; padding: 0;");document.body.appendChild(k);var e={};j.style.verticalAlign="baseline";e.ascent=j.offsetTop-g.offsetTop;j.style.verticalAlign="bottom";e.height=j.offsetTop-g.offsetTop;e.descent=e.height-e.ascent;e.baseline=e.ascent;
document.body.removeChild(k);return l[a]=e};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.RTFTokenizer=function(){};a.RTFTokenizer.prototype.tokenize=function(a){a&&(a=a.replace(/(\\\w+)(\\u\d+)/g,"$1 $2"),a=a.replace(/\\u(\d+) /g,function(a,e){return String.fromCharCode(parseInt(e))}),a=a.replace(/\\{/g,String.fromCharCode(0)),a=a.replace(/\\}/g,String.fromCharCode(1)),a=a.replace(/&squot;/g,"'"),a=a.replace(/&amp;/g,"&"),a=a.replace(/&lt;/g,"<"),a=a.replace(/&gt;/g,
">"));for(var c=[],f=a,e=0,h=0,g,j,k,l,m=function(a,d,g){c.push({type:a,value:d});f=f.slice(g);e+=g};a&&e<a.length;)if(j=e,"{"==f.charAt(0))h++,m("openBlock",h,1);else if("}"==f.charAt(0))m("closeBlock",h,1),h--,""==f&&(e=a.length);else if((g=f.match(/^\\([\w\*]*)\\/))&&g[1])g=g[1],m("controlWord",g,g.length+1),e-=1;else if((g=f.match(/^\\(\w*)\s/))&&g[1])g=g[1],m("controlWord",g,g.length+2);else if((g=f.match(/^\\(\w*)\{/))&&g[1])g=g[1],m("controlWord",g,g.length+1),e-=1;else if((g=f.match(/^\\(\w*)\}/))&&
g[1])g=g[1],m("controlWord",g,g.length+1),e-=1;else if((g=f.match(/^\\(\w*)\;\\/))&&g[1])g=g[1],m("controlWord",g,g.length+2),e-=1;else if((g=f.match(/^\\(\w*)\;\}/))&&g[1])g=g[1],m("controlWord",g,g.length+2),e-=1;else if((g=f.match(/^\\(\w*)/))&&g[1])g=g[1],m("controlWord",g,g.length+1),e=a.length;else if("{"!=f.charAt(0)&&"}"!=f.charAt(0)&&"\\"!=f.charAt(0))g=f.indexOf("{"),j=f.indexOf("}"),k=f.indexOf("\\"),l=f.length,g=-1==g?l+1:g,j=-1==j?l+1:j,k=-1==k?l+1:k,g=Math.min(g,j,k),-1!=g&&0!=g?(m("text",
f.substring(0,g).replace(String.fromCharCode(0),"{").replace(String.fromCharCode(1),"}"),g),""==f&&(e=a.length)):(m("text",f.replace(String.fromCharCode(0),"{").replace(String.fromCharCode(1),"}"),f.length+1),e=a.length);else if(j==e){console.log("Error, simbolo no conocido: <<["+f+"]>>");return}return c};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.RTFParser=function(d){this.evaluator=d;this.tokenizer=new a.RTFTokenizer};a.RTFParser.prototype.parse=function(d){d=this.tokenizer.tokenize(d);
d=checkMathSymboslInFormula(d);var c={},f,e=2;if("openBlock"==d[0].type&&"fonttbl"==d[1].value){for(f=d[0].value;"closeBlock"!=d[e].type&&d[e].value!=f;)c[d[e].value]=d[e+2].value.substring(0,d[e+2].value.length-1),e+=3;e++}var h={},g=0,j,k,l;if("openBlock"==d[e].type&&"colortbl"==d[e+1].value){f=d[e++].value;for(e++;"closeBlock"!=d[e].type&&d[e].value!=f;)j=parseInt(d[e++].value.substring(3)).toString(16),k=parseInt(d[e++].value.substring(5)).toString(16),l=parseInt(d[e++].value.substring(4)).toString(16),
h[g++]="#"+(2>j.length?"0"+j:j)+(2>k.length?"0"+k:k)+(2>l.length?"0"+l:l);e++}f=new a.RTFNode(this.evaluator,"","textBlock","",!1,"");g=new a.RTFNode(this.evaluator,"","textLineBlock","",!1,"");f.addChild(g);for(var m,q,p,n=l=k=j=!1,u=!1,s=!1,t=[new a.FontStyle(20,"Arial","","",!1,!1,null)],r=t[0],w=!0,z=-1,A=-1,v=[],x=!1,D=!1,C=!1,B=!1,E=d.length;e<E;e++)if("controlWord"==d[e].type&&c[d[e].value])r.fontType=c[d[e].value];else if("controlWord"==d[e].type&&d[e].value.match(/^fs(\d+)/))r.fontSize=parseInt(d[e].value.match(/^fs(\d+)/)[1]/
2);else if("controlWord"==d[e].type&&"b"==d[e].value)r.textBold="bold";else if("controlWord"==d[e].type&&"b0"==d[e].value)r.textBold="";else if("controlWord"==d[e].type&&"i"==d[e].value)r.textItalic="italic";else if("controlWord"==d[e].type&&"i0"==d[e].value)r.textItalic="";else if("controlWord"==d[e].type&&"ul"==d[e].value)r.textUnderline=!0;else if("controlWord"==d[e].type&&"ulnone"==d[e].value)r.textUnderline=!1;else if("controlWord"==d[e].type&&"ol"==d[e].value)r.textOverline=!0;else if("controlWord"==
d[e].type&&"olnone"==d[e].value)r.textOverline=!1;else if("controlWord"==d[e].type&&d[e].value.match(/^cf(\d+)/))r.textColor=h[parseInt(d[e].value.substring(2))];else if("openBlock"==d[e].type)z=d[e].value,r=r.clone(),t.push(r),v.push(null);else if("closeBlock"==d[e].type)d[e].value==A&&(A=-1,j=!1,g=g.parent),t.pop(),r=t[t.length-1],v.pop();else if("controlWord"==d[e].type&&"par"==d[e].value){g.addChild(new a.RTFNode(this.evaluator,"","newLine",r.clone()));f=new a.RTFNode(this.evaluator,"","textLineBlock",
r.clone());if("textBlock"!=g.nodeType)for(g=g.parent;"textBlock"!=g.nodeType;)g=g.parent;g.addChild(f);g=f}else if("controlWord"==d[e].type&&"mjaformula"==d[e].value)x=!0,A=z,j=!0,f=new a.RTFNode(this.evaluator,"","formula",r.clone()),g.addChild(f),g=f,v[v.length-1]=f;else if("controlWord"==d[e].type&&("fraction"==d[e].value||"radicand"==d[e].value||"radical"==d[e].value||"what"==d[e].value||"sum"==d[e].value||"integral"==d[e].value||"limit"==d[e].value)){var y=v[v.length-2].style.clone();f=new a.RTFNode(this.evaluator,
"",d[e].value,y);v[v.length-2].addChild(f);v[v.length-1]=f}else if("controlWord"==d[e].type&&"index"==d[e].value||"to"==d[e].value||"from"==d[e].value)y=v[v.length-2].style.clone(),y.fontSize=parseInt(y.fontSize-0.2*y.fontSize),8>y.fontSize&&(y.fontSize=8),f=new a.RTFNode(this.evaluator,"",d[e].value,y),v[v.length-2].addChild(f),v[v.length-1]=f;else if("controlWord"==d[e].type&&("num"==d[e].value||"den"==d[e].value))y=v[v.length-2].style.clone(),y.fontSize=Math.round(y.fontSize-0.1*y.fontSize),8>
y.fontSize&&(y.fontSize=8),"num"==d[e].value?f=new a.RTFNode(this.evaluator,"","numerator",y):"den"==d[e].value&&(f=new a.RTFNode(this.evaluator,"","denominator",y)),v[v.length-2].addChild(f),v[v.length-1]=f;else if("controlWord"==d[e].type&&("subix"==d[e].value||"supix"==d[e].value))y=v[v.length-2].style.clone(),y.fontSize=Math.floor(y.fontSize-y.fontSize/3),8>y.fontSize&&(y.fontSize=8),"subix"==d[e].value?f=new a.RTFNode(this.evaluator,"","subIndex",y):"supix"==d[e].value&&(f=new a.RTFNode(this.evaluator,
"","superIndex",y)),f.originalStyle=v[v.length-2].style.clone(),v[v.length-2].addChild(f),v[v.length-1]=f;else if("controlWord"==d[e].type&&("defparts"==d[e].value||"matrix"==d[e].value||"element"==d[e].value))y=v[v.length-2].style.clone(),f=new a.RTFNode(this.evaluator,"",d[e].value,y),v[v.length-2].addChild(f),v[v.length-1]=f,"defparts"==d[e].value?p=f:"matrix"==d[e].value&&(q=f);else if("controlWord"==d[e].type&&"parts"==d[e].value)s=!0;else if("text"==d[e].type&&s)p.parts=parseInt(d[e].value),
s=!1;else if("controlWord"==d[e].type&&"rows"==d[e].value)n=!0;else if("text"==d[e].type&&n)q.rows=parseInt(d[e].value),n=!1;else if("controlWord"==d[e].type&&"columns"==d[e].value)u=!0;else if("text"==d[e].type&&u)q.columns=parseInt(d[e].value),u=!1;else if("controlWord"==d[e].type&&"expr"==d[e].value)w=!1,k=!0;else if("controlWord"==d[e].type&&"decimals"==d[e].value)l=!0;else if("text"==d[e].type&&l)m.decimals=this.evaluator.parser.parse(parseInt(d[e].value)+""),l=!1;else if("controlWord"==d[e].type&&
"fixed1"==d[e].value)m.fixed=!0;else if("controlWord"==d[e].type&&"fixed0"==d[e].value)m.fixed=!1;else if(!("controlWord"==d[e].type&&"component"==d[e].value))if("controlWord"==d[e].type&&"NumCtrl"==d[e].value)D=!0;else if("controlWord"==d[e].type&&"Space"==d[e].value)C=!0;else if("controlWord"==d[e].type&&"hyperlink"==d[e].value)B=!0;else if("text"==d[e].type&&B){textContent=d[e].value.split("|")[0];y=r.clone();y.textUnderline=!0;y.textColor="blue";f=new a.RTFNode(this.evaluator,textContent,"text",
y);if("textLineBlock"!=g.nodeType)for(g=g.parent;"textLineBlock"!=g.nodeType;)g=g.parent;g.addChild(f);B=!1}else if("text"==d[e].type&&D)f=new a.RTFNode(this.evaluator,d[e].value,"componentNumCtrl",r.clone()),g.addChild(f),D=!1;else if("text"==d[e].type&&C)f=new a.RTFNode(this.evaluator,d[e].value,"componentSpace",r.clone()),g.addChild(f),C=!1;else if("text"==d[e].type&&k)y=v[v.length-2].style.clone(),textContent=this.evaluator.parser.parse("''+("+d[e].value+")"),f=new a.RTFNode(this.evaluator,textContent,
"dynamicText",y),v[v.length-2].addChild(f),m=v[v.length-1]=f,k=!1;else if("text"==d[e].type&&!k&&!j){textContent=d[e].value;f=new a.RTFNode(this.evaluator,textContent,"text",r.clone());if("textLineBlock"!=g.nodeType)for(g=g.parent;"textLineBlock"!=g.nodeType;)g=g.parent;g.addChild(f)}else if("text"==d[e].type&&!k&&j)textContent=d[e].value,f=new a.RTFNode(this.evaluator,textContent,"text",v[v.length-1].style.clone()),v[v.length-1].addChild(f);else if("("==d[e].type||")"==d[e].type)y=v[v.length-1].style.clone(),
y.textItalic="",f=new a.RTFNode(this.evaluator,d[e].type,"mathSymbol",y),v[v.length-1].addChild(f);else if("+"==d[e].type||"-"==d[e].type||"*"==d[e].type||"="==d[e].type)f=new a.RTFNode(this.evaluator,d[e].type,"mathSymbol",v[v.length-1].style.clone()),v[v.length-1].addChild(f);if(null!=g){var G=g.getRoot();G.stableWidth=w;G.getTextMetrics();G.hasFormula=x}return G};a.FontStyle=function(a,c,f,e,h,g,j){this.fontSize=a;this.fontType=c;this.textItalic=f;this.textBold=e;this.textUnderline=h;this.textOverline=
g;this.textColor=j};a.FontStyle.prototype.toString=function(){return(this.textBold+" "+this.textItalic+" "+this.fontSize+"px "+this.fontType).trim()};a.FontStyle.prototype.toCSS=function(){var a="style='font-family: "+this.fontType+"; font-size: "+this.fontSize+"px; ";this.textUnderline&&!this.textOverline&&(a+="text-decoration: underline; ");!this.textUnderline&&this.textOverline&&(a+="text-decoration: overline; ");this.textUnderline&&this.textOverline&&(a+="text-decoration: underline overline; ");
this.textBold&&!this.textItalic&&(a+="font-style: normal; font-weight: bold; ");!this.textBold&&this.textItalic&&(a+="font-style: italic; font-weight: normal; ");this.textBold&&this.textItalic&&(a+="font-style: italic; font-weight: bold; ");!this.textBold&&!this.textItalic&&(a+="font-style: normal; font-weight: normal; ");this.textColor&&(a+="color: "+this.textColor+"; ");return a+"'"};a.FontStyle.prototype.clone=function(){return new a.FontStyle(this.fontSize,this.fontType,this.textItalic,this.textBold,
this.textUnderline,this.textOverline,this.textColor)};checkMathSymboslInFormula=function(a){for(var c=[],f=!1,e=!1,h=[],g=0,j=a.length;g<j;g++){"openBlock"==a[g].type&&h.push(a[g].value);"closeBlock"==a[g].type&&(h.pop(),0>=h.length&&(f=!1));if("controlWord"==a[g].type&&("expr"==a[g].value||"decimals"==a[g].value))e=!0;"controlWord"==a[g].type&&"mjaformula"==a[g].value&&(f=!0);if("text"==a[g].type&&f&&!e){for(var k=0,l=a[g].value,m="",q=0,p=l.length;q<p;q++)if("("==l.charAt(q)||")"==l.charAt(q)||
"+"==l.charAt(q)||"-"==l.charAt(q)||"*"==l.charAt(q)||"="==l.charAt(q))m=l.substring(k,q),""!=m&&c.push({type:"text",value:m}),c.push({type:l.charAt(q),value:l.charAt(q)}),k=q+1;m=l.substring(k,q);""!=m&&c.push({type:"text",value:m})}else c.push(a[g]),"text"==a[g].type&&e&&(e=!1)}return c};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.floor;a.Space=function(a,d){this.parent=a;this.evaluator=this.parent.evaluator;var e=this.evaluator.parser;this.values=d;this.type=
"R2";this.xExpr=e.parse("0");this.yExpr=e.parse("0");this.w=parseInt(a.container.width);this.h=parseInt(a.container.height);this.drawif=e.parse("1");this.fixed=2!=this.parent.version?!1:!0;this.scale=48;this.Oy=this.Ox=0;this.image=new Image;this.image.onload=function(){this.ready=1};this.imageSrc="";this.bg_display="topleft";this.background="descinst.com.mja.descartes.DescartesJS.class"==this.parent.code||this.parent.arquimedes?"#f0f8fa":"#ffffff";this.net=2!=this.parent.version?"#c0c0c0":"";this.net10=
2!=this.parent.version?"#808080":"";this.axes=2!=this.parent.version?"#808080":"";this.text="#ffafaf";this.numbers=!1;this.x_axis=2!=this.parent.version?"":" ";this.y_axis=2!=this.parent.version?"":" ";this.sensitive_to_mouse_movements=!1;this.cID="";this.mouse_y=this.mouse_x=0;this.ctrs=[];this.graphics=[];this.zIndex=a.zIndex;this.plecaHeight=this.parent.plecaHeight||0;this.displaceRegionNorth=this.parent.displaceRegionNorth||0;this.displaceRegionWest=this.parent.displaceRegionWest||0;for(var h in d)d.hasOwnProperty(h)&&
(this[h]=d[h]);this.init()};a.Space.prototype.init=function(){this.displaceRegionNorth=this.parent.displaceRegionNorth||0;this.displaceRegionWest=this.parent.displaceRegionWest||0;var a=this.parent,d=this.evaluator,e=this.id,h,g=parseInt(this.parent.container.height),j=parseInt(this.parent.container.width);d.setVariable(e+"._w",this.w);d.setVariable(e+"._h",this.h);this.x=d.evalExpression(this.xExpr)+this.displaceRegionWest;this.y=d.evalExpression(this.yExpr)+this.plecaHeight+this.displaceRegionNorth;
this.container&&(this.container.style.left=this.x+"px",this.container.style.top=this.y+"px");if(!this.parent.hackChafaParaQueFuncionenLasEscenasDeArquimedes||"_BASE_"==this.id)0<=this.y?(h=g-this.y,this.h>h&&(this.h=h)):(h=this.h+this.y,this.h=h>=g?g:h),0<=this.x?(h=j-this.x,this.w>h&&(this.w=h)):(h=this.w+this.x,this.w=h>=j?j:h);if(""!=this.imageSrc||!this.imageSrc.toLowerCase().match(/vacio.gif$/))this.image=a.getImage(this.imageSrc);this.OxExpr&&(j=this.OxExpr,"%"==j[j.length-1]?this.Ox=this.w*
parseFloat(j)/100:(a=parseFloat(j),a!=j&&(a=0),this.Ox=a));this.OyExpr&&(j=this.OyExpr,"%"==j[j.length-1]?this.Oy=this.h*parseFloat(j)/100:(a=parseFloat(j),a!=j&&(a=0),this.Oy=a));2!=this.parent.version?(d.setVariable(e+"._w",this.w),d.setVariable(e+"._h",this.h),d.setVariable(e+".escala",this.scale),d.setVariable(e+".Ox",this.Ox),d.setVariable(e+".Oy",this.Oy),d.setVariable(e+".mouse_x",0),d.setVariable(e+".mouse_y",0),d.setVariable(e+".mouse_pressed",0)):(e=this.evaluator.getVariable("_w"),void 0==
e&&(e=this.w),d.setVariable("_w",e),e=this.evaluator.getVariable("_h"),void 0==e&&(e=this.h),d.setVariable("_h",e),e=this.evaluator.getVariable("escala"),void 0==e&&(e=this.w),d.setVariable("escala",e),e=this.evaluator.getVariable("Ox"),void 0==e&&(e=this.Ox),d.setVariable("Ox",e),e=this.evaluator.getVariable("Oy"),void 0==e&&(e=this.Oy),d.setVariable("Oy",e),d.setVariable("mouse_x",0),d.setVariable("mouse_y",0),d.setVariable("mouse_pressed",0),""==this.x_axis&&""==this.y_axis&&(this.axes=""))};a.Space.prototype.addCtr=
function(a){this.ctrs.push(a)};a.Space.prototype.addGraph=function(a){this.graphics.push(a)};a.Space.prototype.getRelativeX=function(a){return(a-d(this.w/2+this.Ox))/this.scale};a.Space.prototype.getRelativeY=function(a){return(-a+d(this.h/2+this.Oy))/this.scale};a.Space.prototype.getAbsoluteX=function(a){return a*this.scale+d(this.w/2+this.Ox)};a.Space.prototype.getAbsoluteY=function(a){return-a*this.scale+d(this.h/2+this.Oy)};a.Space.prototype.findOffset=function(){var a=this.container,d;for(this.offsetTop=
this.offsetLeft=0;a;){d=null;a.getAttribute&&(d=a.getAttribute("class"));if(d&&("DescartesSpace2DContainer"==d||"DescartesAppContainer"==d))this.offsetLeft+=a.offsetLeft,this.offsetTop+=a.offsetTop;a=a.parentNode}};a.Space.prototype.getCursorPosition=function(c){c=a.getCursorPosition(c);return{x:c.x-this.offsetLeft,y:c.y-this.offsetTop}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.floor,c=Math.round,f=2*Math.PI;a.Space2D=function(e,c){a.Space.call(this,e,c);
this.backgroundCanvas=document.createElement("canvas");this.backgroundCanvas.setAttribute("id",this.id+"_background");this.backgroundCanvas.setAttribute("width",this.w+"px");this.backgroundCanvas.setAttribute("height",this.h+"px");this.backgroundCtx=this.backgroundCanvas.getContext("2d");this.canvas=document.createElement("canvas");this.canvas.setAttribute("id",this.id+"_canvas");this.canvas.setAttribute("width",this.w+"px");this.canvas.setAttribute("height",this.h+"px");this.canvas.setAttribute("class",
"DescartesSpace2DCanvas");this.canvas.setAttribute("style","z-index: "+this.zIndex+";");this.ctx=this.canvas.getContext("2d");this.graphicControlContainer=document.createElement("div");this.graphicControlContainer.setAttribute("id",this.id+"_graphicControls");this.graphicControlContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: "+this.zIndex+";");this.numericalControlContainer=document.createElement("div");this.numericalControlContainer.setAttribute("id",this.id+"_numericalControls");
this.numericalControlContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: "+this.zIndex+";");this.container=document.createElement("div");this.container.setAttribute("id",this.id);this.container.setAttribute("class","DescartesSpace2DContainer");this.container.setAttribute("style","left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.parent.arquimedes&&"#f0f8fa"===a.getColor(this.evaluator,this.background)&&this.container.setAttribute("style","left: "+
this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+"; border: 1px solid #b8c4c8;");this.container.appendChild(this.backgroundCanvas);this.container.appendChild(this.canvas);this.container.appendChild(this.graphicControlContainer);this.container.appendChild(this.numericalControlContainer);e.container.insertBefore(this.container,e.loader);this.findOffset();this.parent.images[this.id+".image"]=this.canvas;this.parent.images[this.id+".image"].ready=1;this.parent.images[this.id+".image"].complete=!0;
this.evaluator.setVariable(this.id+".image",this.id+".image");this.parent.images[this.id+".back"]=this.backgroundCanvas;this.parent.images[this.id+".back"].ready=1;this.parent.images[this.id+".back"].complete=!0;this.evaluator.setVariable(this.id+".back",this.id+".back");this.drawBefore=0<this.evaluator.evalExpression(this.drawif);"descartesJS_scenario"!==this.id&&this.registerMouseEvents()};a.extend(a.Space2D,a.Space);var e;a.Space2D.prototype.update=function(a){var c=2!=this.parent.version?this.id+
".Ox":"Ox",d=2!=this.parent.version?this.id+".Oy":"Oy",f=2!=this.parent.version?this.id+".escala":"escala",l=this.evaluator;l.setVariable(this.id+"._w",this.w);l.setVariable(this.id+"._h",this.h);var m=this.x!=l.evalExpression(this.xExpr)+this.displaceRegionWest,q=this.y!=l.evalExpression(this.yExpr)+this.parent.plecaHeight+this.displaceRegionNorth;this.spaceChange=a||m||q||this.drawBefore!=0<l.evalExpression(this.drawif)||this.Ox!=l.getVariable(c)||this.Oy!=l.getVariable(d)||this.scale!=l.getVariable(f);
this.x=m?l.evalExpression(this.xExpr)+this.displaceRegionWest:this.x;this.y=q?l.evalExpression(this.yExpr)+this.parent.plecaHeight+this.displaceRegionNorth:this.y;this.Ox=l.getVariable(c);this.Oy=l.getVariable(d);this.scale=l.getVariable(f);this.drawBefore=0<l.evalExpression(this.drawif);1E-6>this.scale?(this.scale=1E-6,l.setVariable(f,0)):1E6<this.scale&&(this.scale=1E6,l.setVariable(f,1E6));m&&(this.container.style.left=this.x+"px");q&&(this.container.style.top=this.y+"px");(m||q)&&this.findOffset();
if(0<l.evalExpression(this.drawif)){this.container.style.display="block";a=0;for(c=this.graphics.length;a<c;a++)e=this.graphics[a],""!=e.trace&&(!this.spaceChange&&!this.click&&!e.background)&&e.drawTrace();this.drawBackground();this.draw()}else this.container.style.display="none"};a.Space2D.prototype.drawBackground=function(){if(this.spaceChange){var e=this.evaluator,c=this.backgroundCtx;c.clearRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height);c.fillStyle=a.getColor(e,this.background);
c.fillRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height);this.image&&(""!=this.image.src&&this.image.ready&&this.image.complete)&&("topleft"==this.bg_display?c.drawImage(this.image,0,0):"stretch"==this.bg_display?c.drawImage(this.image,0,0,this.w,this.h):"patch"==this.bg_display?(c.fillStyle=c.createPattern(this.image,"repeat"),c.fillRect(0,0,this.canvas.width,this.canvas.height)):"center"==this.bg_display&&c.drawImage(this.image,(this.w-this.image.width)/2,(this.h-this.image.height)/
2));for(var f=this.scale,k=0,l=0>this.w+this.h?0:this.w+this.h;f>l;)f/=10,k++;for(;f<l/10;)f*=10;c.lineWidth=1;""!=this.net&&(c.strokeStyle=a.getColor(e,this.net),this.drawMarks(c,f/10,-1));if(2!=this.parent.version&&""!=this.net10||2==this.parent.version&&""!=this.net&&""!=this.net10)c.strokeStyle=a.getColor(e,this.net10),this.drawMarks(c,f,-1);if(""!=this.axes){c.strokeStyle=a.getColor(e,this.axes);c.beginPath();if(""!=this.x_axis||2!=this.parent.version)c.moveTo(0,d(this.h/2+this.Oy)+0.5),c.lineTo(this.w,
d(this.h/2+this.Oy)+0.5);if(""!=this.y_axis||2!=this.parent.version)c.moveTo(d(this.w/2+this.Ox)+0.5,0),c.lineTo(d(this.w/2+this.Ox)+0.5,this.h);c.stroke();this.drawMarks(c,f,4);this.drawMarks(c,f/2,2);this.drawMarks(c,f/2/5,1)}if(""!=this.x_axis||""!=this.y_axis)c.fillStyle=a.getColor(e,this.axes),c.font="12px Arial",c.textAlign="right",c.textBaseline="top",c.fillText(this.x_axis,d(this.w)-2,d(this.h/2+this.Oy)),c.fillText(this.y_axis,d(this.w/2+this.Ox)-2,0);this.numbers&&""!=this.axes&&(c.fillStyle=
a.getColor(e,this.axes),c.font="12px Arial",c.textAlign="start",c.textBaseline="bottom",f>(this.w+this.h)/2?this.drawNumbers(c,f/5,f<=this.scale?k+1:k):f>(this.w+this.h)/4?this.drawNumbers(c,f/2,f<=this.scale?k+1:k):this.drawNumbers(c,f,k));e=0;for(c=this.graphics.length;e<c;e++)f=this.graphics[e],f.background&&f.draw()}};a.Space2D.prototype.draw=function(){var e=this.ctx,c;e.clearRect(0,0,this.canvas.width,this.canvas.height);for(var j=0,k=this.graphics.length;j<k;j++)c=this.graphics[j],c.background||
c.draw();j=0;for(k=this.ctrs.length;j<k;j++)c=this.ctrs[j],"graphic"==c.type&&c.draw();if(""!=this.text&&this.click&&"LEFT"==this.whichButton){e.fillStyle=a.getColor(this.evaluator,this.text);e.strokeStyle=e.fillStyle;e.lineWidth=1;e.font="12px Courier New";e.textAlign="center";e.textBaseline="bottom";j=1>=this.scale?this.mouse_x.toFixed(0):this.mouse_x.toFixed(this.scale.toString().length);k=1>=this.scale?this.mouse_y.toFixed(0):this.mouse_y.toFixed(this.scale.toString().length);j="("+j+","+k+")";
k=e.measureText(j).width;c=this.getAbsoluteX(this.mouse_x);var l=this.getAbsoluteY(this.mouse_y),m=d(c),q=d(l-10);m+k/2>this.w?m=this.w-k/2:0>m-k/2&&(m=k/2);q+1>this.h?q=this.h:0>q-14&&(q=15);e.fillText(j,m,q);e.beginPath();e.arc(c,l,2.5,0,f,!0);e.stroke()}};a.Space2D.prototype.drawMarks=function(a,e,f){var k=this.w,l=this.h,m,q=0,p=k,n=0,u=l,s=d(k/2+this.Ox),t=d(l/2+this.Oy);0<=f&&(q=s-f,p=s+f,n=t-f,u=t+f);a.beginPath();for(f=-c(s/e);(m=s+c(f*e))<k;f++)a.moveTo(m+0.5,n+0.5),a.lineTo(m+0.5,u+0.5);
for(f=-c(t/e);(k=t+c(f*e))<l;f++)a.moveTo(q+0.5,k+0.5),a.lineTo(p+0.5,k+0.5);a.stroke()};a.Space2D.prototype.drawNumbers=function(a,e){for(var f=this.w,k=this.h,l,m=d(f/2+this.Ox),q=d(k/2+this.Oy),p=-c(m/e);(l=m+c(p*e))<f;p++)a.fillText(parseFloat((p*e/this.scale).toFixed(4)),l+2,q-2);for(p=-c(q/e);(f=q+c(p*e))<k;p++)a.fillText(parseFloat((-p*e/this.scale).toFixed(4)),m+2,f-2)};a.Space2D.prototype.registerMouseEvents=function(){function e(a){p.click=1;p.parent.evaluator.setVariable(p.id+".mouse_pressed",
1);p.parent.deactivateGraphiControls();l(a);window.addEventListener("touchmove",q,!1);window.addEventListener("touchend",c,!1);(!p.fixed||p.sensitive_to_mouse_movements)&&a.preventDefault()}function c(a){p.click=0;p.parent.evaluator.setVariable(p.id+".mouse_pressed",0);window.removeEventListener("touchmove",q,!1);window.removeEventListener("touchend",c,!1);a.preventDefault();p.parent.update()}function f(a){p.click=1;p.parent.evaluator.setVariable(p.id+".mouse_pressed",1);p.parent.deactivateGraphiControls();
p.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"RIGHT"==p.whichButton&&(window.addEventListener("mouseup",k,!1),p.fixed||(p.clickPosForZoom=p.getCursorPosition(a).y,p.tempScale=p.scale,window.addEventListener("mousemove",m,!1)));"LEFT"==p.whichButton&&(p.parent.evaluator.setVariable(p.id+".mouse_pressed",1),l(a),window.addEventListener("mousemove",q,!1),window.addEventListener("mouseup",k,!1));a.preventDefault()}function k(a){p.click=
0;p.parent.evaluator.setVariable(p.id+".mouse_pressed",0);a.preventDefault();"RIGHT"==p.whichButton&&window.removeEventListener("mousemove",m,!1);p.sensitive_to_mouse_movements||window.removeEventListener("mousemove",q,!1);window.removeEventListener("mouseup",k,!1);p.parent.update()}function l(a){p.posAnte=p.getCursorPosition(a);p.mouse_x=p.getRelativeX(p.posAnte.x);p.mouse_y=p.getRelativeY(p.posAnte.y);p.parent.evaluator.setVariable(p.id+".mouse_x",p.mouse_x);p.parent.evaluator.setVariable(p.id+
".mouse_y",p.mouse_y);p.parent.update()}function m(a){p.clickPosForZoomNew=p.getCursorPosition(a).y;p.evaluator.setVariable(2!=p.parent.version?p.id+".escala":"escala",p.tempScale+p.tempScale/45*((p.clickPosForZoom-p.clickPosForZoomNew)/10));p.parent.update();a.preventDefault()}function q(a){if(!p.fixed){p.posNext=p.getCursorPosition(a);var e=d(p.posAnte.x-p.posNext.x),c=d(p.posAnte.y-p.posNext.y),f=2!=p.parent.version?p.id+".Oy":"Oy";p.parent.evaluator.setVariable(2!=p.parent.version?p.id+".Ox":
"Ox",p.Ox-e);p.parent.evaluator.setVariable(f,p.Oy-c);p.posAnte.x-=e;p.posAnte.y-=c}p.click&&l(a);(!p.fixed||p.sensitive_to_mouse_movements)&&a.preventDefault()}var p=this,n=a.hasTouchSupport;this.canvas.oncontextmenu=function(){return!1};n&&(this.sensitive_to_mouse_movements&&this.canvas.addEventListener("touchmove",l,!1),this.canvas.addEventListener("touchstart",e,!1));n||(this.sensitive_to_mouse_movements&&this.canvas.addEventListener("mousemove",l,!1),this.canvas.addEventListener("mousedown",
f,!1))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var d=Math.floor,c=Math.cos,f=Math.sin;a.Space3D=function(e,d){a.Space.call(this,e,d);this.backgroundCanvas=document.createElement("canvas");this.backgroundCanvas.setAttribute("id",this.id+"_background");this.backgroundCanvas.setAttribute("width",this.w+"px");this.backgroundCanvas.setAttribute("height",this.h+"px");this.backgroundCtx=this.backgroundCanvas.getContext("2d");this.canvas=document.createElement("canvas");
this.canvas.setAttribute("id",this.id+"_canvas");this.canvas.setAttribute("width",this.w+"px");this.canvas.setAttribute("height",this.h+"px");this.canvas.setAttribute("class","DescartesSpace3DCanvas");this.canvas.setAttribute("style","z-index: "+this.zIndex+";");this.ctx=this.canvas.getContext("2d");this.graphicControlContainer=document.createElement("div");this.graphicControlContainer.setAttribute("id",this.id+"_graphicControls");this.graphicControlContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: "+
this.zIndex+";");this.numericalControlContainer=document.createElement("div");this.numericalControlContainer.setAttribute("id",this.id+"_numericalControls");this.numericalControlContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: "+this.zIndex+";");this.container=document.createElement("div");this.container.setAttribute("id",this.id);this.container.setAttribute("class","DescartesSpace3DContainer");this.container.setAttribute("style","left: "+this.x+"px; top: "+this.y+
"px; z-index: "+this.zIndex+";");this.container.appendChild(this.backgroundCanvas);this.container.appendChild(this.canvas);this.container.appendChild(this.graphicControlContainer);this.container.appendChild(this.numericalControlContainer);e.container.insertBefore(this.container,e.loader);this.findOffset();this.eye=new a.Vector3D(0,0,0);this.center=new a.Vector3D(0,0,0);this.yUpEye=new a.Vector3D(0,0,1);this.distanceEyeCenter=10;this.alpha=Math.PI/4;this.beta=-Math.PI/5;this.lookAtMatrix=new a.Matrix4x4;
this.perspectiveMatrix=new a.Matrix4x4;this.perspective=(new a.Matrix4x4).perspective(45,this.w/this.h,0.01,1E3);cosAlpha=c(-this.alpha);sinAlpha=f(-this.alpha);cosBeta=c(this.beta);sinBeta=f(this.beta);this.eye.set(this.distanceEyeCenter*cosAlpha*cosBeta,this.distanceEyeCenter*sinAlpha*cosBeta,-this.distanceEyeCenter*sinBeta);this.yUpEye=this.yUpEye.set(c(-this.alpha-Math.PI/2),f(-this.alpha-Math.PI/2),0).crossProduct(this.eye).normalize();this.lookAtMatrix=this.lookAtMatrix.setIdentity().lookAt(this.eye,
this.center,this.yUpEye);this.perspectiveMatrix=this.perspective.multiply(this.lookAtMatrix);this.registerMouseEvents();this.update()};a.extend(a.Space3D,a.Space);a.Space3D.prototype.update=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.fillStyle=a.getColor(this.evaluator,this.background);this.ctx.fillRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height);if(!this.click){this.scene=new a.Scene(this);for(var e=0,c=this.graphics.length;e<c;e++)this.graphics[e].update()}this.scene.draw()};
a.Space3D.prototype.transformCoordinateX=function(a){var c=this.w/2;return d(a*c+c+this.Ox)};a.Space3D.prototype.transformCoordinateY=function(a){var c=this.h/2;return d(-a*c+c+this.Oy)};a.Space3D.prototype.registerMouseEvents=function(){var e,d;function g(a){n.click=1;n.parent.evaluator.setVariable(n.id+".mouse_pressed",1);m(a);window.addEventListener("touchmove",p,!1);window.addEventListener("touchend",j,!1);(!n.fixed||n.sensitive_to_mouse_movements)&&a.preventDefault()}function j(a){n.click=0;
n.parent.evaluator.setVariable(n.id+".mouse_pressed",0);window.removeEventListener("touchmove",p,!1);window.removeEventListener("touchend",j,!1);a.preventDefault()}function k(a){n.click=1;n.whichButton=null==a.which?2>a.button?"LEFT":4==a.button?"MIDDLE":"RIGHT":2>a.which?"LEFT":2==a.which?"MIDDLE":"RIGHT";"LEFT"==n.whichButton&&(n.parent.evaluator.setVariable(n.id+".mouse_pressed",1),n.posAnte=n.getCursorPosition(a),e=n.getRelativeX(n.posAnte.x),d=n.getRelativeY(n.posAnte.y),m(a),window.addEventListener("mousemove",
p,!1),window.addEventListener("mouseup",l,!1));a.preventDefault()}function l(a){n.click=0;n.parent.evaluator.setVariable(n.id+".mouse_pressed",0);a.preventDefault();"RIGHT"==n.whichButton&&window.removeEventListener("mousemove",q,!1);window.removeEventListener("mouseup",l,!1)}function m(a){n.posAnte=n.getCursorPosition(a);n.mouse_x=n.getRelativeX(n.posAnte.x);n.mouse_y=n.getRelativeY(n.posAnte.y);n.parent.evaluator.setVariable(n.id+".mouse_x",n.mouse_x);n.parent.evaluator.setVariable(n.id+".mouse_y",
n.mouse_y);n.parent.update()}function q(){}function p(a){n.click&&(m(a),n.alpha+=n.mouse_x-e,n.beta+=n.mouse_y-d,s=c(-n.alpha),t=f(-n.alpha),r=c(n.beta),w=f(n.beta),n.eye.set(n.distanceEyeCenter*s*r,n.distanceEyeCenter*t*r,-n.distanceEyeCenter*w),n.yUpEye=n.yUpEye.set(c(-n.alpha-Math.PI/2),f(-n.alpha-Math.PI/2),0).crossProduct(n.eye).normalize(),n.lookAtMatrix=n.lookAtMatrix.setIdentity().lookAt(n.eye,n.center,n.yUpEye),n.perspectiveMatrix=n.perspective.multiply(n.lookAtMatrix),e=n.mouse_x,d=n.mouse_y)}
var n=this,u=a.hasTouchSupport;d=e=0;this.canvas.oncontextmenu=function(){return!1};u&&(this.sensitive_to_mouse_movements&&this.canvas.addEventListener("touchmove",m,!1),this.canvas.addEventListener("touchstart",g,!1));u||(this.sensitive_to_mouse_movements&&this.canvas.addEventListener("mousemove",m,!1),this.canvas.addEventListener("mousedown",k,!1));var s,t,r,w};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.SpaceAP=function(d,c){a.Space.call(this,d,c);this.exportarVars=
this.importarVars=null;var f=d.evaluator;this.file=this.file.match(/^\[/)&&this.file.match(/\]$/)?f.parser.parse(this.file.substring(1,this.file.length-1)):this.file.match(/^\'/)&&this.file.match(/\'$/)?f.parser.parse(this.file):f.parser.parse("'"+this.file+"'");this.oldFile=f.evalExpression(this.file);this.initFile()};a.extend(a.SpaceAP,a.Space);a.SpaceAP.prototype.initFile=function(){this.firstUpdate=!0;var d;if(this.oldFile){var c=document.getElementById(this.oldFile);d=c&&"descartes/spaceApFile"==
c.type?c.text:a.openExternalFile(this.oldFile);null!=d&&(d=d.split("\n"))}if(d&&d.toString().match(/<applet/gi)){for(var c="",f=!1,e=0,h=d.length;e<h&&!(d[e].match("<applet")&&(f=!0),f&&(c+=d[e]),d[e].match("</applet"));e++);e=document.createElement("div");e.innerHTML=c;e.firstChild.setAttribute("width",this.w);e.firstChild.setAttribute("height",this.h);c=this.descApp?this.descApp.container:null;this.descApp=new a.DescartesApp(e.firstChild);this.descApp.container.setAttribute("class","DescartesAppContainer");
this.descApp.container.setAttribute("style","position: absolute; overflow: hidden; background-color: "+this.background+"; width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");c?this.parent.container.replaceChild(this.descApp.container,c):this.parent.container.insertBefore(this.descApp.container,this.parent.loader);c=this.descApp.spaces;e=0;for(h=c.length;e<h;e++)c[e].findOffset();this.descApp.container.style.display=0<this.evaluator.evalExpression(this.drawif)?
"block":"none";var g=this;this.descApp.update=function(){this.updateAuxiliaries();this.updateEvents();this.updateControls();this.updateSpaces();g.exportar()}}else c=this.descApp?this.descApp.container:null,this.descApp={},this.descApp.container=document.createElement("div"),this.descApp.container.setAttribute("class","DescartesAppContainer"),e="position: absolute; overflow: hidden; background-color: "+this.background+"; width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+
"px; z-index: "+this.zIndex+";",this.image&&("topleft"==this.bg_display?e+="background-image: url("+this.imageSrc+"); background-repeat:no-repeat;":"stretch"==this.bg_display?e+="background-image: url("+this.imageSrc+"); background-repeat:no-repeat; background-size: 100% 100%;":"patch"==this.bg_display?e+="background-image: url("+this.imageSrc+");":"center"==this.bg_display&&(e+="background-image: url("+this.imageSrc+"); background-repeat:no-repeat; background-position: center center;")),this.descApp.container.setAttribute("style",
e),c?this.parent.container.replaceChild(this.descApp.container,c):this.parent.container.insertBefore(this.descApp.container,this.parent.loader),this.descApp.container.style.display=0<this.evaluator.evalExpression(this.drawif)?"block":"none"};a.SpaceAP.prototype.update=function(){var a=this.evaluator.evalExpression(this.file);if(this.oldFile!=a)this.oldFile=a,this.initFile();else{var a=this.x!=this.evaluator.evalExpression(this.xExpr),c=this.y!=this.evaluator.evalExpression(this.yExpr)+this.plecaHeight;
this.x=a?this.evaluator.evalExpression(this.xExpr):this.x;this.y=c?this.evaluator.evalExpression(this.yExpr)+this.plecaHeight:this.y;a&&(this.descApp.container.style.left=this.x+"px");c&&(this.descApp.container.style.top=this.y+"px");if(a||c)for(var a=this.descApp.spaces,c=0,f=a.length;c<f;c++)a[c].findOffset();this.descApp.container.style.display=0<this.evaluator.evalExpression(this.drawif)?"block":"none";if(this.firstUpdate&&(this.firstUpdate=!1,null==this.importarVars)){this.importarVars=[];for(var e in this.evaluator.variables)this.evaluator.variables.hasOwnProperty(e)&&
e.match(/^public./)&&this.importarVars.push({varName:e,value:this.evaluator.getVariable(e)})}this.importar()}};a.SpaceAP.prototype.importar=function(){for(var a,c=!1,f=0,e=this.importarVars.length;f<e;f++)a=this.evaluator.getVariable(this.importarVars[f].varName),a!=this.importarVars[f].value&&(this.importarVars[f].value=a,this.descApp.evaluator.setVariable(this.importarVars[f].varName,this.importarVars[f].value),c=!0);c&&this.descApp.update()};a.SpaceAP.prototype.exportar=function(){};return a}(descartesJS||
{}),descartesJS=function(a){if(a.loadLib)return a;a.SpaceHTML_IFrame=function(d,c){a.Space.call(this,d,c);var f=this.parent.evaluator;this.file=this.file.match(/^\[/)&&this.file.match(/\]$/)?f.parser.parse(this.file.substring(1,this.file.length-1)):this.file.match(/^\'/)&&this.file.match(/\'$/)?f.parser.parse(this.file):f.parser.parse("'"+this.file+"'");this.oldFile=f.evalExpression(this.file);this.MyIFrame=document.createElement("iframe");this.MyIFrame.setAttribute("src",this.oldFile);this.MyIFrame.setAttribute("id",
this.id);this.MyIFrame.setAttribute("marginheight",0);this.MyIFrame.setAttribute("marginwidth",0);this.MyIFrame.setAttribute("frameborder",0);this.MyIFrame.setAttribute("scrolling","auto");this.MyIFrame.setAttribute("style","position: absolute; width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px;");this.MyIFrame.style.display=0<this.evaluator.evalExpression(this.drawif)?"block":"none";this.parent.container.insertBefore(this.MyIFrame,this.parent.loader);var e=this;this.MyIFrame.onload=
function(){var a=this;e.evaluator.setFunction(e.id+".set",function(e,c){a.contentWindow.postMessage({type:"set",name:e,value:c},"*")});e.evaluator.setFunction(e.id+".update",function(){a.contentWindow.postMessage({type:"update"},"*")});e.evaluator.setFunction(e.id+".get",function(e,c){a.contentWindow.postMessage({type:"get",name:e,value:c},"*")});e.evaluator.setFunction(e.id+".exec",function(e,c){a.contentWindow.postMessage({type:"exec",name:e,value:c},"*")})};this.evaluator.setVariable(this.id+"._scroll",
0)};a.extend(a.SpaceHTML_IFrame,a.Space);a.SpaceHTML_IFrame.prototype.update=function(a){a&&(this.y=this.x=Math.Infinity);a=this.evaluator;var c=this.x!=a.evalExpression(this.xExpr)+this.displaceRegionWest,f=this.y!=a.evalExpression(this.yExpr)+this.parent.plecaHeight+this.displaceRegionNorth;this.x=c?a.evalExpression(this.xExpr)+this.displaceRegionWest:this.x;this.y=f?a.evalExpression(this.yExpr)+this.parent.plecaHeight+this.displaceRegionNorth:this.y;var e=a.evalExpression(this.file);this.oldFile=
e;this.MyIFrame.setAttribute("src",e);c&&(this.MyIFrame.style.left=this.x+"px");f&&(this.MyIFrame.style.top=this.y+"px");this.MyIFrame.style.display=0<a.evalExpression(this.drawif)?"block":"none";this.scrollVar=a.getVariable(this.id+"._scroll");1==this.scrollVar?this.MyIFrame.setAttribute("scrolling","yes"):-1==this.scrollVar?this.MyIFrame.setAttribute("scrolling","no"):this.MyIFrame.setAttribute("scrolling","auto")};return a}(descartesJS||{}),babel=function(a){a.falso=a["false"]=a.fals=a.gezurra=
a.faux=a.fals="false";a.verdadero=a["true"]=a.veritable=a.egia=a.vrai=a.verdadeiro=a.veritable="true";a.no=a.ez=a.non=a["n\u00e3o"]="false";a["s\u00ed"]=a.yes=a.bai=a.oui=a.si=a["sim "]="true";a.negro=a.black=a.negre=a.beltza=a.noir=a.preto="#000000";a.maxenta=a.magenta="#ff00ff";a.azul=a.blue=a.blau=a.urdina=a.bleu="#0000ff";a.turquesa=a.cyan=a.turkesa=a.turquoise="#00ffff";a.verde=a.green=a.verd=a.berdea=a.vert="#00ff00";a.amarillo=a.yellow=a.groc=a.horia=a.jaune=a.amarelo="#ffff00";a.naranja=a.orange=
a.taronja=a.laranja=a.laranxa="#ffc800";a.rojo=a.red=a.vermell=a.gorria=a.rouge=a.vermello=a.vermelho="#ff0000";a.pink=a.rosa=a.arrosa=a.rose="#ffafaf";a.grisObscuro=a.darkGray=a.grisFosc=a["gris iluna"]=a.grisObscur=a.grisEscuro=a.cinzaEscuro="#404040";a.gris=a.gray=a.grisa=a.cinza="#808080";a.grisClaro=a.lightGray=a.grisClar=a["gris argia"]=a.grisClair=a.cinzaClaro="#c0c0c0";a.blanco=a.white=a.blanc=a.zuria=a.branco="#ffffff";a.escala=a.scale=a.eskala=a["\u00e9chelle"]="scale";a.nombre=a.name=a.nom=
a.izena=a.nome="name";a.ikusgai=a["vis\u00edvel"]=a.visible="visible";a.rastro=a.trace=a.rastre=a.arrastoa="trace";a.fondo=a.background=a.fons=a.hondoa=a.fond=a.fundo="background";a.colour=a.color=a.kolorea=a.couleur=a.cor="color";a["par\u00e1metro"]=a.parameter=a.parametroa=a["par\u00e2metro"]=a["par\u00e0metre"]="parameter";a["sucesi\u00f3n"]=a.sequence=a["successi\u00f3"]=a.segida=a.succession=a["seq\u00fc\u00eancia"]="sequence";a["tama\u00f1o"]=a.size=a.neurria=a.taille=a.tamanho=a["grand\u00e0ria"]=
"size";a.decimales=a.decimals=a.hamartarra=a["d\u00e9cimales"]=a.decimais="decimals";a.red=a.net=a.xarxa=a.sarea=a["r\u00e9seau"]=a.rede=a.malha="net";a.red10=a.net10=a.xarxa10=a.sarea10=a["r\u00e9seau10"]=a.rede10=a.malha10="net10";a.ejes=a.axes=a.eixos=a.ardatzak=a.eixes="axes";a.texto=a.text=a.testua=a.texte="text";a["cr\u00e9ditos"]=a.about=a["cr\u00e8dits"]=a.kreditoak=a["cr\u00e9dits"]=a.sobre="about";a.config=a.konfig=a["configura\u00e7\u00e3o"]="config";a.inicio=a.init=a.inici=a.hasiera=a.commencement=
a["in\u00edcio"]="init";a.limpiar=a.clear=a.neteja=a.ezabatu=a.nettoye=a.limpar="clear";a.incr=a.gehi=a.incremento="incr";a.min=a.inf="min";a.max=a.sup=a["m\u00e1x"]="max";a.relleno=a.fill=a.ple=a.betea=a.plein=a.recheo=a.preencher="fill";a["relleno+"]=a["fill+"]=a["ple+"]=a["betea+"]=a["plein+"]=a["recheo+"]=a["preencher+"]="fillP";a["relleno-"]=a["fill-"]=a["ple-"]=a["betea-"]=a["plein-"]=a["recheo-"]=a["preencher-"]="fillM";a.flecha=a.arrow=a.fletxa=a.gezia=a["fl\u00e8che"]=a.frecha=a.seta="arrow";
a.ancho=a.width=a.ample=a.zabalera=a.large=a.largura="width";a.punta=a.spear=a.muturra=a.pointe=a.ponta="spear";a["regi\u00f3n"]=a.region=a["regi\u00f3"]=a.eskualde=a["r\u00e9gion"]=a["rexi\u00f3n"]=a["regi\u00e3o"]="region";a.norte=a.north=a.nord=a.ipar="north";a.sur=a.south=a.sud=a.hego=a.sul="south";a.este=a.east=a.est=a.ekialde=a.leste="east";a.oeste=a.west=a.oest=a.hegoalde=a.ouest="west";a.exterior=a.external=a.kanpoalde=a.externo="external";a["expresi\u00f3n"]=a.expresion=a["expresi\u00f3"]=
a.adierazpen=a["express\u00e3o"]="expresion";a.tipo=a.type=a.tipus=a.mota="type";a["posici\u00f3n"]=a.position=a["posici\u00f3"]=a.posizio=a["posi\u00e7\u00e3o"]="position";a["constricci\u00f3n"]=a.constraint=a["constricci\u00f3"]=a.beharte=a.constriction=a["constrici\u00f3n"]=a["restri\u00e7\u00e3o"]="constraint";a.valor=a.value=a.balio=a.valeur="value";a["ecuaci\u00f3n"]=a.equation=a["equaci\u00f3"]=a.ekuazio=a["\u00e9quation"]=a["equa\u00e7\u00e3o"]="equation";a.curva=a.curve=a.corba=a.kurba=a.courbe=
"curve";a.texto=a.text=a.testu=a.texte="text";a.punto=a.point=a.punt=a.puntu=a.ponto="point";a.segmento=a.segment=a.zuzenki="segment";a.arco=a.arc=a.arku="arc";a["pol\u00edgono"]=a.polygon=a["pol\u00edgon"]=a.poligono=a.polygone="polygon";a.imagen=a.image=a.imatge=a.irudi=a.imaxe=a.imagem="image";a["Versi\u00f3n"]=a.Version=a["Versi\u00f3"]=a["Vers\u00e3o"]="version";a.Idioma=a.Language=a.Hizkuntza=a.Langue="language";a["O.x"]="O.x";a["O.y"]="O.y";a.Botones=a.Buttons=a.Botons=a.Botoiak=a.Boutons=
a["Bot\u00f3ns"]=a["Bot\u00f5es"]=a.Botons="Buttons";a["Animaci\u00f3n"]=a.Animation=a["Animaci\u00f3"]=a.Animazio=a["Anima\u00e7\u00e3o"]="Animation";a.constante=a.constant=a.Konstante="constant";a.fuente=a.font=a.iturri=a.source=a.fonte="font";a["num\u00e9rico"]=a.numeric=a["num\u00e8ric"]=a.zenbakizko=a["num\u00e9rique"]="numeric";a["gr\u00e1fico"]=a.graphic=a["gr\u00e0fic"]=a.grafiko=a.graphique="graphic";a.texto=a.text=a.testu=a.texte="text";a.inicio=a.init=a.inici=a.hasiera=a.commencement=a["in\u00edcio"]=
"init";a.hacer=a["do"]=a.fer=a.egin=a.faire=a.facer=a.fazer="do";a.mientras=a["while"]=a.mentre=a.bitartean=a["tandis que"]=a.mentres=a.enquanto="while";a.evaluar=a.evaluate=a.avalua=a.ebaluatu=a["\u00e9valuer"]=a.avaliar="evaluate";a.variable=a.aldagaia=a["vari\u00e1vel"]="variable";a["funci\u00f3n"]=a["function"]=a["funci\u00f3"]=a.funtzio=a.fonction=a["fun\u00e7\u00e3o"]="function";a.algoritmo=a.algorithm=a.algorisme=a.algorithme="algorithm";a.vector=a.array=a.bektore=a.vecteur=a.matriz="array";
a["dibujar-si"]=a["draw-if"]=a["marraztu-baldin"]=a["dessiner-si"]=a["debuxar-se"]=a["desenhar-se"]=a["dibuixa-si"]="drawif";a.dominio=a.range=a.domini=a["izate-eremua"]=a.domain=a["dom\u00ednio"]="range";a.pausa=a.delay=a.eten="delay";a["eje-x"]=a["x-axis"]=a["eix-x"]=a["x-ardatza"]=a["axe-x"]=a["eixe-x"]=a["eixo-x"]="x-axis";a["eje-y"]=a["y-axis"]=a["eix-y"]=a["y-ardatza"]=a["axe-y"]=a["eixe-y"]=a["eixo-y"]="y-axis";a["n\u00fameros"]=a.numbers=a.nombres=a.zenbakiak="numbers";a["exponencial-si"]=
a["exponential-if"]=a["esponentzial-baldin"]=a["exponentiel-si"]=a["exponencial-se"]="exponentialif";a.familia=a.family=a["fam\u00edlia"]=a.famille="family";a.intervalo=a.interval=a.tarte=a.intervalle="interval";a.pasos=a.steps=a.passos=a.pausoak=a.pas="steps";a.centro=a.center=a.centre=a.zentro="center";a.radio=a.radius=a.radi=a.erradio=a.rayon=a.raio="radius";a.fin=a.end=a.fi=a.bukaera=a.fim="end";a["una-sola-vez"]=a["only-once"]=a["una-sola-vegada"]=a["behin-bakarrik"]=a["une-seule-fois"]=a["unha-soa-vez"]=
a["apenas-uma-vez"]="onlyOnce";a.siempre=a.always=a.sempre=a.beti=a.toujours="always";a["color-int"]=a["int-colour"]=a["barruko-kolore"]=a["couleur-int"]=a["cor-int"]="colorInt";a.repetir=a.loop=a.repeteix=a.errepikatu=a["r\u00e9p\u00e9ter"]="loop";a.controles=a.controls=a.kontrolak=a["contr\u00f4les"]=a.controis="controls";a.animar=a.animate=a.anima=a.animatu=a.animer="animate";a.auto="auto";a.alto=a.height=a.alt=a.altu=a.haut=a.altura="height";a.x=a.left="x";a.y=a.top="y";a.espacio=a.space=a.espai=
a.espazio=a.espace=a.espazo=a["espa\u00e7o"]="space";a.Nu="Nu";a.Nv="Nv";a.ancho=a.depth=a.amplada=a.zabalera=a.largeur=a.ancho=a.profundidade=a.amplada="width";a.largo=a.length=a.llargada=a.luzera=a.longueur=a.longo=a.comprimento=a.llargada="length";a.alto=a.height=a["al\u00e7ada"]=a.altu=a.hauteur=a.alto=a.altura=a["al\u00e7ada"]="height";a.color_reverso=a.backcolor=a.color_revers=a["atzealde kolorea"]=a.couleur_revers=a.cor_reverso=a.cor_de_fundo="backcolor";a.aristas=a.edges=a.arestes=a.ertzak=
a["ar\u00eates"]=a.arestas="edges";a.rotini=a.inirot="inirot";a.posini=a.inipos="inipos";a["tri\u00e1ngulo"]=a.triangle=a.hirukia=a["tri\u00e2ngulo"]="triangle";a.cara=a.face=a.aurpegi="face";a.polireg=a.regpoly=a["pol\u00edgonoRegular"]="polireg";a.superficie=a.surface=a["superf\u00edcie"]=a.azalera="surface";a.macro=a.makro="macro";a.id="id";a.modelo=a.model=a.eredu=a["mod\u00e8le"]="model";a.color=a.kolore=a.couleur=a.cor="color";a.luz=a.light=a.llum=a.argia=a["lumi\u00e8re"]="light";a.metal=a.metall=
a["m\u00e9tal"]="metal";a.alambre=a.wire=a.filferro=a.alanbre=a["fil de fer"]=a.arame="wire";a.cortar=a.split=a.talla=a.moztu=a.couper=a.dividir="split";a.despliegue=a.render=a.desplegament=a.zabaltze=a["d\u00e8ploiement"]=a.despregamento=a.processar="render";a.orden=a.sort=a.ordre=a.ordena=a.orde=a.ordenar="sort";a.pintor=a.painter=a.margolari=a.peintre="painter";a["trazado de rayos"]=a["ray trace"]=a["tra\u00e7at de raigs"]=a["izpi trazadura"]=a["trace de rayons"]=a["trazado de raios"]=a["tra\u00e7ado de raios"]=
"raytrace";a.imagen=a.bg_image=a.imatge=a.irudia=a.imaxe=a.imagem_de_fundo="image";a.despl_imagen=a.bg_display=a.despl_imatge=a["irudi desplazamendu"]=a.despl_image=a.despr_imaxe=a["apresenta\u00e7\u00e3o_de_imagem"]="bg_display";a["arr-izq"]=a.topleft=a["dalt-esq"]=a["goi-ezk"]=a["au-dessus-gau"]=a["arr-esq"]=a["acima-esquerda"]="topleft";a["expand."]=a.stretch=a.hedatu=a["expandir "]="stretch";a.mosaico=a.patch=a.mosaic=a.mosaiko=a["mosa\u00efque"]="patch";a.centrada=a.center=a.zentratu=a["centr\u00e9e"]=
a.centrado="center";a.archivo=a.file=a.fitxer=a.artxibo=a.fichier=a.arquivo="file";a.filas_norte=a.rows_north=a.files_nord=a["HTML kodea"]=a.files_nord=a.filas_norte=a.linhas_norte=a.files_nord="rowsNorth";a.filas_sur=a.rows_south=a.files_sud=a.ipar_lerro=a.files_sud=a.filas_sur=a.linhas_sul=a.files_sud="rowsSouth";a.ancho_este=a.width_east=a.ample_est=a.hego_lerro=a.ample_est=a.ancho_leste=a.largura_leste=a.ample_est="widthEast";a.ancho_oeste=a.width_west=a.ample_oest=a.ekialde_zabalera=a.ample_ouest=
a.ancho_oeste=a.largura_oeste=a.ample_oest="widthWest";a.fijo=a.fixed=a.fix=a.hegoalde_zabalera=a.fixe=a.fixo="fixed";a["Reiniciar Animaci\u00f3n"]=a["Init Animation"]=a["Reinicia Animaci\u00f3"]=a.finko=a["Recommencer l'Animation"]=a["Reiniciar Anima\u00e7\u00e3o"]="initAnimation";a["Explicaci\u00f3n"]=a.Explanation=a.Azalpena=a.Explication=a["Explica\u00e7\u00e3o"]=a["Explicaci\u00f3"]="Explanation";a.tooltip=a.dica="tooltip";a.discreto=a.discrete=a.discret=a.diskretu="discrete";a.interfaz=a.gui=
a["interf\u00edcie"]=a.interfaze=a["interface"]="gui";a.pulsador=a.spinner=a.polsador=a.pultsadore=a.bouton="spinner";a["campo de texto"]=a.textfield=a["camp de text"]=a["testu esarrua"]=a["champ de texte"]="textfield";a["men\u00fa"]=a.choice=a.menu=a.escolha="menu";a.barra=a.scrollbar=a.barre="scrollbar";a.opciones=a.options=a.opcions=a.aukerak=a["opci\u00f3ns"]=a["op\u00e7\u00f5es"]="options";a.interior=a.barruko=a["int\u00e9rieur"]="interior";a["condici\u00f3n"]=a.condition=a["condici\u00f3"]=
a.baldintza=a["condi\u00e7\u00e3o"]="condition";a["acci\u00f3n"]=a.action=a["acci\u00f3"]=a.ekintza=a["a\u00e7\u00e3o"]="action";a.evento=a.event=a.esdeveniment=a.gertaera=a["\u00e9v\u00e9nement"]="event";a["abrir URL"]=a["open URL"]=a["obre URL"]=a["URL zabaldu"]=a["ouvrir URL"]="openURL";a["abrir Escena"]=a["open Scene"]=a["obre Escena"]=a["eszena zabaldu"]=a["ouvrir Escena"]=a["abrir Cena"]="openScene";a["bot\u00f3n"]=a.button=a["bot\u00f3"]=a.botoi=a.bouton=a["bot\u00e3o"]="button";a.mensaje=
a.message=a.mezua=a.mensaxe=a.mensagem=a.missatge="message";a.alternar=a.alternate=a.alterna=a.txandakatu=a.alterner="alternate";a["ejecuci\u00f3n"]=a.execution=a["execuci\u00f3"]=a.gauzatze=a["ex\u00e9cution"]=a["execuci\u00f3n"]=a["execu\u00e7\u00e3o"]="execution";a.calcular=a.calculate=a.calcula=a.kalkulatu=a.calculer="calculate";a.coord_abs=a.abs_coord=a.koor_abs="abs_coord";a.negrita=a.bold=a.negreta=a.lodi=a["caract\u00e8re gras"]=a.negra=a.negrito="bold";a.cursiva=a.italics=a.etzana=a.italique=
a["it\u00e1lico"]="italics";a.subrayada=a.underlined=a.subratllat=a.azpimarratua=a.soulignement=a["subli\u00f1ada"]=a.sublinhado="underlined";a.imagen=a.image=a.imatge=a.irundia=a.imaxe=a.imagem="image";a.pos_mensajes=a.msg_pos=a.pos_missatges=a.mezuen_pos=a.pos_messages=a.pos_mensaxes="msg_pos";a.izquierda=a.left=a.esquerra=a.eskerrean=a.gauche=a.esquerda=a.esquerda=a.esquerra="left";a.derecha=a.right=a.dreta=a.eskuinan=a.droite=a.dereita=a.direita=a.dreta="right";a["sensible_a_los_movimientos_del_rat\u00f3n"]=
a.sensitive_to_mouse_movements=a["sensible_als_moviments_del_ratol\u00ed"]=a["xagu mugimenduarekiko sentikorra"]=a.sensible_aux_mouvements_du_souris=a.sensible_aos_movementos_do_rato=a["sens\u00edvel_aos_movimentos_do_mouse"]="sensitive_to_mouse_movements";a.reproducir=a.play=a.reprodueix=a.erreproduzitu=a.reproduire=a.reproduzir="playAudio";a["activo-si"]=a["active-if"]=a["actiu-si"]=a["altiboa-baldin"]=a["actif-si"]=a["activo-se"]=a["ativo-se"]="activeif";a.rotfin=a.finrot=a.bukrot="endrot";a.posfin=
a.finpos=a.bukpos="endpos";a.editable=a.editagarria=a["edit\u00e1vel"]="editable";a.tipo=a.type=a.tipus=a.mota="type";a.R2="R2";a.R3="R3";a.vectores=a.bektoreak=a.vecteurs=a.vetores=a.vectors="vectors";a["fuente puntos"]=a["font size"]=a["font punts"]=a["puntu iturria"]=a["source points"]=a["fonte puntos"]=a["fonte pontos"]="font_size";a.SansSerif="SansSerif";a.Serif="Serif";a.Monoespaciada=a.Monospaced=a.Monoespazada="Monospaced";a["ecuaci\u00f3n"]=a.equation=a["equaci\u00f3"]=a.ekuazio=a["\u00e9quation"]=
a["equa\u00e7\u00e3o"]="equation";a.punto=a.dot=a.punt=a.puntu=a.point=a.ponto="point";a.escenario=a.scenario=a.escenari=a.agertoki=a["sc\u00e8ne"]=a["cen\u00e1rio"]="scenario";a.cID="cID";a.matriz=a.matrix=a.matriu=a.matrice="matrix";a.filas=a.rows=a.files="rows";a.columnas=a.columns=a.colonnes="columns";a.solo_texto=a.only_text=a.seulement_texte=a["s\u00f3_texto"]=a.tan_sols_texte="onlyText";a.evaluar=a.evaluate="evaluate";a.respuesta=a.answer="answer";a.decimal_symbol=a["signo decimal"]=a["decimal symbol"]=
"decimal_symbol";a.info="info";a.color_contorn_text=a.color_text_border=a.color_borde_texto=a.muga_testuaren_kolorea=a.couleur_contour_texte=a.cor_borde_texto=a.colore_bordo_testo=a.cor_borda_texto=a.color_contorn_text="border";a.video=a["vid\u00e9o"]="video";a.audio=a["\u00e0udio"]="audio";a.autoplay="autoplay";a.loop="loop";a.poster="poster";a.opacidad=a.opacity=a["opacit\u00e9"]=a.opacitat=a.opacidade="opacity";a.alinear=a.align=a["ali\u00f1ar"]=a.aligner="align";a.malla=a.mesh="mesh";return a}(babel||
{}),descartesJS=function(a){if(a.loadLib)return a;a.Vector2D=function(a,c){this.x=a;this.y=c};a.Vector2D.AXIS_X=new a.Vector2D(1,0);a.Vector2D.AXIS_Y=new a.Vector2D(0,1);a.Vector2D.prototype.vectorLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.Vector2D.prototype.dotProduct=function(a){return this.x*a.x+this.y*a.y};a.Vector2D.prototype.angleBetweenVectors=function(a){return Math.acos(this.dotProduct(a)/(this.vectorLength()*a.vectorLength()))};return a}(descartesJS||{}),descartesJS=
function(a){function d(a){for(var e="[",h=0,g=a.length;h<g;h++){if(a[h]instanceof Array)e+=d(a[h]);else{c=a[h];if("undefined"==typeof c||!c)c=0;"string"==typeof c&&(c="'"+c+"'");e+=c}h<g-1&&(e+=",")}return e+"]"}if(a.loadLib)return a;a.DescartesApp=function(c){this.applet=c;this.externalVariables={};this.parentContainer=c.parentNode;this.width=c.getAttribute("width");this.height=c.getAttribute("height");this.decimal_symbol=".";this.childs=c.getElementsByTagName("param");this.code=c.getAttribute("code");
this.saveState=[];this.images={};this.images.length=-1;this.audios={};this.audios.length=-1;this.evaluator=new a.Evaluator(this);this.lessonParser=new a.LessonParser(this);this.firstRun=!0;this.arquimedes=this.code.match("descinst.DescartesWeb2_0.class");this.licenseW2="{\\rtf1\\uc0{\\fonttbl\\f0\\fcharset0 Arial;\\f1\\fcharset0 Arial;\\f2\\fcharset0 Arial;\\f3\\fcharset0 Arial;\\f4\\fcharset0 Arial;}{\\f0\\fs34 __________________________________________________________________________________ \\par \\fs22                                        Los contenidos de esta unidad did\u00e1ctica interactiva est\u00e1n bajo una  {\\*\\hyperlink licencia Creative Commons|http://creativecommons.org/licenses/by-nc-sa/2.5/es/}, si no se indica lo contrario.\\par                                        La unidad did\u00e1ctica fue creada con DescartesWeb2.0, que es un producto de c\u00f3digo abierto del  {\\*\\hyperlink Ministerio de Educaci\u00f3n de Espa\u00f1a|http://recursostic.educacion.es/descartes/web/DescartesWeb2.0/} y\\par                                        el {\\*\\hyperlink Instituto de Matem\u00e1ticas|http://arquimedes.matem.unam.mx/} de la Universidad Nacional Aut\u00f3noma de M\u00e9xico, cedido bajo licencia {\\*\\hyperlink EUPL v 1.1|/resources/eupl_v1.1es.pdf}, con {\\*\\hyperlink c\u00f3digo en Java|http://recursostic.educacion.es/descartes/web/source/}.}";
this.licenseA="{\\rtf1\\uc0{\\fonttbl\\f0\\fcharset0 Arial;\\f1\\fcharset0 Arial;\\f2\\fcharset0 Arial;\\f3\\fcharset0 Arial;\\f4\\fcharset0 Arial;}{\\f0\\fs34 __________________________________________________________________________________ \\par \\fs22                                        Los contenidos de esta unidad did\u00e1ctica interactiva est\u00e1n bajo una  {\\*\\hyperlink licencia Creative Commons|http://creativecommons.org/licenses/by-nc-sa/2.5/es/}, si no se indica lo contrario.\\par                                        La unidad did\u00e1ctica fue creada con Arqu\u00edmedes, que es un producto de c\u00f3digo abierto del  {\\*\\hyperlink Ministerio de Educaci\u00f3n de Espa\u00f1a|http://recursostic.educacion.es/descartes/web/DescartesWeb2.0/} y\\par                                        el {\\*\\hyperlink Instituto de Matem\u00e1ticas|http://arquimedes.matem.unam.mx/} de la Universidad Nacional Aut\u00f3noma de M\u00e9xico, cedido bajo licencia {\\*\\hyperlink EUPL v 1.1|/resources/eupl_v1.1es.pdf}, con {\\*\\hyperlink c\u00f3digo en Java|http://recursostic.educacion.es/descartes/web/source/}.}";
this.hackChafaParaQueFuncionenLasEscenasDeArquimedes=!1;if(this.arquimedes){c=this.childs;for(var e,d=0,g=0,j=0,k=c.length;j<k;j++)e=c[j],"rtf_height"==e.name&&(d=parseInt(e.value)),"Buttons"==babel[e.name]&&(this.buttonsConfig=this.lessonParser.parseButtonsConfig(e.value),g=this.buttonsConfig.height);d&&(this.height=d+g+70)}this.init()};a.DescartesApp.prototype.init=function(){this.evaluator=new a.Evaluator(this);this.lessonParser=new a.LessonParser(this);this.spaces=[];this.externalSpace={container:document.createElement("div"),
controls:[]};this.northSpace={container:document.createElement("div"),controls:[]};this.southSpace={container:document.createElement("div"),controls:[]};this.eastSpace={container:document.createElement("div"),controls:[]};this.westSpace={container:document.createElement("div"),controls:[]};this.specialSpace={container:document.createElement("div"),controls:[]};this.editableRegion={container:document.createElement("div"),textFields:[]};this.controls=[];this.auxiliaries=[];this.events=[];this.numberOfIframes=
this.plecaHeight=this.tabindex=this.zIndex=0;void 0!=this.container&&this.parentContainer.removeChild(this.container);this.container=document.createElement("div");this.loader=document.createElement("div");this.parentContainer.appendChild(this.container);this.container.width=this.width;this.container.height=this.height;this.container.setAttribute("class","DescartesAppContainer");this.container.setAttribute("style","width: "+this.width+"px; height:"+this.height+"px;");this.container.appendChild(this.loader);
this.loader.width=this.width;this.loader.height=this.height;this.loader.setAttribute("class","DescartesLoader");this.loader.setAttribute("style","width: "+this.width+"px; height:"+this.height+"px; z-index: 1000;");if(this.firstRun){var c=this,e=this.loader.width,d=this.loader.height,g=document.createElement("canvas");g.width=e;g.height=d;var j=g.getContext("2d");j.save();j.strokeStyle="#1f375d";j.fillStyle="#1f375d";j.lineCap="round";j.lineWidth=2;j.beginPath();j.translate((e-360)/2,(d-195)/2);j.scale(3,
3);j.moveTo(3,25);j.lineTo(3,1);j.lineTo(21,1);j.bezierCurveTo(33,1,41,15,41,25);j.stroke();j.beginPath();j.moveTo(1,63);j.lineTo(1,64);j.moveTo(5,62);j.lineTo(5,64);j.moveTo(9,61);j.lineTo(9,64);j.moveTo(13,60);j.lineTo(13,64);j.moveTo(17,58);j.lineTo(17,64);j.moveTo(21,56);j.lineTo(21,64);j.moveTo(25,53);j.lineTo(25,64);j.moveTo(29,50);j.lineTo(29,64);j.moveTo(33,46);j.lineTo(33,64);j.moveTo(37,41);j.lineTo(37,64);j.moveTo(41,32);j.lineTo(41,64);j.stroke();j.font="20px Arial";j.fillText("escartes",
45,33);j.fillText("JS",98,64);j.restore();e="url("+g.toDataURL()+")";this.imageLoader=document.createElement("div");this.imageLoader.width=this.width;this.imageLoader.height=this.height;this.imageLoader.setAttribute("class","DescartesLoaderImage");this.imageLoader.setAttribute("style","background-image: "+e+"; width: "+this.width+"px; height:"+this.height+"px;");this.loader.appendChild(this.imageLoader);e=new Image;e.onload=function(){c.imageLoader.setAttribute("style","background-image: url("+this.src+
"); width: "+c.width+"px; height:"+c.height+"px; top: 0px; left: 0px")};e.src="images/DescartesLoader.png";this.loaderBar=document.createElement("canvas");this.loaderBar.width=this.width;this.loaderBar.height=this.height;this.loaderBar.setAttribute("class","DescartesLoaderBar");this.loaderBar.setAttribute("style","width: "+this.width+"px; height:"+this.height+"px;");this.loaderBar.ctx=this.loaderBar.getContext("2d");this.loader.appendChild(this.loaderBar);this.barWidth=Math.floor(this.loader.width/
10);this.barHeight=Math.floor(this.loader.height/70);this.timer=setInterval(function(){c.drawLoaderGraph(c.loaderBar.ctx,c.loaderBar.width,c.loaderBar.height)},10);this.firstRun=!1;this.initPreloader()}else this.initBuildApp()};a.DescartesApp.prototype.initAudio=function(c){var e=this;this.audios[c]=new Audio(c);this.audios[c].filename=c;var d=function(){this.ready=1},g=function(){!this.canPlayType("audio/"+this.filename.substring(this.filename.length-3))&&"mp3"==this.filename.substring(this.filename.length-
3)?(e.audios[c]=new Audio(this.filename.replace("mp3","ogg")),e.audios[c].filename=this.filename.replace("mp3","ogg"),e.audios[c].addEventListener("canplaythrough",d,!1),e.audios[c].addEventListener("load",d,!1),e.audios[c].addEventListener("error",g,!1),e.audios[c].load()):(console.log("El archivo '"+c+"' no puede ser reproducido"),this.errorload=1)};this.audios[c].addEventListener("canplaythrough",d,!1);this.audios[c].addEventListener("load",d,!1);this.audios[c].addEventListener("error",g,!1);a.hasTouchSupport?
(this.audios[c].load(),this.audios[c].play(),setTimeout(function(){console.log("detenido");e.audios[c].pause()},10),this.audios[c].ready=1):this.audios[c].load()};a.DescartesApp.prototype.initPreloader=function(){this.images["lib/DescartesCCLicense.png"]=a.getCreativeCommonsLicenseImage();this.images["lib/DescartesCCLicense.png"].addEventListener("load",function(){this.ready=1},!1);this.images["lib/DescartesCCLicense.png"].addEventListener("error",function(){this.errorload=1},!1);for(var c,e=0,d=
this.childs.length;e<d;e++){var g=this.childs[e].value.match(/[\w-//]*(.png|.jpg|.gif|.svg|.PNG|.JPG|.GIF|.SVG)/g);if(g)for(var j=0,k=g.length;j<k;j++)c=g[j],!c.toLowerCase().match(/vacio.gif$/)&&""!=c.substring(0,c.length-4)&&(this.images[c]=new Image,this.images[c].addEventListener("load",function(){this.ready=1},!1),this.images[c].addEventListener("error",function(){this.errorload=1},!1),this.images[c].src=c);if(c=this.childs[e].value.match(/[\w-//]*(\.ogg|\.oga|\.mp3|\.wav|\.OGG|\.OGA\.MP3|\.WAV)/g)){j=
0;for(k=c.length;j<k;j++)g=c[j],this.initAudio(g)}this.childs[e].value.match(/vector|array|bektore|vecteur|matriz/g)&&this.childs[e].value.match(/archivo|file|fitxer|artxibo|fichier|arquivo/g)&&this.lessonParser.parseAuxiliar(this.childs[e].value)}var l=this,m;for(m in this.images)this.images.hasOwnProperty(m)&&this.images.length++;for(m in this.audios)this.audios.hasOwnProperty(m)&&this.audios.length++;var q=function(){l.readys=0;var a=l.images.length,c;for(c in l.images)l.images.hasOwnProperty(c)&&
(l.images[c].ready||l.images[c].errorload)&&l.readys++;var e=l.audios.length;for(c in l.audios)l.audios.hasOwnProperty(c)&&(l.audios[c].ready||l.audios[c].errorload)&&l.readys++;l.readys!=a+e?setTimeout(q,30):l.initBuildApp()};q()};a.DescartesApp.prototype.getImage=function(a){if(a)return this.images[a]||(this.images[a]=new Image,this.images[a].src=a,this.images[a].addEventListener("load",function(){this.ready=1},!1),this.images[a].addEventListener("error",function(){this.errorload=1},!1)),this.images[a]};
a.DescartesApp.prototype.getAudio=function(a){var c=this;if(!this.audios[a]){this.audios[a]=new Audio(a);this.audios[a].addEventListener("canplaythrough",function(){this.ready=1},!1);var d=function(){!this.canPlayType("audio/"+a.substring(a.length-3))&&"mp3"==a.substring(a.length-3)?(c.audios[a]=new Audio(a.replace("mp3","ogg")),c.audios[a].addEventListener("canplaythrough",onCanPlayThrough,!1),c.audios[a].addEventListener("load",onCanPlayThrough,!1),c.audios[a].addEventListener("error",d,!1),c.audios[a].load()):
(console.log("El archivo '"+a+"' no puede ser reproducido"),this.errorload=1)};this.audios[a].addEventListener("error",d,!1);this.audios[a].play();setTimeout(function(){c.audios[a].pause()},10)}return this.audios[a]};a.DescartesApp.prototype.drawLoaderGraph=function(a,c,d){var g=2*(this.barWidth-2)/(this.images.length+this.audios.length);a.translate(c/2,d-50);a.scale(2,2);a.strokeRect(-this.barWidth,-this.barHeight,2*this.barWidth,this.barHeight);a.fillStyle="gray";a.fillRect(-this.barWidth+2,-this.barHeight+
2,2*(this.barWidth-2),this.barHeight-4);a.fillStyle="#1f375d";a.fillRect(-this.barWidth+2,-this.barHeight+2,this.readys*g,this.barHeight-4);a.setTransform(1,0,0,1,0,0)};a.DescartesApp.prototype.initBuildApp=function(){for(var a=this.childs,c=this.lessonParser,d=[],g=[],j=[],k=[],l=[],m=[],q=0,p=a.length;q<p;q++){childs_i=a[q];if("pleca"==childs_i.name){var n=c.parsePleca(childs_i.value,this.width);this.container.insertBefore(n,this.loader);this.plecaHeight=n.imageHeight?n.imageHeight:n.offsetHeight}"Buttons"==
babel[childs_i.name]?this.buttonsConfig=c.parseButtonsConfig(childs_i.value):"decimal_symbol"==babel[childs_i.name]?this.decimal_symbol=childs_i.value:"version"==babel[childs_i.name]?this.version=parseInt(childs_i.value):"language"==babel[childs_i.name]?this.language=childs_i.value:"enable"==babel[childs_i.getAttribute("enable")]?this.enable=babel[childs_i.getAttribute("enable")]:"rtf"==childs_i.name?(n=parseInt(this.height)-this.plecaHeight-this.buttonsConfig.height-45,k.push("space='descartesJS_scenario' type='text' expresion='[10,20]' background='yes' text='"+
childs_i.value.replace(/'/g,"&squot;")+"'"),k.push("space='descartesJS_scenario' type='text' expresion='[10,"+(n-25)+"]' background='yes' text='"+this.licenseA+"'"),k.push("space='descartesJS_scenario' type='image' expresion='[15,"+n+"]' background='yes' abs_coord='yes' file='lib/DescartesCCLicense.png'")):"E"==childs_i.name.charAt(0)?(childs_i.value.match(/'HTMLIFrame'/)&&this.numberOfIframes++,childs_i.value.match("'_BASE_'")&&(this.hackChafaParaQueFuncionenLasEscenasDeArquimedes=!0),d.push(childs_i.value)):
"C"==childs_i.name.charAt(0)&&"_"==childs_i.name.charAt(1)?g.push(childs_i.value):"A"==childs_i.name.charAt(0)&&"Animation"!=babel[childs_i.name]?j.push(childs_i.value):"G"==childs_i.name.charAt(0)?k.push(childs_i.value):"S"==childs_i.name.charAt(0)?l.push(childs_i.value):"Animation"==babel[childs_i.name]&&m.push(childs_i.value)}this.scenarioRegion={container:document.createElement("div"),scroll:0};this.scenarioRegion.container.setAttribute("id","descartesJS_Scenario_Region");this.scenarioRegion.scenarioSpace=
this.lessonParser.parseSpace("tipo='R2' id='descartesJS_scenario' fondo='blanco' x='0' y='0' fijo='yes' red='no' red10='no' ejes='no' text='no' ancho='"+this.width+"' alto='"+this.height+"'");this.scenarioRegion.container.appendChild(this.scenarioRegion.scenarioSpace.container);this.arquimedes&&(this.container.appendChild(this.scenarioRegion.container),this.spaces.push(this.scenarioRegion.scenarioSpace));q=0;for(p=d.length;q<p;q++)a=c.parseSpace(d[q]),this.arquimedes&&this.scenarioRegion.container.appendChild(a.container),
this.spaces.push(a),this.zIndex++;q=0;for(p=k.length;q<p;q++)if(d=c.parseGraphic(k[q]))d.visible&&(this.editableRegionVisible=!0),d.space.addGraph(d);q=0;for(p=l.length;q<p;q++)(d=c.parse3DGraphic(l[q]))&&d.space.addGraph(d);q=0;for(p=g.length;q<p;q++)this.controls.push(c.parseControl(g[q]));q=0;for(p=j.length;q<p;q++)c.parseAuxiliar(j[q]);q=0;for(p=m.length;q<p;q++)this.animation=c.parseAnimation(m[q]);this.configRegions();this.updateAuxiliaries();q=0;for(p=this.controls.length;q<p;q++)this.controls[q].init();
this.updateControls();this.updateSpaces(!0);var u=this;this.numberOfIframes?setTimeout(function(){u.finishInit()},250*this.numberOfIframes):this.finishInit()};a.DescartesApp.prototype.finishInit=function(){this.update();this.loader.style.display="none";this.parentContainer.style="overflow: hidden;";clearTimeout(this.timer);this.enable&&(this.blocker=document.createElement("div"),this.blocker.setAttribute("class","blocker"),this.blocker.setAttribute("style","width: "+this.width+"px; height: "+this.height+
"px"),this.container.appendChild(this.blocker))};a.DescartesApp.prototype.configRegions=function(){var c=this.evaluator.parser,e=this.buttonsConfig,d=this.container;if(2!=this.version)var g="15",j=100,k=100,l=100,m=100;else g="14",j=63,k=50,l=44,m=53;var q=0,p=0,n=0,u=n=0,s=0,t=0,r=0,w=0,t=this.northSpace.controls,z=this.southSpace.controls,A=this.eastSpace.controls,v=this.westSpace.controls;if(0<e.rowsNorth||0<t.length||e.about||e.config){0>=e.rowsNorth?(q=e.height,e.rowsNorth=1):q=e.height*e.rowsNorth;
var x=this.northSpace.container;x.setAttribute("id","descartesJS_northRegion");x.setAttribute("style","width: "+d.width+"px; height: "+q+"px; background: #c0c0c0; position: absolute; left: 0px; top: 0px; z-index: 100;");d.insertBefore(x,this.loader);var s=d.width,D=0;e.about&&(D=j,s-=D);e.config&&(s-=k);for(var x=Math.ceil(t.length/e.rowsNorth),C=s/x,n=0,B=t.length;n<B;n++)t[n].expresion=c.parse("("+(D+C*(n%x))+","+e.height*Math.floor(n/x)+","+C+","+e.height+")"),t[n].drawif=c.parse("1");if(e.about){var E;
"espa\u00f1ol"==this.language?E="cr\u00e9ditos":"english"==this.language&&(E="about");new a.Button(this,{region:"north",name:E,font_size:c.parse(g),expresion:c.parse("(0, 0, "+j+", "+q+")")})}e.config&&("espa\u00f1ol"==this.language?E="config":"english"==this.language&&(E="config"),new a.Button(this,{region:"north",name:E,font_size:c.parse(g),action:"config",expresion:c.parse("("+(s+j)+", 0, "+k+", "+q+")")}))}if(0<e.rowsSouth||0<z.length||e.init||e.clear){0>=e.rowsSouth?(p=e.height,e.rowsSouth=1):
p=e.height*e.rowsSouth;t=d.width;D=0;e.init&&(D=l,t-=D);e.clear&&(t-=m);x=this.southSpace.container;x.setAttribute("id","descartesJS_southRegion");x.setAttribute("style","width: "+d.width+"px; height: "+p+"px; background: #c0c0c0; position: absolute; left: 0px; top: "+(d.height-p)+"px; z-index: 100;");d.insertBefore(x,this.loader);x=Math.ceil(z.length/e.rowsSouth);C=t/x;n=0;for(B=z.length;n<B;n++)z[n].expresion=c.parse("("+(D+C*(n%x))+","+e.height*Math.floor(n/x)+","+C+","+e.height+")"),z[n].drawif=
c.parse("1");e.init&&("espa\u00f1ol"==this.language?E="inicio":"english"==this.language&&(E="init"),new a.Button(this,{region:"south",name:E,font_size:c.parse(g),action:"init",expresion:c.parse("(0, 0, "+l+", "+p+")")}));e.clear&&("espa\u00f1ol"==this.language?E="limpiar":"english"==this.language&&(E="clear"),new a.Button(this,{region:"south",name:E,font_size:c.parse(g),action:"clear",expresion:c.parse("("+(t+l)+", 0, "+m+", "+p+")")}))}if(0<A.length){n=d.height-q-p;r=e.widthEast;x=this.eastSpace.container;
x.setAttribute("id","descartesJS_eastRegion");x.setAttribute("style","width: "+r+"; height: "+n+"px; background: #c0c0c0; position: absolute; left: "+(d.width-r)+"px; top: "+q+"px; z-index: 100;");d.insertBefore(x,this.loader);n=0;for(B=A.length;n<B;n++)A[n].expresion=c.parse("(0,"+e.height*n+","+r+","+e.height+")"),A[n].drawif=c.parse("1")}if(0<v.length){n=d.height-q-p;w=e.widthWest;x=this.westSpace.container;x.setAttribute("id","descartesJS_westRegion");x.setAttribute("style","width: "+w+"; height: "+
n+"px; background: #c0c0c0; position: absolute; left: 0px; top: "+q+"px; z-index: 100;");d.insertBefore(x,this.loader);n=0;for(B=v.length;n<B;n++)v[n].expresion=c.parse("(0,"+e.height*n+","+w+","+e.height+")"),v[n].drawif=c.parse("1")}if(this.editableRegionVisible){u=e.height;x=this.editableRegion.container;x.setAttribute("id","descartesJS_editableRegion");x.setAttribute("style","width: "+d.width+"px; height: "+u+"px; position: absolute; left: 0px; top: "+(d.height-p-e.height)+"px; z-index: 100; background: #c0c0c0; overflow: hidden;");
d.insertBefore(x,this.loader);c=this.editableRegion.textFields;e=d.width/c.length;n=0;for(B=c.length;n<B;n++)"div"==c[n].type?(x.appendChild(c[n].container),c[n].container.setAttribute("style","font-family: Arial; width: "+(e-4)+"px; height: "+(u-5)+"px; position: absolute; left: "+n*e+"px; top: 0px; border: 2px groove white;"),g=c[n].container.firstChild,j=g.offsetWidth,g.setAttribute("style","font-family: Arial; padding-top: 0%; background-color: lightgray; position: absolute; left: 0px; top: 0px; width: "+
j+"px;"),g.firstChild.textContent=g.firstChild.textContent.substring(1,g.firstChild.textContent.length-1),c[n].container.lastChild.setAttribute("style","font-family: 'Courier New'; width: "+(e-j-8)+"px; height: "+(u-9)+"px; position: absolute; left: "+j+"px; top: 0px; border: 2px groove white;")):(x.appendChild(c[n]),c[n].setAttribute("style","font-family: 'Courier New'; width: "+e+"px; height: "+u+"px; position: absolute; left: "+n*e+"px; top: 0px; border: 2px groove white;"))}this.displaceRegionNorth=
q;this.displaceRegionWest=w;d.width-=r;d.height=d.height-p-u;n=0;for(B=this.spaces.length;n<B;n++)this.spaces[n].init()};a.DescartesApp.prototype.update=function(){this.updateAuxiliaries();this.updateEvents();this.updateControls();this.updateSpaces()};a.DescartesApp.prototype.deactivateGraphiControls=function(){for(var a,c=0,d=this.controls.length;c<d;c++)a=this.controls[c],"graphic"==a.type&&a.deactivate()};a.DescartesApp.prototype.updateAuxiliaries=function(){for(var a=0,c=this.auxiliaries.length;a<
c;a++)this.auxiliaries[a].update()};a.DescartesApp.prototype.updateEvents=function(){for(var a=0,c=this.events.length;a<c;a++)this.events[a].update()};a.DescartesApp.prototype.updateControls=function(){for(var a=0,c=this.controls.length;a<c;a++)this.controls[a].update()};a.DescartesApp.prototype.updateSpaces=function(a){for(var c=0,d=this.spaces.length;c<d;c++)this.spaces[c].update(a)};a.DescartesApp.prototype.clear=function(){for(var a=0,c=this.spaces.length;a<c;a++)this.spaces[a].spaceChange=!0,
this.spaces[a].drawBackground()};a.DescartesApp.prototype.play=function(){this.animation&&this.animation.play()};a.DescartesApp.prototype.stop=function(){this.animation&&this.animation.stop()};a.DescartesApp.prototype.reinitAnimation=function(){this.animation&&this.animation.reinit()};a.DescartesApp.prototype.getControlById=function(a){for(var c,d=0,g=this.controls.length;d<g;d++)if(c=this.controls[d],c.id==a)return c;return{update:function(){}}};a.DescartesApp.prototype.getSpaceByCId=function(a){for(var c,
d=0,g=this.spaces.length;d<g;d++)if(c=this.spaces[d],c.cID==a)return c;return{update:function(){},w:0}};a.DescartesApp.prototype.getSpaceById=function(a){for(var c,d=0,g=this.spaces.length;d<g;d++)if(c=this.spaces[d],c.id==a)return c;return{update:function(){},w:0}};a.DescartesApp.prototype.getControlByCId=function(a){for(var c,d=0,g=this.controls.length;d<g;d++)if(c=this.controls[d],c.cID==a)return c;return{update:function(){},w:0}};var c;a.DescartesApp.prototype.getState=function(){var a=this.evaluator.variables,
c,h="",g;for(g in a)a.hasOwnProperty(g)&&(c=a[g],"string"==typeof c&&(c="'"+c+"'"),void 0!=c&&("rnd"!=g&&"pi"!=g&&"e"!=g&&"Infinity"!=g&&"-Infinity"!=g&&"object"!=typeof c)&&(h=""!=h?h+"\n"+g+"="+c:g+"="+c));var a=this.evaluator.vectors,j;for(j in a)a.hasOwnProperty(j)&&(c=a[j],h=h+"\n"+j+"="+d(c));j=this.evaluator.matrices;for(var k in j)j.hasOwnProperty(k)&&(c=j[k],h=h+"\n"+k+"="+d(c));return h};a.DescartesApp.prototype.setState=function(a){a=a.split("\n");for(var c,d,g=0,j=a.length;g<j;g++)c=a[g].split("="),
2<=c.length&&(d=eval(c[1]),-1!=c[1].indexOf("[[")?(this.evaluator.matrices[c[0]]=d,this.evaluator.matrices[c[0]].rows=d.length,this.evaluator.matrices[c[0]].cols=d[0].length):-1!=c[1].indexOf("[")?(this.evaluator.vectors[c[0]]=d,this.evaluator.variables[c[0]+".long"]=d.length):this.evaluator.variables[c[0]]=d),this.update()};a.DescartesApp.prototype.getEvaluation=function(){for(var a=0,c=0,d="",g=0,j=this.controls.length;g<j;g++)"textfield"==this.controls[g].gui&&this.controls[g].evaluate&&(a++,c+=
this.controls[g].ok,this.controls[g].value=""==this.controls[g].value?"''":this.controls[g].value,d+=" \\n "+this.controls[g].id+"="+this.controls[g].value+"|"+this.controls[g].ok);return"questions="+a+" \\n correct="+c+" \\n wrong="+(a-c)+d};a.DescartesApp.prototype.showSolution=function(){for(var a=0,c=this.controls.length;a<c;a++)"textfield"==this.controls[a].gui&&this.controls[a].evaluate&&this.controls[a].changeValue(this.controls[a].getFirstAnswer());this.update()};a.DescartesApp.prototype.showAnswer=
function(){for(var a=0,c=this.saveState.length;a<c;a++)this.evaluator.evalExpression(this.saveState[a]);this.update()};return a}(descartesJS||{}),descartesJS=function(a){function d(){for(var c=0,d=a.apps.length;c<d;c++)for(var f=0,j=a.apps[c].spaces.length;f<j;f++)a.apps[c].spaces[f].findOffset()}function c(){a.getFeatures();if(a.hasCanvasSupport){for(var c=document.getElementsByTagName("*"),f=[],g=0,j=c.length;g<j;g++)"DescartesAppContainer"==c[g].className&&f.push(c[g]);g=0;for(j=f.length;g<j;g++)f[g].parentNode.removeChild(f[g]);
for(var f=document.getElementsByTagName("applet"),c=[],j=0,k=f.length;j<k;j++)g=f[j],(g.getAttribute("code").match("DescartesJS")||g.getAttribute("code").match("Descartes.class")||g.getAttribute("code").match("descinst.DescartesWeb2_0.class"))&&c.push(g);g=0;for(j=c.length;g<j;g++)f=c[g],a.apps.push(new a.DescartesApp(f)),f.className="DescartesJS";document.getElementById("StyleDescartesApps").innerHTML="applet.DescartesJS {display:none;}";window.addEventListener("resize",d,!1)}else document.getElementById("StyleDescartesApps").innerHTML=
"applet {display:block;}"}a.apps=[];a.getDescartesApps=function(){return a.apps};if(!window.hasOwnProperty("debugDescartesJS")||!debugDescartesJS){var f=document.getElementById("StyleDescartesApps");f&&f.parentNode.removeChild(f);f=document.createElement("style");f.id="StyleDescartesApps";f.type="text/css";f.setAttribute("rel","stylesheet");f.innerHTML="applet.DescartesJS {display:none;} applet {display:none;}";document.head.appendChild(f)}a.receiveMessage=function(c){if(0!==a.apps.length)if((c=c.data)&&
"set"===c.type)a.apps[0].evaluator.setVariable(c.name,c.value);else if(c&&"update"===c.type)a.apps[0].update();else if(c&&"exec"===c.type){var d=a.apps[0].evaluator.getFunction(c.name),f=[];""!==c.value&&(f=c.value.toString().split(","));d&&d.apply(a.evaluator,f)}};void 0===a.loadLib&&(a.loadLib=!0,window.addEventListener("load",c,!1),window.addEventListener("message",a.receiveMessage,!1));return a}(descartesJS||{});
