/*
 Joel Espinosa Longi
 jlongi@im.unam.mx
 https://github.com/jlongi/DescartesJS
 LGPL - http://www.gnu.org/licenses/lgpl.html
 2015-10-14
*/
var babel=function(a){if(a.loadLib)return a;a.falso=a["false"]=a.fals=a.gezurra=a.faux=a.fals="false";a.verdadero=a["true"]=a.veritable=a.egia=a.vrai=a.verdadeiro=a.veritable="true";a.no=a.ez=a.non=a["n\u00e3o"]="false";a["s\u00ed"]=a.yes=a.bai=a.oui=a.si=a["sim "]="true";a.negro=a.black=a.negre=a.beltza=a.noir=a.preto=a["#000000"]="#000000";a.maxenta=a.magenta=a["#ff00ff"]="#ff00ff";a.azul=a.blue=a.blau=a.urdina=a.bleu=a["#0000ff"]="#0000ff";a.turquesa=a.cyan=a.turkesa=a.turquoise=a["#00ffff"]="#00ffff";
a.verde=a.green=a.verd=a.berdea=a.vert=a["#00ff00"]="#00ff00";a.amarillo=a.yellow=a.groc=a.horia=a.jaune=a.amarelo=a["#ffff00"]="#ffff00";a.naranja=a.orange=a.taronja=a.laranja=a.laranxa=a["#ffc800"]="#ffc800";a.rojo=a.red=a.vermell=a.gorria=a.rouge=a.vermello=a.vermelho=a["#ff0000"]="#ff0000";a.pink=a.rosa=a.arrosa=a.rose=a["#ffafaf"]="#ffafaf";a.grisObscuro=a.darkGray=a.grisFosc=a["gris iluna"]=a.grisObscur=a.grisEscuro=a.cinzaEscuro=a["#404040"]="#404040";a.gris=a.gray=a.grisa=a.cinza=a["#808080"]=
"#808080";a.grisClaro=a.lightGray=a.grisClar=a["gris argia"]=a.grisClair=a.cinzaClaro=a["#c0c0c0"]="#c0c0c0";a.blanco=a.white=a.blanc=a.zuria=a.branco=a["#ffffff"]="#ffffff";a.escala=a.scale=a.eskala=a["\u00e9chelle"]="scale";a.nombre=a.name=a.nom=a.izena=a.nome="name";a.ikusgai=a["vis\u00edvel"]=a.visible="visible";a.rastro=a.trace=a.rastre=a.arrastoa="trace";a.fondo=a.background=a.fons=a.hondoa=a.fond=a.fundo="background";a["par\u00e1metro"]=a.parameter=a.parametroa=a["par\u00e2metro"]=a["par\u00e0metre"]=
"parameter";a["sucesi\u00f3n"]=a.sequence=a["successi\u00f3"]=a.segida=a.succession=a["seq\u00fc\u00eancia"]="sequence";a["tama\u00f1o"]=a.size=a.neurria=a.taille=a.tamanho=a["grand\u00e0ria"]="size";a.decimales=a.decimals=a.hamartarra=a["d\u00e9cimales"]=a.decimais="decimals";a.red=a.net=a.xarxa=a.sarea=a["r\u00e9seau"]=a.rede=a.malha="net";a.red10=a.net10=a.xarxa10=a.sarea10=a["r\u00e9seau10"]=a.rede10=a.malha10="net10";a.ejes=a.axes=a.eixos=a.ardatzak=a.eixes="axes";a.texto=a.text=a.testua=a.texte=
"text";a["cr\u00e9ditos"]=a.about=a["cr\u00e8dits"]=a.kreditoak=a["cr\u00e9dits"]=a.sobre="about";a.config=a.konfig=a["configura\u00e7\u00e3o"]="config";a.limpiar=a.clear=a.neteja=a.ezabatu=a.nettoye=a.limpar="clear";a.incr=a.gehi=a.incremento="incr";a.min=a.inf="min";a.max=a.sup=a["m\u00e1x"]="max";a.relleno=a.fill=a.ple=a.betea=a.plein=a.recheo=a.preencher="fill";a["relleno+"]=a["fill+"]=a["ple+"]=a["betea+"]=a["plein+"]=a["recheo+"]=a["preencher+"]=a.fillP="fillP";a["relleno-"]=a["fill-"]=a["ple-"]=
a["betea-"]=a["plein-"]=a["recheo-"]=a["preencher-"]=a.fillM="fillM";a.flecha=a.arrow=a.fletxa=a.gezia=a["fl\u00e8che"]=a.frecha=a.seta="arrow";a.ancho=a.width=a.ample=a.zabalera=a.large=a.largura="width";a.punta=a.spear=a.muturra=a.pointe=a.ponta="spear";a["regi\u00f3n"]=a.region=a["regi\u00f3"]=a.eskualde=a["r\u00e9gion"]=a["rexi\u00f3n"]=a["regi\u00e3o"]="region";a.norte=a.north=a.nord=a.ipar="north";a.sur=a.south=a.sud=a.hego=a.sul="south";a.este=a.east=a.est=a.ekialde=a.leste="east";a.oeste=
a.west=a.oest=a.hegoalde=a.ouest="west";a.exterior=a.external=a.kanpoalde=a.externo="external";a["expresi\u00f3n"]=a.expresion=a["expresi\u00f3"]=a.adierazpen=a["express\u00e3o"]="expresion";a.tipo=a.type=a.tipus=a.mota="type";a["posici\u00f3n"]=a.position=a["posici\u00f3"]=a.posizio=a["posi\u00e7\u00e3o"]="position";a["constricci\u00f3n"]=a.constraint=a["constricci\u00f3"]=a.beharte=a.constriction=a["constrici\u00f3n"]=a["restri\u00e7\u00e3o"]="constraint";a.valor=a.value=a.balio=a.valeur="value";
a["ecuaci\u00f3n"]=a.equation=a["equaci\u00f3"]=a.ekuazio=a["\u00e9quation"]=a["equa\u00e7\u00e3o"]="equation";a.curva=a.curve=a.corba=a.kurba=a.courbe="curve";a.texto=a.text=a.testu=a.texte="text";a.punto=a.point=a.punt=a.puntu=a.ponto="point";a.segmento=a.segment=a.zuzenki="segment";a.arco=a.arc=a.arku="arc";a["pol\u00edgono"]=a.polygon=a["pol\u00edgon"]=a.poligono=a.polygone="polygon";a.imagen=a.image=a.imatge=a.irudi=a.imaxe=a.imagem="image";a["Versi\u00f3n"]=a.Version=a["Versi\u00f3"]=a["Vers\u00e3o"]=
a.version="version";a.Idioma=a.Language=a.Hizkuntza=a.Langue=a.language="language";a["O.x"]="O.x";a["O.y"]="O.y";a.Botones=a.Buttons=a.Botons=a.Botoiak=a.Boutons=a["Bot\u00f3ns"]=a["Bot\u00f5es"]=a.Botons="Buttons";a["Animaci\u00f3n"]=a.Animation=a["Animaci\u00f3"]=a.Animazio=a["Anima\u00e7\u00e3o"]="Animation";a.constante=a.constant=a.Konstante="constant";a.fuente=a.font=a.iturri=a.source=a.fonte="font";a["num\u00e9rico"]=a.numeric=a["num\u00e8ric"]=a.zenbakizko=a["num\u00e9rique"]="numeric";a["gr\u00e1fico"]=
a.graphic=a["gr\u00e0fic"]=a.grafiko=a.graphique="graphic";a.inicio=a.init=a.inici=a.hasiera=a.commencement=a["in\u00edcio"]="init";a.hacer=a["do"]=a.fer=a.egin=a.faire=a.facer=a.fazer=a.doExpr="doExpr";a.mientras=a["while"]=a.mentre=a.bitartean=a["tandis que"]=a.mentres=a.enquanto=a.whileExpr="whileExpr";a.evaluar=a.evaluate=a.avalua=a.ebaluatu=a["\u00e9valuer"]=a.avaliar="evaluate";a.variable=a.aldagaia=a["vari\u00e1vel"]="variable";a["funci\u00f3n"]=a["function"]=a["funci\u00f3"]=a.funtzio=a.fonction=
a["fun\u00e7\u00e3o"]="function";a.algoritmo=a.algorithm=a.algorisme=a.algorithme="algorithm";a.vector=a.array=a.bektore=a.vecteur=a.matriz="array";a["dibujar-si"]=a["draw-if"]=a["marraztu-baldin"]=a["dessiner-si"]=a["debuxar-se"]=a["desenhar-se"]=a["dibuixa-si"]=a.drawif="drawif";a.dominio=a.range=a.domini=a["izate-eremua"]=a.domain=a["dom\u00ednio"]="range";a.pausa=a.delay=a.eten="delay";a["eje-x"]=a["x-axis"]=a["eix-x"]=a["x-ardatza"]=a["axe-x"]=a["eixe-x"]=a["eixo-x"]=a.x_axis="x_axis";a["eje-y"]=
a["y-axis"]=a["eix-y"]=a["y-ardatza"]=a["axe-y"]=a["eixe-y"]=a["eixo-y"]=a.y_axis="y_axis";a["n\u00fameros"]=a.numbers=a.nombres=a.zenbakiak="numbers";a["exponencial-si"]=a["exponential-if"]=a["esponentzial-baldin"]=a["exponentiel-si"]=a["exponencial-se"]=a.exponentialif="exponentialif";a.familia=a.family=a["fam\u00edlia"]=a.famille="family";a.intervalo=a.interval=a.tarte=a.intervalle="interval";a.pasos=a.steps=a.passos=a.pausoak=a.pas="steps";a.centro=a.center=a.centre=a.zentro="center";a.radio=
a.radius=a.radi=a.erradio=a.rayon=a.raio="radius";a.fin=a.end=a.fi=a.bukaera=a.fim="end";a["una-sola-vez"]=a["only-once"]=a["una-sola-vegada"]=a["behin-bakarrik"]=a["une-seule-fois"]=a["unha-soa-vez"]=a["apenas-uma-vez"]=a.onlyOnce="onlyOnce";a.siempre=a.always=a.sempre=a.beti=a.toujours="always";a["color-int"]=a["int-colour"]=a["barruko-kolore"]=a["couleur-int"]=a["cor-int"]=a.colorInt="colorInt";a.repetir=a.loop=a.repeteix=a.errepikatu=a["r\u00e9p\u00e9ter"]="loop";a.controles=a.controls=a.kontrolak=
a["contr\u00f4les"]=a.controis="controls";a.animar=a.animate=a.anima=a.animatu=a.animer="animate";a.auto="auto";a.alto=a.height=a.alt=a.altu=a.haut=a.altura="height";a.x=a.left="x";a.y=a.top="y";a.espacio=a.space=a.espai=a.espazio=a.espace=a.espazo=a["espa\u00e7o"]="space";a.Nu="Nu";a.Nv="Nv";a.ancho=a.depth=a.amplada=a.zabalera=a.largeur=a.ancho=a.profundidade=a.amplada=a.width="width";a.largo=a.length=a.llargada=a.luzera=a.longueur=a.longo=a.comprimento=a.llargada="length";a.alto=a.height=a["al\u00e7ada"]=
a.altu=a.hauteur=a.alto=a.altura=a["al\u00e7ada"]="height";a.color_reverso=a.backcolor=a.color_revers=a["atzealde kolorea"]=a.couleur_revers=a.cor_reverso=a.cor_de_fundo="backcolor";a.aristas=a.edges=a.arestes=a.ertzak=a["ar\u00eates"]=a.arestas="edges";a.rotini=a.inirot="inirot";a.posini=a.inipos="inipos";a["tri\u00e1ngulo"]=a.triangle=a.hirukia=a["tri\u00e2ngulo"]="triangle";a.cara=a.face=a.aurpegi="face";a.polireg=a.regpoly=a["pol\u00edgonoRegular"]="polireg";a.superficie=a.surface=a["superf\u00edcie"]=
a.azalera="surface";a.cubo=a.cube=a.cub=a.kubo="cube";a["paralelep\u00edpedo"]=a.box=a["paral\u00b7lelep\u00edpede"]=a.paralelepipedo=a["parall\u00e9l\u00e9pip\u00e8de"]="box";a.cono=a.cone=a.con=a.kono=a["c\u00f4ne"]="cone";a.cilindro=a.cylinder=a.cilindre=a.zilindro=a.cylindre="cylinder";a.esfera=a.sphere=a["sph\u00e8re"]="sphere";a.tetraedro=a.tetrahedron=a.tetraedre=a["t\u00e9tra\u00e8dre"]="tetrahedron";a.octaedro=a["octahedron="]=a.octaedre=a.oktaedro=a["octa\u00e8dre"]="octahedron";a.dodecaedro=
a.dodecahedron=a.dodecaedre=a.dodekaedro=a["dod\u00e9ca\u00e8dre"]="dodecahedron";a.icosaedro=a.icosahedron=a.icosaedre=a.ikosaedro=a["icosa\u00e8dre"]="icosahedron";a.elipsoide=a.ellipsoid=a["el\u00b7lipsoide"]=a["ellipso\u00efde"]=a["elips\u00f3ide"]="ellipsoid";a.macro=a.makro="macro";a.id="id";a.modelo=a.model=a.eredu=a["mod\u00e8le"]="model";a.color=a.kolore=a.couleur=a.cor=a.colour=a.kolorea="color";a.luz=a.light=a.llum=a.argia=a["lumi\u00e8re"]="light";a.metal=a.metall=a["m\u00e9tal"]="metal";
a.alambre=a.wire=a.filferro=a.alanbre=a["fil de fer"]=a.arame="wire";a.cortar=a.split=a.talla=a.moztu=a.couper=a.dividir="split";a.despliegue=a.render=a.desplegament=a.zabaltze=a["d\u00e8ploiement"]=a.despregamento=a.processar="render";a.orden=a.sort=a.ordre=a.ordena=a.orde=a.ordenar="sort";a.pintor=a.painter=a.margolari=a.peintre="painter";a["trazado de rayos"]=a["ray trace"]=a["tra\u00e7at de raigs"]=a["izpi trazadura"]=a["trace de rayons"]=a["trazado de raios"]=a["tra\u00e7ado de raios"]=a.raytrace=
"raytrace";a.imagen=a.bg_image=a.imatge=a.irudia=a.imaxe=a.imagem_de_fundo=a.image="image";a.despl_imagen=a.bg_display=a.despl_imatge=a["irudi desplazamendu"]=a.despl_image=a.despr_imaxe=a["apresenta\u00e7\u00e3o_de_imagem"]="bg_display";a["arr-izq"]=a.topleft=a["dalt-esq"]=a["goi-ezk"]=a["au-dessus-gau"]=a["arr-esq"]=a["acima-esquerda"]="topleft";a["expand."]=a.stretch=a.hedatu=a["expandir "]="stretch";a.mosaico=a.patch=a.mosaic=a.mosaiko=a["mosa\u00efque"]="patch";a.centrada=a.center=a.zentratu=
a["centr\u00e9e"]=a.centrado="imgcenter";a.archivo=a.file=a.fitxer=a.artxibo=a.fichier=a.arquivo="file";a.tipo_de_macro=a.macro_type=a.tipus_de_macro=a.makro_mota=a.type_de_macro=a.tipo_de_macro=a.tipo_de_macro=a.tipus_de_macro="macro_type";a.filas_norte=a.rows_north=a.files_nord=a["HTML kodea"]=a.files_nord=a.filas_norte=a.linhas_norte=a.files_nord=a.rowsNorth="rowsNorth";a.filas_sur=a.rows_south=a.files_sud=a.ipar_lerro=a.files_sud=a.filas_sur=a.linhas_sul=a.files_sud=a.rowsSouth="rowsSouth";a.ancho_este=
a.width_east=a.ample_est=a.hego_lerro=a.ample_est=a.ancho_leste=a.largura_leste=a.ample_est=a.widthEast="widthEast";a.ancho_oeste=a.width_west=a.ample_oest=a.ekialde_zabalera=a.ample_ouest=a.ancho_oeste=a.largura_oeste=a.ample_oest=a.widthWest="widthWest";a.fijo=a.fixed=a.fix=a.hegoalde_zabalera=a.fixe=a.fixo="fixed";a["Reiniciar Animaci\u00f3n"]=a["Init Animation"]=a["Reinicia Animaci\u00f3"]=a.finko=a["Recommencer l'Animation"]=a["Reiniciar Anima\u00e7\u00e3o"]=a.initAnimation="initAnimation";a["Explicaci\u00f3n"]=
a.Explanation=a.Azalpena=a.Explication=a["Explica\u00e7\u00e3o"]=a["Explicaci\u00f3"]="Explanation";a.tooltip=a.dica="tooltip";a.discreto=a.discrete=a.discret=a.diskretu="discrete";a.interfaz=a.gui=a["interf\u00edcie"]=a.interfaze=a["interface"]="gui";a.pulsador=a.spinner=a.polsador=a.pultsadore=a.bouton="spinner";a["campo de texto"]=a.textfield=a["camp de text"]=a["testu esarrua"]=a["champ de texte"]="textfield";a["men\u00fa"]=a.choice=a.menu=a.escolha="menu";a.barra=a.scrollbar=a.barre="scrollbar";
a.opciones=a.options=a.opcions=a.aukerak=a["opci\u00f3ns"]=a["op\u00e7\u00f5es"]="options";a.interior=a.barruko=a["int\u00e9rieur"]="interior";a["condici\u00f3n"]=a.condition=a["condici\u00f3"]=a.baldintza=a["condi\u00e7\u00e3o"]="condition";a["acci\u00f3n"]=a.action=a["acci\u00f3"]=a.ekintza=a["a\u00e7\u00e3o"]="action";a.evento=a.event=a.esdeveniment=a.gertaera=a["\u00e9v\u00e9nement"]="event";a["abrir URL"]=a["open URL"]=a["obre URL"]=a["URL zabaldu"]=a["ouvrir URL"]=a.openURL="openURL";a["abrir Escena"]=
a["open Scene"]=a["obre Escena"]=a["eszena zabaldu"]=a["ouvrir Escena"]=a["abrir Cena"]=a.openScene="openScene";a["bot\u00f3n"]=a.button=a["bot\u00f3"]=a.botoi=a.bouton=a["bot\u00e3o"]="button";a.mensaje=a.message=a.mezua=a.mensaxe=a.mensagem=a.missatge="message";a.alternar=a.alternate=a.alterna=a.txandakatu=a.alterner="alternate";a["ejecuci\u00f3n"]=a.execution=a["execuci\u00f3"]=a.gauzatze=a["ex\u00e9cution"]=a["execuci\u00f3n"]=a["execu\u00e7\u00e3o"]="execution";a.calcular=a.calculate=a.calcula=
a.kalkulatu=a.calculer="calculate";a.coord_abs=a.abs_coord=a.koor_abs="abs_coord";a.negrita=a.bold=a.negreta=a.lodi=a["caract\u00e8re gras"]=a.negra=a.negrito="bold";a.cursiva=a.italics=a.etzana=a.italique=a["it\u00e1lico"]="italics";a.subrayada=a.underlined=a.subratllat=a.azpimarratua=a.soulignement=a["subli\u00f1ada"]=a.sublinhado="underlined";a.imagen=a.image=a.imatge=a.irundia=a.imaxe=a.imagem="image";a.pos_mensajes=a.msg_pos=a.pos_missatges=a.mezuen_pos=a.pos_messages=a.pos_mensaxes="msg_pos";
a.izquierda=a.left=a.esquerra=a.eskerrean=a.gauche=a.esquerda=a.esquerda=a.esquerra=a.x="x";a.derecha=a.right=a.dreta=a.eskuinan=a.droite=a.dereita=a.direita=a.dreta="right";a["sensible_a_los_movimientos_del_rat\u00f3n"]=a.sensitive_to_mouse_movements=a["sensible_als_moviments_del_ratol\u00ed"]=a["xagu mugimenduarekiko sentikorra"]=a.sensible_aux_mouvements_du_souris=a.sensible_aos_movementos_do_rato=a["sens\u00edvel_aos_movimentos_do_mouse"]="sensitive_to_mouse_movements";a.reproducir=a.play=a.reprodueix=
a.erreproduzitu=a.reproduire=a.reproduzir=a.playAudio="playAudio";a["activo-si"]=a["active-if"]=a["actiu-si"]=a["altiboa-baldin"]=a["actif-si"]=a["activo-se"]=a["ativo-se"]=a.activeif="activeif";a.rotfin=a.finrot=a.bukrot=a.endrot="endrot";a.posfin=a.finpos=a.bukpos=a.endpos="endpos";a.editable=a.editagarria=a["edit\u00e1vel"]="editable";a.tipo=a.type=a.tipus=a.mota="type";a.R2="R2";a.R3="R3";a.vectores=a.bektoreak=a.vecteurs=a.vetores=a.vectors="vectors";a["fuente puntos"]=a["font size"]=a["font punts"]=
a["puntu iturria"]=a["source points"]=a["fonte puntos"]=a["fonte pontos"]=a.font_size="font_size";a["ecuaci\u00f3n"]=a.equation=a["equaci\u00f3"]=a.ekuazio=a["\u00e9quation"]=a["equa\u00e7\u00e3o"]="equation";a.punto=a.dot=a.punt=a.puntu=a.point=a.ponto="point";a.escenario=a.scenario=a.escenari=a.agertoki=a["sc\u00e8ne"]=a["cen\u00e1rio"]="scenario";a.cID="cID";a.matriz=a.matrix=a.matriu=a.matrice="matrix";a.filas=a.rows=a.files="rows";a.columnas=a.columns=a.colonnes="columns";a.solo_texto=a.only_text=
a.seulement_texte=a["s\u00f3_texto"]=a.tan_sols_texte=a.onlyText="onlyText";a.respuesta=a.answer="answer";a.peso=a.weight=a.pes="weight";a.decimal_symbol=a["signo decimal"]=a["decimal symbol"]="decimal_symbol";a.info="info";a.color_contorn_text=a.color_text_border=a.color_borde_texto=a.muga_testuaren_kolorea=a.couleur_contour_texte=a.cor_borde_texto=a.colore_bordo_testo=a.cor_borda_texto=a.color_contorn_text=a.border="border";a.video=a["vid\u00e9o"]="video";a.audio=a["\u00e0udio"]="audio";a.autoplay=
"autoplay";a.loop="loop";a.poster="poster";a.opacidad=a.opacity=a["opacit\u00e9"]=a.opacitat=a.opacidade="opacity";a.alinear=a.align=a["ali\u00f1ar"]=a.aligner="align";a.malla=a.mesh="mesh";a.local=a.Local="local";a.rectangle=a["rect\u00e1ngulo"]="rectangle";a.generic=a.generico="generic";a.loadLib=!0;a["GUI_espa\u00f1ol"]={decimal_symbol:"Simbolo decimal",language:"Lenguaje",about:"Cr\u00e9ditos",config:"Configuraci\u00f3n",init:"Inicio",clear:"Limpiar"};a.GUI_english={};a["GUI_catal\u00e0"]={};
a.GUI_euskera={};a["GUI_fran\u00e7ais"]={};a.GUI_galego={};a["GUI_portugu\u00eas"]={};a["GUI_valenci\u00e0"]={};a.translate=function(a,k){return k.charAt(0).toUpperCase()+k.substring(1)};a["LANG_espa\u00f1ol"]={"true":"s\u00ed","false":"no",decimal_symbol:"signo decimal",version:"Versi\u00f3n",language:"Idioma",Buttons:"Botones",about:"cr\u00e9ditos",init:"inicio",clear:"limpiar",widthEast:"ancho_este",widthWest:"ancho_oeste",type:"tipo",width:"ancho",height:"alto",drawif:"dibujar-si",exponentialif:"exponencial-si",
activeif:"activo-si",fixed:"fijo",scale:"escala",image:"imagen",bg_display:"despl_imagen",background:"fondo",file:"archivo",topleft:"arr-izq",stretch:"expand.",patch:"mosaico",imgcenter:"centrada",center:"centro",net:"red",net10:"red10",axes:"ejes",text:"texto",numbers:"n\u00fameros",x_axis:"eje-x",y_axis:"eje-y",sensitive_to_mouse_movements:"sensible_a_los_movimientos_del_rat\u00f3n",render:"despliegue",sort:"orden",painter:"pintor",split:"cortar",raytrace:"trazado de rayos",numeric:"num\u00e9rico",
region:"regi\u00f3n",north:"norte",south:"sur",east:"este",west:"oeste",external:"exterior",expresion:"expresi\u00f3n",space:"espacio",name:"nombre",value:"valor",incr:"incremento",gui:"interfaz",spinner:"pulsador",textfield:"campo de texto",menu:"men\u00fa",scrollbar:"barra",options:"opciones",button:"bot\u00f3n",graphic:"gr\u00e1fico",discrete:"discreto",decimals:"decimales",visible:"visible",action:"acci\u00f3n",playAudio:"reproducir",parameter:"par\u00e1metro",interior:"interior",condition:"condici\u00f3n",
action:"acci\u00f3n",event:"evento",openURL:"abrir URL",openScene:"abrir Escena",message:"mensaje",alternate:"alternar",execution:"ejecuci\u00f3n",calculate:"calcular",onlyText:"solo_texto",msg_pos:"pos_mensajes",color:"color",colorInt:"color-int",bold:"negrita",italics:"cursiva",underlined:"subrayada",font_size:"fuente puntos",size:"tama\u00f1o",constraint:"constricci\u00f3n",answer:"respuesta",weight:"peso","function":"funci\u00f3n",algorithm:"algoritmo",array:"vector",doExpr:"hacer",whileExpr:"mientras",
evaluate:"evaluar",range:"dominio",onlyOnce:"una-sola-vez",always:"siempre",matrix:"matriz",rows:"filas",columns:"columnas",constant:"constante",equation:"ecuaci\u00f3n",curve:"curva",sequence:"sucesi\u00f3n",text:"texto",point:"punto",segment:"segmento",arc:"arco",polygon:"pol\u00edgono",image:"imagen",abs_coord:"coord_abs",trace:"rastro",family:"familia",interval:"intervalo",steps:"pasos",fillP:"relleno+",fillM:"relleno-",fill:"relleno",spear:"punta",arrow:"flecha",radius:"radio",end:"fin",vectors:"vectores",
opacity:"opacidad",backcolor:"color_reverso",triangle:"tri\u00e1ngulo",face:"cara",surface:"superficie",cube:"cubo",box:"paralelep\u00edpedo",cone:"cono",cylinder:"cilindro",sphere:"esfera",tetrahedron:"tetraedro",octahedron:"octaedro",dodecahedron:"dodecaedro",icosahedron:"icosaedro",ellipsoid:"elipsoide",model:"modelo",light:"luz",metal:"metal",wire:"alambre",edges:"aristas",length:"largo",Animation:"Animaci\u00f3n",delay:"pausa",controls:"controles",loop:"repetir"};a.toLanguage=function(c,k){return a["LANG_"+
(k||"espa\u00f1ol")][c]||c};return a}(babel||{}),descartesJS=function(a){if(a.loadLib)return a;a.convertFont=function(a){if(""==a)return a;fontTokens=a.split(",");fontCanvas="";"bold"==fontTokens[1].toLowerCase()?fontCanvas+="Bold ":"italic"==fontTokens[1].toLowerCase()||"italics"==fontTokens[1].toLowerCase()?fontCanvas+="Italic ":"bold+italic"==fontTokens[1].toLowerCase()&&(fontCanvas+="Italic Bold ");fontName=fontTokens[0].split(" ")[0].toLowerCase();fontCanvas+=fontTokens[2]+"px ";return fontCanvas=
"serif"===fontName||"times new roman"===fontName||"timesroman"===fontName||"times"===fontName?fontCanvas+"descartesJS_serif,Times,'Times New Roman', serif":"sansserif"===fontName||"arial"===fontName||"helvetica"===fontName?fontCanvas+"descartesJS_sansserif,Arial,Helvetica,Sans-serif":fontCanvas+"descartesJS_monospace,Courier,'Courier New',Monospace"};a.getTextWidth=function(f,b){a.ctx.font=b;return Math.round(a.ctx.measureText(f).width)};a.getFieldFontSize=function(a){a=Math.min(50,a);return a=24<=
a?Math.floor(a/2+2-a/16):20<=a?12:17<=a?11:15<=a?10:9};var c={ss_5:{a:5,d:3},ss_6:{a:5,d:3},ss_7:{a:6,d:3},ss_8:{a:7,d:3},ss_9:{a:9,d:4},ss_10:{a:10,d:4},ss_11:{a:11,d:4},ss_12:{a:12,d:4},ss_13:{a:13,d:4},ss_14:{a:13,d:4},ss_15:{a:14,d:4},ss_16:{a:15,d:4},ss_17:{a:15,d:5},ss_18:{a:16,d:5},ss_19:{a:18,d:5},ss_20:{a:19,d:5},ss_21:{a:19,d:6},ss_22:{a:20,d:6},ss_23:{a:21,d:6},ss_24:{a:21,d:7},ss_25:{a:23,d:6},ss_26:{a:25,d:7},ss_27:{a:26,d:7},ss_28:{a:26,d:7},ss_29:{a:27,d:7},ss_30:{a:28,d:8},ss_31:{a:28,
d:8},ss_32:{a:29,d:8},ss_33:{a:31,d:8},ss_34:{a:32,d:8},ss_35:{a:32,d:9},ss_36:{a:33,d:9},ss_37:{a:34,d:10},ss_38:{a:34,d:10},ss_39:{a:35,d:10},ss_40:{a:36,d:10},ss_41:{a:38,d:11},ss_42:{a:38,d:11},ss_43:{a:39,d:11},ss_44:{a:40,d:11},ss_45:{a:40,d:11},ss_46:{a:42,d:11},ss_47:{a:43,d:11},ss_48:{a:45,d:11},ss_49:{a:45,d:13},ss_50:{a:46,d:13},ss_51:{a:47,d:13},ss_52:{a:48,d:13},ss_53:{a:48,d:14},ss_54:{a:49,d:14},ss_55:{a:51,d:14},ss_56:{a:52,d:14},ss_57:{a:52,d:14},ss_58:{a:53,d:14},ss_59:{a:53,d:14},
ss_60:{a:54,d:14},ss_61:{a:55,d:15},ss_62:{a:56,d:15},ss_63:{a:57,d:15},ss_64:{a:58,d:15},ss_65:{a:59,d:16},ss_66:{a:60,d:16},ss_67:{a:60,d:16},ss_68:{a:61,d:16},ss_69:{a:62,d:17},ss_70:{a:63,d:17},ss_71:{a:64,d:17},ss_72:{a:65,d:17},ss_73:{a:66,d:17},ss_74:{a:66,d:17},ss_75:{a:67,d:17},ss_76:{a:68,d:17},ss_77:{a:70,d:18},ss_78:{a:70,d:18},ss_79:{a:71,d:18},ss_80:{a:72,d:18},ss_81:{a:73,d:20},ss_82:{a:73,d:20},ss_83:{a:74,d:20},ss_84:{a:75,d:20},ss_85:{a:77,d:20},ss_86:{a:77,d:20},ss_87:{a:78,d:20},
ss_88:{a:79,d:20},ss_89:{a:80,d:20},ss_90:{a:80,d:20},ss_91:{a:81,d:20},ss_92:{a:83,d:20},ss_93:{a:84,d:20},ss_94:{a:84,d:20},ss_95:{a:85,d:20},ss_96:{a:86,d:20},ss_97:{a:87,d:20},ss_98:{a:87,d:20},ss_99:{a:89,d:20},s_5:{a:4,d:4},s_6:{a:5,d:4},s_7:{a:6,d:4},s_8:{a:7,d:4},s_9:{a:9,d:4},s_10:{a:10,d:3},s_11:{a:11,d:4},s_12:{a:12,d:4},s_13:{a:12,d:4},s_14:{a:13,d:4},s_15:{a:13,d:5},s_16:{a:15,d:5},s_17:{a:15,d:5},s_18:{a:16,d:5},s_19:{a:16,d:6},s_20:{a:17,d:6},s_21:{a:18,d:6},s_22:{a:20,d:6},s_23:{a:20,
d:7},s_24:{a:21,d:7},s_25:{a:23,d:7},s_26:{a:23,d:7},s_27:{a:24,d:8},s_28:{a:26,d:8},s_29:{a:26,d:8},s_30:{a:27,d:8},s_31:{a:28,d:9},s_32:{a:28,d:9},s_33:{a:29,d:9},s_34:{a:31,d:9},s_35:{a:32,d:10},s_36:{a:32,d:10},s_37:{a:33,d:10},s_38:{a:34,d:10},s_39:{a:34,d:12},s_40:{a:35,d:12},s_41:{a:37,d:12},s_42:{a:38,d:12},s_43:{a:39,d:12},s_44:{a:40,d:12},s_45:{a:41,d:13},s_46:{a:41,d:13},s_47:{a:42,d:13},s_48:{a:43,d:13},s_49:{a:44,d:15},s_50:{a:45,d:15},s_51:{a:45,d:15},s_52:{a:46,d:15},s_53:{a:48,d:15},
s_54:{a:48,d:15},s_55:{a:49,d:15},s_56:{a:50,d:15},s_57:{a:51,d:15},s_58:{a:52,d:15},s_59:{a:53,d:15},s_60:{a:54,d:15},s_61:{a:54,d:17},s_62:{a:55,d:17},s_63:{a:56,d:17},s_64:{a:57,d:17},s_65:{a:58,d:17},s_66:{a:59,d:17},s_67:{a:60,d:17},s_68:{a:61,d:17},s_69:{a:61,d:18},s_70:{a:62,d:18},s_71:{a:63,d:18},s_72:{a:64,d:18},s_73:{a:65,d:19},s_74:{a:66,d:19},s_75:{a:67,d:19},s_76:{a:67,d:19},s_77:{a:68,d:20},s_78:{a:70,d:20},s_79:{a:71,d:20},s_80:{a:71,d:20},s_81:{a:72,d:21},s_82:{a:73,d:21},s_83:{a:73,
d:21},s_84:{a:75,d:21},s_85:{a:76,d:21},s_86:{a:77,d:21},s_87:{a:77,d:21},s_88:{a:78,d:21},s_89:{a:79,d:21},s_90:{a:81,d:21},s_91:{a:81,d:21},s_92:{a:82,d:21},s_93:{a:83,d:21},s_94:{a:83,d:21},s_95:{a:84,d:21},s_96:{a:86,d:21},s_97:{a:87,d:21},s_98:{a:87,d:21},s_99:{a:88,d:21},m_5:{a:4,d:3},m_6:{a:5,d:3},m_7:{a:6,d:3},m_8:{a:6,d:3},m_9:{a:9,d:4},m_10:{a:9,d:4},m_11:{a:10,d:5},m_12:{a:11,d:5},m_13:{a:11,d:6},m_14:{a:11,d:7},m_15:{a:12,d:6},m_16:{a:13,d:6},m_17:{a:14,d:7},m_18:{a:14,d:7},m_19:{a:15,
d:7},m_20:{a:16,d:7},m_21:{a:16,d:8},m_22:{a:17,d:8},m_23:{a:17,d:9},m_24:{a:19,d:9},m_25:{a:21,d:9},m_26:{a:21,d:9},m_27:{a:22,d:9},m_28:{a:22,d:10},m_29:{a:23,d:10},m_30:{a:24,d:10},m_31:{a:25,d:11},m_32:{a:26,d:11},m_33:{a:26,d:11},m_34:{a:27,d:11},m_35:{a:28,d:11},m_36:{a:28,d:12},m_37:{a:28,d:11},m_38:{a:30,d:11},m_39:{a:31,d:12},m_40:{a:31,d:12},m_41:{a:32,d:14},m_42:{a:32,d:14},m_43:{a:33,d:14},m_44:{a:34,d:14},m_45:{a:35,d:14},m_46:{a:36,d:14},m_47:{a:37,d:14},m_48:{a:37,d:14},m_49:{a:38,
d:17},m_50:{a:38,d:17},m_51:{a:39,d:17},m_52:{a:41,d:17},m_53:{a:41,d:18},m_54:{a:42,d:18},m_55:{a:43,d:18},m_56:{a:43,d:18},m_57:{a:44,d:19},m_58:{a:46,d:19},m_59:{a:46,d:19},m_60:{a:47,d:19},m_61:{a:47,d:21},m_62:{a:48,d:21},m_63:{a:49,d:21},m_64:{a:49,d:22},m_65:{a:51,d:21},m_66:{a:52,d:21},m_67:{a:52,d:21},m_68:{a:53,d:21},m_69:{a:53,d:22},m_70:{a:54,d:22},m_71:{a:55,d:22},m_72:{a:56,d:22},m_73:{a:57,d:23},m_74:{a:58,d:23},m_75:{a:58,d:23},m_76:{a:59,d:23},m_77:{a:59,d:24},m_78:{a:60,d:24},m_79:{a:62,
d:24},m_80:{a:62,d:24},m_81:{a:63,d:25},m_82:{a:64,d:25},m_83:{a:64,d:25},m_84:{a:65,d:25},m_85:{a:65,d:25},m_86:{a:67,d:25},m_87:{a:68,d:25},m_88:{a:68,d:25},m_89:{a:69,d:25},m_90:{a:70,d:25},m_91:{a:70,d:25},m_92:{a:71,d:25},m_93:{a:72,d:25},m_94:{a:73,d:25},m_95:{a:74,d:25},m_96:{a:74,d:25},m_97:{a:75,d:25},m_98:{a:76,d:25},m_99:{a:77,d:25}},k={};document.createElement("canvas");var e;a.getFontMetrics=function(a){if(k[a])return k[a];e=parseInt(a.match(/(\d+\.*)+px/)[0]);var b;a.match("sansserif")?
b="ss_":a.match("serif")?b="s_":a.match("monospace")&&(b="m_");b=c[b+e];b={ascent:b.a,descent:b.d,h:b.a+b.d,baseline:b.a};return k[a]=b};return a}(descartesJS||{}),descartesJS=function(a){function c(){var a,b,d,h,n,g,e,f,c;Number.prototype.originalToFixed=Number.prototype.toFixed;Number.prototype.toFixed=function(p){try{return this.originalToFixed(p)}catch(r){p=p?p:0;p=0>p?0:parseInt(p);a=this.toString();n=a.indexOf("e");-1!==n&&(g=a.split("e"),f="-"===g[0][0]?"-":"",e="-"===f?parseFloat(g[0].substring(1)).originalToFixed(11):
parseFloat(g[0]).originalToFixed(11),c=parseInt(g[1]),b=e.indexOf("."),0>b+c?(b=0>b?1:b,a=f+"0."+Array(Math.abs(b+c)+1).join("0")+e.replace(".","")):(e=e.replace(".",""),a=f+e+Array(c-e.length+2).join("0")));b=a.indexOf(".");d="";if(-1===b)0<p&&(d="."),d+=Array(p+1).join("0"),a+=d;else if(h=a.length-b-1,h>=p)11>=p&&(a=parseFloat(a).originalToFixed(p)),a=0<p?a.substring(0,b+1+p):a.substring(0,b);else{var m=0;for(p-=h;m<p;m++)d+="0";a+=d}return a}}}function k(a,b,d){a.fillStyle="#c0c0c0";a.fillRect(b.offsetLeft,
b.offsetTop,b.offsetWidth,b.offsetHeight);e(a,b,d.controls)}function e(a,b,d){for(var h,n=d.length-1;0<=n;n--)h=d[n],h.drawIfValue&&a.drawImage(h.getScreenshot(),b.offsetLeft+h.x,b.offsetTop+h.y)}if(a.loadLib)return a;var f=2*Math.PI,b=360/f,g=f/360,t=Math.floor,d,r,p,m,q,u,n,h,v;a.rangeOK=1;a.extend=function(a,b){if("function"==typeof Object.create)a.prototype=Object.create(b.prototype);else if(a.prototype.__proto__)a.prototype.__proto__=b.prototype;else for(var d in b.prototype)b.prototype.hasOwnProperty(d)&&
(a.prototype[d]=b.prototype[d]);a.prototype.uber=b.prototype};a.radToDeg=function(a){return a*b};a.degToRad=function(a){return a*g};a.drawLine=function(a,b,d,h,n,g,e){a.lineWidth=e||1;a.strokeStyle=g||"black";v=a.lineWidth%2?.5:0;a.beginPath();a.moveTo(t(b)+v,t(d)+v);a.lineTo(t(h)+v,t(n)+v);a.stroke()};a.getColor=function(a,b){if("string"==typeof b)return b;d=a.evalExpression(b);r=t(255*d[0][0]);p=t(255*d[0][1]);m=t(255*d[0][2]);q=1-d[0][3];return"rgba("+r+","+p+","+m+","+q+")"};a.getFeatures=function(){a.hasJavaSupport=
navigator.javaEnabled();var b=navigator.appVersion.toLowerCase();a.hasTouchSupport=window.hasOwnProperty&&window.hasOwnProperty("ontouchstart")||"ontouchstart"in window||/android/i.test(b);a.isIOS=/iPad|iPhone/i.test(navigator.userAgent);b=document.createElement("canvas");a.hasCanvasSupport=b.getContext&&b.getContext("2d");a.hasCanvasSupport&&(a.ctx=document.createElement("canvas").getContext("2d"),a._ratio=a.devicePixelRatio=a.backingStoreRatio=1);c()};a.removeNeedlessDecimals=function(a){var b,
d;if("string"==typeof a&&(b=a.indexOf("."),-1!=b)){d=a.substring(b);if(0==parseFloat(d))return a.substring(0,b);for(var h=d.length;0<h;h--)if(0!=d.charAt(h))return a.substring(0,b+h+1)}return a};a.returnValue=function(a){return"number"===typeof a?parseFloat(a.toFixed(11)):a};a.whichButton=function(a){return null!==a.which?2>a.which?"L":2===a.which?"M":"R":2>a.button?"L":4===a.button?"M":"R"};a.getCursorPosition=function(a){a.touches?(u=a.touches[0],n=u.pageX,h=u.pageY):(n=a.clientX,h=a.clientY);return{x:n,
y:h}};a.getScreenshot=function(){var b=a.apps[0],d,h=document.createElement("canvas"),n=new Image;if(b){h.setAttribute("width",b.width);h.setAttribute("height",b.height);for(var g=h.getContext("2d"),f=0,c=b.spaces.length;f<c;f++)d=b.spaces[f],d.drawIfValue&&"R2"===d.type&&(g.drawImage(d.backgroundCanvas,d.x,d.y),g.drawImage(d.canvas,d.x,d.y),e(g,d.container,d.ctrs));0<b.northSpace.controls.length&&k(g,b.northSpace.container,b.northSpace);0<b.southSpace.controls.length&&k(g,b.southSpace.container,
b.southSpace);0<b.eastSpace.controls.length&&k(g,b.eastSpace.container,b.eastSpace);0<b.westSpace.controls.length&&k(g,b.westSpace.container,b.westSpace);n.src=h.toDataURL("image/png")}return n};a.showAbout=function(){var b="<html>\n<head>\n<style>\nbody{ text-align:center; }\niframe{ width:650px; height:73px; overflow:hidden; border:1px solid black; }\ndt{ font-weight:bold; margin-top:10px; }\n</style>\n</head>\n<body>\n<iframe src='http://arquimedes.matem.unam.mx/Descartes5/creditos/bannerPatrocinadores.html'></iframe>\n<h2> <a href='http://proyectodescartes.org/' target='_blank'>ProyectoDescartes.org</a> <br> <a href='http://descartesjs.org' target='_blank'>DescartesJS.org</a> </h2>\n<dl>\n<dt> Dise&ntilde;o funcional:</dt>\n<dd>\n<nobr>Jos&eacute; Luis Abreu Leon,</nobr>\n<nobr>Jos&eacute; R. Galo Sanchez,</nobr>\n<nobr>Juan Madrigal Muga</nobr>\n</dd>\n<dt>Autores del software:</dt>\n<dd>\n<nobr>Jos&eacute; Luis Abreu Leon,</nobr>\n<nobr>Marta Oliver&oacute; Serrat,</nobr>\n<nobr>Oscar Escamilla Gonz&aacute;lez,</nobr>\n<nobr>Joel Espinosa Longi</nobr>\n</dd>\n</dl>\n<p>\nEl software en Java est&aacute; bajo la licencia\n<a href='https://joinup.ec.europa.eu/software/page/eupl/licence-eupl'>EUPL v.1.1 </a>\n<br>\nEl software en JavaScript est&aacute; bajo licencia\n<a href='http://www.gnu.org/licenses/lgpl.html'>LGPL</a>\n</p>\n<p>\nLa documentaci&oacute;n y el c&oacute;digo fuente se encuentran en :\n<br>\n<a href='http://arquimedes.matem.unam.mx/Descartes5/'>http://arquimedes.matem.unam.mx/Descartes5/</a>\n</p>\n";
a.creativeCommonsLicense&&(b+="<p>\nEste objeto, creado con Descartes, est&aacute; licenciado\npor sus autores como\n<a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'><nobr>Creative Commons</nobr></a>\n<br>\n<a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'><img src='https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png'></a>\n</p>");var b=b+"</body> </html>",d=window.open("","creditos","width=700,height=500,titlebar=0,toolbar=0,location=0,menubar=0,resizable=0,scrollbars=0,status=0");
d.document.write(b);d.document.close()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k;a._externalFilesContent={};a.openExternalFile=function(e){if(a._externalFilesContent[e])return a._externalFilesContent[e];c=null;var f=!1;if(window.XMLHttpRequest)try{f=new XMLHttpRequest}catch(b){f=!1}else if(window.ActiveXObject)try{f=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{f=new ActiveXObject("Microsoft.XMLHTTP")}catch(g){f=!1}}k=f;k.open("GET",e,!1);try{k.send(null),
c=k.responseText,c.match(String.fromCharCode(65533))&&(k.open("GET",e,!1),k.overrideMimeType("text/plain; charset=ISO-8859-1"),k.send(null),c=k.responseText)}catch(b){console.log("Error to load the file :",e),c=null}return c};a.addExternalFileContent=function(e,f){a._externalFilesContent[e]=f};return a}(descartesJS||{}),descartesJS=function(a){function c(a){l=a.indexOf("--radial--");-1!=l&&(a=a.substring(0,l));b=a.trim();a={ignoreAcents:!1,ignoreCaps:!1,regExp:null};b[0]==b[b.length-1]&&"'"==b[0]&&
(a.ignoreCaps=!0,b=b.substring(1,b.length-1),"`"==b[0]&&"\u00b4"==b[b.length-1]&&(a.ignoreAcents=!0,b=b.substring(1,b.length-1)));"`"==b[0]&&"\u00b4"==b[b.length-1]&&(a.ignoreAcents=!0,b=b.substring(1,b.length-1),b[0]==b[b.length-1]&&"'"==b[0]&&(a.ignoreCaps=!0,b=b.substring(1,b.length-1)));"*"===b.charAt(0)&&"*"!==b.charAt(b.length-1)?b=b.substring(1)+"$":"*"!==b.charAt(0)&&"*"===b.charAt(b.length-1)?b="^"+b.substring(0,b.length-1):"*"!==b.charAt(0)&&"*"!==b.charAt(b.length-1)?b="^"+b+"$":"*"===
b.charAt(0)&&"*"===b.charAt(b.length-1)&&(b=b.substring(1,b.length-1));b=b.replace(/\?/g,"[\\S\\s]{1}");a.regExp=b;return a}function k(a,d){b=(a||"").trim();a={ignoreAcents:!1,ignoreCaps:!1,regExp:null};a.expr=b.split(",");a.expr[0]=a.expr[0].trim();a.expr[0]={type:a.expr[0].charAt(0),expr:d.parser.parse(a.expr[0].substring(1))};a.expr[1]=a.expr[1].trim();a.expr[1]={type:a.expr[1].charAt(a.expr[1].length-1),expr:d.parser.parse(a.expr[1].substring(0,a.expr[1].length-1))};return a}function e(a,b,d){b=
parseFloat(b);r=a.expr[0];p=a.expr[1];m=d.evalExpression(r.expr);q=d.evalExpression(p.expr);u="("==r.type;n="["==r.type;h=")"==p.type;v="]"==p.type;return(u&&b>m||n&&b>=m)&&(h&&b<q||v&&b<=q)?1:0}function f(a){return a.toString().replace(/\u00e1/g,"a").replace(/\u00e9/g,"e").replace(/\u00ed/g,"i").replace(/\u00f3/g,"o").replace(/\u00fa/g,"u").replace(/\u00c1/g,"A").replace(/\u00c9/g,"E").replace(/\u00cd/g,"I").replace(/\u00d3/g,"O").replace(/\u00da/g,"U").replace(/\u00f1/g,"n").replace(/\u00d1/g,"N")}
if(a.loadLib)return a;var b,g,t,d,r,p,m,q,u,n,h,v,l;a.buildRegularExpresionsPatterns=function(a,d){a=a||"";"("===a.charAt(0)&&")"===a.charAt(a.length-1)&&-1===a.indexOf(",")&&(a=a.substring(1,a.length-1));a=a.replace(/&squot;/g,"'").replace(/&amp;/g,"&").split("|");for(var h=0,n=a.length;h<n;h++){g=a[h].split("&");t=[];for(var e=0,f=g.length;e<f;e++)b=g[e],-1===b.indexOf(",")||"("!==b.charAt(0)&&"["!==b.charAt(0)||")"!==b.charAt(b.length-1)&&"]"!==b.charAt(b.length-1)?t.push(c(b)):t.push(k(b,d));
a[h]=t}return a};a.escorrecto=function(b,h,n,c){n=n||a.externalEvaluator;c=c||a.buildRegularExpresionsPatterns(b,n);h=f(h);b=0;for(var p=c.length;b<p;b++){g=c[b];d=!0;for(var l=0,r=g.length;l<r;l++)d=g[l].regExp?d&&!!h.match(new RegExp(f(g[l].regExp),"i")):d&&e(g[l],h,n);if(d)return 1}return 0};a.esCorrecto=function(h,n,c,p){c=c||a.externalEvaluator;p=p||a.buildRegularExpresionsPatterns(h,c);h=0;for(var l=p.length;h<l;h++){g=p[h];d=!0;for(var r=0,m=g.length;r<m;r++)(b=g[r].regExp)?(g[r].ignoreAcents&&
(n=f(n),b=f(b)),g[r].ignoreCaps&&(n=n.toLowerCase(),b=f(b).toLowerCase()),d=d&&!!n.match(b)):d=d=d&&e(g[r],n,c);if(d)return 1}return 0};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.getCreativeCommonsLicenseImage=function(){var a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAAfCAMAAABUFvrSAAAAA3NCSVQICAjb4U/gAAAB/lBMVEX///////////8AAAANDA0NDg0ODg4QEBAZGRkbGxsfGxwgICAjHyAkJCQoJSYoKCgoKSgpKSkpKikqJycqKiotLS0wMDAxLS4yMTEyMzE1NjU+Pz4/Nzk/OzxAQEBDRENQUFBQUVBaV1hdXl1gYGBjX2FoZWZubGxwcHBwcm91cnN2c3R4dXZ5fHl6fXl8f3x9f3x+e3x/gX6AgICChYKEgYKEhYSEhoSHhoeJjImMiouOh4uPj4+Rj4+Rk5GRlJGTmJOVmZSWmZaYlpeamJmenZ2eoJ2flpqfn5+fo56ipqGjoaGjqKOmqqarsaqsq6ussquts6yus62utK2vr6+vsq+vtK6vta6ws6+wta+wtq+xt7Cyt7GyuLGzuLK0ubO0urO1tbW1urS2u7W3vLa4vbe5vri5vrm6ubm6v7m6v7q7wLq7wLu8wLy8wbu8wby9wry9wr2+wr2+w76/v7+/w76/xL7AxL/Axb/AxcDBxcDCx8LDx8LDyMPEx8PEyMPEycTFycTFycXGysXGysbHy8fIx8fIzMfIzMjJyMjJzcjJzcnKzcnLysvLzsrLz8rLz8vMz8vM0MvM0MzN0MzN0czN0c3O0c3O0s7Pz8/P08/Q08/Q1NDR1NDR1NHS1dHS1dLT1tLW1dXf39/g3+Dj4+Po5+fv7+/x8fH///+utJ0VAAAAA3RSTlMACg7nIQFTAAAD4UlEQVRIx7WWj3fTVBTHq5dSZp/SonbqJOtGhWKdTONA1HWADIfourHpdMOhW9dtTuqEDmbsKBhZpMOUtroCIWxtre37L71J2vw69UyLvNOctN/kft573/vefXU8DU+kORwAM9FY/Aq3xgsbYjafz2buCHyKW4nPR2emp74cGx0dGf7vDcnIXVy+luTTmYIkbxeL24+kwt00n1xdXlTIE2OjIy2RHYDcH1O3xIJ8tNOpTMLZeUy+lxFucD8g+avJifOjIz1e5YG3x4jbUUFwDLlCTgq3GQa1DUj59E1ueT568cLk2EkPABMMMgCeE1rUiZ0VBMevpYS83IU8V4BNJNiAC792Xf8jfWM1Hpudnvp4N/jLFFvZD7vVqLP/QkHwleStnMJ1sVWqtSFEe67nheTK0tzMBS8EUANQHoBHCfKoSn+3Tamsr1d0BcEcL0rI9ZWp3qo+HLOU4bnl2Gwv+EsNMPUDetgDL51G7p5doYqu4DvnCLaFuqKA134thJFbpdRKHriXTl1diu4DU49l8A4Pe+E5sv8gsO9CRFfKdJ28+lqIkH5NUcB8Rm4D131qaVUXtMl3ee77GDDK7wCo06cMYAzz+hs4uFClZCi09hF5n9JB0q4pCljYPArAUlsbAjhWEJKXFyFIVSc0L4IKBpX1EAqhkqHUniV70WZC/lIVBbzxoBNcaETCzzCsdvsAA1zQKd1BL5qDkRFqJ6R7QVe+eTGhgv/UwaLsVKaZUFcwM67eAsrknY8yN1e/a2YFfqkN0pKSrf0NZeHcbUojhBhWZLcAcIg+cJcT7iEfLo9x95DqxXaW5+IvaMnTBqyninaT9nYIRd56pqEMEtLX9zz50EhergiQUCJZDVC3G2dQzP/Cxd8GP7UvN1QqfXt29dfMSp8ygUM1Y7ntAJ7bZ2yQoHmDvNdtU36LREq6YrGiet/NohXKzbBi7tNWt3Q9efWs6ckLglMWMXlzX3+CdcsXCPqMknPWs6OiLrcucFF9uY0z6o26cbltpK5+G7049fmbLZVNYTOsetFsg/x0eX52enKshUMEwT+rW7r8T1saa32LYCxCZ5oVoXAhvbayhKV+4vxIS2A4IkoHkGwqQ2W1bIrvPNYxjdfh7ENzoa+yWOhfkXNH4HHB0Jt/eMB2NMm/n9Lf0fYHaJemaBelYHuJWsHQm5XOmA/TsJQ7ZYqpf6iJUv9t6coiaGA4jMd/uHH8D8gF0exDo2yau6KWjhp9UWoHw8ufZTYfyFvF4paMf1i+6LDE2Ixo2EAtmm0KDl3vOH5JzOZyWfHS8Q5rHpqN2O5xIw9NwP/3v8KnnhD3b1lluBxHejSEAAAAAElFTkSuQmCC";
return a};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.floor,k,e,f,b,g,t,d,r,p,m,q,u,n;a.Color=function(a,d){this.b=this.g=this.r=0;this.a=1;this.evaluator=d;if(a){if(babel[a]&&("net"===babel[a]&&(a="rojo"),a=babel[a],this.r=parseInt("0x"+a.substring(1,3),16),this.g=parseInt("0x"+a.substring(3,5),16),this.b=parseInt("0x"+a.substring(5,7),16),this.colorStr=a,this.getColor=this.getColorString),6===a.length&&(this.r=parseInt("0x"+a.substring(0,2),16),this.g=parseInt("0x"+
a.substring(2,4),16),this.b=parseInt("0x"+a.substring(4,6),16),this.colorStr="#"+a,this.getColor=this.getColorString),8===a.length&&(this.r=parseInt("0x"+a.substring(2,4),16),this.g=parseInt("0x"+a.substring(4,6),16),this.b=parseInt("0x"+a.substring(6,8),16),this.a=1-parseInt("0x"+a.substring(0,2),16)/255,this.colorStr="rgba("+this.r+","+this.g+","+this.b+","+this.a+")",this.getColor=this.getColorString),"("===a[0]){e=[];f=this.splitComa(a.substring(1,a.length-1));for(var n=0,g=f.length;n<g;n++)b=
parseInt(f[n],16),f[n]!=b.toString(16)&&f[n]!=="0"+b.toString(16)?("["===f[n].charAt(0)&&"]"===f[n].charAt(f[n].length-1)&&(f[n]=f[n].substring(1,f[n].length-1)),e.push(this.evaluator.parser.parse(f[n]))):e.push(this.evaluator.parser.parse((b/255).toString()));this.rExpr=e[0];this.gExpr=e[1];this.bExpr=e[2];this.aExpr=e[3];this.getColor=this.getColorExpression}}else this.colorStr="rgba("+this.r+","+this.g+","+this.b+","+this.a+")",this.getColor=this.getColorString};a.Color.prototype.splitComa=function(a){g=
[];for(var b=r=d=t=0,n=a.length;b<n;b++)p=a.charAt(b),"("===p?t++:")"===p?t--:"["===p?d++:"]"===p?d--:","===p&&0===t&&0===d&&(g.push(a.substring(r,b)),r=b+1);g.push(a.substring(r));return g};a.Color.prototype.getColorString=function(){return this.colorStr};a.Color.prototype.getColorExpression=function(){k=this.evaluator;this.r=c(255*k.evalExpression(this.rExpr));this.g=c(255*k.evalExpression(this.gExpr));this.b=c(255*k.evalExpression(this.bExpr));this.a=1-k.evalExpression(this.aExpr);return"rgba("+
this.r+","+this.g+","+this.b+","+this.a+")"};a.Color.prototype.borderColor=function(){return 380>this.r+this.g+this.b?"#ffffff":"#000000"};a.RGBAToHexColor=function(b){b=b.substring(5,b.length-1).split(",");m=parseInt(b[0]).toString(16);q=parseInt(b[1]).toString(16);u=parseInt(b[2]).toString(16);n=(255-parseInt(255*parseFloat(b[3]))).toString(16);m=1==m.length?"0"+m:m;q=1==q.length?"0"+q:q;u=1==u.length?"0"+u:u;n=1==n.length?"0"+n:n;return new a.Color(n+m+q+u)};return a}(descartesJS||{}),descartesJS=
function(a){if(a.loadLib)return a;var c=document.head,k=document.createElement("meta");k.setAttribute("http-equiv","X-UA-Compatible");k.setAttribute("content","IE=edge,chrome=1");c.appendChild(k);k=document.createElement("meta");k.setAttribute("name","viewport");k.setAttribute("content","width=device-width,initial-scale=1.0,user-scalable=yes");document.querySelector("meta[name=viewport]")||c.appendChild(k);k=document.createElement("meta");k.setAttribute("name","apple-mobile-web-app-capable");k.setAttribute("content",
"yes");c.appendChild(k);k=document.createElement("meta");k.setAttribute("name","apple-mobile-web-app-status-bar-style");k.setAttribute("content","black");c.appendChild(k);(c=document.getElementById("StyleDescartesApps2"))&&c.parentNode.removeChild(c);c=document.createElement("style");c.type="text/css";c.id="StyleDescartesApps2";c.setAttribute("rel","stylesheet");document.head.appendChild(c);c.innerHTML="div.DescartesCatcher{background-color:rgba(255,255,255,0);cursor:pointer;position:absolute;}\ndiv.DescartesAppContainer{border:0 solid black;position:relative;overflow:hidden;top:0;left:0;}\ndiv.DescartesLoader{background-color:#CACACA;position:absolute;overflow:hidden;top:0;left:0;}\ndiv.DescartesLoaderImage{position:absolute;background-repeat:no-repeat;background-position:center;overflow:hidden;top:0;left:0;}\ncanvas.DescartesLoaderBar{position:absolute;overflow:hidden;top:0;left:0;}\ncanvas.DescartesSpace2DCanvas,canvas.DescartesSpace3DCanvas,div.blocker{touch-action:none;position:absolute;overflow:hidden;left:0;top:0;}\ndiv.DescartesSpace2DContainer,div.DescartesSpace3DContainer{position:absolute;overflow:hidden;line-height:0;}\ncanvas.DescartesButton{position:absolute;cursor:pointer;}\ndiv.DescartesButtonContainer{position:absolute;background-repeat:no-repeat;}\ndiv.DescartesSpinnerContainer,div.DescartesTextFieldContainer,div.DescartesMenuContainer{background:lightgray;position:absolute;overflow:hidden;}\ninput.DescartesSpinnerField,input.DescartesTextFieldField,input.DescartesMenuField,input.DescartesScrollbarField{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;font-family:descartesJS_sansserif,Arial,Helvetica,Sans-serif;padding:0;border:solid #666 1px;position:absolute;top:0;}\nlabel.DescartesSpinnerLabel,label.DescartesMenuLabel,label.DescartesScrollbarLabel,label.DescartesTextFieldLabel{font-family:descartesJS_sansserif,Arial,Helvetica,Sans-serif;font-weight:normal;text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;background-color:#e0e4e8;position:absolute;left:0;top:0;}\ndiv.DescartesGraphicControl{touch-action:none;border-style:none;position:absolute;}\ndiv.DescartesTextAreaContainer{position:absolute;overflow:hidden;background:#c0d0d8;}\nselect.DescartesMenuSelect{font-family:descartesJS_sansserif,Arial,Helvetica,Sans-serif;padding-top:0;text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;background-color:white;position:absolute;left:0;top:0;}\ndiv.DescartesScrollbarContainer{touch-action:none;background:#eee;overflow:hidden;position:absolute;}";
return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.sin,k=Math.floor,e=Math.random,f=Math.round,b=Math.abs,g=String.fromCharCode,t,d,r,p,m,q,u,n,h,v;a.Krypto=function(a){this.key=(a||0).toString()};a.Krypto.prototype.getKey=function(a){t=[];for(var d=0;256>d;d++)t[d]=g(this.alfanum(k(b(7.5*(c(1*d-a)+c(1.4*d+a)+c(.6*d-a)+c(2.2*d+a))))));return t.join("")};a.Krypto.prototype.encode=function(a){d=k(31*e());this.key=this.getKey(d);p=g(this.alfanum(d));return p+this.encripta(a)};
a.Krypto.prototype.decode=function(a){d=this.numalfa(a.charCodeAt(0));this.key=this.getKey(d);return this.desencripta(a.substring(1))};a.Krypto.prototype.encripta=function(a){return this.bytesToString(this.encriptaAux(this.stringToBytes(a)))};a.Krypto.prototype.encriptaAux=function(a){if(null==a||null==this.key)return null;q=Array(3*a.length);for(var b=0,d=a.length;b<d;b++)h=256*k(a[b]+128)+f(255*e())+65536*f(255*e()),v=k((h<<this.shift(b))/256),q[3*b]=this.alfanum(v%32),q[3*b+1]=this.alfanum(v/32%
32),q[3*b+2]=this.alfanum(v/1024%32);return q};a.Krypto.prototype.desencripta=function(a){return this.bytesToString(this.desencriptaAux(this.stringToBytes(a)))};a.Krypto.prototype.desencriptaAux=function(a){if(null==a||null==this.key)return null;u=Array(a.length/3);for(var b=0,d=u.length;b<d;b++)v=this.numalfa(a[3*b])+32*this.numalfa(a[3*b+1])+1024*this.numalfa(a[3*b+2]),h=k(256*v>>this.shift(b)),n=k(h/256)%256-128,0>n&&(n+=256),u[b]=n;return u};a.Krypto.prototype.alfanum=function(a){a=k(a);return 10>
a?48+a:87+a};a.Krypto.prototype.numalfa=function(a){return 58>a?a-48:a-87};a.Krypto.prototype.stringToBytes=function(a){p=Array(a.length);for(var b=0,d=a.length;b<d;b++)p[b]=a.charCodeAt(b);return p};a.Krypto.prototype.bytesToString=function(a){for(var b=0,d=a.length;b<d;b++)a[b]=g(a[b]);return a.join("")};a.Krypto.prototype.shift=function(a){r=this.key.charCodeAt(a%this.key.length);p=this.numalfa(r);m=k(p/2%8);0==m&&(m=4);return m};a.Krypto.prototype.parseByte=function(a){a=parseInt(a);a=0>a?0:a;
return 255<a?255:a};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.max;window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame;a.Animation=function(k,e){this.parent=k;var f=k.evaluator,b=f.parser,g=new a.Auxiliary(k);this.start=null;this.delay=e.delay?b.parse(e.delay):b.parse("60");
this.loop=e.loop?e.loop:!1;this.auto=void 0==e.auto?!0:e.auto;this.controls=e.controls;this.pause=!1;this.init=g.splitInstructions(b,e.init);this.doExpr=g.splitInstructions(b,e.doExpr);e.whileExpr&&(this.whileExpr=b.parse(e.whileExpr));var t=this,d,r,p=t.doExpr.length;this.animationExec=function(){for(r=0;r<p;r++)f.evalExpression(t.doExpr[r]);t.parent.update();t.playing&&(0<f.evalExpression(t.whileExpr)||t.loop)?(d=f.evalExpression(t.delay),window.requestAnimationFrame||(t.timer=setTimeout(t.animationExec,
c(d,10)))):(t.stop(),t.pause=!1,t.parent.update())};this.playing=!1;this.auto&&this.play()};a.Animation.prototype.play=function(){var a=this;this.playing?(this.pause=!0,this.stop()):(this.pause||this.reinit(),this.playing=!0,this.pause=!1,delay=this.parent.evaluator.evalExpression(this.delay),this.timer=window.requestAnimationFrame?requestAnimationFrame(function(e){a.step(e)}):setTimeout(this.animationExec,c(delay,10)))};a.Animation.prototype.stop=function(){this.playing=!1;window.requestAnimationFrame?
window.cancelAnimationFrame(this.timer):clearInterval(this.timer)};a.Animation.prototype.reinit=function(){for(var a=0,e=this.init.length;a<e;a++)this.parent.evaluator.evalExpression(this.init[a])};a.Animation.prototype.step=function(a){var e=this;null===e.start&&(e.start=a);delay=c(e.parent.evaluator.evalExpression(e.delay),10);a-e.start>delay&&(e.animationExec(),e.start=null);e.playing&&(e.timer=requestAnimationFrame(function(a){e.step(a)}))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
a.Action=function(a,k){this.parent=a;this.evaluator=this.parent.evaluator};a.Action.prototype.execute=function(){};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Message=function(c,k){a.Action.call(this,c,k);this.parameter=(k||"").replace(/\\n/g,"\n").replace(/&squot;/g,"'")};a.extend(a.Message,a.Action);a.Message.prototype.execute=function(){alert(this.parameter)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Calculate=function(c,k){a.Action.call(this,
c,k);var e=this.evaluator,f=e.parser;k=(k||"").replace(/&squot;/g,"'");k=k.replace(/;/g,"\\n");k=k.split("\\n")||[""];for(var b=[],g,t=0,d=k.length;t<d;t++)(g=f.parse(k[t],!0))&&b.push(g);d=b.length;this.execute=function(){for(t=0;t<d;t++)e.evalExpression(b[t])}};a.extend(a.Calculate,a.Action);return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.OpenURL=function(c,k){a.Action.call(this,c,k);this.parameter=k;this.target="_blank";var e=this.parameter.indexOf("target");-1!=e&&(this.target=
this.parameter.substring(e),this.target=this.target.substring(this.target.indexOf("=")+1),this.parameter=this.parameter.substring(0,e-1));if("javascript"==this.parameter.substring(0,10)){this.parameter=new a.SimpleText(c,this.parameter.substring(11).replace(/&squot;/g,"'"));var f=this;this.actionExec=function(){eval(f.parameter.toString())}}else"http://"!=this.parameter.substring(0,7)&&(this.parameter=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+this.parameter),this.actionExec=
function(){window.open(this.parameter,this.target)}};a.extend(a.OpenURL,a.Action);a.OpenURL.prototype.execute=function(){this.actionExec()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.OpenScene=function(c,k){a.Action.call(this,c,k);this.parameter=k;this.target="_blank";var e=this.parameter.indexOf("target");-1!=e&&(this.target=this.parameter.substring(e),this.target=this.target.substring(this.target.indexOf("=")+1),this.parameter=this.parameter.substring(0,e-1));"_blank"!==
this.target&&"_parent"!==this.target&&"_self"!==this.target&&"_top"!==this.target?this.actionExec=function(){window.parent.postMessage({type:"changeTarget",name:this.target,value:this.parameter},"*")}:"javascript"==this.parameter.substring(0,10)?(this.parameter=this.parameter.substring(11).replace(/&squot;/g,"'"),this.actionExec=function(){eval(this.parameter)}):("http://"!=this.parameter.substring(0,7)&&(this.parameter=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+this.parameter),
this.actionExec=function(){window.open(this.parameter,this.target,"width="+this.parent.width+",height="+this.parent.height+",left="+(window.screen.width-this.parent.width)/2+", top="+(window.screen.height-this.parent.height)/2+"location=0,menubar=0,scrollbars=0,status=0,titlebar=0,toolbar=0")})};a.extend(a.OpenScene,a.Action);a.OpenScene.prototype.execute=function(){this.actionExec()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.About=function(c,k){a.Action.call(this,
c,k);k||(this.urlAbout=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+k)};a.extend(a.About,a.Action);a.About.prototype.execute=function(){if(this.urlAbout)var a=window.open(this.urlAbout,"_blank","width=800px,height=600px,location=no,menubar=no,scrollbars=yes");else a=window.open("about:blank","_blank","width=800px,height=600px,location=no,menubar=no,scrollbars=yes"),a.document.write("<hmtl><head><title>Cr\u00e9ditos</title></head><body><h1>Aqu\u00ed van los cr\u00e9ditos</h1></body></html>")};
return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Config=function(c,k){a.Action.call(this,c,k)};a.extend(a.Config,a.Action);a.Config.prototype.execute=function(){this.parent.editor?this.parent.editor.show():window.open("about:blank","_blank","width=800px,height=600px,location=no,menubar=no,scrollbars=yes").document.write("<xmp style='width:100%; height:100%;'><script type='text/javascript' src='http://arquimedes.matem.unam.mx/Descartes5/lib/descartes-min.js'>\x3c/script>\n"+
this.parent.applet.outerHTML.replace(/<applet/g,"<ajs").replace(/<\/applet/g,"</ajs")+"</xmp>")};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Init=function(c,k){a.Action.call(this,c,k)};a.extend(a.Init,a.Action);a.Init.prototype.execute=function(){this.parent.init()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Clear=function(c,k){a.Action.call(this,c,k)};a.extend(a.Clear,a.Action);a.Clear.prototype.execute=function(){this.parent.clear()};
return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Animate=function(c,k){a.Action.call(this,c,k)};a.extend(a.Animate,a.Action);a.Animate.prototype.execute=function(){this.parent.play()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.InitAnimation=function(c,k){a.Action.call(this,c,k)};a.extend(a.InitAnimation,a.Action);a.InitAnimation.prototype.execute=function(){this.parent.reinitAnimation()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
var c=/[\w\.\-//]*(\.ogg|\.oga|\.mp3|\.wav|\.OGG|\.OGA\.MP3|\.WAV)/g;a.PlayAudio=function(k,e){a.Action.call(this,k,e);e&&e.match(c)?this.filenameExpr=this.evaluator.parser.parse("'"+e.match(c)+"'"):this.filenameExpr=this.evaluator.parser.parse(e)};a.extend(a.PlayAudio,a.Action);a.PlayAudio.prototype.execute=function(){var a=this.theAudio=this.parent.getAudio(this.evaluator.evalExpression(this.filenameExpr));a.paused?a.play():(a.pause(),a.currentTime=0)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
a.Auxiliary=function(a,f){this.parent=a;this.evaluator=this.parent.evaluator;this.expresion=this.id="";this.evaluate="onlyOnce";this.local="";for(var b in f)f.hasOwnProperty(b)&&(this[b]=f[b])};a.Auxiliary.prototype.firstRun=function(){};a.Auxiliary.prototype.update=function(){};var c,k;a.Auxiliary.prototype.splitInstructions=function(a,f){k=[];f=f?f.split(";"):[""];for(var b=0,g=f.length;b<g;b++)(c=a.parse(f[b],!0))&&k.push(c);return k};a.Auxiliary.prototype.getPrivateVariables=function(a,f){k=[];
f=f?f.split(/;|,/):[""];for(var b=0,g=f.length;b<g;b++)(c=a.parse(f[b],!0))&&k.push(c);b=0;for(g=k.length;b<g;b++)k[b]="asign"===k[b].type?k[b].childs[0].value:"identifier"===k[b].type?k[b].value:"";return k};a.Auxiliary.prototype.parseExpressions=function(a){this.init=this.splitInstructions(a,this.init);this.privateVars=this.getPrivateVariables(a,this.local);this.doExpr=this.splitInstructions(a,this.doExpr);this.whileExpr=a.parse(this.whileExpr)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
a.Variable=function(c,k){a.Auxiliary.call(this,c,k);var e=this.evaluator.parser;this.expresionString=this.expresion;(this.expresion=e.parse(this.expresionString))&&e.setVariable(this.id,this.expresion);this.editable&&(this.registerTextField(),this.parent.editableRegionVisible=!0)};a.extend(a.Variable,a.Auxiliary);a.Variable.prototype.registerTextField=function(){var a=document.createElement("div"),k=document.createElement("label");k.appendChild(document.createTextNode("___"+this.id+"=___"));var e=
document.createElement("input");e.value=this.expresionString;e.disabled=!this.editable;a.appendChild(k);a.appendChild(e);var f=this,b=f.evaluator.parser;e.onkeydown=function(a){13==a.keyCode&&(f.expresion=b.parse(this.value),b.setVariable(f.id,f.expresion),f.parent.update())};this.parent.editableRegion.textFields.push({container:a,type:"div"})};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Constant=function(c,k){a.Auxiliary.call(this,c,k);this.expresion=this.evaluator.parser.parse(this.expresion);
this.update()};a.extend(a.Constant,a.Auxiliary);a.Constant.prototype.update=function(){this.evaluator.setVariable(this.id,this.evaluator.evalExpression(this.expresion))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e;a.Vector=function(f,b){c=f.evaluator;k=c.parser;this.size=k.parse("3");a.Auxiliary.call(this,f,b);this.expresion=this.expresion.split(";");this.parseFile=k.parse(this.file);this.update()};a.extend(a.Vector,a.Auxiliary);a.Vector.prototype.update=function(){var f=
this.expresion;c=this.evaluator;k=c.parser;this.oldFile=this.file;if(e=c.evalExpression(this.parseFile))this.file=e;var b;if(this.file){b=(vectorElement=document.getElementById(this.file))&&"descartes/vectorFile"==vectorElement.type?vectorElement.text:a.openExternalFile(this.file);if(null!=b){b=b.replace(/\r/g,"").split("\n");for(var g=[],t=0,d=b.length;t<d;t++)""!=b[t]&&g.push(b[t]);b=g}null==b||1==b.length&&""==b[0]?this.size=k.parse("0"):(f=b,this.size=null);null===this.size&&(this.size=k.parse(f.length+
""))}b=[];t=0;for(d=f.length;t<d;t++)(g=k.parse(f[t],!0))&&"asign"!=g.type&&(g=k.parse(this.id+"["+t+"]="+f[t],!0)),b.push(g);f=[];f._size_=c.evalExpression(this.size);t=0;for(d=this._size_;t<d;t++)f.push(0);c.vectors[this.id]=f;c.setVariable(this.id+".long",f._size_);t=0;for(d=b.length;t<d;t++)c.evalExpression(b[t])};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Matrix=function(c,k){var e=c.evaluator,f=e.parser;this.rows=f.parse("3");this.columns=f.parse("3");a.Auxiliary.call(this,
c,k);this.expresion=this.splitInstructions(f,this.expresion);var f=e.evalExpression(this.rows),b=e.evalExpression(this.columns),g=[];g.type="matrix";for(var t,d=0;d<b;d++){t=[];for(var r=0,p=f;r<p;r++)t.push(0);g[d]=t}e.matrices[this.id]=g;this.update()};a.extend(a.Matrix,a.Auxiliary);a.Matrix.prototype.update=function(){var a=this.evaluator,k=a.evalExpression(this.rows),e=a.evalExpression(this.columns);a.setVariable(this.id+".filas",k);a.setVariable(this.id+".columnas",e);var f=a.matrices[this.id];
f.rows=k;f.cols=e;k=0;for(e=this.expresion.length;k<e;k++)a.evalExpression(this.expresion[k])};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Function=function(c,k){a.Auxiliary.call(this,c,k);var e=this.evaluator,f=e.parser,b=this.id.indexOf("(");this.name=this.id.substring(0,b);this.params=this.id.substring(b+1,this.id.indexOf(")"));this.domain=this.range?f.parse(this.range):f.parse("1");this.params=""==this.params?[]:this.params.split(",");this.numberOfParams=this.params.length;
this.algorithm||(this.whileExpr=this.doExpr=this.init="");this.parseExpressions(f);this.expresion=f.parse(this.expresion);var g=this;this.functionExec=function(){this.iterations=0;if(g.numberOfParams<=arguments.length){for(var b=[],d=0,f=g.privateVars.length;d<f;d++)b.push(e.getVariable(g.privateVars[d])),e.setVariable(g.privateVars[d],0);for(var c=[],d=0,f=g.params.length;d<f;d++)c[d]=e.getVariable(g.params[d])||0,e.setVariable(g.params[d],arguments[d]);d=0;for(f=g.init.length;d<f;d++)e.evalExpression(g.init[d]);
do{d=0;for(f=g.doExpr.length;d<f;d++)e.evalExpression(g.doExpr[d]);if(1E5<++this.iterations)return console.log("se ha excedido el l\u00edmite de 100000 repeticiones en la funci\u00f3n << "+g.name+" >>"),0}while(0<e.evalExpression(g.whileExpr));var m=e.evalExpression(g.expresion);a.rangeOK=e.evalExpression(g.domain);d=0;for(f=g.params.length;d<f;d++)e.setVariable(g.params[d],c[d]);d=0;for(f=g.privateVars.length;d<f;d++)e.setVariable(g.privateVars[d],b[d]);return m}return 0};e.setFunction(this.name,
this.functionExec)};a.extend(a.Function,a.Auxiliary);return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Algorithm=function(c,k){a.Auxiliary.call(this,c,k);var e=this.evaluator;this.parseExpressions(e.parser);this.algorithmExec=function(){for(var a=this.iterations=0,b=this.init.length;a<b;a++)e.evalExpression(this.init[a]);do{a=0;for(b=this.doExpr.length;a<b;a++)e.evalExpression(this.doExpr[a]);if(1E5<++this.iterations)return console.log("se ha excedido el l\u00edmite de 100000 repeticiones en el algoritmo << "+
self.name+" >>"),0}while(0<e.evalExpression(this.whileExpr))}};a.extend(a.Algorithm,a.Auxiliary);a.Algorithm.prototype.update=function(){this.algorithmExec();"onlyOnce"===this.evaluate&&(this.update=function(){})};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Event=function(c,k){a.Auxiliary.call(this,c,k);var e=this.evaluator;delete this.evaluate;this.condition=e.parser.parse(this.condition);this.lastEvaluation=!1;this.action=this.parent.lessonParser.parseAction(this);
"onlyOnce"==this.execution&&(this.eventExec=function(){0<this.evaluator.evalExpression(this.condition)&&!this.lastEvaluation&&(this.lastEvaluation=!0,this.action.execute())});"alternate"==this.execution&&(this.eventExec=function(){var a=0<this.evaluator.evalExpression(this.condition);3==this.parent.version?a!=this.lastEvaluation&&(this.action.execute(),this.lastEvaluation=a?!0:!1):a&&!this.lastEvaluation?(this.action.execute(),this.lastEvaluation=!0):!a&&this.lastEvaluation&&(this.lastEvaluation=
!1)});"always"==this.execution&&(this.eventExec=function(){0<this.evaluator.evalExpression(this.condition)&&this.action.execute()})};a.extend(a.Event,a.Auxiliary);a.Event.prototype.update=function(){this.eventExec()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b;a.Graphic=function(b,f){this.parent=b;this.evaluator=b.evaluator;var d=this.evaluator.parser;this.spaceID="";this.background=!1;this.type="";this.drawif=d.parse("1");this.abs_coord=!1;this.color=new a.Color("blue");
2!==this.parent.version&&(this.color=new a.Color("20303a"),this.parent.arquimedes&&(this.color=new a.Color("black")));this.trace="";this.expresion=d.parse("(0,0)");this.family="";this.family_interval=d.parse("[0,1]");this.family_steps=d.parse("8");this.editable=!1;this.font="Monospaced,PLAIN,"+(5<=this.parent.version?"15":"12");this.fixed=!0;this.text="";this.decimals=d.parse("2");for(var e in f)f.hasOwnProperty(e)&&(this[e]=f[e]);this.space=this.getSpace();this.canvas=this.background?this.space.backgroundCanvas:
this.space.canvas;this.ctx=this.canvas.getContext("2d");this.trace&&(this.traceCtx=this.space.backgroundCanvas.getContext("2d"));this.font=a.convertFont(this.font);this.fontSize=(this.fontSize=this.font.match(/([\d\.]+)px/))?parseFloat(this.fontSize[1]):10};a.Graphic.prototype.getSpace=function(){for(var a=this.parent.spaces,b,d=0,f=a.length;d<f;d++)if(b=a[d],b.id==this.spaceID)return b;return a[0]};a.Graphic.prototype.getFamilyValues=function(){c=this.evaluator;k=c.evalExpression(this.family_interval);
this.familyInf=k[0][0];this.familySup=k[0][1];this.fSteps=Math.round(c.evalExpression(this.family_steps));this.family_sep=0<this.fSteps?(this.familySup-this.familyInf)/this.fSteps:0};a.Graphic.prototype.drawFamilyAux=function(a,b,d){c=this.evaluator;this.getFamilyValues();e=c.getVariable(this.family);if(0<=this.fSteps)for(var f=0,p=this.fSteps;f<=p;f++)c.setVariable(this.family,this.familyInf+f*this.family_sep),0<c.evalExpression(this.drawif)&&(this.update(),this.drawAux(a,b,d));c.setVariable("_Text_H_",
0);c.setVariable(this.family,e)};a.Graphic.prototype.draw=function(a,b){""!=this.family?this.drawFamilyAux(this.ctx,a,b):0<this.evaluator.evalExpression(this.drawif)&&(this.update(),this.drawAux(this.ctx,a,b))};a.Graphic.prototype.drawTrace=function(a,b){""!=this.family?this.drawFamilyAux(this.traceCtx,a,b):0<this.evaluator.evalExpression(this.drawif)&&(this.update(),this.drawAux(this.traceCtx,a,b))};a.Graphic.prototype.drawText=function(a,e,d,r,p,m,k,u,n,h,v){if("rtfNode"===e.type)a.fillStyle=p.getColor(),
a.strokeStyle=p.getColor(),a.textBaseline="alphabetic",e.draw(a,d,r+1,n,h,k,v,p.getColor());else for("simpleText"===e.type&&(e=e.toString(n,h).split("\\n")),d+=m.match("Arial")?-2:m.match("Times")?-2:0,c=this.evaluator,a.fillStyle=p.getColor(),a.font=m,a.textAlign=k,a.textBaseline=u,this.border&&(a.strokeStyle=this.border.getColor(),a.lineWidth=4),b=1.2*this.fontSize||0,p=0,m=e.length;p<m;p++)f=e[p],this.border&&(a.lineJoin="round",a.miterLimit=2,a.strokeText(f,d,r+b*p)),a.fillText(f,d,r+b*p)};return a}(descartesJS||
{}),descartesJS=function(a){if(a.loadLib)return a;a.SimpleText=function(a,f){this.text=f=f.replace("&#x2013","\u2013").replace(/\&squot;/g,"'");this.textElements=[];this.textElementsMacros=[];this.parent=a;this.evaluator=a.evaluator;this.type="simpleText";for(var b="'",g=0,c=0,d=-1,r,p;g<f.length;)r=f.charAt(g),p=f.charAt(g-1),"["===r&&"\\"===p?(this.textElements.push(f.substring(c,g-1)+"["),this.textElementsMacros.push("'"+f.substring(c,g-1)+"['"),c=g+1):"]"===r&&"\\"===p?(this.textElements.push(f.substring(c,
g-1)+"]"),this.textElementsMacros.push("'"+f.substring(c,g-1)+"]'"),c=g+1):"["===r&&-1===d?(this.textElements.push(f.substring(c,g)),this.textElementsMacros.push("'"+f.substring(c,g)+"'"),c=g,d++):"["===r?d++:"]"===r&&0===d?(this.textElements.push(this.evaluator.parser.parse(f.substring(c,g+1))),this.textElementsMacros.push("["+f.substring(c,g+1)+"]"),c=g+1,d--):("]"==f.charAt(g)&&(d=0>d?d:d-1),b+=f.charAt(g)),g++;this.textElements.push(f.substring(c,g));this.textElementsMacros.push("'"+f.substring(c,
g)+"'")};var c,k;a.SimpleText.prototype.toString=function(e,f){c="";for(var b=0,g=this.textElements.length;b<g;b++)"string"===typeof this.textElements[b]?c+=this.textElements[b]:(k=this.evaluator.evalExpression(this.textElements[b])[0][0],""!==k&&("string"===typeof k?c+=k:(k=parseFloat(k),k=f?k.toFixed(e):a.removeNeedlessDecimals(k.toFixed(e)),c+=k.toString().replace(".",this.parent.decimal_symbol))));return c};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b,
g,t,d,r,p,m,q,u,n,h,v,l,w,y,C,D,z,F,H,I,A,G;a._debug_vez=0;a.Equation=function(b,d){this.width=b.evaluator.parser.parse("1");this.fillM=this.fillP="";a.Graphic.call(this,b,d);this.parseExpression();(this.visible=2===this.parent.version&&void 0==this.visible?!0:this.visible)&&this.registerTextField();q=new a.R2;u=new a.R2;n=new a.R2;l=new a.R2;h=new a.R2;this.cInd=0};a.extend(a.Equation,a.Graphic);a.Equation.prototype.parseExpression=function(){if("compOperator"===this.expresion.type){var b=this.expresion.childs[0],
d=this.expresion.childs[1];"identifier"!=b.type||"y"!=b.value||d.contains("y")?"identifier"!=d.type||"y"!=d.value||b.contains("y")?"identifier"!=b.type||"x"!=b.value||d.contains("x")?"identifier"!=d.type||"x"!=d.value||b.contains("x")||(this.of_y=!0,this.funExpr=d,this.drawAux=this.drawAuxFun):(this.funExpr=d,this.of_y=!0,this.drawAux=this.drawAuxFun):(this.funExpr=b,this.of_y=!1,this.drawAux=this.drawAuxFun):(this.funExpr=d,this.of_y=!1,this.drawAux=this.drawAuxFun)}this.newt=new a.R2Newton(this.evaluator,
this.expresion)};a.Equation.prototype.update=function(){};a.Equation.prototype.draw=function(){""!=this.family?this.drawFamilyAux(this.ctx,this.fill,this.color):(this.update(),this.drawAux(this.ctx,this.fill,this.color))};a.Equation.prototype.drawFamilyAux=function(a,b,d){k=this.evaluator;this.getFamilyValues();tempParam=k.getVariable(this.family);if(0<=this.fSteps)for(var n=0,h=this.fSteps;n<=h;n++)k.setVariable(this.family,this.familyInf+n*this.family_sep),this.update(),this.drawAux(a,b,d);k.setVariable(this.family,
tempParam)};a.Equation.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.fill,this.trace)};var B,K,E,x,L,J,M;a.Equation.prototype.drawAux=function(N,O,S){if(!(0>=this.evaluator.evalExpression(this.drawif))){k=this.evaluator;e=k.parser;f=this.space;b=k.evalExpression(this.width);N.strokeStyle=this.color.getColor();N.lineWidth=b;g=e.getVariable("x");t=e.getVariable("y");d=f.w+24;r=f.h+24;p=d/9;3>p&&(p=3);m=r/7;3>m&&(m=3);0==this.cInd?(c=[],this.cInd++):this.cInd=(this.cInd+1)%1E5;q.set(0,
0);u.set(0,0);n.set(0,0);J=.25;M=8;this.abs_coord||(J/=f.scale,M/=f.scale);N.beginPath();for(G=parseInt(m/2);G<r;G+=m)for(A=parseInt(p/2);A<d;A+=p){if(this.abs_coord){l.set(A,G);v=this.newt.findZero(l,J);if(null==v)continue;k.setVariable("x",v.x);k.setVariable("y",v.y);h.set(v.x,v.y)}else{l.set(f.getRelativeX(A),f.getRelativeY(G));v=this.newt.findZero(l,J);if(null==v)continue;k.setVariable("x",v.x);k.setVariable("y",v.y);h.set(f.getAbsoluteX(v.x),f.getAbsoluteY(v.y))}w=h.ix();y=h.iy();if(-12<=w&&
w<d+24&&-12<=y&&y<r+24){if(c[w+12+(y+12)*f.w]===this.cInd)continue;c[w+12+(y+12)*f.w]=this.cInd}a.rangeOK&&(N.moveTo(w,y),N.lineTo(w,y));q.x=v.x;q.y=v.y;u.x=v.x;u.y=v.y;C=this.newt.getUnitNormal();if(0!=C.x||0!=C.y)for(C.rotL90(),n.x=C.x,n.y=C.y,z=D=0,F=!1;2>z;)if(F&&(n.x=-C.x,n.y=-C.y,v.x=q.x,v.y=q.y,u.x=v.x,u.y=v.y,this.abs_coord?h.set(v.x,v.y):h.set(f.getAbsoluteX(v.x),f.getAbsoluteY(v.y)),w=h.ix(),y=h.iy(),F=!1,D=0),v.x+=M*n.x,v.y+=M*n.y,v=this.newt.findZero(v,J),null!=v){k.setVariable("x",v.x);
k.setVariable("y",v.y);n.x=v.x-u.x;n.y=v.y-u.y;n.normalize();if(0==n.x&&0==n.y)break;u.x=v.x;u.y=v.y;this.abs_coord?h.set(v.x,v.y):h.set(f.getAbsoluteX(v.x),f.getAbsoluteY(v.y));H=parseInt(h.ix());I=parseInt(h.iy());if(H!=w||I!=y)if(B=w,K=y,w=H,y=I,-12<=w&&w<d+24&&-12<=y&&y<r+24){D=0;E=c[w+12+(y+12)*f.w];c[w+12+(y+12)*f.w]=this.cInd;for(O=1;8>O;O++)x=B+Math.round((w-B)*O/8),L=K+Math.round((y-K)*O/8),0<=x&&x<d&&0<=L&&L<r&&(c[x+12+(L+12)*f.w]=this.cInd);a.rangeOK&&(N.moveTo(B,K),N.lineTo(w,y));if(E===
this.cInd)break}else F=!0,z++;else 4<++D&&(F=!0,z++)}}N.stroke()}};a.Equation.prototype.X=function(a,b,d){d||(b=this.space.w/2+this.space.Ox+this.space.scale*b);b<-a&&(b=-a);b>this.space.w+a&&(b=this.space.w+a);return b};a.Equation.prototype.Y=function(a,b,d){d||(b=this.space.h/2+this.space.Oy-this.space.scale*b);b<-a&&(b=-a);b>this.space.h+a&&(b=this.space.h+a);return b};a.Equation.prototype.XX=function(a,b,d){return Math.round(this.X(a,b,d))};a.Equation.prototype.YY=function(a,b,d){return Math.round(this.Y(a,
b,d))};a.Equation.prototype.extrapolate=function(b,d,n,h,f,g){for(var e=this.evaluator.getVariable(d),c=g/2,p=0,m,r,l,k,t,q;1E-15<Math.abs(c);){m=this.evaluator.getVariable(d);r=this.evaluator.getVariable(d)+c;this.evaluator.setVariable(d,r);l=!0;try{k=f,f=this.evaluator.evalExpression(this.funExpr),this.evaluator.setVariable(n,f),0<this.evaluator.evalExpression(b)?(t=new a.R2(Math.min(k,f),Math.max(k,f)),q=0,q=0<g?this.Singularity(Math.abs(c),d,h,m,k,r,f,t):this.Singularity(Math.abs(c),d,h,r,f,m,
k,t),0<q&&(l=!1)):l=!1}catch(v){l=!1}l?p+=c:this.evaluator.setVariable(d,m);c/=2}this.evaluator.setVariable(d,e);return new a.R2(p/Math.abs(g),f)};a.Equation.prototype.extrapolateOnSingularity=function(b,d,n,h,f,c){h=this.evaluator.getVariable(d);for(var g=c/2,e=0,p=f,m;1E-15<Math.abs(g);){this.evaluator.setVariable(d,this.evaluator.getVariable(d)+g);m=!0;if(0<this.evaluator.evalExpression(b))try{p=this.evaluator.evalExpression(this.funExpr),this.evaluator.setVariable(n,p),0>=this.evaluator.evalExpression(b)&&
(m=!1)}catch(r){m=!1}else m=!1;m?e+=g:this.evaluator.setVariable(d,this.evaluator.getVariable(d)-g);g/=2}if(0==e)for(g=c/2,e=c,p=f;1E-15<Math.abs(g);){this.evaluator.setVariable(d,this.evaluator.getVariable(d)-g);m=!0;if(0<this.evaluator.evalExpression(b))try{p=this.evaluator.evalExpression(this.funExpr)}catch(r){m=!1}else m=!1;m?e+=-g:this.evaluator.setVariable(d,this.evaluator.getVariable(d)+g);g/=2}this.evaluator.setVariable(d,h);return new a.R2(e/Math.abs(c),p)};a.Equation.prototype.Singularity=
function(a,b,d,n,h,g,f,c){if(isNaN(f)||isNaN(h)||isNaN(c.y)||isNaN(c.x)||n>=g)return 2;var e=this.evaluator.getVariable(b),p=0;try{if(1E-15>Math.abs(g-n)||1E-12>Math.abs(g-n)&&Math.abs(f-h)>Math.abs(a))return this.evaluator.setVariable(b,e),1;var m=(n+g)/2;this.evaluator.setVariable(b,m);var r=NaN;try{r=this.evaluator.evalExpression(this.funExpr)}catch(l){return 2}if(isNaN(r))return 2;if(Math.abs(f-h)>a){this.evaluator.setVariable(b,n-1E-12);var k=this.evaluator.evalExpression(this.funExpr),k=(h-
k)/1E-12;this.evaluator.setVariable(b,g+1E-12);var t=(this.evaluator.evalExpression(this.funExpr)-f)/1E-12;if((10>Math.abs(t)||10>Math.abs(k))&&(0<=t&&0<=k||0>=t&&0>=k)&&4*Math.abs(t)<Math.abs((f-h)/(g-n)))return this.evaluator.setVariable(b,e),2}if(isNaN(c.x)||isNaN(c.y)||isNaN(r))return 2;if(!(c.x<=r&&r<=c.y)){this.evaluator.setVariable(b,m);c.x=Math.min(h,r);c.y=Math.max(h,r);var q=this.Singularity(a/2,b,d,n,h,m,r,c);this.evaluator.setVariable(b,g);c.x=Math.min(f,r);c.y=Math.max(f,r);var v=this.Singularity(a/
2,b,d,m,r,g,f,c),p=Math.max(q,v)}}catch(l){p=1}this.evaluator.setVariable(b,e);return p};a.Equation.prototype.drawAuxFun=function(b,d,n){g=this.evaluator.parser.getVariable("x");t=this.evaluator.parser.getVariable("y");a.rangeOK=1;d="x";n="y";this.of_y&&(d="y",n="x");var h=this.drawif,c=this.evaluator.evalExpression(this.width),f=!1,e=new a.R2(this.space.w/2+this.space.Ox,this.space.h/2+this.space.Oy),e=this.of_y?e.ix():e.iy(),p=0,m=0,r=0,l=0,k=1/this.space.scale,q=k*(this.of_y?Math.ceil(-this.space.h+
(this.space.h/2+this.space.Oy)):-Math.ceil(this.space.w/2+this.space.Ox)),v=0;this.abs_coord&&(q=0,k=1);for(var u,y,G,w,D,J,B,x,A,C=this.of_y?this.space.h+4:this.space.w+4;r<=C;){u=!0;y=0;this.evaluator.setVariable(d,q);try{G=this.evaluator.evalExpression(this.funExpr),isNaN(G)||(this.evaluator.setVariable(n,G),0<this.evaluator.evalExpression(this.drawif)&&a.rangeOK?(f?(w=Math.min(v,G),D=Math.max(v,G),J=new a.R2(w,D),y=this.Singularity(k,d,0,q-k,v,q,G,J),0===y?(v<=G?(v=J.x,G=J.y):(G=J.x,v=J.y),B=
parseInt(this.of_y?this.XX(c,v,this.abs_coord):this.YY(c,v,this.abs_coord)),p=this.abs_coord?Math.round(G):parseInt(this.of_y?this.XX(c,G,this.abs_coord):this.YY(c,G,this.abs_coord)),this.fillM&&p>e&&(b.lineWidth=1,b.strokeStyle=this.fillM.getColor(),b.beginPath(),this.of_y?(b.moveTo(e+1,this.space.h-r+.5),b.lineTo(p,this.space.h-r+.5)):(b.moveTo(r+.5,e+1),b.lineTo(r+.5,p)),b.stroke()),this.fillP&&p<e&&(b.lineWidth=1,b.strokeStyle=this.fillP.getColor(),b.beginPath(),this.of_y?(b.moveTo(e-1,this.space.h-
r+.5),b.lineTo(p,this.space.h-r+.5)):(b.moveTo(r+.5,e-1),b.lineTo(r+.5,p)),b.stroke()),b.lineWidth=c,b.strokeStyle=this.color.getColor(),b.beginPath(),this.of_y?(b.moveTo(B+.5,this.space.h-l),b.lineTo(p+.5,this.space.h-r)):(b.moveTo(l+.5,B),b.lineTo(r+.5,p))):1===y?(this.evaluator.setVariable(d,q-k),x=this.extrapolate(h,d,n,0,v,k),p=parseInt(this.of_y?this.XX(c,x.y,this.abs_coord):this.YY(c,x.y,this.abs_coord)),b.lineWidth=c,b.strokeStyle=this.color.getColor(),b.beginPath(),this.of_y?(b.moveTo(m+
.5,this.space.h-l),b.lineTo(p+.5,this.space.h-l+Math.round(x.x))):(b.moveTo(l+.5,m),b.lineTo(l+Math.round(x.x)+.5,p)),this.evaluator.setVariable(d,q),A=this.extrapolate(h,d,n,0,G,-k),m=this.YY(c,A.y,this.abs_coord),p=this.YY(c,G,this.abs_coord),b.lineWidth=c,b.strokeStyle=this.color.getColor(),b.beginPath(),this.of_y?(b.moveTo(m+.5,this.space.h-r),b.lineTo(p+.5,this.space.h-r)):(b.moveTo(r+.5,m),b.lineTo(r+.5,p))):(p=parseInt(this.of_y?this.XX(c,G,this.abs_coord):this.YY(c,G,this.abs_coord)),b.lineWidth=
c,b.strokeStyle=this.color.getColor(),b.beginPath(),this.of_y?(b.moveTo(p+.5,this.space.h-r),b.lineTo(p+.5,this.space.h-r)):(b.moveTo(r+.5,p),b.lineTo(r+.5,p)))):(A=this.extrapolateOnSingularity(h,d,n,0,G,-k),m=this.of_y?this.XX(c,A.y,this.abs_coord):this.YY(c,A.y,this.abs_coord),p=parseInt(this.of_y?this.XX(c,G,this.abs_coord):this.YY(c,G,this.abs_coord)),b.lineWidth=c,b.strokeStyle=this.color.getColor(),b.beginPath(),this.of_y?(b.moveTo(m,this.space.h-(r+Math.round(A.x))+.5),b.lineTo(p,this.space.h-
r+.5)):(b.moveTo(r+Math.round(A.x),m),b.lineTo(r,p))),b.stroke(),v=G):u=!1)}catch(z){u=!1}f&&!u&&(this.evaluator.setVariable(d,q-k),this.evaluator.setVariable(n,v),x=this.extrapolate(h,d,n,0,v,k),p=parseInt(this.of_y?this.XX(c,x.y,this.abs_coord):this.YY(c,x.y,this.abs_coord)),b.lineWidth=c,b.strokeStyle=this.color.getColor(),b.beginPath(),this.of_y?(b.moveTo(m,this.space.h-(l+Math.round(x.x))+.5),b.lineTo(p,this.space.h-(l+Math.round(x.x))+.5)):(b.moveTo(l+Math.round(x.x)+.5,m),b.lineTo(l+Math.round(x.x)+
.5,p)),b.stroke(),this.evaluator.setVariable(d,q));f=u;q+=k;m=p;l=r++}this.evaluator.parser.setVariable("x",g);this.evaluator.parser.setVariable("y",t)};a.Equation.prototype.registerTextField=function(){var a=document.createElement("input");a.value=this.expresionString;a.disabled=!this.editable;var b=this;a.onkeydown=function(a){13==a.keyCode&&(b.expresion=b.evaluator.parser.parse(this.value),b.parseExpression(),b.parent.update())};this.parent.editableRegion.textFields.push(a)};return a}(descartesJS||
{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.round;a.Curve=function(b,d){this.parameter="t";this.parameter_interval=b.evaluator.parser.parse("[0,1]");this.parameter_steps=b.evaluator.parser.parse("8");this.width=b.evaluator.parser.parse("1");this.fill="";a.Graphic.call(this,b,d);(this.visible=2==this.parent.version&&void 0==this.visible?!0:!1)&&this.registerTextField()};a.extend(a.Curve,a.Graphic);var k,e,f,b,g,t,d,r,p,m,q;a.Curve.prototype.update=function(){k=this.evaluator;e=k.evalExpression(this.parameter_interval);
this.paraInf=e[0][0];this.paraSup=e[0][1];this.pSteps=k.evalExpression(this.parameter_steps);this.paraSep=0<this.pSteps?Math.abs(this.paraSup-this.paraInf)/this.pSteps:0};a.Curve.prototype.draw=function(){this.uber.draw.call(this,this.fill,this.color)};a.Curve.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.fill,this.trace)};a.Curve.prototype.drawAux=function(e,n,h){k=this.evaluator;f=this.space;b=c(k.evalExpression(this.width));e.lineWidth=0<b?b:1E-6;e.lineCap="round";e.lineJoin=
"round";e.strokeStyle=h.getColor();g=k.getVariable(this.parameter);e.beginPath();k.setVariable(this.parameter,this.paraInf);t=k.evalExpression(this.expresion);this.exprX=this.abs_coord?c(t[0][0]):c(f.getAbsoluteX(t[0][0]));this.exprY=this.abs_coord?c(t[0][1]):c(f.getAbsoluteY(t[0][1]));this.rotateExp&&(d=a.degToRad(k.evalExpression(this.rotateExp)),r=Math.cos(d),p=Math.sin(d),m=this.exprX*r-this.exprY*p,q=this.exprX*p+this.exprY*r,this.exprX=m,this.exprY=q);e.moveTo(this.exprX+.5,this.exprY+.5);for(h=
1;h<=this.pSteps;h++)k.setVariable(this.parameter,this.paraInf+h*this.paraSep),t=k.evalExpression(this.expresion),this.exprX=this.abs_coord?c(t[0][0]):c(f.getAbsoluteX(t[0][0])),this.exprY=this.abs_coord?c(t[0][1]):c(f.getAbsoluteY(t[0][1])),this.rotateExp&&(m=this.exprX*r-this.exprY*p,q=this.exprX*p+this.exprY*r,this.exprX=m,this.exprY=q),e.lineTo(this.exprX+.5,this.exprY+.5);this.fill&&(e.fillStyle=n.getColor(),e.fill("evenodd"));e.stroke();k.setVariable(this.parameter,g)};a.Curve.prototype.registerTextField=
function(){var a=document.createElement("input");a.value=this.expresionString;a.disabled=!this.editable;var b=this;a.onkeydown=function(a){13==a.keyCode&&(b.expresion=b.evaluator.parser.parse(this.value),b.parent.update())};this.parent.editableRegion.textFields.push(a)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=2*Math.PI,k=Math.round,e,f,b,g,t,d,r,p,m,q,u,n,h,v;a.Sequence=function(b,d){this.size=b.evaluator.parser.parse("2");this.range=b.evaluator.parser.parse("[1, 100]");
a.Graphic.call(this,b,d)};a.extend(a.Sequence,a.Graphic);a.Sequence.prototype.update=function(){e=this.evaluator;b=e.evalExpression(this.expresion);this.exprX=b[0][0];this.exprY=b[0][1];this.rotateExp&&(g=a.degToRad(e.evalExpression(this.rotateExp)),t=Math.cos(g),d=Math.sin(g),r=this.exprX*t-this.exprY*d,p=this.exprX*d+this.exprY*t,this.exprX=r,this.exprY=p);u=e.evalExpression(this.range);this.rangeInf=u[0][0];this.rangeMax=u[0][1]};a.Sequence.prototype.draw=function(){this.uber.draw.call(this,this.color,
this.color)};a.Sequence.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Sequence.prototype.drawAux=function(a,d){e=this.evaluator;f=this.space;h=n=Math.ceil(e.evalExpression(this.size)-.4);a.fillStyle=d.getColor();a.beginPath();this.rangeInf>this.rangeMax&&(v=this.rangeInf,this.rangeInf=this.rangeMax,this.rangeMax=v);for(var g=e.getVariable("n"),p=this.rangeInf,r=this.rangeMax;p<=r;p++)e.setVariable("n",p),b=e.evalExpression(this.expresion),this.exprX=b[0][0],
this.exprY=b[0][1],m=this.abs_coord?k(this.exprX):k(f.getAbsoluteX(this.exprX)),q=this.abs_coord?k(this.exprY):k(f.getAbsoluteY(this.exprY)),a.beginPath(),a.arc(m,q,n,0,c,!0),a.fill();a.fill();this.text!=[""]&&this.uber.drawText.call(this,a,this.text,m+h,q-h,this.color,this.font,"start","alphabetic",e.evalExpression(this.decimals),this.fixed,!0);e.setVariable("n",g)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=2*Math.PI,k=Math.round,e,f,b,g,t,d,r,p,m,q,u,n;a.Point=
function(b,d){this.size=b.evaluator.parser.parse("2");a.Graphic.call(this,b,d)};a.extend(a.Point,a.Graphic);a.Point.prototype.update=function(){e=this.evaluator;b=e.evalExpression(this.expresion);this.exprX=b[0][0];this.exprY=b[0][1];this.rotateExp&&(g=a.degToRad(e.evalExpression(this.rotateExp)),t=Math.cos(g),d=Math.sin(g),r=this.exprX*t-this.exprY*d,p=this.exprX*d+this.exprY*t,this.exprX=r,this.exprY=p)};a.Point.prototype.draw=function(){this.uber.draw.call(this,this.color,this.color)};a.Point.prototype.drawTrace=
function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Point.prototype.drawAux=function(a,b){e=this.evaluator;f=this.space;u=k(e.evalExpression(this.size));n=u+1;a.fillStyle=b.getColor();m=this.abs_coord?k(this.exprX):k(f.getAbsoluteX(this.exprX));q=this.abs_coord?k(this.exprY):k(f.getAbsoluteY(this.exprY));a.beginPath();a.arc(m,q,u,0,c,!0);a.fill();this.text!=[""]&&this.uber.drawText.call(this,a,this.text,m+n+1,q-n,this.color,this.font,"start","alphabetic",e.evalExpression(this.decimals),
this.fixed,!0)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.round,k=2*Math.PI,e,f,b,g,t,d,r,p,m,q,u,n,h,v,l,w,y,C;a.Segment=function(b,d){this.width=b.evaluator.parser.parse("1");this.size=b.evaluator.parser.parse("2");a.Graphic.call(this,b,d)};a.extend(a.Segment,a.Graphic);a.Segment.prototype.update=function(){e=this.evaluator;b=e.evalExpression(this.expresion);this.endPoints=[];for(var n=0,h=b.length;n<h;n++)this.endPoints[n]={x:b[n][0],y:b[n][1]};if(this.rotateExp)for(g=
a.degToRad(e.evalExpression(this.rotateExp)),t=Math.cos(g),d=Math.sin(g),n=0,h=this.endPoints.length;n<h;n++)r=this.endPoints[n].x*t-this.endPoints[n].y*d,p=this.endPoints[n].x*d+this.endPoints[n].y*t,this.endPoints[n].x=r,this.endPoints[n].y=p};a.Segment.prototype.draw=function(){this.uber.draw.call(this,this.color,this.color)};a.Segment.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Segment.prototype.drawAux=function(a,b,d){e=this.evaluator;f=this.space;m=
c(e.evalExpression(this.width));a.lineWidth=0<m?m:1E-6;h=e.evalExpression(this.size);0>h&&(h=0);a.fillStyle=b.getColor();a.strokeStyle=d.getColor();a.lineCap="round";q=10+a.lineWidth;v=0==a.lineWidth%2?0:.5;this.abs_coord?(l=c(this.endPoints[0].x),w=c(this.endPoints[0].y),y=c(this.endPoints[1].x),C=c(this.endPoints[1].y)):(l=c(f.getAbsoluteX(this.endPoints[0].x)),w=c(f.getAbsoluteY(this.endPoints[0].y)),y=c(f.getAbsoluteX(this.endPoints[1].x)),C=c(f.getAbsoluteY(this.endPoints[1].y)));a.beginPath();
a.moveTo(l+v,w+v);a.lineTo(y+v,C+v);a.stroke();a.beginPath();a.arc(l,w,h,0,k,!0);a.arc(y,C,h,0,k,!0);a.fill();this.text!=[""]&&(u=parseInt((l+y)/2)-3,n=parseInt((w+C)/2)+3,this.uber.drawText.call(this,a,this.text,u+q,n-q,this.color,this.font,"start","alphabetic",e.evalExpression(this.decimals),this.fixed,!0))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.floor,k=Math.round,e,f,b,g,t,d,r,p,m,q,u,n,h,v,l,w,y,C;a.Arrow=function(b,d){this.width=b.evaluator.parser.parse("5");
this.size=b.evaluator.parser.parse("2");this.spear=b.evaluator.parser.parse("8");this.arrow=new a.Color("ee0022");a.Graphic.call(this,b,d)};a.extend(a.Arrow,a.Graphic);a.Arrow.prototype.update=function(){e=this.evaluator;f=e.evalExpression(this.expresion);this.endPoints=[];for(var n=0,h=f.length;n<h;n++)this.endPoints[n]={x:f[n][0],y:f[n][1]};if(this.rotateExp)for(b=a.degToRad(e.evalExpression(this.rotateExp)),g=Math.cos(b),t=Math.sin(b),n=0,h=this.endPoints.length;n<h;n++)d=this.endPoints[n].x*g-
this.endPoints[n].y*t,r=this.endPoints[n].x*t+this.endPoints[n].y*g,this.endPoints[n].x=d,this.endPoints[n].y=r};a.Arrow.prototype.draw=function(){this.uber.draw.call(this,this.arrow,this.color)};a.Arrow.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.arrow,this.trace)};a.Arrow.prototype.drawAux=function(b,d,g){e=this.evaluator;p=this.space;e.evalExpression(this.size);u=e.evalExpression(this.width);0>u&&(u=0);n=Math.ceil(u/2);h=p.scale;this.vect=new a.Vector2D(this.endPoints[1].x-
this.endPoints[0].x,this.endPoints[1].y-this.endPoints[0].y);v=this.vect.vectorLength();this.angle=this.vect.angleBetweenVectors(a.Vector2D.AXIS_X);b.fillStyle=d.getColor();b.strokeStyle=g.getColor();b.lineWidth=2;this.abs_coord?(l=k(this.endPoints[0].x),w=k(this.endPoints[0].y),y=k(this.endPoints[1].x),C=k(this.endPoints[1].y)):(l=k(p.getAbsoluteX(this.endPoints[0].x)),w=k(p.getAbsoluteY(this.endPoints[0].y)),y=k(p.getAbsoluteX(this.endPoints[1].x)),C=k(p.getAbsoluteY(this.endPoints[1].y)));d=e.evalExpression(this.spear);
0>d&&(d=0);b.save();b.translate(l,w,v);this.abs_coord?0<=this.vect.x&&0<=this.vect.y||0>=this.vect.x&&0<=this.vect.y?b.rotate(this.angle):b.rotate(-this.angle):(v*=h,0<=this.vect.x&&0<=this.vect.y||0>=this.vect.x&&0<=this.vect.y?b.rotate(-this.angle):b.rotate(this.angle));b.beginPath();b.moveTo(-n,c(-n));b.lineTo(c(v-d-u),c(-n));b.lineTo(c(v-2*d),c(-d-n));b.lineTo(c(v),0);b.lineTo(c(v-2*d),c(d+n));b.lineTo(c(v-d-u),c(n));b.lineTo(-n,c(n));b.closePath();b.stroke();b.fill();b.restore();this.text!=[""]&&
(m=parseInt((l+y)/2)-3,q=parseInt((w+C)/2)+3,this.uber.drawText.call(this,b,this.text,m,q,g,this.font,"start","alphabetic",e.evalExpression(this.decimals),this.fixed,!0))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.round,k,e,f,b,g,t,d,r,p,m,q,u;a.Polygon=function(b,d){this.width=b.evaluator.parser.parse("1");this.fill="";a.Graphic.call(this,b,d);this.endPoints=[]};a.extend(a.Polygon,a.Graphic);a.Polygon.prototype.update=function(){k=this.evaluator;f=k.evalExpression(this.expresion);
for(var n=0,h=f.length;n<h;n++)this.endPoints[n]={x:f[n][0],y:f[n][1]};if(this.rotateExp)for(b=a.degToRad(k.evalExpression(this.rotateExp)),g=Math.cos(b),t=Math.sin(b),n=0,h=this.endPoints.length;n<h;n++)d=this.endPoints[n].x*g-this.endPoints[n].y*t,r=this.endPoints[n].x*t+this.endPoints[n].y*g,this.endPoints[n].x=d,this.endPoints[n].y=r};a.Polygon.prototype.draw=function(){this.uber.draw.call(this,this.fill,this.color)};a.Polygon.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,
this.trace)};a.Polygon.prototype.drawAux=function(a,b,d){k=this.evaluator;e=this.space;p=c(k.evalExpression(this.width));a.lineWidth=0<p?p:1E-6;a.strokeStyle=d.getColor();a.lineCap="round";a.lineJoin="round";m=0<p?.5:0;q=this.abs_coord?c(this.endPoints[0].x):c(e.getAbsoluteX(this.endPoints[0].x));u=this.abs_coord?c(this.endPoints[0].y):c(e.getAbsoluteY(this.endPoints[0].y));a.beginPath();a.moveTo(q+m,u+m);d=1;for(var g=this.endPoints.length;d<g;d++)q=this.abs_coord?c(this.endPoints[d].x):c(e.getAbsoluteX(this.endPoints[d].x)),
u=this.abs_coord?c(this.endPoints[d].y):c(e.getAbsoluteY(this.endPoints[d].y)),a.lineTo(q+m,u+m);this.fill&&(a.fillStyle=b.getColor(),a.fill());a.stroke()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.round,k,e,f,b,g,t,d,r,p,m,q,u,n,h,v,l,w,y,C,D,z;a.Arc=function(b,d){this.width=b.evaluator.parser.parse("1");this.fill="";this.center=b.evaluator.parser.parse("(0,0)");this.radius=b.evaluator.parser.parse("1");this.init="0";this.end="90";a.Graphic.call(this,b,d);
this.init.match(/^_\(/)&&(this.initFlag=!0,this.init=this.init.substring(1));this.end.match(/^_\(/)&&(this.endFlag=!0,this.end=this.end.substring(1));this.initExpr=b.evaluator.parser.parse(this.init);this.endExpr=b.evaluator.parser.parse(this.end)};a.extend(a.Arc,a.Graphic);a.Arc.prototype.update=function(){k=this.evaluator;e=k.evalExpression(this.center);this.exprX=e[0][0];this.exprY=e[0][1];f=0;this.rotateExp&&(f=a.degToRad(k.evalExpression(this.rotateExp)),b=Math.cos(f),g=Math.sin(f),t=this.exprX*
b-this.exprY*g,d=this.exprX*g+this.exprY*b,this.exprX=t,this.exprY=d);var c=k.evalExpression(this.initExpr),l=k.evalExpression(this.endExpr);"(expr)"==this.initExpr.type&&"(expr)"==this.endExpr.type||"[expr]"==this.initExpr.type&&"[expr]"==this.endExpr.type||"(expr)"==this.initExpr.type&&"[expr]"==this.endExpr.type||"[expr]"==this.initExpr.type&&"(expr)"==this.endExpr.type?(r=c[0][0],p=c[0][1],m=l[0][0],q=l[0][1],this.vectors?this.abs_coord&&(p=-p,q=-q):this.abs_coord?(r-=this.exprX,p=-p+this.exprY,
m-=this.exprX,q=-q+this.exprY):(r-=this.exprX,p-=this.exprY,m-=this.exprX,q-=this.exprY),u=0==r?0>p?-Math.PI/2:Math.PI/2:Math.acos(1*r/Math.sqrt(r*r+p*p)),n=0==m?0>q?-Math.PI/2:Math.PI/2:Math.acos(1*m/Math.sqrt(m*m+q*q)),u+=f,n+=f,0<r&&0<p&&this.abs_coord&&(u=2*Math.PI-u),0<r&&0>p&&!this.abs_coord&&(u=2*Math.PI-u),0>r&&0>p&&!this.abs_coord&&(u=2*Math.PI-u),0>r&&0<p&&this.abs_coord&&(u=2*Math.PI-u),0<m&&0<q&&this.abs_coord&&(n=2*Math.PI-n),0<m&&0>q&&!this.abs_coord&&(n=2*Math.PI-n),0>m&&0>q&&!this.abs_coord&&
(n=2*Math.PI-n),0>m&&0<q&&this.abs_coord&&(n=2*Math.PI-n),this.initFlag?(h=u,u=n,n=h):(h=Math.min(u,n),v=Math.max(u,n),u=h,n=v,n-u>Math.PI&&this.abs_coord&&(u=v,n=h),n-u<=Math.PI&&!this.abs_coord&&(u=v,n=h)),this.iniAng=u,this.endAng=n,this.drawPoints=!0):(this.iniAng=a.degToRad(c)+f,this.endAng=a.degToRad(l)+f,this.drawAngle=!0)};a.Arc.prototype.draw=function(){this.uber.draw.call(this,this.fill,this.color)};a.Arc.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.fill,this.trace)};
a.Arc.prototype.drawAux=function(a,b,d){k=this.evaluator;l=this.space;C=k.evalExpression(this.radius);0>C&&(C=0);z=c(k.evalExpression(this.width));a.lineWidth=0<z?z:1E-6;a.lineCap="round";a.strokeStyle=d.getColor();this.drawAngle?(this.abs_coord?(w=c(this.exprX),y=c(this.exprY)):(w=c(l.getAbsoluteX(this.exprX)),y=c(l.getAbsoluteY(this.exprY)),C*=l.scale,this.iniAng=-this.iniAng,this.endAng=-this.endAng),this.iniAng>this.endAng&&(D=this.iniAng,this.iniAng=this.endAng,this.endAng=D)):this.drawPoints&&
(this.abs_coord?(w=c(this.exprX),y=c(this.exprY)):(w=c(l.getAbsoluteX(this.exprX)),y=c(l.getAbsoluteY(this.exprY)),C*=l.scale,this.iniAng=-this.iniAng,this.endAng=-this.endAng));this.fill&&(a.fillStyle=b.getColor(),a.beginPath(),a.moveTo(w,y),a.arc(w,y,C,this.iniAng,this.endAng,void 0),a.fill());a.beginPath();a.arc(w,y,C,this.iniAng,this.endAng,void 0);a.stroke();this.text!=[""]&&this.uber.drawText.call(this,a,this.text,w+4,y-2,this.color,this.font,"start","alphabetic",k.evalExpression(this.decimals),
this.fixed,!0)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b,g,t,d,r,p,m,q,u,n,h,v,l,w;a.Text=function(b,d){this.width=b.evaluator.parser.parse("0");a.Graphic.call(this,b,d);this.align||(this.align="start");this.ascent=this.fontSize-Math.ceil(this.fontSize/7)-(this.font.match("Courier")?3:0);this.abs_coord=!0};a.extend(a.Text,a.Graphic);a.Text.prototype.update=function(){c=this.evaluator;k=c.evalExpression(this.expresion);this.exprX=k[0][0];this.exprY=k[0][1];
this.rotateExp&&(e=a.degToRad(c.evalExpression(this.rotateExp)),f=Math.cos(e),b=Math.sin(e),g=this.exprX*f-this.exprY*b,t=this.exprX*b+this.exprY*f,this.exprX=g,this.exprY=t)};a.Text.prototype.draw=function(){this.uber.draw.call(this,this.color)};a.Text.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.color)};a.Text.prototype.drawAux=function(a,b){w=this.evaluator.evalExpression(this.decimals);"rtfNode"===this.text.type?(m=this.text,this.ascent=0):m=this.splitText(this.text.toString(w,
this.fixed).split("\\n"));this.text!=[""]&&this.uber.drawText.call(this,a,m,parseInt(this.exprX)+5,parseInt(this.exprY)+this.ascent,b,this.font,this.align,"alphabetic",w,this.fixed)};a.Text.prototype.splitText=function(a){c=this.evaluator;d=c.evalExpression(this.width);m=[];this.ctx.font=this.font;if(20<=d&&"undefined"!=a.type){for(var b=0,n=a.length;b<n;b++)r=a[b],p=this.ctx.measureText(r).width,p>d?m=m.concat(this.splitWords(r,d)):m.push(r);q=Math.floor(1.2*this.fontSize)*m.length;c.setVariable("_Text_H_",
q);return m}c.setVariable("_Text_H_",0);c.setVariable("_Text_W_",1E3);return a};a.Text.prototype.splitWords=function(a,b){u=a;n=[];h="";l=0;for(var d,c=0,e=a.length;c<e;c++)v=u.charAt(c)," "===v&&(lastIndexOfWhite=c),h+=v,Math.round(this.ctx.measureText(h).width)>b&&(d=a.substring(l,c+1)," "!==v&&(-1===d.indexOf(" ")?(lastIndexOfWhite=c,c--):c=lastIndexOfWhite),n.push(a.substring(l,lastIndexOfWhite)),h="",l=c+1);n.push(a.substring(l));return n};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
var c=Math.round,k,e,f,b,g,t,d,r,p,m,q,u,n,h;a.Image=function(b,d){this.file="";this.inirot=b.evaluator.parser.parse("0");this.pattern=!1;a.Graphic.call(this,b,d);this.img=new Image;this.scaleY=this.scaleX=1;this.update()};a.extend(a.Image,a.Graphic);a.Image.prototype.update=function(){k=this.evaluator;e=k.evalExpression(this.expresion);this.exprX=e[0][0];this.exprY=e[0][1];this.rotateExp&&(f=a.degToRad(k.evalExpression(this.rotateExp)),b=Math.cos(f),g=Math.sin(f),t=this.exprX*b-this.exprY*g,d=this.exprX*
g+this.exprY*b,this.exprX=t,this.exprY=d);4<=e[0].length&&(this.centered=!0,this.scaleX=e[0][2],0==this.scaleX&&(this.scaleX=1E-5),this.scaleY=e[0][3],0==this.scaleY&&(this.scaleY=1E-5),e[0][4]&&(this.pattern=1==e[0][4]?!0:!1));e[1]&&2==e[1].length&&(this.centered=!0,this.scaleX=e[1][0],0==this.scaleX&&(this.scaleX=1E-5),this.scaleY=e[1][1],0==this.scaleY&&(this.scaleY=1E-5));if((r=k.evalExpression(this.file))||""==r)this.img=this.parent.getImage(r)};a.Image.prototype.draw=function(){this.uber.draw.call(this)};
a.Image.prototype.drawTrace=function(){this.uber.drawTrace.call(this)};a.Image.prototype.drawAux=function(b){k=this.evaluator;p=this.space;this.img&&this.img.ready&&this.img.complete&&(m=this.centered?0:c(this.img.width/2),q=this.centered?0:c(this.img.height/2),u=this.abs_coord?c(this.exprX):c(p.getAbsoluteX(this.exprX)),n=this.abs_coord?c(this.exprY):c(p.getAbsoluteY(this.exprY)),h=a.degToRad(-k.evalExpression(this.inirot)),b.save(),b.translate(u+m,n+q),b.rotate(h),this.opacity&&(b.globalAlpha=k.evalExpression(this.opacity)),
this.pattern?(b.fillStyle=b.createPattern(this.img,"repeat"),b.drawImage(this.img,-this.img.width/2*this.scaleX,-this.img.height/2*this.scaleY),b.fillRect(0,0,this.img.width*this.scaleX,this.img.height*this.scaleY)):(b.scale(this.scaleX,this.scaleY),b.drawImage(this.img,-this.img.width/2,-this.img.height/2)),b.restore())};return a}(descartesJS||{}),descartesJS=function(a){function c(a,b,c){d=4*(b+c*a.width);return{r:a.data[d],g:a.data[d+1],b:a.data[d+2],a:a.data[d+3]}}if(a.loadLib)return a;var k,
e,f,b,g,t,d;a.Fill=function(b,d){a.Graphic.call(this,b,d)};a.extend(a.Fill,a.Graphic);a.Fill.prototype.update=function(){k=this.evaluator.evalExpression(this.expresion);this.exprX=k[0][0];this.exprY=k[0][1]};a.Fill.prototype.draw=function(){this.uber.draw.call(this,this.color,this.color)};a.Fill.prototype.drawTrace=function(){};a.Fill.prototype.drawAux=function(a,p){p.getColor();imageData=this.ctx.getImageData(0,0,this.space.w,this.space.h);this.abs_coord?(e=parseInt(this.exprX),f=parseInt(this.exprY)):
(e=parseInt(this.space.getAbsoluteX(this.exprX)),f=parseInt(this.space.getAbsoluteY(this.exprY)));if(!(0>e||0>f||e>=this.space.w||f>=this.space.h)){b=[{x:e,y:f}];for(t=c(imageData,e,f);0<b.length;){g=b.pop();e=g.x;f=g.y;var m=c(imageData,e,f);if(t.r===m.r&&t.g===m.g&&t.b===m.b&&t.a===m.a){var m=imageData,k=p;d=4*(e+f*m.width);m.data[d+0]=k.r;m.data[d+1]=k.g;m.data[d+2]=k.b;m.data[d+3]=255*k.a;0<e&&b.push({x:e-1,y:f});e<imageData.width-1&&b.push({x:e+1,y:f});b.push({x:e,y:f-1});b.push({x:e,y:f+1})}}this.ctx.putImageData(imageData,
0,0)}};return a}(descartesJS||{}),descartesJS=function(a,c){if(a.loadLib)return a;var k=new String("-_-rnd-pi-e-sqr-ra\u00edz-sqrt-exp-log-log10-abs-ent-sgn-ind-sen-sin-cos-tan-cot-sec-csc-senh-sinh-cosh-tanh-coth-sech-csch-asen-asin-acos-atan-min-max-_Num_-_Trace_-_Stop_Audios_-esCorrecto-escorrecto-_GetValues_-_GetMatrix_-_Save_-_Open_-_SaveState_-_OpenState_-_AnchoDeCadena_-_Rojo_-_Verde_-_Azul_-"),e=/[\w\.\-//]*(\.png|\.jpg|\.gif|\.svg)/gi,f;a.Macro=function(b,g){this.hasExpresion=!1;this.inirot=
b.evaluator.parser.parse("0");this.inipos=b.evaluator.parser.parse("(0,0)");a.Graphic.call(this,b,g);for(var f in g)"expresion"==f&&(this.hasExpresion=!0),g.hasOwnProperty(f)&&(this[f]=g[f]);this.graphics=[];f=b.lessonParser;var d=new a.Tokenizer;if(this.hasExpresion){"'"!==this.expresion.charAt(0)&&(this.expresion="'"+this.expresion+"'");this.expresion=this.evaluator.parser.parse(this.expresion);var r=this.evaluator.evalExpression(this.expresion),p;r&&((p=document.getElementById(r))&&"descartes/macro"==
p.type?p=p.text:(p=a.openExternalFile(r))&&!p.match(/tipo_de_macro/g)&&(p=null));var m,q;if(p){q=p.replace(/&aacute;/g,"\u00e1").replace(/&eacute;/g,"\u00e9").replace(/&iacute;/g,"\u00ed").replace(/&oacute;/g,"\u00f3").replace(/&uacute;/g,"\u00fa").replace(/&Aacute;/g,"\u00c1").replace(/&Eacute;/g,"\u00c9").replace(/&Iacute;/g,"\u00cd").replace(/&Oacute;/g,"\u00d3").replace(/&Uacute;/g,"\u00da").replace(/&ntilde;/g,"\u00f1").replace(/&Ntilde;/g,"\u00d1").replace(/\&gt;/g,">").replace(/\&lt;/g,"<").replace(/\&amp;/g,
"&").replace(/\r/g,"").split("\n");p=[];for(var r=0,u=q.length;r<u;r++)if(m=q[r].indexOf("="),-1!==m){m=f.split(q[r]);for(var n=0,h=m.length;n<h;n++)m[n]&&1<m.length&&("id"!==c[m[n][0]]&&"type"!==c[m[n][0]]||p.push(m))}for(var v,l,r=0,u=p.length;r<u;r++)for(h=(n=p[r]||[],n[0])&&"id"===n[0][0],q=0,m=n.length;q<m;q++)if(v=n[q][0].indexOf("."),-1===v||h?v=c[n[q][0]]:(v=c[n[q][0].substring(v+1)],n[q][0]=this.name+"."+n[q][0]),!("font"===v||("fill"===v||"color"===v||"border"===v||"arrow"===v)&&"("!==n[q][1].charAt(0)||
"file"===v&&n[q][1].match(e)||"id"!==v&&void 0!==c[n[q][1]]))if("text"==v)if(n[q][1].match(/\{\\rtf1/)){v=n[q][1];var w=this;l=function(a,b){for(var n=d.tokenize(b.replace(/\&squot;/g,"'")),h=0,c=n.length;h<c;h++)"identifier"!=n[h].type||k.match("-"+n[h].value+"-")||(n[h].value=w.name+"."+n[h].value);return(a.match(/^\\expr/)?"\\expr ":"\\decimals ")+d.flatTokens(n)};v=v.replace(/\\expr ([a-zA-Z_0-9\u00C0-\u021B+*/%|&^#!?:()><.'\+\-]*)/gi,l);v=v.replace(/\\decimals ([a-zA-Z_0-9\u00C0-\u021B+*/%|&^#!?:()><.'\+\-]*)/gi,
l);n[q][1]=v}else{l=f.parseText(n[q][1]).textElementsMacros;for(var y=0,C=l.length;y<C;y++){v=d.tokenize(l[y].replace(/\&squot;/g,"'"));for(var D=0,z=v.length;D<z;D++)"identifier"!==v[D].type||k.match("-"+v[D].value+"-")||(v[D].value=this.name+"."+v[D].value);v=d.flatTokens(v).replace(/&squot;/g,"'").replace(/'\+\(/g,"[").replace(/\)\+'/g,"]");l[y]=v.substring(1,v.length-1)}n[q][1]=l.join("")}else{l=n[q][1].replace(/\&squot;/g,"'").split(";");y=0;for(C=l.length;y<C;y++){v=d.tokenize(l[y].replace(/\\n/g,
";"));D=0;for(z=v.length;D<z;D++)"identifier"!==v[D].type||k.match("-"+v[D].value+"-")||(v[D].value=this.name+"."+v[D].value);l[y]=d.flatTokens(v)}n[q][1]=l.join(";")}r=0;for(u=p.length;r<u;r++)if(p[r][0]){n="";h=!1;q=0;for(m=p[r].length;q<m;q++)"type"===c[p[r][q][0]]&&(n="espacio='"+this.spaceID+"' ",h=!0),n=n+p[r][q][0]+"='"+p[r][q][1]+"' ";p[r]=n;h?this.graphics.push(f.parseGraphic(p[r],this.abs_coord,this.background,this.inirot)):f.parseAuxiliar(p[r])}}}};a.extend(a.Macro,a.Graphic);a.Macro.prototype.update=
function(){f=this.evaluator.evalExpression(this.inipos);this.iniPosX=f[0][0];this.iniPosY=f[0][1]};a.Macro.prototype.drawAux=function(a){for(var c=0,f=this.graphics.length;c<f;c++)this.graphics[c]&&(a.save(),this.graphics[c].abs_coord?a.translate(this.iniPosX,this.iniPosY):a.translate(this.iniPosX*this.space.scale,-this.iniPosY*this.space.scale),this.graphics[c].draw(),a.restore())};return a}(descartesJS||{},babel),descartesJS=function(a){if(a.loadLib)return a;a.Generic=function(c,k){this.width=c.evaluator.parser.parse("1");
a.Graphic.call(this,c,k)};a.extend(a.Generic,a.Graphic);a.Generic.prototype.update=function(){};a.Generic.prototype.draw=function(){this.uber.draw.call(this,this.fill,this.color)};a.Generic.prototype.drawTrace=function(){this.uber.drawTrace.call(this,this.trace,this.trace)};a.Generic.prototype.drawAux=function(a,k,e){var f=this.evaluator.getDefinition(this.expresionString);f&&f.draw(a,k,e,this)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.sqrt,k=Math.sin,e=
Math.cos,f,b,g,t,d,r,p,m,q,u,n,h,v,l,w;a.norm3D=function(a){return c(a.x*a.x+a.y*a.y+a.z*a.z)};a.normalize3D=function(b){f=a.norm3D(b);if(0===f)return{x:0,y:0,z:0};if(1===f)return{x:b.x,y:b.y,z:b.z};f=1/f;return{x:b.x*f,y:b.y*f,z:b.z*f}};a.dotProduct3D=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};a.crossProduct3D=function(a,b){return{x:a.y*b.z-a.z*b.y,y:a.z*b.x-a.x*b.z,z:a.x*b.y-a.y*b.x}};a.scalarProduct3D=function(a,b){return{x:a.x*b,y:a.y*b,z:a.z*b}};a.subtract3D=function(a,b){return{x:a.x-b.x,
y:a.y-b.y,z:a.z-b.z}};a.add3D=function(a,b){return{x:a.x+b.x,y:a.y+b.y,z:a.z+b.z}};a.equals3DEpsilon=function(a,b,d){return Math.abs(a.x-b.x)<=d&&Math.abs(a.y-b.y)<=d&&Math.abs(a.z-b.z)<=d};a.Vector4D=function(a,b,d,n){this.x=a||0;this.y=b||0;this.z=d||0;this.w=n||0};a.Matrix4x4=function(a,b,d,n,h,c,f,e,g,p,m,r,l,k,q,t){this.a00=a||0;this.a01=b||0;this.a02=d||0;this.a03=n||0;this.a10=h||0;this.a11=c||0;this.a12=f||0;this.a13=e||0;this.a20=g||0;this.a21=p||0;this.a22=m||0;this.a23=r||0;this.a30=l||
0;this.a31=k||0;this.a32=q||0;this.a33=t||0};a.Matrix4x4.prototype.setIdentity=function(){this.a00=1;this.a10=this.a03=this.a02=this.a01=0;this.a11=1;this.a21=this.a20=this.a13=this.a12=0;this.a22=1;this.a32=this.a31=this.a30=this.a23=0;this.a33=1;return this};a.Matrix4x4.prototype.multiplyVector4=function(b){return new a.Vector4D(b.x*this.a00+b.y*this.a10+b.z*this.a20+b.w*this.a30,b.x*this.a01+b.y*this.a11+b.z*this.a21+b.w*this.a31,b.x*this.a02+b.y*this.a12+b.z*this.a22+b.w*this.a32,b.x*this.a03+
b.y*this.a13+b.z*this.a23+b.w*this.a33)};a.Matrix4x4.prototype.translate=function(b){return new a.Matrix4x4(this.a00,this.a01,this.a02,this.a03,this.a10,this.a11,this.a12,this.a13,this.a20,this.a21,this.a22,this.a23,this.a00*b.x+this.a10*b.y+this.a20*b.z+this.a30,this.a01*b.x+this.a11*b.y+this.a21*b.z+this.a31,this.a02*b.x+this.a12*b.y+this.a22*b.z+this.a32,this.a03*b.x+this.a13*b.y+this.a23*b.z+this.a33)};a.Matrix4x4.prototype.rotateX=function(d){b=k(d);g=e(d);m=this.a10;q=this.a11;u=this.a12;n=
this.a13;h=this.a20;v=this.a21;l=this.a22;w=this.a23;return new a.Matrix4x4(this.a00,this.a01,this.a02,this.a03,m*g+h*b,q*g+v*b,u*g+l*b,n*g+w*b,m*-b+h*g,q*-b+v*g,u*-b+l*g,n*-b+w*g,this.a30,this.a31,this.a32,this.a33)};a.Matrix4x4.prototype.rotateY=function(n){b=k(n);g=e(n);t=this.a00;d=this.a01;r=this.a02;p=this.a03;h=this.a20;v=this.a21;l=this.a22;w=this.a23;return new a.Matrix4x4(t*g+h*-b,d*g+v*-b,r*g+l*-b,p*g+w*-b,this.a10,this.a11,this.a12,this.a13,t*b+h*g,d*b+v*g,r*b+l*g,p*b+w*g,this.a30,this.a31,
this.a32,this.a33)};a.Matrix4x4.prototype.rotateZ=function(h){b=k(h);g=e(h);t=this.a00;d=this.a01;r=this.a02;p=this.a03;m=this.a10;q=this.a11;u=this.a12;n=this.a13;return new a.Matrix4x4(t*g+m*b,d*g+q*b,r*g+u*b,p*g+n*b,t*-b+m*g,d*-b+q*g,r*-b+u*g,p*-b+n*g,this.a20,this.a21,this.a22,this.a23,this.a30,this.a31,this.a32,this.a33)};return a}(descartesJS||{}),descartesJS=function(a){function c(a){0!==parseInt(this.size)&&(a.lineWidth=1,a.fillStyle=this.backColor,a.strokeStyle=this.frontColor,a.beginPath(),
a.arc(this.newV[0].x,this.newV[0].y,this.size+.5,0,g),a.fill(),a.stroke())}function k(a,b){a.lineCap="round";a.lineJoin="round";a.lineWidth="#"==this.backColor.charAt(0)||"#"==this.frontColor.charAt(0)?1:.1;a.beginPath();a.moveTo(this.newV[0].x,this.newV[0].y);for(var d=1,c=this.newV.length;d<c;d++)a.lineTo(this.newV[d].x,this.newV[d].y);a.closePath();"color"===this.model?(a.fillStyle=0<=this.direction?this.backColor:this.frontColor,a.strokeStyle=a.fillStyle,a.stroke(),a.fill()):"light"===this.model||
"metal"===this.model?(a.fillStyle=0<=this.direction?b.computeColor(this.backColor,this,"metal"===this.model):b.computeColor(this.frontColor,this,"metal"===this.model),a.strokeStyle=a.fillStyle,a.stroke(),a.fill()):"wire"===this.model&&(a.lineWidth=1.5,a.strokeStyle=this.frontColor,a.stroke());this.edges&&"wire"!==this.model&&(a.lineWidth=1,a.strokeStyle="#808080",a.stroke())}function e(a){q=this.evaluator.getVariable(this.family);this.evaluator.setVariable(this.family,this.familyValue);this.drawText(a,
this.text,this.newV[0].x,this.newV[0].y+this.displace,this.frontColor,this.font,"left","alphabetic",this.decimals,this.fixed,!0);this.evaluator.setVariable(this.family,q)}function f(a){a.lineCap="round";a.lineJoin="round";a.lineWidth=this.lineWidth;a.strokeStyle=this.frontColor;a.beginPath();a.moveTo(this.newV[0].x,this.newV[0].y);a.lineTo(this.newV[1].x,this.newV[1].y);a.stroke()}function b(b,h,c){t=a.subtract3D(b,h);d=a.subtract3D(b,c);return a.normalize3D(a.crossProduct3D(t,d))}if(a.loadLib)return a;
var g=2*Math.PI,t,d,r,p,m,q;a.Primitive3D=function(a,d){this.space=d;for(var g in a)a.hasOwnProperty(g)&&(this[g]=a[g]);this.newV=[];this.spaceVertices=[];"vertex"===this.type?this.draw=c:"face"===this.type?(this.normal=b(this.vertices[0],this.vertices[1],this.vertices[2]),this.draw=k):"text"===this.type?(this.fontSize=(this.fontSize=this.font.match(/(\d+)px/))?parseInt(this.fontSize[1]):10,this.draw=e):"edge"===this.type&&(this.draw=f);this.isText&&(this.computeDepth=function(){this.newV=this.vertices;
this.depth=this.vertices[0].z;this.average=this.vertices[0]})};a.Primitive3D.prototype.computeDepth=function(d){this.average={x:0,y:0,z:0};this.removeDoubles();this.normal={x:0,y:1,z:0};this.direction={x:1,y:0,z:0};for(var h=0,c=this.vertices.length;h<c;h++)this.newV[h]=d.rotateVertex(this.vertices[h]),this.spaceVertices[h]=d.rotateVertex(this.vertices[h]),this.average.x+=this.newV[h].x,this.average.y+=this.newV[h].y,this.average.z+=this.newV[h].z;this.average=a.scalarProduct3D(this.average,1/c);
this.averageP=d.project(this.average);this.depth=this.averageP.z;2<this.vertices.length&&(this.normal=b(this.newV[0],this.newV[1],this.newV[2]),this.direction=a.dotProduct3D(this.normal,a.normalize3D(d.eye)));this.passDraw=1;h=0;for(c=this.vertices.length;h<c;h++)this.newV[h]=d.project(this.newV[h]),this.passDraw=this.passDraw&&0<this.newV[h].z;d.new3D||(this.passDraw=1)};var u;a.Primitive3D.prototype.removeDoubles=function(){if("edge"!==this.type){u=[];for(var a=0,b=this.vertices.length;a<b;a++)this.vertices[a].x===
this.vertices[(a+1)%b].x&&this.vertices[a].y===this.vertices[(a+1)%b].y&&this.vertices[a].z===this.vertices[(a+1)%b].z&&this.vertices[a].w===this.vertices[(a+1)%b].w||u.push(this.vertices[a]);0===u.length&&u.push(this.vertices[0]);this.vertices=u}};a.Primitive3D.prototype.drawText=function(b,d,c,f,e,g,k,q,t,u,H){if("rtfNode"==d.type)b.fillStyle=e,b.strokeStyle=e,b.textBaseline="alphabetic",d.draw(b,c,f,t,u,k,H);else for("simpleText"===d.type&&(d=d.toString(t,u).split("\\n")),c+=g.match("Arial")?-2:
g.match("Times")?-2:0,r=this.evaluator,b.fillStyle=a.getColor(r,e),b.font=g,b.textAlign=k,b.textBaseline=q,p=1.2*this.fontSize||0,e=0,g=d.length;e<g;e++)m=d[e],this.border&&b.strokeText(m,c,f+p*e),b.fillText(m,c,f+p*e)};a.Primitive3D.prototype.splitFace=function(b){if(this.intersects(b)){for(var d=null,c=null,e=0,f=0,g=0,p=b.vertices.length;g<p;g++){var m=this.intersection(b.vertices[g],b.vertices[(g+1)%p]);if(null!==m)if(null===d){if(d=m,e=g,2===b.vertices.length){c=d;break}}else if(!a.equals3DEpsilon(m,
d,1E-8)){c=m;f=g;break}}if(null!==d&&null!==c){var g=this.isInterior(d)||this.isInterior(c),r=null,k=null;if(!g&&3<=b.vertices.length)for(var p=0,q=this.vertices.length;p<q;p++)if(m=b.intersection(this.vertices[p],this.vertices[(p+1)%q]),null!==m)if(null===r)r=m;else if(!a.equals3DEpsilon(m,r,1E-8)){k=m;break}if(g||null!==r&&null!==k&&b.isInterior(r)&&b.isInterior(k)){k=!0;q=b.vertices;r=m=null;if(2===q.length)a.equals(d,q[0],1E-8)||a.equals(d,q[1],1E-8)?k=!1:(m=[],m[0]=q[0],m[1]=d,r=[],r[0]=d,r[1]=
q[1]);else for(var m=[],r=[],t=0,g=p=0;g<q.length;g++)g<e?m[t++]=q[g]:g==e?(m[t++]=q[g],m[t++]=d,r[p++]=d):g<f?r[p++]=q[g]:g==f?(r[p++]=q[g],r[p++]=c,m[t++]=c):m[t++]=q[g];if(k)return d=[],d[0]=new a.Primitive3D({vertices:m,type:"face",frontColor:b.frontColor,backColor:b.backColor,edges:b.edges,model:b.model},this.space),d[0].normal=b.normal,d[1]=new a.Primitive3D({vertices:r,type:"face",frontColor:b.frontColor,backColor:b.backColor,edges:b.edges,model:b.model},this.space),d[1].normal=b.normal,d}}}return[b]};
a.Primitive3D.prototype.intersects=function(a){return this.intersectsPlane(a)&&a.intersectsPlane(this)};a.Primitive3D.prototype.intersectsPlane=function(b){var d=a.dotProduct3D(b.vertices[0],b.normal),c=a.dotProduct3D(this.vertices[0],b.normal);if(1E-8>Math.abs(d-c))return!0;for(var g=1,e=this.vertices.length;g<e;g++){var f=a.dotProduct3D(this.vertices[g],b.normal);if(1E-8>Math.abs(d-f)||f>d&&c<d||f<d&&c>d)return!0}return!1};a.Primitive3D.prototype.intersection=function(b,d){if(0<this.vertices.length){var c=
a.subtract3D(d,b),g=a.dotProduct3D(c,this.normal);if(0!==g&&(g=a.dotProduct3D(a.subtract3D(this.vertices[0],b),this.normal)/g,-1E-8<g&&1.00000001>g))return a.add3D(b,a.scalarProduct3D(c,g))}return null};a.Primitive3D.prototype.isInterior=function(b){if(0<this.vertices.length)for(var d=0,c=a.subtract3D(this.vertices[0],b),g=0,e=this.vertices.length;g<e;g++){var f=a.subtract3D(this.vertices[(g+1)%e],b),p=a.dotProduct3D(a.crossProduct3D(c,f),this.normal);if(1E-8>Math.abs(p)){if(0>a.dotProduct3D(c,f))break}else{if(0>
d&&0<p||0<d&&0>p)return!1;c=f;d=p}}return!0};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c={x:0,y:0,z:0},k,e,f,b,g,t;a.Graphic3D=function(b,d){this.parent=b;this.evaluator=b.evaluator;var c=b.evaluator.parser;this.spaceID="E0";this.background=!1;this.type="";this.color=new a.Color("eeffaa");this.backcolor=new a.Color("6090a0");this.Nu=this.evaluator.parser.parse("7");this.Nv=this.evaluator.parser.parse("7");this.drawif=c.parse("1");this.abs_coord=!1;this.family="";
this.family_interval=c.parse("[0,1]");this.family_steps=c.parse("8");this.font="Monospaced,PLAIN,12";this.fixed=!0;this.text="";this.decimals=c.parse("2");this.inirot="(0,0,0)";this.inirotEuler=!1;this.inipos=c.parse("(0,0,0)");this.endrot="(0,0,0)";this.endrotEuler=!1;this.endpos=c.parse("(0,0,0)");this.model="color";for(var g in d)d.hasOwnProperty(g)&&(this[g]=d[g]);void 0==this.expresion&&"macro"!=this.type&&(this.expresion=c.parse("(0,0)"));this.space=this.getSpace();this.canvas=this.background?
this.space.backgroundCanvas:this.space.canvas;this.ctx=this.canvas.getContext("2d");this.font=a.convertFont(this.font);this.fontSize=(this.fontSize=this.font.match(/(\d+)px/))?parseInt(this.fontSize[1]):10;this.inirot.match("Euler")&&(this.inirot=this.inirot.replace("Euler",""),this.inirotEuler=!0);this.endrot.match("Euler")&&(this.endrot=this.endrot.replace("Euler",""),this.endrotEuler=!0);this.inirot=c.parse(this.inirot);this.endrot=c.parse(this.endrot);this.inirotM=new a.Matrix4x4;this.inirotM_X=
new a.Matrix4x4;this.inirotM_Y=new a.Matrix4x4;this.inirotM_Z=new a.Matrix4x4;this.iniposM=new a.Matrix4x4;this.endrotM=new a.Matrix4x4;this.endrotM_X=new a.Matrix4x4;this.endrotM_Y=new a.Matrix4x4;this.endrotM_Z=new a.Matrix4x4;this.endposM=new a.Matrix4x4};a.Graphic3D.prototype.getSpace=function(){for(var a=this.parent.spaces,b,d=0,c=a.length;d<c;d++)if(b=a[d],b.id==this.spaceID)return b;return a[0]};a.Graphic3D.prototype.getFamilyValues=function(){k=this.evaluator;e=k.evalExpression(this.family_interval);
this.familyInf=e[0][0];this.familySup=e[0][1];this.fSteps=Math.round(k.evalExpression(this.family_steps));this.family_sep=0<this.fSteps?(this.familySup-this.familyInf)/this.fSteps:0};a.Graphic3D.prototype.buildFamilyPrimitives=function(){k=this.evaluator;this.getFamilyValues();f=k.getVariable(this.family);if(0<=this.fSteps)for(var a=0,b=this.fSteps;a<=b;a++)k.setVariable(this.family,this.familyInf+a*this.family_sep),this.familyValue=this.familyInf+a*this.family_sep,k.evalExpression(this.drawif)&&
this.buildPrimitives();k.setVariable(this.family,f)};a.Graphic3D.prototype.update=function(){this.primitives=[];this.evaluator.evalExpression(this.drawif)&&(this.family||this.buildPrimitives());this.family&&this.buildFamilyPrimitives()};a.Graphic3D.prototype.updateMVMatrix=function(){g=this.evaluator.evalExpression(this.inirot);this.inirotEuler?(this.inirotM=this.inirotM.setIdentity(),this.inirotM=this.inirotM.rotateZ(a.degToRad(g[0][0])),this.inirotM=this.inirotM.rotateX(a.degToRad(g[0][1])),this.inirotM=
this.inirotM.rotateZ(a.degToRad(g[0][2]))):(this.inirotM_X=this.inirotM_X.setIdentity().rotateX(a.degToRad(g[0][0])),this.inirotM_Y=this.inirotM_Y.setIdentity().rotateY(a.degToRad(g[0][1])),this.inirotM_Z=this.inirotM_Z.setIdentity().rotateZ(a.degToRad(g[0][2])));g=this.evaluator.evalExpression(this.inipos);c={x:g[0][0],y:g[0][1],z:g[0][2]};this.iniposM=this.iniposM.setIdentity().translate(c);g=this.evaluator.evalExpression(this.endrot);this.endrotEuler?(this.endrotM=this.endrotM.setIdentity(),this.endrotM=
this.endrotM.rotateZ(a.degToRad(g[0][0])),this.endrotM=this.endrotM.rotateX(a.degToRad(g[0][1])),this.endrotM=this.endrotM.rotateZ(a.degToRad(g[0][2]))):(this.endrotM_X=this.endrotM_X.setIdentity().rotateX(a.degToRad(g[0][0])),this.endrotM_Y=this.endrotM_Y.setIdentity().rotateY(a.degToRad(g[0][1])),this.endrotM_Z=this.endrotM_Z.setIdentity().rotateZ(a.degToRad(g[0][2])));g=this.evaluator.evalExpression(this.endpos);c={x:g[0][0],y:g[0][1],z:g[0][2]};this.endposM=this.endposM.setIdentity().translate(c)};
a.Graphic3D.prototype.transformVertex=function(a){this.inirotEuler?b=this.inirotM.multiplyVector4(a):(b=this.inirotM_X.multiplyVector4(a),b=this.inirotM_Y.multiplyVector4(b),b=this.inirotM_Z.multiplyVector4(b));b=this.iniposM.multiplyVector4(b);this.endrotEuler?b=this.endrotM.multiplyVector4(b):(b=this.endrotM_X.multiplyVector4(b),b=this.endrotM_Y.multiplyVector4(b),b=this.endrotM_Z.multiplyVector4(b));b=this.endposM.multiplyVector4(b);this.macroChildren&&(b=this.applyMacroTransform(b));return b};
a.Graphic3D.prototype.applyMacroTransform=function(a){this.macro_inirotEuler?b=this.macro_inirotM.multiplyVector4(a):(b=this.macro_inirotM_X.multiplyVector4(a),b=this.macro_inirotM_Y.multiplyVector4(b),b=this.macro_inirotM_Z.multiplyVector4(b));b=this.macro_iniposM.multiplyVector4(b);this.macro_endrotEuler?b=this.macro_endrotM.multiplyVector4(b):(b=this.macro_endrotM_X.multiplyVector4(b),b=this.macro_endrotM_Y.multiplyVector4(b),b=this.macro_endrotM_Z.multiplyVector4(b));return b=this.macro_endposM.multiplyVector4(b)};
a.Graphic3D.prototype.parseExpression=function(){t=[];for(var a=this.expresion.replace(/\n/g," ").replace(/ ( )+/g," ").trim(),b=[],d=0,c,g=a.length,e=a.length-1;-1<e;e--)c=a.charAt(e),0==d?"="==c&&(d=1):1==d?" "!=c&&(d="<"==c||">"==c?0:2):2==d&&" "==c&&(b.unshift(a.substring(e+1,g)),g=e,d=0);b.unshift(a.substring(0,g));e=0;for(a=b.length;e<a;e++)t.push(this.evaluator.parser.parse(b[e],!0));return t};var d;a.Graphic3D.prototype.splitFace=function(a){for(var b=0,c=this.primitives.length;b<c;b++)if(d=
[],"face"===this.primitives[b].type){for(var g=0,e=a.primitives.length;g<e;g++)"face"===a.primitives[g].type?d=d.concat(this.primitives[b].splitFace(a.primitives[g])):d.push(a.primitives[g]);a.primitives=d}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b;a.Point3D=function(b,c){a.Graphic3D.call(this,b,c)};a.extend(a.Point3D,a.Graphic3D);a.Point3D.prototype.buildPrimitives=function(){c=this.evaluator;this.updateMVMatrix();k=c.evalExpression(this.expresion);e=
k[0][0];f=k[0][1];b=k[0][2];this.primitives.push(new a.Primitive3D({vertices:[this.transformVertex(new a.Vector4D(e,f,b,1))],type:"vertex",backColor:this.backcolor.getColor(),frontColor:this.color.getColor(),size:c.evalExpression(this.width)}));""!==this.text&&this.primitives.push(new a.Primitive3D({vertices:[this.transformVertex(new a.Vector4D(e,f,b,1))],type:"text",frontColor:this.color.getColor(),font:this.font,decimals:c.evalExpression(this.decimals),fixed:this.fixed,displace:this.fontSize,evaluator:c,
text:this.text,family:this.family,familyValue:this.familyValue},this.space))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b,g,t;a.Segment3D=function(b,c){this.width=b.evaluator.parser.parse("1");a.Graphic3D.call(this,b,c)};a.extend(a.Segment3D,a.Graphic3D);a.Segment3D.prototype.buildPrimitives=function(){evaluator=this.evaluator;this.updateMVMatrix();t=evaluator.getVariable("u");evaluator.setVariable("u",this.Nu);expr=evaluator.evalExpression(this.expresion);
c=expr[0][0];k=expr[0][1];e=expr[0][2];f=expr[1][0];b=expr[1][1];g=expr[1][2];this.primitives.push(new a.Primitive3D({vertices:[this.transformVertex(new a.Vector4D(c,k,e,1)),this.transformVertex(new a.Vector4D(f,b,g,1))],type:"edge",frontColor:this.color.getColor(),lineWidth:evaluator.evalExpression(this.width)},this.space));evaluator.setVariable("u",t)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b,g,t,d,r,p,m,q,u,n;a.Surface3D=function(b,d){this.parameter=
"t";this.parameter_interval=b.evaluator.parser.parse("[0,1]");this.parameter_steps=b.evaluator.parser.parse("8");a.Graphic3D.call(this,b,d);this.expresion=this.parseExpression()};a.extend(a.Surface3D,a.Graphic3D);a.Surface3D.prototype.buildPrimitives=function(){c=this.evaluator;this.updateMVMatrix();f=c.getVariable("x");b=c.getVariable("y");g=c.getVariable("z");k=c.getVariable("u");e=c.getVariable("v");c.setVariable("u",0);c.setVariable("v",0);t=c.evalExpression(this.Nu);d=c.evalExpression(this.Nv);
r=[];for(m=0;m<=t;m++)for(c.setVariable("u",m/t),q=0;q<=d;q++){c.setVariable("v",q/d);u=0;for(n=this.expresion.length;u<n;u++)c.evalExpression(this.expresion[u]);r.push(this.transformVertex(new a.Vector4D(c.getVariable("x"),c.getVariable("y"),c.getVariable("z"),1)))}for(m=0;m<t;m++)for(q=0;q<d;q++)p=[],p.push(r[q+m*d+m]),p.push(r[q+1+m*d+m]),p.push(r[q+2+(m+1)*d+m]),p.push(r[q+1+(m+1)*d+m]),this.primitives.push(new a.Primitive3D({vertices:p,type:"face",frontColor:this.color.getColor(),backColor:this.backcolor.getColor(),
edges:this.edges,model:this.model},this.space));c.setVariable("x",f);c.setVariable("y",b);c.setVariable("z",g);c.setVariable("u",k);c.setVariable("v",e)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b,g;a.Polygon3D=function(b,d){this.width=b.evaluator.parser.parse("1");a.Graphic3D.call(this,b,d)};a.extend(a.Polygon3D,a.Graphic3D);a.Polygon3D.prototype.buildPrimitives=function(){evaluator=this.evaluator;this.updateMVMatrix();expr=evaluator.evalExpression(this.expresion);
for(var t=0,d=expr.length-1;t<d;t++)c=expr[t][0],k=expr[t][1],e=expr[t][2],f=expr[t+1][0],b=expr[t+1][1],g=expr[t+1][2],this.primitives.push(new a.Primitive3D({vertices:[this.transformVertex(new a.Vector4D(c,k,e,1)),this.transformVertex(new a.Vector4D(f,b,g,1))],type:"edge",frontColor:this.color.getColor(),lineWidth:evaluator.evalExpression(this.width)},this.space))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b,g;a.Curve3D=function(b,d){this.width=b.evaluator.parser.parse("1");
a.Graphic3D.call(this,b,d);this.expresion=this.parseExpression()};a.extend(a.Curve3D,a.Graphic3D);a.Curve3D.prototype.buildPrimitives=function(){evaluator=this.evaluator;this.updateMVMatrix();f=evaluator.getVariable("x");b=evaluator.getVariable("y");g=evaluator.getVariable("z");e=evaluator.getVariable("u");evaluator.setVariable("u",0);k=evaluator.evalExpression(this.Nu);c=[];for(var t=0;t<=k;t++){evaluator.setVariable("u",t/k);for(var d=0,r=this.expresion.length;d<r;d++)evaluator.evalExpression(this.expresion[d]);
c.push(this.transformVertex(new a.Vector4D(evaluator.getVariable("x"),evaluator.getVariable("y"),evaluator.getVariable("z"),1)))}t=0;for(d=c.length-1;t<d;t++)this.primitives.push(new a.Primitive3D({vertices:[c[t],c[t+1]],type:"edge",frontColor:this.color.getColor(),lineWidth:evaluator.evalExpression(this.width)},this.space));evaluator.setVariable("x",f);evaluator.setVariable("y",g);evaluator.setVariable("z",b);evaluator.setVariable("u",e)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;
var c,k,e,f,b,g,t,d,r;a.Triangle3D=function(b,d){a.Graphic3D.call(this,b,d)};a.extend(a.Triangle3D,a.Graphic3D);a.Triangle3D.prototype.buildPrimitives=function(){evaluator=this.evaluator;this.updateMVMatrix();expr=evaluator.evalExpression(this.expresion);c=expr[0][0];k=expr[0][1];e=expr[0][2];f=expr[1][0];b=expr[1][1];g=expr[1][2];t=expr[2][0];d=expr[2][1];r=expr[2][2];this.primitives.push(new a.Primitive3D({vertices:[this.transformVertex(new a.Vector4D(c,k,e,1)),this.transformVertex(new a.Vector4D(t,
d,r,1)),this.transformVertex(new a.Vector4D(f,b,g,1))],type:"face",frontColor:this.color.getColor(),backColor:this.backcolor.getColor(),edges:this.edges,model:this.model},this.space))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c;a.Face3D=function(c,e){a.Graphic3D.call(this,c,e)};a.extend(a.Face3D,a.Graphic3D);a.Face3D.prototype.buildPrimitives=function(){evaluator=this.evaluator;this.updateMVMatrix();expr=evaluator.evalExpression(this.expresion);c=[];for(var k=expr.length-
1;0<=k;k--)c.push(this.transformVertex(new a.Vector4D(expr[k][0],expr[k][1],expr[k][2],1)));this.primitives.push(new a.Primitive3D({vertices:c,type:"face",frontColor:this.color.getColor(),backColor:this.backcolor.getColor(),edges:this.edges,model:this.model},this.space))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b;a.Polireg3D=function(b,c){this.width=b.evaluator.parser.parse("2");this.length=b.evaluator.parser.parse("2");a.Graphic3D.call(this,b,c)};a.extend(a.Polireg3D,
a.Graphic3D);a.Polireg3D.prototype.buildPrimitives=function(){evaluator=this.evaluator;this.updateMVMatrix();c=evaluator.evalExpression(this.Nu);k=[this.transformVertex(new a.Vector4D(0,0,0,1))];e=evaluator.evalExpression(this.width)/2;f=evaluator.evalExpression(this.length)/2;b=2*Math.PI/c;for(var g=0;g<c;g++)k.push(this.transformVertex(new a.Vector4D(e*Math.cos(b*g),f*Math.sin(b*g),0,1)));for(g=0;g<c;g++)this.primitives.push(new a.Primitive3D({vertices:[k[0],g+2<=c?k[g+2]:k[1],k[g+1]],type:"face",
frontColor:this.color.getColor(),backColor:this.backcolor.getColor(),edges:this.edges,model:this.model},this.space))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f;a.Text3D=function(b,c){a.Graphic3D.call(this,b,c)};a.extend(a.Text3D,a.Graphic3D);a.Text3D.prototype.buildPrimitives=function(){c=this.evaluator;k=c.evalExpression(this.expresion);e=k[0][0];f=k[0][1];this.primitives.push(new a.Primitive3D({vertices:[new a.Vector4D(e,f,0,1)],type:"text",frontColor:this.color.getColor(),
font:this.font,decimals:c.evalExpression(this.decimals),fixed:this.fixed,displace:0,isText:!0,evaluator:c,text:this.text,family:this.family,familyValue:this.familyValue,joel:"hola"},this.space))};return a}(descartesJS||{}),descartesJS=function(a,c){if(a.loadLib)return a;var k=new String("-rnd-pi-e-sqr-sqrt-ra\u00edz-exp-log-log10-abs-ent-sgn-ind-sin-sen-cos-tan-cot-sec-csc-sinh-senh-cosh-tanh-coth-sech-csch-asin-asen-acos-atan-min-max-"),e=/[\w\.\-//]*(\.png|\.jpg|\.gif|\.svg)/gi,f,b;a.Macro3D=function(b,
f){this.expresion=void 0;this.inirot="(0,0,0)";this.inirotEuler=!1;this.inipos=b.evaluator.parser.parse("(0,0,0)");this.endrot="(0,0,0)";this.endrotEuler=!1;this.endpos=b.evaluator.parser.parse("(0,0,0)");a.Graphic.call(this,b,f);for(var d in f)f.hasOwnProperty(d)&&(this[d]=f[d]);this.inirot.match("Euler")&&(this.inirot=this.inirot.replace("Euler",""),this.inirotEuler=!0);this.endrot.match("Euler")&&(this.endrot=this.endrot.replace("Euler",""),this.endrotEuler=!0);this.inirot=this.evaluator.parser.parse(this.inirot);
this.endrot=this.evaluator.parser.parse(this.endrot);this.inirotM=new a.Matrix4x4;this.inirotM_X=new a.Matrix4x4;this.inirotM_Y=new a.Matrix4x4;this.inirotM_Z=new a.Matrix4x4;this.iniposM=new a.Matrix4x4;this.endrotM=new a.Matrix4x4;this.endrotM_X=new a.Matrix4x4;this.endrotM_Y=new a.Matrix4x4;this.endrotM_Z=new a.Matrix4x4;this.endposM=new a.Matrix4x4;this.graphics=[];d=b.lessonParser;var r=new a.Tokenizer;if(void 0!=this.expresion){"'"!==this.expresion.charAt(0)&&(this.expresion="'"+this.expresion+
"'");this.expresion=this.evaluator.parser.parse(this.expresion);var p=this.evaluator.evalExpression(this.expresion),m;p&&((m=document.getElementById(p))&&"descartes/macro"==m.type?m=m.text:(m=a.openExternalFile(p))&&!m.match(/tipo_de_macro/g)&&(m=null));var q,u;if(m){u=m.replace(/&aacute;/g,"\u00e1").replace(/&eacute;/g,"\u00e9").replace(/&iacute;/g,"\u00ed").replace(/&oacute;/g,"\u00f3").replace(/&uacute;/g,"\u00fa").replace(/&Aacute;/g,"\u00c1").replace(/&Eacute;/g,"\u00c9").replace(/&Iacute;/g,
"\u00cd").replace(/&Oacute;/g,"\u00d3").replace(/&Uacute;/g,"\u00da").replace(/&ntilde;/g,"\u00f1").replace(/&Ntilde;/g,"\u00d1").replace(/\&gt;/g,">").replace(/\&lt;/g,"<").replace(/\&amp;/g,"&").replace(/\r/g,"").split("\n");m=[];for(var p=0,n=u.length;p<n;p++)q=u[p].indexOf("="),-1!==q&&(q=u[p].substring(0,q),"id"!==c[q]&&"type"!==c[q]||m.push(d.split(u[p])));for(var h,v,l,w,p=0,n=m.length;p<n;p++)for(w=(h=m[p]||[],h[0])&&"id"===h[0][0],u=0,q=h.length;u<q;u++)if(v=h[u][0].indexOf("."),-1===v||
w?v=c[h[u][0]]:(v=c[h[u][0].substring(v+1)],h[u][0]=this.name+"."+h[u][0]),!("font"===v||("fill"===v||"color"===v||"backcolor"===v||"arrow"===v)&&"("!==h[u][1].charAt(0)||"file"===v&&h[u][1].match(e)||"id"!==v&&void 0!==c[h[u][1]])||"width"===v||"height"===v||"length"===v)if("text"==v)if(h[u][1].match(/\{\\rtf1/)){v=h[u][1];var y=this;l=function(a,b){for(var d=r.tokenize(b.replace(/\&squot;/g,"'")),c=0,g=d.length;c<g;c++)"identifier"!=d[c].type||k.match("-"+d[c].value+"-")||(d[c].value=y.name+"."+
d[c].value);return(a.match(/^\\expr/)?"\\expr ":"\\decimals ")+r.flatTokens(d)};v=v.replace(/\\expr ([a-zA-Z_0-9\u00C0-\u021B+*/%|&^#!?:()><.']*)/gi,l);v=v.replace(/\\decimals ([a-zA-Z_0-9\u00C0-\u021B+*/%|&^#!?:()><.']*)/gi,l);h[u][1]=v}else{l=d.parseText(h[u][1]).textElementsMacro3Ds;for(var C=0,D=l.length;C<D;C++){v=r.tokenize(l[C].replace(/\&squot;/g,"'"));for(var z=0,F=v.length;z<F;z++)"identifier"!==v[z].type||k.match("-"+v[z].value+"-")||(v[z].value=this.name+"."+v[z].value);v=r.flatTokens(v).replace(/&squot;/g,
"'").replace(/'\+\(/g,"[").replace(/\)\+'/g,"]");l[C]=v.substring(1,v.length-1)}h[u][1]=l.join("")}else{v=r.tokenize(h[u][1]);l=0;for(C=v.length;l<C;l++)"identifier"!==v[l].type||k.match("-"+v[l].value+"-")||(v[l].value=this.name+"."+v[l].value);h[u][1]=r.flatTokens(v)}p=0;for(n=m.length;p<n;p++)if(m[p][0]){h="";w=!1;u=0;for(q=m[p].length;u<q;u++)"type"===c[m[p][u][0]]&&(h="espacio='"+this.spaceID+"' ",w=!0),h=h+m[p][u][0]+"='"+m[p][u][1]+"' ";m[p]=h;w?this.graphics.push(d.parse3DGraphic(m[p],this.abs_coord,
this.background,this.inirot)):d.parseAuxiliar(m[p])}}p=0;for(n=this.graphics.length;p<n;p++)this.graphics[p].macroChildren=!0}};a.extend(a.Macro3D,a.Graphic);a.Macro3D.prototype.update=function(){this.updateTransformation();if(this.inipos){var a=this.evaluator.evalExpression(this.inipos);this.iniPosX=a[0][0];this.iniPosY=a[0][1]}this.primitives=[];for(var a=0,c=this.graphics.length;a<c;a++)f=this.graphics[a],f.macro_inirotEuler=this.inirotEuler,f.macro_inirotM=this.inirotM,f.macro_inirotM_X=this.inirotM_X,
f.macro_inirotM_Y=this.inirotM_Y,f.macro_inirotM_Z=this.inirotM_Z,f.macro_iniposM=this.iniposM,f.macro_endrotEuler=this.endrotEuler,f.macro_endrotM=this.endrotM,f.macro_endrotM_X=this.endrotM_X,f.macro_endrotM_Y=this.endrotM_Y,f.macro_endrotM_Z=this.endrotM_Z,f.macro_endposM=this.endposM,f.update();a=0;for(c=this.graphics.length;a<c;a++){f=this.graphics[a];if(f.split||this.split)for(var d=a+1;d<c;d++)b=this.graphics[d],(b.split||this.split)&&f.splitFace(b);this.primitives=this.primitives.concat(f.primitives||
[])}};a.Macro3D.prototype.updateTransformation=function(){tmpExpr=this.evaluator.evalExpression(this.inirot);this.inirotEuler?(this.inirotM=this.inirotM.setIdentity(),this.inirotM=this.inirotM.rotateZ(a.degToRad(tmpExpr[0][0])),this.inirotM=this.inirotM.rotateX(a.degToRad(tmpExpr[0][1])),this.inirotM=this.inirotM.rotateZ(a.degToRad(tmpExpr[0][2]))):(this.inirotM_X=this.inirotM_X.setIdentity().rotateX(a.degToRad(tmpExpr[0][0])),this.inirotM_Y=this.inirotM_Y.setIdentity().rotateY(a.degToRad(tmpExpr[0][1])),
this.inirotM_Z=this.inirotM_Z.setIdentity().rotateZ(a.degToRad(tmpExpr[0][2])));tmpExpr=this.evaluator.evalExpression(this.inipos);translate={x:tmpExpr[0][0],y:tmpExpr[0][1],z:tmpExpr[0][2]};this.iniposM=this.iniposM.setIdentity().translate(translate);tmpExpr=this.evaluator.evalExpression(this.endrot);this.endrotEuler?(this.endrotM=this.endrotM.setIdentity(),this.endrotM=this.endrotM.rotateZ(a.degToRad(tmpExpr[0][0])),this.endrotM=this.endrotM.rotateX(a.degToRad(tmpExpr[0][1])),this.endrotM=this.endrotM.rotateZ(a.degToRad(tmpExpr[0][2]))):
(this.endrotM_X=this.endrotM_X.setIdentity().rotateX(a.degToRad(tmpExpr[0][0])),this.endrotM_Y=this.endrotM_Y.setIdentity().rotateY(a.degToRad(tmpExpr[0][1])),this.endrotM_Z=this.endrotM_Z.setIdentity().rotateZ(a.degToRad(tmpExpr[0][2])));tmpExpr=this.evaluator.evalExpression(this.endpos);translate={x:tmpExpr[0][0],y:tmpExpr[0][1],z:tmpExpr[0][2]};this.endposM=this.endposM.setIdentity().translate(translate)};a.Macro3D.prototype.drawAux=function(a){};return a}(descartesJS||{},babel),descartesJS=function(a){function c(a,
b,d,c,e){k.call(this,a/1.8,a/1.8,a/1.8,c,e)}function k(a,b,d,c,e){a/=2;b/=2;d/=2;this.changeGeometry(a,b,d,c,e)||(this.vertices=[new h(a,d,b,1),new h(a,-d,b,1),new h(a,d,-b,1),new h(a,-d,-b,1),new h(-a,d,b,1),new h(-a,-d,b,1),new h(-a,d,-b,1),new h(-a,-d,-b,1)],this.faces=[[2,3,1,0],[1,5,4,0],[5,7,6,4],[6,7,3,2],[4,6,2,0],[3,7,5,1]],this.updateValues(a,b,d,c,e))}function e(a,b,d,c,e){a/=2;this.changeGeometry(a,b,d,c,e)||(this.vertices=[new h(0,0,a,1),new h(-.49*a,-.86*a,-.32*a,1),new h(-.49*a,.86*
a,-.32*a,1),new h(1*a,0,-.32*a,1)],this.faces=[[3,2,1],[1,2,0],[2,3,0],[3,1,0]],this.updateValues(a,b,d,c,e))}function f(a,b,d,c,e){a/=2;this.changeGeometry(a,b,d,c,e)||(this.vertices=[new h(0,0,a,1),new h(a,0,0,1),new h(-a,0,0,1),new h(0,a,0,1),new h(0,-a,0,1),new h(0,0,-a,1)],this.faces=[[3,1,0],[2,3,0],[1,4,0],[4,2,0],[1,3,5],[3,2,5],[4,1,5],[2,4,5]],this.updateValues(a,b,d,c,e))}function b(b,d,c,e,g){b/=3.4;if(!this.changeGeometry(b,d,c,e,g)){F=b/1.6180339887;H=1.6180339887*b;this.vertices=[new h(b,
b,b,1),new h(b,b,-b,1),new h(b,-b,b,1),new h(b,-b,-b,1),new h(-b,b,b,1),new h(-b,b,-b,1),new h(-b,-b,b,1),new h(-b,-b,-b,1),new h(0,F,H,1),new h(0,F,-H,1),new h(0,-F,H,1),new h(0,-F,-H,1),new h(F,H,0,1),new h(F,-H,0,1),new h(-F,H,0,1),new h(-F,-H,0,1),new h(H,0,F,1),new h(H,0,-F,1),new h(-H,0,F,1),new h(-H,0,-F,1)];I=(new a.Matrix4x4).setIdentity().rotateY(-u/6);B=0;for(K=this.vertices.length;B<K;B++)this.vertices[B]=I.multiplyVector4(this.vertices[B]);this.faces=[[0,16,2,10,8],[12,1,17,16,0],[8,
4,14,12,0],[2,16,17,3,13],[13,15,6,10,2],[6,18,4,8,10],[3,17,1,9,11],[13,3,11,7,15],[1,12,14,5,9],[11,9,5,19,7],[5,14,4,18,19],[6,15,7,19,18]];this.updateValues(b,d,c,e,g)}}function g(b,d,c,e,g){b/=4;if(!this.changeGeometry(b,d,c,e,g)){H=1.6180339887*b;this.vertices=[new h(0,b,H,1),new h(0,b,-H,1),new h(0,-b,H,1),new h(0,-b,-H,1),new h(b,H,0,1),new h(b,-H,0,1),new h(-b,H,0,1),new h(-b,-H,0,1),new h(H,0,b,1),new h(H,0,-b,1),new h(-H,0,b,1),new h(-H,0,-b,1)];this.faces=[[10,0,2],[0,8,2],[8,5,2],[5,
7,2],[7,10,2],[6,0,10],[11,6,10],[7,11,10],[7,3,11],[5,3,7],[9,3,5],[8,9,5],[4,9,8],[0,4,8],[6,4,0],[11,3,1],[6,11,1],[4,6,1],[9,4,1],[3,9,1]];I=(new a.Matrix4x4).setIdentity().rotateY(-1.029);B=0;for(K=this.vertices.length;B<K;B++)this.vertices[B]=I.multiplyVector4(this.vertices[B]);this.updateValues(b,d,c,e,g)}}function t(a,b,d,c,e){a/=2;this.isSphere?d=b=a:(b/=2,d/=2);if(!this.changeGeometry(a,b,d,c,e)){this.vertices=[new h(0,0,b,1)];for(B=1;B<c;B++)for(z=B*u/c,E=0;E<e;E++)D=E*n/e,w=a*m(z)*q(D),
y=d*m(z)*m(D),C=b*q(z),this.vertices.push(new h(w,y,C,1));this.vertices.push(new h(0,0,-b,1));this.faces=[];for(B=0;B<e;B++)this.faces.push([0,(B+1)%e+1,B%e+1]);for(B=1;B<c-1;B++)for(E=0;E<e;E++)this.faces.push([E+1+(B-1)*e,(E+1)%e+1+(B-1)*e,(E+1)%e+1+B*e,E+1+B*e]);for(B=0;B<e;B++)this.faces.push([this.vertices.length-1,this.vertices.length-1-e+B,this.vertices.length-1-e+(B+1)%e]);this.updateValues(a,b,d,c,e)}}function d(a,b,d,c,e){a/=2;b/=2;d/=2;if(!this.changeGeometry(a,b,d,c,e)){this.vertices=
[];for(B=0;B<e;B++)for(E=0;E<c;E++)w=a*(e-B)/e*q(E*n/c),y=d*(e-B)/e*m(E*n/c),C=b-2*B*b/e,this.vertices.push(new h(w,y,C,1));this.vertices.push(new h(0,0,-b,1));this.faces=[];for(B=0;B<e-1;B++)for(E=0;E<c;E++)this.faces.push([E+B*c,(E+1)%c+B*c,(E+1)%c+(B+1)*c,E+(B+1)*c]);for(B=0;B<c;B++)this.faces.push([this.vertices.length-1,this.vertices.length-1-c+B,this.vertices.length-1-c+(B+1)%c]);this.updateValues(a,b,d,c,e)}}function r(a,b,d,c,e){a/=2;b/=2;d/=2;if(!this.changeGeometry(a,b,d,c,e)){this.vertices=
[];for(B=0;B<e+1;B++)for(E=0;E<c;E++)w=a*q(E*n/c),y=d*m(E*n/c),C=b-2*B*b/e,this.vertices.push(new h(w,y,C,1));this.faces=[];for(B=0;B<e;B++)for(E=0;E<c;E++)this.faces.push([E+B*c,(E+1)%c+B*c,(E+1)%c+(B+1)*c,E+(B+1)*c]);this.updateValues(a,b,d,c,e)}}function p(){function a(b){return parseInt(b)}function b(a){return parseFloat(a)}this.vertices=[];this.faces=[];B=0;for(K=this.fileData.length;B<K;B++)A=this.fileData[B],A.match(/^V\(/)?(G=A.substring(2,A.length-1).split(",").map(b),this.vertices.push(new h(G[0]||
0,G[1]||0,G[2]||0,1))):A.match(/^F\(/)&&(G=A.substring(2,A.length-1).split(",").map(a),this.faces.push(G.reverse()))}if(a.loadLib)return a;var m=Math.sin,q=Math.cos,u=Math.PI,n=2*u,h,v,l,w,y,C,D,z,F,H,I,A,G,B,K,E,x;a.OtherGeometry=function(n,m){this.width=n.evaluator.parser.parse("2");this.height=n.evaluator.parser.parse("2");this.length=n.evaluator.parser.parse("2");h=a.Vector4D;a.Graphic3D.call(this,n,m);switch(this.type){case "cube":this.buildGeometry=c;break;case "box":this.buildGeometry=k;break;
case "tetrahedron":this.buildGeometry=e;break;case "octahedron":this.buildGeometry=f;break;case "sphere":this.isSphere=!0;case "ellipsoid":this.buildGeometry=t;break;case "dodecahedron":this.buildGeometry=b;break;case "icosahedron":this.buildGeometry=g;break;case "cone":this.buildGeometry=d;break;case "cylinder":this.buildGeometry=r;break;case "mesh":this.fileData=a.openExternalFile(this.evaluator.evalExpression(this.file)).split(/\r/),this.buildGeometry=p}};a.extend(a.OtherGeometry,a.Graphic3D);
a.OtherGeometry.prototype.buildPrimitives=function(){v=this.evaluator;this.updateMVMatrix();this.buildGeometry(v.evalExpression(this.width),v.evalExpression(this.height),v.evalExpression(this.length),v.evalExpression(this.Nu),v.evalExpression(this.Nv));B=0;for(K=this.faces.length;B<K;B++){l=[];E=0;for(x=this.faces[B].length;E<x;E++)l.push(this.transformVertex(this.vertices[this.faces[B][E]]));this.primitives.push(new a.Primitive3D({vertices:l,type:"face",frontColor:this.color.getColor(),backColor:this.backcolor.getColor(),
edges:this.edges,model:this.model},this.space))}};a.OtherGeometry.prototype.changeGeometry=function(a,b,d,c,e){return this.oldWidth===a&&this.oldHeight===b&&this.oldLength===d&&this.oldNu===c&&this.oldNv===e};a.OtherGeometry.prototype.updateValues=function(a,b,d,c,e){this.oldWidth=a;this.oldHeight=b;this.oldLength=d;this.oldNv=e;this.oldNu=c};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.max,k=Math.min,e=Math.PI,f=Math.cos,b=Math.sin,g=Math.abs,t=Math.round,d,
r,p,m,q,u,n,h,v,l,w,y,C,D,z,F,H,I;a.R2=function(a,b){this.x=a||0;this.y=b||0};a.R2.prototype.set=function(a,b){this.x=a||0;this.y=b||0;return this};a.R2.prototype.copy=function(){return new a.R2(this.x,this.y)};a.R2.prototype.ix=function(){return t(c(k(this.x,32E3),-32E3))};a.R2.prototype.iy=function(){return t(c(k(this.y,32E3),-32E3))};a.R2.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};a.R2.prototype.norm2=function(){return this.x*this.x+this.y*this.y};a.R2.prototype.norm=function(){return Math.sqrt(this.norm2())};
a.R2.prototype.distance=function(a){r=this.copy();r.sub(a);return r.norm()};a.R2.prototype.dot=function(a){return this.x*a.x+this.y*a.y};a.R2.prototype.det=function(a){return this.x*a.y-this.y*a.x};a.R2.prototype.mul=function(a){this.x*=a;this.y*=a};a.R2.prototype.div=function(a){this.x/=a;this.y/=a};a.R2.prototype.add=function(a){this.x+=a.x;this.y+=a.y};a.R2.prototype.sub=function(a){this.x-=a.x;this.y-=a.y};a.R2.prototype.normalize=function(){d=this.norm();0!=d&&this.div(d)};a.R2.prototype.rotR90=
function(){d=this.x;this.x=this.y;this.y=-d};a.R2.prototype.rotL90=function(){d=this.x;this.x=-this.y;this.y=d};a.R2.prototype.rot=function(a){p=this.copy();u=f(a);n=b(a);this.x=p.x*u-p.y*n;this.y=p.x*n+p.y*u};a.R2.prototype.rot=function(a){this.rot(a*e/180)};a.R2.prototype.intersection=function(b,d,e,f){h=d.x-b.x;v=e.x-f.x;l=e.x-b.x;w=d.y-b.y;y=e.y-f.y;C=e.y-b.y;I=h*y-v*w;return 1E-6<g(I)?(m=(l*y-C*v)/I,q=(-l*w+C*h)/I,0<=m&&1>=m&&0<=q&&1>=q?new a.R2(b.x+h*m,b.y+w*m):null):(d.x-e.x)*C!=(d.y-e.y)*
l?null:b.x!=d.x?(D=k(b.x,d.x),z=c(b.x,d.x),D<=e.x&&e.x<=z?e:D<=f.x&&f.x<=z?f:null):e.x!=f.x?(F=k(e.x,f.x),H=c(e.x,f.x),F<=b.x&&b.x<=H?b:F<=d.x&&d.x<=H?d:null):b.y!=d.y?(D=k(b.y,d.y),z=c(b.y,d.y),D<=e.y&&e.y<=z?e:D<=f.y&&f.y<=z?f:null):e.y!=f.y?(F=k(e.y,f.y),H=c(e.y,f.y),F<=b.y&&b.y<=H?b:F<=d.y&&d.y<=H?d:null):b.x==e.x&&b.y==e.y?b:null};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b,g,t,d,r;a.R2Newton=function(d,c){this.evaluator=d;this.constraint=c;if("=="==
this.constraint.value||"<"==this.constraint.value||"<="==this.constraint.value||">"==this.constraint.value||">="==this.constraint.value)this.sign="<"==this.constraint.value||"<="==this.constraint.value?"menor":">"==this.constraint.value||">="==this.constraint.value?"mayor":"igual",this.constraint=this.constraint.equalToMinus(),this.constraint=this.constraint.childs[0];g=new a.R2(0,0);b=new a.R2(0,0);r=new a.R2(0,0)};a.R2Newton.prototype.getUnitNormal=function(){this.normal.normalize();return r.set(this.normal.x,
this.normal.y)};a.R2Newton.prototype.gradient=function(a){c=this.evaluator;g.x=0;g.y=0;t=c.getVariable("x");d=c.getVariable("y");c.setVariable("x",a.x);c.setVariable("y",a.y);this.f0=c.evalExpression(this.constraint);c.setVariable("x",c.getVariable("x")+1E-6);k=c.evalExpression(this.constraint);g.x=(k-this.f0)/1E-6;g.x=isNaN(g.x)?Infinity:g.x;c.setVariable("x",c.getVariable("x")-1E-6);c.setVariable("y",c.getVariable("y")+1E-6);k=c.evalExpression(this.constraint);g.y=(k-this.f0)/1E-6;g.y=isNaN(g.y)?
Infinity:g.y;c.setVariable("x",t);c.setVariable("y",d);return g};a.R2Newton.prototype.findZero=function(a,g,r){c=this.evaluator;b.x=a.x;b.y=a.y;t=c.getVariable("x");d=c.getVariable("y");c.setVariable("x",a.x);c.setVariable("y",a.y);this.f0=c.evalExpression(this.constraint);if("menor"===this.sign&&0>=this.f0||"mayor"===this.sign&&0<=this.f0)return b;c.setVariable("x",t);c.setVariable("y",d);for(var k=0;16>k;k++)if(e=b.x,f=b.y,this.normal=this.gradient(b),0!=this.normal.norm2()&&this.normal.mul(-this.f0/
this.normal.norm2()),b.x=e+this.normal.x,b.y=f+this.normal.y,this.normal.norm()<g)return 0===this.normal.x&&0===this.normal.y&&(this.normal.x=b.x-a.x,this.normal.y=b.y-a.y),b;return r?b:null};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;a.Vector2D=function(a,k){this.x=a;this.y=k};a.Vector2D.AXIS_X=new a.Vector2D(1,0);a.Vector2D.AXIS_Y=new a.Vector2D(0,1);a.Vector2D.prototype.vectorLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.Vector2D.prototype.dotProduct=
function(a){return this.x*a.x+this.y*a.y};a.Vector2D.prototype.angleBetweenVectors=function(a){return Math.acos(this.dotProduct(a)/(this.vectorLength()*a.vectorLength()))};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.floor,k=Math.round,e,f,b,g,t,d,r,p,m,q,u,n,h,v,l,w,y,C,D,z;a.Control=function(b,d){this.parent=b;this.evaluator=b.evaluator;var c=this.parser=b.evaluator.parser;this.id="graphic"!==d.type?"C":"G";this.gui=this.type="";this.region="south";this.y=
this.x=0;this.w="video"!==d.type?100:350;this.h="video"!==d.type?23:120;"graphic"!==d.type&&"audio"!==d.type&&"video"!==d.type?"text"!==d.type?this.expresion=c.parse("(0,0,100,23)"):(this.expresion=c.parse("(0,0,300,200)"),this.w=300,this.h=200):this.expresion=c.parse("(0,0)");this.fixed=2!=this.parent.version?!1:!0;this.visible=!0;this.color=4>this.parent.version?new a.Color("000000"):new a.Color("222222");this.colorInt="graphic"!==d.type?new a.Color("f0f8ff"):new a.Color("cc0022");this.underlined=
this.italics=this.bold="";this.font_size=4>this.parent.version?-1:c.parse("12");this.parameter=this.action="";this.parameterFont="Monospace 12px";this.drawif=c.parse("1");this.activeif=c.parse("1");this.tooltip="";this.tooltipFont="Monospace 12px";this.Explanation="";this.ExplanationFont="Monospace 12px";this.cID=this.msg_pos="";this.valueExpr=c.parse("0");this.decimals=c.parse("2");this.min=c.parse("-Infinity");this.max=c.parse("Infinity");this.incr=c.parse("0.1");this.exponentialif=this.discrete=
!1;this.zIndex=-1;for(var e in d)d.hasOwnProperty(e)&&(this[e]=d[e]);"video"!==this.type&&"audio"!==this.type||"interior"===this.region||(this.region="interior");void 0==this.name&&(this.name=2==this.parent.version?this.id:"_nada_");this.name="_._"==this.name||"_nada_"==this.name||"_void_"==this.name?"":this.name;c=this.evaluator.evalExpression(this.expresion);this.x=k(c[0][0]);this.y=k(c[0][1]);4==c[0].length&&(this.w=k(c[0][2]),this.h=k(c[0][3]));this.actionExec=b.lessonParser.parseAction(this)};
a.Control.prototype.init=function(){};a.Control.prototype.update=function(){};a.Control.prototype.draw=function(){};a.Control.prototype.getContainer=function(){var a=this.parent.spaces,b;if("interior"===this.region)for(var d=0,c=a.length;d<c;d++){if(b=a[d],b.id===this.spaceID)return b.addCtr(this),this.zIndex=b.zIndex,b.numericalControlContainer}else{if("external"===this.region)return this.parent.externalSpace.addCtr(this),this.parent.externalSpace.container;if("scenario"===this.region)return this.cID?
(this.expresion=this.evaluator.parser.parse("(0,-1000,"+this.w+","+this.h+")"),this.parent.scenarioRegion.scenarioSpace.addCtr(this),this.zIndex=this.parent.scenarioRegion.scenarioSpace.zIndex,this.parent.scenarioRegion.scenarioSpace.numericalControlContainer):this.parent.externalSpace.container;if("north"===this.region)return this.parent.northSpace.controls.push(this),this.parent.northSpace.container;if("south"===this.region)return this.parent.southSpace.controls.push(this),this.parent.southSpace.container;
if("east"===this.region)return this.parent.eastSpace.controls.push(this),this.parent.eastSpace.container;if("west"===this.region)return this.parent.westSpace.controls.push(this),this.parent.westSpace.container;if("special"===this.region)return this.parent.specialSpace.controls.push(this),this.parent.specialSpace.container}a[0].addCtr(this);this.zIndex=a[0].zIndex;return a[0].numericalControlContainer};a.Control.prototype.addControlContainer=function(a){var b=this.getContainer();b.childNodes[0]?b.insertBefore(a,
b.childNodes[0]):b.appendChild(a);b.childNodes[0]?b.insertBefore(a,b.childNodes[0]):b.appendChild(a)};a.Control.prototype.updatePositionAndSize=function(){b=g=t=d=!1;r=this.evaluator.evalExpression(this.expresion);p=k(r[0][0]);b=k(this.x)!==p;this.x=p;p=k(r[0][1]);g=k(this.y)!==p;this.y=p;4===r[0].length&&(p=k(r[0][2]),t=k(this.w)!==p,this.w=p,p=k(r[0][3]),d=k(this.h)!==p,this.h=p);if(t||d||b||g)this.init(!0),this.draw()};a.Control.prototype.formatOutputValue=function(a){h=this.parent;m=a+"";q=this.evaluator.evalExpression(this.decimals);
u=m.indexOf(".");-1!=u&&(n=m.substring(u+1),n.length>q&&(m=parseFloat(m).toFixed(q)));this.fixed&&(2!==h.version||2===h.version&&!this.exponentialif)&&(m=parseFloat(a).toFixed(q));this.exponentialif&&0!=parseFloat(m)&&(m=this.fixed&&2!==h.version?parseFloat(m).toExponential(q):parseFloat(m).toExponential(),m=m.toUpperCase(),m=m.replace("+",""));return m=m.replace(".",h.decimal_symbol)};a.Control.prototype.updateAndExecAction=function(){this.parent.updateControls();"init"===this.action&&(this.click=
!1);this.actionExec.execute();this.parent.updateControls();"animate"!==this.action&&this.parent.update()};a.Control.prototype.createGradient=function(a,b){this.linearGradient=this.ctx.createLinearGradient(0,0,0,b);e=b*b;for(var d=0;d<b;d++)f=c(d-35*b/100),this.linearGradient.addColorStop(d/b,"rgba(0,0,0,"+f*f*192/e/255+")")};a.Control.prototype.getScreenshot=function(){w=this;v=document.createElement("canvas");v.setAttribute("width",w.w);v.setAttribute("height",w.h);l=v.getContext("2d");l.font=w.fieldFontSize+
"px Arial, Helvetica, 'Droid Sans', Sans-serif";w.canvas&&(y=w.canvas.offsetLeft,C=w.canvas.offsetTop,l.drawImage(w.canvas,y,C));w.label&&(y=w.label.offsetLeft,C=w.label.offsetTop,D=w.label.offsetWidth,z=w.label.offsetHeight,l.fillStyle="#e0e4e8",l.fillRect(y,C,D,z),l.fillStyle="black",l.textAlign="center",l.textBaseline="middle",l.fillText(w.name,y+D/2,C+z/2));w.field&&(y=w.field.offsetLeft,C=w.field.offsetTop,D=w.field.offsetWidth,z=w.field.offsetHeight,l.fillStyle="white",l.strokeStyle="#666666",
l.lineWidth=1,l.fillRect(y,0,D,z),l.strokeRect(y+.5,.5,D-1,z-1),l.fillStyle="black",l.textAlign="center",l.textAlign="left",l.fillText(w.field.value,y+2,z/2));w.select&&(y=w.select.offsetLeft,C=w.select.offsetTop,D=w.select.offsetWidth,z=w.select.offsetHeight,l.fillStyle="#e0e4e8",l.strokeStyle="#666666",l.lineWidth=1,l.fillRect(y,0,D,z),l.strokeRect(y+.5,.5,D,z-1),l.fillStyle="black",l.textAlign="center",l.textAlign="left",l.fillText(w.select.value,y+2,z/2),l.fillStyle="#c0c0c0",l.fillRect(y+D-15+
.5,.5,15,z-1),l.strokeRect(y+D-15+.5,.5,15,z-1),l.fillStyle="black",l.beginPath(),l.moveTo(y+D-15+4.5,z/2-2.5),l.lineTo(y+D-15+8,z/2+2.5),l.lineTo(y+D-15+11.5,z/2-2.5),l.closePath(),l.fill());return v};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.floor,k=Math.abs,e,f,b,g,t,d,r,p,m,q,u,n,h,v,l,w,y,C,D=/[\w\.\-//]*(\.gif)/gi,z,F,H,I,A,G,B,K,E,x,L,J,M;a.Button=function(b,d){this.imageSrc="";this.image=new Image;this.imageOver=new Image;this.imageDown=new Image;
a.Control.call(this,b,d);a.button_ratio=(window.devicePixelRatio||1)/(a.ctx.webkitBackingStorePixelRatio||a.ctx.mozBackingStorePixelRatio||a.ctx.msBackingStorePixelRatio||a.ctx.oBackingStorePixelRatio||a.ctx.backingStorePixelRatio||1);-1===this.font_size&&(this.fontSizeNotSet=!0);"["===this.name.charAt(0)&&"]"===this.name.charAt(this.name.length-1)?this.name=this.parser.parse(this.name.substring(1,this.name.length-1)):this.name=this.parser.parse("'"+this.name+"'");var c;this.classContainer="";if(this.imageSrc.trim().match("^_STYLE_")){this.customStyle=
!0;this.canvasStyle=[];this.containerStyle=[];this.containerStyle.textBorder=3;c=this.imageSrc.trim().substring(8).split("|");for(var e,f,g=0,h=c.length;g<h;g++)e=c[g],f=e.match(/rgb/g),e.match("class=")?this.classContainer=" "+e.substring(6):e.match("border=")?(this.canvasStyle.push({type:"border-style",value:"solid"}),this.canvasStyle.push({type:"border-width",value:e.substring(7).trim()+"px"})):e.match("borderRadius=")?(this.canvasStyle.push({type:"border-radius",value:e.substring(13).trim()+"px"}),
this.containerStyle.push({type:"border-radius",value:e.substring(13).trim()+"px"})):e.match("borderColor=")?this.canvasStyle.push({type:"border-color",value:(f?"":"#")+e.substring(12).trim()}):e.match("overColor=")?this.containerStyle.overColor=(f?"":"#")+e.substring(10).trim():e.match("downColor=")?this.containerStyle.downColor=(f?"":"#")+e.substring(10).trim():e.match("font=")?this.containerStyle.font=e.substring(5).trim().toLowerCase():e.match("inactiveColor=")?this.containerStyle.inactiveColor=
(f?"":"#")+e.substring(14).trim():e.match("inactiveColorBorder=")?this.containerStyle.inactiveColorBorder=(f?"":"#")+e.substring(20).trim():e.match("shadowTextBlur=")?this.containerStyle.shadowTextBlur=parseFloat(e.substring(15).trim()):e.match("shadowTextOffsetX=")?this.containerStyle.shadowTextOffsetX=parseFloat(e.substring(18).trim()):e.match("shadowTextOffsetY=")?this.containerStyle.shadowTextOffsetY=parseFloat(e.substring(18).trim()):e.match("shadowTextColor=")?this.containerStyle.shadowTextColor=
(f?"":"#")+e.substring(16).trim():e.match("shadowBoxBlur=")?this.containerStyle.shadowBoxBlur=parseFloat(e.substring(14).trim()):e.match("shadowBoxOffsetX=")?this.containerStyle.shadowBoxOffsetX=parseFloat(e.substring(17).trim()):e.match("shadowBoxOffsetY=")?this.containerStyle.shadowBoxOffsetY=parseFloat(e.substring(17).trim()):e.match("shadowBoxColor=")?this.containerStyle.shadowBoxColor=(f?"":"#")+e.substring(15).trim():e.match("shadowInsetBoxBlur=")?this.containerStyle.shadowInsetBoxBlur=parseFloat(e.substring(19).trim()):
e.match("shadowInsetBoxOffsetX=")?this.containerStyle.shadowInsetBoxOffsetX=parseFloat(e.substring(22).trim()):e.match("shadowInsetBoxOffsetY=")?this.containerStyle.shadowInsetBoxOffsetY=parseFloat(e.substring(22).trim()):e.match("shadowInsetBoxColor=")?this.containerStyle.shadowInsetBoxColor=(f?"":"#")+e.substring(20).trim():e.match("textBorder=")&&(this.containerStyle.textBorder=parseFloat(e.substring(11).trim()));this.imageSrc="vacio.gif"}this.imageSrc.match("_COLORES_")&&(c=this.imageSrc.split("_"),
this.colorInt=new a.Color(c[2]),this.color=new a.Color(c[3]),this.font_size=this.parser.parse(c[5]),this.imageSrc="");"["==this.imageSrc.charAt(0)?this.imageSrc=this.parser.parse(this.imageSrc.substring(1,this.imageSrc.length-1)):this.imageSrc=this.parser.parse("'"+this.imageSrc+"'");c=this.evaluator.evalExpression(this.imageSrc).toString().trim();""!=c&&(e=c.substr(0,c.lastIndexOf(".")),f=c.substr(c.lastIndexOf(".")),c.toLowerCase().match(/vacio.gif$/)?(this.imageSrc=this.parser.parse("'vacio.gif'"),
this.image.ready=1,3===this.parent.version&&(this.name=this.parser.parse("")),this.emptyImage={ready:!0},this.parser.parse("'vacio.gif'")):(this.image=this.parent.getImage(c),e&&(this.imageOver=this.parent.getImage(e+"_over"+f),this.imageDown=this.parent.getImage(e+"_down"+f))));this.container=document.createElement("div");this.container.setAttribute("class","DescartesButtonContainer"+this.classContainer);this.container.setAttribute("id",this.id);this.container.setAttribute("style","width:"+this.w+
"px; height:"+this.h+"px; left:"+this.x+"px; top:"+this.y+"px; z-index:"+this.zIndex+";");this.canvas=document.createElement("canvas");this.canvas.width=this.w*a.button_ratio;this.canvas.height=this.h*a.button_ratio;this.canvas.setAttribute("style","position:absolute; left:0px; top:0px; width:"+this.w+"px; height:"+this.h+"px; -webkit-box-sizing:border-box; -moz-box-sizing:border-box; box-sizing:border-box;");this.ctx=this.canvas.getContext("2d");this.container.appendChild(this.canvas);this.addControlContainer(this.container);
this.registerMouseAndTouchEvents();this.init()};a.extend(a.Button,a.Control);a.Button.prototype.init=function(d){e=this.evaluator;z=this.container;f=this.canvas;b=this.ctx;g=e.evalExpression(this.expresion);this.x=g[0][0];this.y=g[0][1];4==g[0].length&&(this.w=parseInt(g[0][2]),this.h=parseInt(g[0][3]));f.width=this.w*a.button_ratio;f.height=this.h*a.button_ratio;f.setAttribute("style","position:absolute; left:0px; top:0px; width:"+this.w+"px; height:"+this.h+"px; -webkit-box-sizing:border-box; -moz-box-sizing:border-box; box-sizing:border-box;");
z.setAttribute("style","width:"+this.w+"px; height:"+this.h+"px; left:"+this.x+"px; top:"+this.y+"px; z-index:"+this.zIndex+"; display:block;");if(this.canvasStyle)for(var c=0,h=this.canvasStyle.length;c<h;c++)f.style[this.canvasStyle[c].type]=this.canvasStyle[c].value;if(this.containerStyle){c=0;for(h=this.containerStyle.length;c<h;c++)z.style[this.containerStyle[c].type]=this.containerStyle[c].value;if(this.containerStyle.shadowBoxColor){var c=this.containerStyle.shadowBoxOffsetX||0,h=this.containerStyle.shadowBoxOffsetY||
2,n=this.containerStyle.shadowBoxBlur||2;z.style.boxShadow=c+"px "+h+"px "+n+"px 1px "+this.containerStyle.shadowBoxColor}this.containerStyle.shadowInsetBoxColor&&(c=this.containerStyle.shadowInsetBoxOffsetX||0,h=this.containerStyle.shadowInsetBoxOffsetY||-2,n=this.containerStyle.shadowInsetBoxBlur||1,f.style.boxShadow=c+"px "+h+"px "+n+"px 1px "+this.containerStyle.shadowInsetBoxColor+" inset");this.containerStyle.shadowTextColor&&(b.shadowBlur=this.containerStyle.shadowTextBlur||1,b.shadowOffsetX=
this.containerStyle.shadowTextOffsetX||0,b.shadowOffsetY=this.containerStyle.shadowTextOffsetY||2,b.shadowColor=this.containerStyle.shadowTextColor)}this.fontSizeNotSet&&(this.font_size=e.parser.parse(a.getFieldFontSize(this.h)+""));this.fs_evaluated=e.evalExpression(this.font_size);this.createGradient(this.w,this.h);z.style.display=0<e.evalExpression(this.drawif)?"block":"none";b.textAlign="center";b.textBaseline="middle";b.lineJoin="round";b.font=this.italics+" "+this.bold+" "+this.fs_evaluated+
"px descartesJS_sansserif,Arial,Helvetica,Sans-serif";this.customStyle&&("serif"==this.containerStyle.font?b.font=this.italics+" "+this.bold+" "+this.fs_evaluated+"px descartesJS_serif,Times,'Times New Roman', serif":"monospace"==this.containerStyle.font?b.font=this.italics+" "+this.bold+" "+this.fs_evaluated+"px descartesJS_monospace,Courier,'Courier New',Monospace":"icons"==this.containerStyle.font&&(b.font=this.italics+" "+this.bold+" "+this.fs_evaluated+"px descartesJS_icons,Arial,Helvetica,Sans-serif"));
this.draw(d)};a.Button.prototype.update=function(){e=this.evaluator;z=this.container;f=this.canvas;this.activeIfValue=0<e.evalExpression(this.activeif);(this.drawIfValue=0<e.evalExpression(this.drawif))?(z.style.display="block",this.draw()):(z.style.display="none",this.buttonClick=!1);z.style.cursor=this.activeIfValue?"pointer":"not-allowed";f.style.cursor=this.activeIfValue?"pointer":"not-allowed";z.setAttribute("data-active",this.activeIfValue?"true":"false");this.updatePositionAndSize()};a.Button.prototype.draw=
function(g){z=this.container;e=this.evaluator;f=this.canvas;b=this.ctx;d=e.evalExpression(this.name);r=e.evalExpression(this.imageSrc)+"";if(!g&&(F=this.over===this.oldOver,H=this.buttonClick===this.oldButtonClick,I=this.activeIfValue===this.oldActiveIfValue,A=this.drawIfValue===this.oldDrawIfValue,G=d===this.oldName,B=r===this.oldImageSrc,this.oldOver=this.over,this.oldButtonClick=this.buttonClick,this.oldActiveIfValue=this.activeIfValue,this.oldDrawIfValue=this.drawIfValue,this.oldName=d,this.oldImageSrc=
r,F&&H&&I&&A&&G&&B))return;b.save();b.setTransform(a.button_ratio,0,0,a.button_ratio,0,0);t=this.fs_evaluated;z.setAttribute("data-name",d);r?(p="vacio.gif"===r?this.emptyImage:this.parent.getImage(r),K=r.substr(0,r.lastIndexOf(".")),E=r.substr(r.lastIndexOf(".")),x=K+"_over"+E,L=K+"_down"+E,J="vacio.gif"===r?this.emptyImage:this.parent.getImage(x),M="vacio.gif"===r?this.emptyImage:this.parent.getImage(L)):p=this.emptyImage;b.clearRect(0,0,this.w,this.h);q=m=0;this.buttonClick&&(q=m=1);v=c(this.w/
2+m)-.5;l=c(this.h/2+q)-.5;p&&(w=p.height||1E8,y=a.getFontMetrics(this.italics+" "+this.bold+" "+t+"px descartesJS_sansserif, Arial, Helvetica, Sans-serif").h,C=""!=d?0<=this.h-w-y-2?!0:!1:!1,n=parseInt((this.w-p.width)/2)+m,h=C?parseInt((this.h-y-p.height+2)/2):parseInt((this.h-p.height)/2)+q,C&&(l=parseInt(this.h-y/2-2),z.style.backgroundColor=this.colorInt.getColor(),b.strokeStyle=this.color.getColor(),b.lineWidth=1,b.beginPath(),b.moveTo(.5,.5),b.lineTo(this.w-.5,.5),b.lineTo(this.w-.5,this.h-
.5),b.lineTo(.5,this.h-.5),b.closePath(),b.stroke()));p&&p.ready?p!==this.emptyImage&&p.complete?r.match(D)?(this.canvas.style.backgroundImage="url('"+r+"')",this.canvas.style.backgroundPosition=n+"px "+h+"px"):b.drawImage(p,n,h):this.emptyImage&&this.customStyle&&(z.style.backgroundColor=this.colorInt.getColor()):(z.style.backgroundColor=this.colorInt.getColor(),this.buttonClick||(a.drawLine(b,this.w-1,0,this.w-1,this.h,"rgba(0,0,0,0.5)"),a.drawLine(b,0,0,0,this.h,"rgba(0,0,0,0.09)"),a.drawLine(b,
1,0,1,this.h,"rgba(0,0,0,0.03)")),b.fillStyle=this.linearGradient,b.fillRect(0,0,this.w,this.h));this.activeIfValue&&(J!==this.emptyImage&&this.over&&J.ready&&J.complete?x.match(D)?(this.canvas.style.backgroundImage="url('"+x+"')",this.canvas.style.backgroundPosition=n+"px "+h+"px"):b.drawImage(J,n,h):this.customStyle&&this.containerStyle.overColor&&this.over&&(z.style.backgroundColor=this.containerStyle.overColor));this.activeIfValue?M!==this.emptyImage&&this.buttonClick&&M.ready&&M.complete?L.match(D)?
(this.canvas.style.backgroundImage="url('"+L+"')",this.canvas.style.backgroundPosition=n+"px "+h+"px"):b.drawImage(M,n,h):this.customStyle&&this.containerStyle.downColor&&this.buttonClick&&(z.style.backgroundColor=this.containerStyle.downColor):this.buttonClick&&!p&&(b.fillStyle="rgba(0,0,0,0.09)",b.fillRect(0,0,this.w,this.h));b.fillStyle=this.color.getColor();this.customStyle&&this.containerStyle.shadowTextColor&&0<this.containerStyle.textBorder&&(b.lineWidth=this.containerStyle.textBorder,b.strokeStyle=
this.containerStyle.shadowTextColor,b.strokeText(d,v,l));C||this.containerStyle||!this.drawTextBorder()||(b.lineWidth=parseInt(t/6),b.strokeStyle=this.colorInt.getColor(),b.strokeText(d,v,l));b.fillText(d,v,l);this.underlined&&(u=b.measureText(d).width,b.strokeStyle=this.color.getColor(),b.lineWidth=c(t/10)||2,b.lineCap="round",b.beginPath(),b.moveTo(parseInt((this.w-u)/2)+m,l+c(t/2)+c(t/5)-1.5),b.lineTo(parseInt((this.w+u)/2)+m,l+c(t/2)+c(t/5)-1.5),b.stroke());this.activeIfValue||(this.customStyle&&
this.containerStyle.inactiveColor?z.style.backgroundColor=this.containerStyle.inactiveColor:(b.fillStyle="rgba(240,240,240,0.6)",b.fillRect(0,0,this.w,this.h)));b.restore();this._image_pos_x=n;this._image_pos_y=h};a.Button.prototype.drawTextBorder=function(){this.colorInt.getColor();this.color.getColor();return!(.5>(k(this.colorInt.r-this.color.r)+k(this.colorInt.g-this.color.g)+k(this.colorInt.b-this.color.b))/255)};a.Button.prototype.buttonPressed=function(){this.updateAndExecAction()};a.Button.prototype.registerMouseAndTouchEvents=
function(){function b(a,d,c){clearInterval(f);e.buttonClick&&e.drawIfValue&&e.activeIfValue&&(d.call(e),a=c?a:100,f=setTimeout(function(){b(a,d,!1)},a))}function d(f){this.focus();f.preventDefault();f.stopPropagation();document.activeElement!=document.body&&document.activeElement.blur();e.whichButton=a.whichButton(f);"L"==e.whichButton&&e.activeIfValue&&(e.buttonClick=!0,e.draw(),"calculate"==e.action&&(e.evaluator.setVariable(e.id,e.evaluator.evalExpression(e.valueExpr)),b(1E3,e.buttonPressed,!0)),
e.canvas.removeEventListener("touchend",c),e.canvas.addEventListener("touchend",c),e.canvas.removeEventListener("mouseup",c),e.canvas.addEventListener("mouseup",c))}function c(a){this.focus();a.preventDefault();a.stopPropagation();if(e.activeIfValue||e.buttonClick)e.buttonClick=!1,e.draw(),"calculate"!=e.action&&(e.evaluator.setVariable(e.id,e.evaluator.evalExpression(e.valueExpr)),e.buttonPressed()),e.canvas.removeEventListener("touchend",c),e.canvas.removeEventListener("mouseup",c);e.parent.update()}
var e=this,f;e.canvas.oncontextmenu=function(){return!1};this.over=this.buttonClick=!1;this.canvas.addEventListener("touchstart",d);this.canvas.addEventListener("mousedown",d);this.canvas.addEventListener("mouseover",function(a){a.preventDefault();a.stopPropagation();e.over=!0;e.draw()});this.canvas.addEventListener("mouseout",function(a){a.preventDefault();a.stopPropagation();e.over=!1;e.buttonClick=!1;e.draw()});document.addEventListener("visibilitychange",function(a){e.buttonClick=!1})};a.Button.prototype.getScreenshot=
function(){var a=document.createElement("canvas");a.width=this.w;a.height=this.h;b=a.getContext("2d");r=e.evalExpression(this.imageSrc);(p="vacio.gif"===r?this.emptyImage:this.parent.getImage(r))&&p.ready?b.drawImage(p,this._image_pos_x,this._image_pos_y):(b.fillStyle=this.colorInt.getColor(),b.fillRect(0,0,this.w,this.h));b.drawImage(this.canvas,0,0);return a};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b,g,t,d,r,p,m,q,u,n,h,v,l,w;a.Spinner=function(b,d){a.Control.call(this,
b,d);this.tabindex=++this.parent.tabindex;"_._"==this.name&&(this.name="");"["===this.name.charAt(0)&&"]"===this.name.charAt(this.name.length-1)?this.name=this.parser.parse(this.name.substring(1,this.name.length-1)):this.name=this.parser.parse("'"+this.name+"'");this.containerControl=document.createElement("div");this.canvas=document.createElement("canvas");this.divUp=document.createElement("div");this.divDown=document.createElement("div");this.field=document.createElement("input");this.label=document.createElement("label");
this.containerControl.appendChild(this.label);this.containerControl.appendChild(this.field);this.containerControl.appendChild(this.canvas);this.containerControl.appendChild(this.divUp);this.containerControl.appendChild(this.divDown);this.addControlContainer(this.containerControl);w=this.evaluator.parser.parse("1");this.originalIncr=this.incr;if(0>=this.evaluator.evalExpression(this.decimals)||0==this.evaluator.evalExpression(this.incr)){var c=this.evaluator.evalExpression(this.incr);0<c?this.originalIncr=
this.incr=this.evaluator.parser.parse(parseInt(c).toString()):this.incr=w}this.registerMouseAndTouchEvents();this.init()};a.extend(a.Spinner,a.Control);a.Spinner.prototype.init=function(){c=this.evaluator;var b=c.evalExpression(this.name).toString();this.label.innerHTML=b;this.value=this.validateValue(c.evalExpression(this.valueExpr));var d=this.formatOutputValue(this.value);this.fieldFontSize=2!==this.parent.version?a.getFieldFontSize(this.h):10;var e=2!==this.parent.version?"__":"_____",f=a.getTextWidth(d+
"_",this.fieldFontSize+"px Arial"),g=2+parseInt(this.h/2),h=parseInt(this.w/2-g/2),e=a.getTextWidth(b+e,this.fieldFontSize+"px Arial");this.visible||(h=this.w-g,f=0);h<e&&(h=e);""==b&&(h=0);this.w-h-g<f&&(h=this.w-g-f);0>h&&(h=0);b=this.w-(h+g);this.containerControl.setAttribute("class","DescartesSpinnerContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.setAttribute("id",
this.id);this.canvas.setAttribute("width",g+"px");this.canvas.setAttribute("height",this.h+"px");this.canvas.setAttribute("style","position: absolute; left: "+h+"px; top: 0px;");this.ctx=this.canvas.getContext("2d");this.divUp.setAttribute("class","up");this.divUp.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+g+"px; height : "+this.h/2+"px; left: "+h+"px; top: 0px;");this.divDown.setAttribute("class","down");this.divDown.setAttribute("style",
"background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+g+"px; height : "+this.h/2+"px; left: "+h+"px; top: "+this.h/2+"px;");this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"_spinner");this.field.setAttribute("class","DescartesSpinnerField");this.field.setAttribute("style","font-family: Arial; font-size: "+this.fieldFontSize+"px; width : "+b+"px; height : "+this.h+"px; left: "+(g+h)+"px;");this.field.setAttribute("tabindex",this.tabindex);
this.field.value=d;this.visible||(this.field.style.display="none");this.label.setAttribute("class","DescartesSpinnerLabel");this.label.setAttribute("style","font-size:"+this.fieldFontSize+"px; width: "+h+"px; height: "+this.h+"px; line-height: "+this.h+"px;");c.setVariable(this.id,this.value);this.createGradient(this.h/2,this.h)};a.Spinner.prototype.update=function(){c=this.evaluator;this.label.innerHTML=c.evalExpression(this.name).toString();0>=c.evalExpression(this.decimals)?(k=c.evalExpression(this.incr),
0<k?this.originalIncr=this.incr=c.parser.parse(parseInt(k).toString()):this.incr=w):this.incr=0!=c.evalExpression(this.originalIncr)?this.originalIncr:w;this.activeIfValue=0<c.evalExpression(this.activeif);this.drawIfValue=0<c.evalExpression(this.drawif);this.field.disabled=!this.activeIfValue;this.drawIfValue?(this.containerControl.style.display="block",this.draw()):(this.click=!1,this.containerControl.style.display="none");this.updatePositionAndSize();this.parent.animation.playing&&document.activeElement==
this.field||(e=this.field.value,f=this.value,this.value=this.validateValue(c.getVariable(this.id)),this.field.value=this.formatOutputValue(this.value),this.value==f&&this.field.value!=e&&(this.value=this.validateValue(e),this.field.value=this.formatOutputValue(this.value)),c.setVariable(this.id,this.value))};a.Spinner.prototype.draw=function(){b=this.ctx;g=this.canvas.width;t=this.canvas.height;b.fillStyle="#f0f8ff";b.fillRect(0,0,g,t);b.fillStyle=this.linearGradient;b.fillRect(0,0,g,t);this.up?(d=
"gray",r="#f0f8ff"):(d="#f0f8ff",r="gray");a.drawLine(b,0,0,g,0,d);a.drawLine(b,0,0,0,t/2,d);a.drawLine(b,0,t/2,g,t/2,r);this.down?(d="gray",r="#f0f8ff"):(d="#f0f8ff",r="gray");a.drawLine(b,0,t/2+1,g,t/2+1,d);a.drawLine(b,0,t/2+1,0,t,d);a.drawLine(b,0,t-1,g,t-1,r);p=[parseInt(g/2+1),parseInt(g/5+1),parseInt(g-g/5+1)];m=[parseInt(t/8+1),parseInt(t/8+1+t/4),parseInt(t/8+1+t/4)];b.fillStyle=this.activeIfValue?"#2244cc":"#8888aa";b.beginPath();b.moveTo(p[0],m[0]);b.lineTo(p[1],m[1]);b.lineTo(p[2],m[2]);
b.fill();m=[parseInt(t-t/8),parseInt(t-t/8-t/4),parseInt(t-t/8-t/4)];b.fillStyle=this.activeIfValue?"#d00018":"#aa8888";b.beginPath();b.moveTo(p[0],m[0]);b.lineTo(p[1],m[1]);b.lineTo(p[2],m[2]);b.fill();b.fillStyle="rgba(0,0,0,"+24/255+")";this.up&&b.fillRect(0,0,g,t/2);this.down&&b.fillRect(0,t/2,g,t)};a.Spinner.prototype.validateValue=function(a){c=this.evaluator;isNaN(parseFloat(a))||a.toString().match("e")&&(a=parseFloat(a).toFixed(20));a=void 0!=a?a.toString():"0";a=a.replace(this.parent.decimal_symbol,
".");q=a==parseFloat(a)?parseFloat(a):parseFloat(c.evalExpression(c.parser.parse(a)));isNaN(q)&&(q=0);h=c.evalExpression(this.min);v=c.evalExpression(this.max);""===h&&(h=-Infinity);""===v&&(v=Infinity);q<h&&(q=h);q>v&&(q=v);this.discrete&&(u=c.evalExpression(this.incr),q=0==u?0:u*Math.round(q/u));n=c.evalExpression(this.decimals);0>=n&&(n=0);return q=parseFloat(parseFloat(q).toFixed(n))};a.Spinner.prototype.increase=function(){this.changeValue(parseFloat(this.value)+this.evaluator.evalExpression(this.incr))};
a.Spinner.prototype.decrease=function(){this.changeValue(parseFloat(this.value)-this.evaluator.evalExpression(this.incr))};a.Spinner.prototype.changeValue=function(a){this.activeIfValue&&(this.value=this.validateValue(a),this.field.value=this.formatOutputValue(this.value),this.evaluator.setVariable(this.id,this.value),this.updateAndExecAction())};a.Spinner.prototype.registerMouseAndTouchEvents=function(){function b(a,d,c){clearInterval(n);if(g.up||g.down)d.call(g),a=c?a:30,n=setTimeout(function(){b(a,
d)},a)}function d(c){c.preventDefault();g.whichButton=a.whichButton(c);"L"==g.whichButton&&g.activeIfValue&&(g.up=!0,b(h,g.increase,!0),g.draw())}function c(d){d.preventDefault();g.whichButton=a.whichButton(d);"L"==g.whichButton&&g.activeIfValue&&(g.down=!0,b(h,g.decrease,!0),g.draw())}function e(a){g.up=!1;clearInterval(n);g.draw()}function f(a){g.down=!1;clearInterval(n);g.draw()}l=a.hasTouchSupport;var g=this,h=l?500:200,n;g.divUp.oncontextmenu=g.divDown.oncontextmenu=g.field.oncontextmenu=g.label.oncontextmenu=
function(){return!1};this.label.addEventListener("touchstart",function(a){a.preventDefault();return!1});this.label.addEventListener("mousedown",function(a){a.preventDefault();return!1});this.field.addEventListener("keydown",function(a){13==a.keyCode&&g.changeValue(g.field.value)});this.divUp.addEventListener("touchstart",d);this.divUp.addEventListener("mousedown",d);this.divDown.addEventListener("touchstart",c);this.divDown.addEventListener("mousedown",c);this.divUp.addEventListener("mouseout",function(a){g.up=
!1;clearInterval(n);g.draw();a.preventDefault()});this.divDown.addEventListener("mouseout",function(a){g.down=!1;clearInterval(n);g.draw();a.preventDefault()});this.divUp.addEventListener("touchend",e);window.addEventListener("touchend",e);this.divUp.addEventListener("mouseup",e);window.addEventListener("mouseup",e);this.divDown.addEventListener("touchend",f);window.addEventListener("touchend",f);this.divDown.addEventListener("mouseup",f);window.addEventListener("mouseup",f);document.addEventListener("visibilitychange",
function(a){g.up=!1;g.down=!1;clearInterval(n);g.draw()});g.field.addEventListener("click",function(a){this.select();this.focus()})};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b,g;a.TextField=function(b,d){a.Control.call(this,b,d);"["===this.name.charAt(0)&&"]"===this.name.charAt(this.name.length-1)?this.name=this.parser.parse(this.name.substring(1,this.name.length-1)):this.name=this.parser.parse("'"+this.name.trim()+"'");void 0===this.valueExprString&&(this.valueExprString=
this.onlyText?"0":"");this.emptyString=!1;this.ok=0;this.tabindex=++this.parent.tabindex;this.regExpDecimalSymbol=new RegExp("\\"+this.parent.decimal_symbol,"g");if(this.answer)if(this.answer.match("krypto_")&&(this.answer=(new a.Krypto).decode(this.answer.substring(7))),this.answerPattern=this.answer,this.answer=a.buildRegularExpresionsPatterns(this.answer,this.evaluator),this.onlyText){var c=this.answerPattern.indexOf("|");this.firstAnswer=-1==c?this.answerPattern:this.answerPattern.substring(0,
c)}else this.firstAnswer=this.parser.parse(this.answerPattern.substring(1,this.answerPattern.indexOf(",")));this.onlyText&&(this.valueExprString.match(/^'/)&&this.valueExprString.match(/'$/)||(this.valueExpr=this.evaluator.parser.parse("'"+this.valueExprString+"'")),this.validateValue=function(a){a=a.toString();return"''"==a||"'"==a?"":a&&a.match(/^'/)&&a.match(/'$/)?a.substring(1,a.length-1):a},this.formatOutputValue=function(a){return a.toString()});""==name.trim()&&(name="");this.containerControl=
document.createElement("div");this.field=document.createElement("input");this.label=document.createElement("label");this.containerControl.appendChild(this.label);this.containerControl.appendChild(this.field);this.addControlContainer(this.containerControl);this.registerMouseAndTouchEvents();this.init()};a.extend(a.TextField,a.Control);a.TextField.prototype.init=function(){c=this.evaluator;var b=c.evalExpression(this.name).toString();this.label.innerHTML=b;this.value=this.validateValue(c.evalExpression(this.valueExpr));
var d=this.formatOutputValue(this.value);this.fieldFontSize=a.getFieldFontSize(this.h);var e=a.getTextWidth(d+"_",this.fieldFontSize+"px Arial"),g=parseInt(this.w/2),f=a.getTextWidth(b,this.fieldFontSize+"px Arial");this.visible||(g=this.w,e=0);g<f&&(g=f);""==b&&(g=0);this.w-g<e&&(g=this.w-e);0>g&&(g=0);b=this.w-g;this.containerControl.setAttribute("class","DescartesTextFieldContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+
this.y+"px; z-index: "+this.zIndex+";");this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"TextField");this.field.setAttribute("class","DescartesTextFieldField");this.field.setAttribute("style","font-size: "+this.fieldFontSize+"px; width : "+b+"px; height : "+this.h+"px; left: "+g+"px;");this.field.setAttribute("tabindex",this.tabindex);this.field.value=d;this.label.setAttribute("class","DescartesTextFieldLabel");this.label.setAttribute("style","font-size:"+this.fieldFontSize+
"px; width: "+g+"px; height: "+this.h+"px; line-height: "+this.h+"px;");this.evaluate&&(this.ok=this.evaluateAnswer());this.evaluator.setVariable(this.id,this.value);this.evaluator.setVariable(this.id+".ok",this.ok);this.oldValue=this.value;this.update()};a.TextField.prototype.update=function(){c=this.evaluator;this.label.innerHTML=c.evalExpression(this.name).toString();this.activeIfValue=0<c.evalExpression(this.activeif);this.drawIfValue=0<c.evalExpression(this.drawif);this.field.disabled=!this.activeIfValue;
this.containerControl.style.display=this.drawIfValue?"block":"none";this.updatePositionAndSize();this.parent.animation.playing&&document.activeElement==this.field||(k=this.field.value,e=this.value,this.value=this.validateValue(c.getVariable(this.id)),this.field.value=this.formatOutputValue(this.value),this.value===e&&this.field.value!=k&&(this.value=this.validateValue(k),this.field.value=this.formatOutputValue(this.value)),c.setVariable(this.id,this.value))};a.TextField.prototype.validateValue=function(a){if(""===
a||"''"==a)return"";c=this.evaluator;a=a.toString().replace(this.regExpDecimalSymbol,".","g");f=a==parseFloat(a)?parseFloat(a):parseFloat(c.evalExpression(c.parser.parse(a)));isNaN(f)&&(f=0);b=c.evalExpression(this.min);""==b&&(b=-Infinity);g=c.evalExpression(this.max);""==g&&(g=Infinity);this.discrete&&(a=c.evalExpression(this.incr),f=0==a?0:a*Math.round(f/a));return f=parseFloat(parseFloat(f).toFixed(c.evalExpression(this.decimals)))};a.TextField.prototype.formatOutputValue=function(a){return""===
a?"":this.uber.formatOutputValue.call(this,a)};a.TextField.prototype.changeValue=function(a,b){this.activeIfValue&&(this.value=this.validateValue(a),this.field.value=this.formatOutputValue(this.value),this.evaluate&&(this.ok=this.evaluateAnswer()),this.evaluator.setVariable(this.id,this.value),this.evaluator.setVariable(this.id+".ok",this.ok),this.updateAndExecAction())};a.TextField.prototype.evaluateAnswer=function(){return a.esCorrecto(this.answer,this.value,this.evaluator,this.answer)};a.TextField.prototype.getFirstAnswer=
function(){return this.answer?this.onlyText?this.firstAnswer:this.evaluator.evalExpression(this.firstAnswer):""};a.TextField.prototype.registerMouseAndTouchEvents=function(){var a=this;a.field.oncontextmenu=a.label.oncontextmenu=function(){return!1};a.label.addEventListener("touchstart",function(a){a.preventDefault();return!1});a.label.addEventListener("mousedown",function(a){a.preventDefault();return!1});this.field.addEventListener("blur",function(b){a.evaluator.evalExpression(a.drawIf)&&a.changeValue(a.field.value,
!0)});this.field.addEventListener("keydown",function(b){a.activeIfValue&&13==b.keyCode&&a.changeValue(a.field.value,!0)});a.field.addEventListener("click",function(a){this.select();this.focus()})};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.abs,k,e,f,b,g,t,d,r,p,m;a.Menu=function(b,d){function c(a){g.options=a.split(",");g.menuOptions=[];g.strValue=[];var b;a=0;for(var d=g.options.length;a<d;a++)b=g.customSplit(g.options[a]),1==b.length?(g.menuOptions.push(b[0]),
g.strValue.push(a.toString())):2==b.length&&(g.menuOptions.push(b[0]),""==b[1]?g.strValue.push(a.toString()):g.strValue.push(b[1]));a=0;for(d=g.menuOptions.length;a<d;a++)g.menuOptions[a].match(/^\[/)&&g.menuOptions[a].match(/\]$/)?g.menuOptions[a]=k.parse(g.menuOptions[a].substring(1,g.menuOptions[a].length-1)):g.menuOptions[a]=k.parse("'"+g.menuOptions[a]+"'");a=0;for(d=g.strValue.length;a<d;a++)g.strValue[a].match(/^\[/)&&g.strValue[a].match(/\]$/)?g.strValue[a]=k.parse(g.strValue[a].substring(1,
g.strValue[a].length-1)):g.strValue[a]=k.parse(g.strValue[a]);for(;g.select.firstChild;)g.select.removeChild(g.select.firstChild);a=0;for(d=g.menuOptions.length;a<d;a++)b=document.createElement("option"),b.innerHTML=e.evalExpression(g.menuOptions[a]),g.select.appendChild(b)}this.options="";a.Control.call(this,b,d);k=this.parser;e=this.evaluator;this.ok=0;this.tabindex=++this.parent.tabindex;this.answer&&(this.answer.match("krypto_")&&(this.answer=(new a.Krypto).decode(this.answer.substring(7))),this.answer=
parseInt(this.answer.split(",")[0].replace("[",""))||0);"["===this.name.charAt(0)&&"]"===this.name.charAt(this.name.length-1)?this.name=this.parser.parse(this.name.substring(1,this.name.length-1)):this.name=this.parser.parse("'"+this.name+"'");var g=this;this.evaluator.setFunction(this.id+".setOptions",c);this.containerControl=document.createElement("div");this.label=document.createElement("label");this.select=document.createElement("select");this.field=document.createElement("input");c(this.options);
this.containerControl.appendChild(this.label);this.containerControl.appendChild(this.select);this.visible&&this.containerControl.appendChild(this.field);this.addControlContainer(this.containerControl);this.registerMouseAndTouchEvents();this.init()};a.extend(a.Menu,a.Control);a.Menu.prototype.init=function(b){e=this.evaluator;var d=e.evalExpression(this.name).toString();this.label.innerHTML=d;this.fieldFontSize=2!=this.parent.version?a.getFieldFontSize(this.h):10;var c=0,g=0,f=0;this.value=b?this.value:
e.evalExpression(this.valueExpr);this.indexValue=this.getIndex(this.value);b=0;for(var p=this.menuOptions.length;b<p;b++)f=a.getTextWidth(e.evalExpression(this.menuOptions[b]).toString(),this.fieldFontSize+"px Arial"),f>c&&(c=f,g=b);c+=25;f=a.getTextWidth(this.formatOutputValue(e.evalExpression(this.strValue[g])),this.fieldFontSize+"px Arial")+7;g=a.getTextWidth(d,this.fieldFontSize+"px Arial")+10;""==d&&(g=0);this.visible||(f=0);for(d=this.w-f-g;d<c&&0<g;)g--,d++;for(;d<c&&0<f;)f--,d++;for(;g+d+
f+1<this.w;)d++,f++;c=g;b=c+d;f=this.w-b;p=this.formatOutputValue(e.evalExpression(this.strValue[this.indexValue]));this.containerControl.setAttribute("class","DescartesMenuContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index:"+this.zIndex+";");this.label.setAttribute("class","DescartesMenuLabel");this.label.setAttribute("style","font-size:"+this.fieldFontSize+"px; width:"+g+"px; height:"+this.h+"px; line-height:"+
this.h+"px;");this.field.setAttribute("type","text");this.field.setAttribute("id",this.id+"_menuField");this.field.value=p;this.field.setAttribute("class","DescartesMenuField");this.field.setAttribute("style","font-size: "+this.fieldFontSize+"px; width: "+f+"px; height: "+this.h+"px; left:"+b+"px;");this.field.setAttribute("tabindex",this.tabindex);this.select.setAttribute("id",this.id+"_menuSelect");this.select.setAttribute("class","DescartesMenuSelect");this.select.setAttribute("style","text-align:left; font-size:"+
this.fieldFontSize+"px; width: "+d+"px; height: "+this.h+"px; left: "+c+"px; border: 1.5px solid #7a8a99; background-color: #eeeeee;");this.select.setAttribute("tabindex",this.tabindex);this.select.selectedIndex=this.indexValue;e.setVariable(this.id,parseFloat(p.replace(this.parent.decimal_symbol,".")));this.update()};a.Menu.prototype.update=function(){e=this.evaluator;this.activeIfValue=0<e.evalExpression(this.activeif);this.drawIfValue=0<e.evalExpression(this.drawif);this.field.disabled=this.activeIfValue?
!1:!0;this.select.disabled=this.activeIfValue?!1:!0;this.drawIfValue?this.containerControl.style.display="block":(this.click=!1,this.containerControl.style.display="none");if(!this.parent.animation.playing||document.activeElement!=this.select){this.label.innerHTML=e.evalExpression(this.name).toString();for(var a=0,b=this.menuOptions.length;a<b;a++)this.select.options[a].innerHTML=e.evalExpression(this.menuOptions[a]);this.value=e.getVariable(this.id);isNaN(this.value)&&(this.value=0);this.field.value=
this.formatOutputValue(this.value);e.setVariable(this.id,parseFloat(this.value));this.select.selectedIndex=parseFloat(this.getIndex(this.value))}this.ok=this.value==this.answer?1:0;this.evaluator.setVariable(this.id+".ok",this.ok);this.updatePositionAndSize()};a.Menu.prototype.customSplit=function(a){t=!1;d="";r=0;for(p=-1;r<a.length;){m=a.charAt(r);a.charAt(r-1);if("["===m&&-1===p){if(t||""!=d)d+="\u00a6";p++}else"["===m?p++:"]"===m&&0===p?(t=!0,p--):"]"==a.charAt(r)&&(p=0>p?p:p-1);d+=a.charAt(r);
r++}return d.split("\u00a6")};a.Menu.prototype.getIndex=function(a){a=parseFloat(a.toString().replace(this.parent.decimal_symbol,"."));f=-1;b=Infinity;for(var d=0,e=this.strValue.length;d<e;d++)g=c(a-parseFloat(this.evaluator.evalExpression(this.strValue[d]))),g<=b&&(b=g,f=d);return f};a.Menu.prototype.changeValue=function(){this.activeIfValue&&(this.evaluator.setVariable(this.id,this.value),this.updateAndExecAction())};a.Menu.prototype.registerMouseAndTouchEvents=function(){var a=this;a.select.oncontextmenu=
a.label.oncontextmenu=a.field.oncontextmenu=function(){return!1};a.label.addEventListener("touchstart",function(a){a.preventDefault();return!1});a.label.addEventListener("mousedown",function(a){a.preventDefault();return!1});this.select.addEventListener("change",function(b){a.value=a.evaluator.evalExpression(a.strValue[this.selectedIndex]);a.field.value=a.formatOutputValue(a.value);a.evaluator.setVariable(a.id,a.field.value);a.changeValue();b.preventDefault()});this.field.addEventListener("keydown",
function(b){13==b.keyCode&&(a.indexValue=a.getIndex(a.field.value),a.value=a.evaluator.evalExpression(a.strValue[a.indexValue]),a.field.value=a.formatOutputValue(a.indexValue),a.select.selectedIndex=a.indexValue,a.changeValue())});a.field.addEventListener("click",function(a){this.focus()})};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.floor,k,e,f,b,g,t,d,r,p,m,q,u,n,h,v,l,w,y,C,D,z;a.Scrollbar=function(b,d){a.Control.call(this,b,d);"["===this.name.charAt(0)&&
"]"===this.name.charAt(this.name.length-1)?this.name=this.parser.parse(this.name.substring(1,this.name.length-1)):this.name=this.parser.parse("'"+this.name+"'");this.orientation=this.w>=this.h?"h":"v";this.containerControl=document.createElement("div");this.canvas=document.createElement("canvas");this.divUp=document.createElement("div");this.divDown=document.createElement("div");this.field=document.createElement("input");this.scrollManipulator=document.createElement("div");this.label=document.createElement("label");
this.containerControl.appendChild(this.canvas);this.containerControl.appendChild(this.label);this.containerControl.appendChild(this.divUp);this.containerControl.appendChild(this.divDown);this.containerControl.appendChild(this.field);this.containerControl.appendChild(this.scrollManipulator);this.addControlContainer(this.containerControl);this.registerMouseAndTouchEvents();this.init()};a.extend(a.Scrollbar,a.Control);a.Scrollbar.prototype.init=function(){k=this.evaluator;this.findOffset();0==k.evalExpression(this.decimals)?
this.incr=1:this.incr=(k.evalExpression(this.max)-k.evalExpression(this.min))/100;this.value=this.validateValue(k.evalExpression(this.valueExpr));f=this.formatOutputValue(this.value);b=this.evaluator.evalExpression(this.expresion);this.x=b[0][0];this.y=b[0][1];4==b[0].length&&(this.w=b[0][2],this.h=b[0][3]);this.orientation=this.w>=this.h?"h":"v";this.initScroll(f);this.changeScrollPositionFromValue();this.prePos=this.pos;k.setVariable(this.id,this.value)};a.Scrollbar.prototype.initScroll=function(b){e=
this;k=e.evaluator;var d=k.evalExpression(e.name).toString();e.label.innerHTML=d;var c="v"===e.orientation?parseInt(19+5*(e.h-100)/100):e.h;e.fieldFontSize="v"===e.orientation?c-parseInt(e.h/20)-1:2!==e.parent.version?a.getFieldFontSize(c):10;var g=a.getTextWidth(b+"_",e.fieldFontSize+"px Arial"),f=e.parent.getSpaceById(e.spaceID).h;e.labelHeight=""==d?0:c;e.fieldHeight=""==e.visible?0:c;if("v"===e.orientation)e.canvasWidth=e.w,e.canvasHeight=e.h-e.labelHeight-e.fieldHeight,18<=e.canvasHeight+e.y-
f&&(e.canvasHeight=f),d=0,d=e.fieldHeight,g=d+e.canvasHeight,e.canvasX=0,e.canvasY=e.fieldHeight,e.labelWidth=e.w,e.labelY=g,e.upWidth=e.downW=e.w,e.upHeight=e.downH=15,e.upX=0,e.upY=e.fieldHeight,e.downX=0,e.downY=g-e.downH,e.fieldWidth=e.w,e.fieldX=0,e.scrollManipulatorW=e.w,e.scrollManipulatorH=parseInt((e.canvasHeight-e.upHeight-e.downH-e.labelHeight-e.fieldHeight)/10),e.scrollManipulatorH=15>e.scrollManipulatorH?15:e.scrollManipulatorH,e.scrollManipulatorLimInf=g-e.downH-e.scrollManipulatorH,
e.scrollManipulatorLimSup=d+e.downH;else{c=a.getTextWidth(d,e.fieldFontSize+"px Arial")+10;e.labelWidth=c;e.fieldWidth=g;""==d&&(e.labelWidth=0);e.visible||(e.fieldWidth=0);for(g=e.w-e.fieldWidth-e.labelWidth;58>g&&0<e.labelWidth;)e.labelWidth--,g++;for(;58>g&&0<e.fieldWidth;)e.fieldWidth--,g++;d=e.labelWidth;c=d+g;e.fieldWidth=e.w-c;e.canvasWidth=g;e.canvasHeight=e.h;e.canvasX=e.labelWidth;e.canvasY=0;e.fieldX=e.canvasWidth+e.labelWidth;e.labelHeight=e.h;e.labelY=0;e.upWidth=e.downW=15;e.upHeight=
e.downH=e.h;e.upX=c-e.downW;e.upY=0;e.downX=e.labelWidth;e.downY=0;e.scrollManipulatorW=parseInt((e.canvasWidth-e.upWidth-e.downW)/10);e.scrollManipulatorW=15>e.scrollManipulatorW?15:e.scrollManipulatorW;e.scrollManipulatorH=e.h;e.scrollManipulatorLimInf=d+e.downW;e.scrollManipulatorLimSup=d+e.canvasWidth-e.downW-e.scrollManipulatorW}e.containerControl.setAttribute("class","DescartesScrollbarContainer");e.containerControl.setAttribute("id",e.id);e.containerControl.setAttribute("style","width: "+e.w+
"px; height: "+e.h+"px; left: "+e.x+"px; top: "+e.y+"px; z-index: "+e.zIndex+";");e.canvas.setAttribute("width",e.w+"px");e.canvas.setAttribute("height",e.h+"px");e.canvas.setAttribute("style","position: absolute; left: 0px; top: 0px;");e.ctx=e.canvas.getContext("2d");e.divUp.setAttribute("class","DescartesCatcher up");e.divUp.setAttribute("style","width : "+e.upWidth+"px; height : "+e.upHeight+"px; left: "+e.upX+"px; top: "+e.upY+"px;");e.divDown.setAttribute("class","DescartesCatcher down");e.divDown.setAttribute("style",
"width : "+e.downW+"px; height : "+e.downH+"px; left: "+e.downX+"px; top: "+e.downY+"px;");e.scrollManipulator.setAttribute("class","DescartesCatcher manipulator");e.scrollManipulator.setAttribute("style","width : "+e.scrollManipulatorW+"px; height : "+e.scrollManipulatorH+"px;");e.scrollManipulator.style.top=("v"===e.orientation?e.scrollManipulatorLimInf:0)+"px";e.scrollManipulator.style.left=("v"===e.orientation?0:e.scrollManipulatorLimInf)+"px";e.field.setAttribute("type","text");e.field.setAttribute("id",
e.id+"scrollbar");e.field.setAttribute("class","DescartesScrollbarField");e.field.setAttribute("style","font-size: "+e.fieldFontSize+"px; width : "+e.fieldWidth+"px; height : "+e.fieldHeight+"px; left: "+e.fieldX+"px; top: 0px;");e.field.value=b;0===e.fieldHeight&&(e.field.style.display="none");e.label.setAttribute("class","DescartesScrollbarLabel");e.label.setAttribute("style","font-size:"+e.fieldFontSize+"px; width: "+e.labelWidth+"px; height: "+e.labelHeight+"px; line-height: "+e.labelHeight+"px; left: 0px; top:"+
e.labelY+"px;")};a.Scrollbar.prototype.update=function(){k=this.evaluator;this.label.innerHTML=k.evalExpression(this.name).toString();0==k.evalExpression(this.decimals)?this.incr=1:this.incr=(k.evalExpression(this.max)-k.evalExpression(this.min))/100;this.activeIfValue=0<k.evalExpression(this.activeif);this.drawIfValue=0<k.evalExpression(this.drawif);this.field.disabled=!this.activeIfValue;this.drawIfValue?(this.containerControl.style.display="block",this.draw()):this.containerControl.style.display=
"none";this.updatePositionAndSize();var a=this.validateValue(k.getVariable(this.id));a==this.value||0<Math.abs(a-this.value)&&1E-9>Math.abs(a-this.value)||(this.value=a,this.changeScrollPositionFromValue(),this.prePos=this.pos);this.value=a;this.field.value=this.formatOutputValue(this.value);k.setVariable(this.id,this.value)};a.Scrollbar.prototype.draw=function(){e=this;g=e.ctx;d=c(this.w);t=c(this.h);g.fillStyle="#e0e4e8";g.fillRect(0,0,d,t);g.strokeStyle="#7a8a99";e.down&&(g.fillStyle="#ccdcec",
g.fillRect(e.downX+.5,e.downY+.5,e.downW,e.downH-1));g.strokeRect(e.downX+.5,e.downY+.5,e.downW,e.downH-1);e.up&&(g.fillStyle="#ccdcec",g.fillRect(e.upX+.5,e.upY-.5,e.upWidth,e.upHeight+1));g.strokeRect(e.upX+.5,e.upY-.5,e.upWidth,e.upHeight+1);r=4;g.fillStyle="black";g.beginPath();"h"===e.orientation?(g.moveTo(e.downX+r,e.downH/2),g.lineTo(e.downX+e.downW-r,r),g.lineTo(e.downX+e.downW-r,e.downH-r),g.moveTo(e.upX+e.upWidth-r,e.downH/2),g.lineTo(e.upX+r,r),g.lineTo(e.upX+r,e.downH-r),g.fill(),e.activeIfValue&&
(p=c(e.pos),g.fillStyle="#ccdcec",g.fillRect(p+.5,0,c(e.scrollManipulatorW),t),g.strokeStyle="#6382bf",g.strokeRect(p+.5,0,c(e.scrollManipulatorW),t),m=c(e.scrollManipulatorW/2),g.beginPath(),g.moveTo(p+m+.5-2,3),g.lineTo(p+m+.5-2,t-3),g.moveTo(p+m+.5,3),g.lineTo(p+m+.5,t-3),g.moveTo(p+m+.5+2,3),g.lineTo(p+m+.5+2,t-3),g.stroke())):(g.moveTo(e.downX+e.downW/2,e.downY+e.downH-r),g.lineTo(e.downX+r,e.downY+r),g.lineTo(e.downX+e.downW-r,e.downY+r),g.moveTo(e.upX+e.upWidth/2,e.upY+r),g.lineTo(e.upX+r,
e.upY+e.upHeight-r),g.lineTo(e.upX+e.upWidth-r,e.upY+e.upHeight-r),g.fill(),e.activeIfValue&&(p=c(e.pos),g.fillStyle="#ccdcec",g.fillRect(0,p+.5,d,c(e.scrollManipulatorH)),g.strokeStyle="#6382bf",g.strokeRect(0,p+.5,d,c(e.scrollManipulatorH)),m=c(e.scrollManipulatorH/2),g.beginPath(),g.moveTo(3,p+m+.5-2),g.lineTo(d-3,p+m+.5-2),g.moveTo(3,p+m+.5),g.lineTo(d-3,p+m+.5),g.moveTo(3,p+m+.5+2),g.lineTo(d-3,p+m+.5+2),g.stroke()));g.strokeRect(.5,.5,d-1,t-1);e.activeIfValue||(g.fillStyle="rgba(240,240,240,"+
160/255+")",g.fillRect(0,0,d,t.h))};a.Scrollbar.prototype.validateValue=function(a){k=this.evaluator;q=a.toString();q=parseFloat(q.replace(this.parent.decimal_symbol,"."));isNaN(q)&&(q=0);this.minimo=k.evalExpression(this.min);q<this.minimo&&(this.value=null,q=this.minimo);this.maximo=k.evalExpression(this.max);q>this.maximo&&(this.value=null,q=this.maximo);u=this.incr;q=0!=u?q*u/u:0;this.fixed&&(q=parseFloat(parseFloat(q).toFixed(k.evalExpression(this.decimals))));return q};a.Scrollbar.prototype.increase=
function(){this.changeValue(parseFloat(this.value)+this.incr)};a.Scrollbar.prototype.decrease=function(){this.changeValue(parseFloat(this.value)-this.incr)};a.Scrollbar.prototype.increase10=function(){r=(this.evaluator.evalExpression(this.max)-this.evaluator.evalExpression(this.min))/10;"h"==this.orientation?this.clickPos.x>this.prePos&&this.changeValue(parseFloat(this.value)+r):this.clickPos.y<this.prePos&&this.changeValue(parseFloat(this.value)+r)};a.Scrollbar.prototype.decrease10=function(){r=
(this.evaluator.evalExpression(this.max)-this.evaluator.evalExpression(this.min))/10;"h"==this.orientation?this.clickPos.x<this.prePos&&this.changeValue(parseFloat(this.value)-r):this.clickPos.y>this.prePos&&this.changeValue(parseFloat(this.value)-r)};a.Scrollbar.prototype.changeValue=function(a){this.activeIfValue&&(n=this.validateValue(a),n!=this.value&&(this.value=n,this.field.value=this.formatOutputValue(n),this.changeScrollPositionFromValue(),this.prePos=this.pos,this.evaluator.setVariable(this.id,
this.value),this.updateAndExecAction()))};a.Scrollbar.prototype.changeValueForScrollMovement=function(){k=this.evaluator;h=this.scrollManipulatorLimInf;v=this.scrollManipulatorLimSup;l=k.evalExpression(this.min);w=k.evalExpression(this.max);u=this.incr;n=c((this.pos-h)*(w-l)/(v-h)/u)*u+l;n!=this.value&&(this.value=n,this.field.value=this.formatOutputValue(n),k.setVariable(this.id,this.value),this.parent.updateControls(),this.actionExec.execute(),this.parent.update())};a.Scrollbar.prototype.changeScrollPositionFromValue=
function(){k=this.evaluator;h=this.scrollManipulatorLimInf;v=this.scrollManipulatorLimSup;l=k.evalExpression(this.min);w=k.evalExpression(this.max);u=this.incr;this.pos=(this.value-l)*(v-h)/(w-l)+h;"h"==this.orientation?this.scrollManipulator.style.left=this.pos+"px":this.scrollManipulator.style.top=this.pos+"px"};a.Scrollbar.prototype.registerMouseAndTouchEvents=function(){function b(a,d,c,e){clearInterval(q);(l.up||l.down||l.canvasClick)&&1E-7<Math.abs(l.value-e)&&(d.call(l),a=c?a:30,q=setTimeout(function(){b(a,
d,!1,e)},a))}function d(c){c.preventDefault();l.whichButton=a.whichButton(c);"L"==l.whichButton&&l.activeIfValue&&(l.clickPos=l.getCursorPosition(c),l.canvasClick=!0,"h"==l.orientation?l.clickPos.x<l.prePos?b(t,l.decrease10,!0,l.minimo):b(t,l.increase10,!0,l.maximo):l.clickPos.y<l.prePos?b(t,l.increase10,!0,l.maximo):b(t,l.decrease10,!0,l.minimo))}function c(a){l.canvasClick=!1;clearInterval(q)}function e(a){1==l.canvasClick&&(l.clickPos=l.getCursorPosition(a),a.preventDefault())}function g(a){l.scrollClick=
!1;l.prePos=l.pos;window.removeEventListener("mouseup",g,!1);window.removeEventListener("mousemove",h,!1);a.preventDefault()}function f(a){l.scrollClick=!1;l.prePos=l.pos;window.removeEventListener("touchend",f,!1);window.removeEventListener("touchmove",h,!1);a.preventDefault()}function h(a){var b=l.getCursorPosition(a);"h"==l.orientation?(l.pos=l.prePos-(l.initPos.x-b.x),l.pos<l.scrollManipulatorLimInf&&(l.pos=l.scrollManipulatorLimInf),l.pos>l.scrollManipulatorLimSup&&(l.pos=l.scrollManipulatorLimSup),
l.scrollManipulator.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+l.scrollManipulatorW+"px; height : "+l.h+"px; left: "+l.pos+"px; top: 0px;")):(l.pos=l.prePos-(l.initPos.y-b.y),l.pos>l.scrollManipulatorLimInf&&(l.pos=l.scrollManipulatorLimInf),l.pos<l.scrollManipulatorLimSup&&(l.pos=l.scrollManipulatorLimSup),l.scrollManipulator.setAttribute("style","background-color: rgba(255, 255, 255, 0); cursor: pointer; position: absolute; width : "+
l.w+"px; height : "+l.scrollManipulatorH+"px; left: 0px; top: "+l.pos+"px;"));l.changeValueForScrollMovement();a.preventDefault()}function n(d){d.preventDefault();l.whichButton=a.whichButton(d);"L"==l.whichButton&&l.activeIfValue&&(l.up=!0,b(t,l.increase,!0,l.maximo))}function p(d){d.preventDefault();l.whichButton=a.whichButton(d);"L"==l.whichButton&&l.activeIfValue&&(l.down=!0,b(t,l.decrease,!0,l.minimo))}function m(a){l.down=!1;clearInterval(q);a.preventDefault()}function r(a){l.up=!1;clearInterval(q);
l.draw()}function k(a){l.down=!1;clearInterval(q);l.draw()}y=a.hasTouchSupport;var l=this,t=y?500:200,q;l.canvas.oncontextmenu=l.divUp.oncontextmenu=l.divDown.oncontextmenu=l.label.oncontextmenu=l.field.oncontextmenu=l.scrollManipulator.oncontextmenu=function(){return!1};this.field.addEventListener("keydown",function(a){13==a.keyCode&&l.changeValue(l.field.value)});this.canvas.addEventListener("touchstart",d);this.canvas.addEventListener("mousedown",d);this.divDown.addEventListener("mouseout",m);
window.addEventListener("touchend",c);window.addEventListener("mouseup",c);this.canvas.addEventListener("touchmove",e);this.canvas.addEventListener("mousemove",e);this.scrollManipulator.addEventListener("touchstart",function(a){l.activeIfValue&&(l.scrollClick=!0,l.initPos=l.getCursorPosition(a),window.addEventListener("touchend",f),window.addEventListener("touchmove",h),a.preventDefault())});this.scrollManipulator.addEventListener("mousedown",function(a){l.activeIfValue&&(l.scrollClick=!0,l.initPos=
l.getCursorPosition(a),window.addEventListener("mouseup",g),window.addEventListener("mousemove",h),a.preventDefault())});this.divUp.addEventListener("touchstart",n);this.divUp.addEventListener("mousedown",n);this.divDown.addEventListener("touchstart",p);this.divDown.addEventListener("mousedown",p);this.divUp.addEventListener("mouseout",function(a){l.up=!1;clearInterval(q);a.preventDefault()});this.divDown.addEventListener("mouseout",m);window.addEventListener("touchend",r);window.addEventListener("mouseup",
r);window.addEventListener("touchend",k);window.addEventListener("mouseup",k)};a.Scrollbar.prototype.findOffset=function(){C=this.containerControl;this.offsetTop=this.offsetLeft=0;D=this.containerControl.style.display;for(this.containerControl.style.display="block";C;)this.offsetLeft+=C.offsetLeft||0,this.offsetTop+=C.offsetTop||0,C=C.parentNode;this.containerControl.style.display=D};a.Scrollbar.prototype.getCursorPosition=function(b){z=a.getCursorPosition(b);return{x:z.x-this.offsetLeft,y:z.y-this.offsetTop}};
return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c;a.Audio=function(c,f){this.controls=!0;this.file="";this.oldDrawIf=0;a.Control.call(this,c,f);var b=this,g=b.evaluator.evalExpression(b.expresion);4==g[0].length?(b.w=g[0][2],b.h=g[0][3]):(b.w=200,b.h=28);b.audio=b.parent.getAudio(b.file);b.autoplay&&(b.audio.setAttribute("autoplay","autoplay"),b.audio.play());b.loop&&b.audio.setAttribute("loop","loop");b.controls&&b.audio.setAttribute("controls","controls");b.audio.setAttribute("style",
"position: absolute; width: "+b.w+"px; left: "+b.x+"px; top: "+b.y+"px; z-index: "+b.zIndex+";");b.addControlContainer(b.audio);b.evaluator.setFunction(b.id+".play",function(){b.audio.play();return 0});b.evaluator.setFunction(b.id+".pause",function(){b.audio.pause();return 0});b.evaluator.setFunction(b.id+".stop",function(){b.audio.pause();return b.audio.currentTime=0});b.evaluator.setFunction(b.id+".currentTime",function(a){b.audio.currentTime=parseFloat(a);return 0});b.audio.addEventListener("timeupdate",
function(a){b.evaluator.setVariable(b.id+".currentTime",b.audio.currentTime)})};a.extend(a.Audio,a.Control);a.Audio.prototype.init=function(){this.audio.style.left=this.x+"px";this.audio.style.top=this.y+"px";this.update()};var k;a.Audio.prototype.update=function(){c=this.evaluator;(k=0<c.evalExpression(this.drawif))?this.audio.style.display="block":(this.audio.style.display="none",k!==this.oldDrawIf&&this.audio.pause());this.oldDrawIf=k;this.updatePositionAndSize()};return a}(descartesJS||{}),descartesJS=
function(a){if(a.loadLib)return a;var c;a.Video=function(e,f){this.controls=!0;this.file="";this.oldDrawIf=0;a.Control.call(this,e,f);var b=this;c=b.evaluator;var g=b.evaluator.evalExpression(b.expresion);4==g[0].length?(b.w=g[0][2],b.h=g[0][3]):(b.w=null,b.h=null);b.video=document.createElement("video");b.autoplay&&b.video.setAttribute("autoplay","autoplay");b.loop&&b.video.setAttribute("loop","loop");b.controls&&b.video.setAttribute("controls","controls");b.poster&&b.video.setAttribute("poster",
b.poster);b.w&&(b.video.setAttribute("width",b.w),b.video.setAttribute("height",b.h));b.video.setAttribute("style","position: absolute; overflow: hidden; left: "+b.x+"px; top: "+b.y+"px;");var g=b.file,k=g.lastIndexOf(".");-1!=k&&(g=b.file.substring(0,k));b.video.canPlayType("video/mp4")&&(k=document.createElement("source"),k.setAttribute("src",g+".mp4"),b.video.appendChild(k));b.video.canPlayType("video/ogg")&&(k=document.createElement("source"),k.setAttribute("src",g+".ogg"),k.setAttribute("type",
"video/ogg"),b.video.appendChild(k),k=document.createElement("source"),k.setAttribute("src",g+".ogv"),k.setAttribute("type","video/ogg"),b.video.appendChild(k));b.video.canPlayType("video/webm")&&(k=document.createElement("source"),k.setAttribute("src",g+".webm"),k.setAttribute("type","video/webm"),b.video.appendChild(k));b.addControlContainer(b.video);b.evaluator.setFunction(b.id+".play",function(){b.video.play();return 0});b.evaluator.setFunction(b.id+".pause",function(){b.video.pause();return 0});
b.evaluator.setFunction(b.id+".stop",function(){b.video.pause();return b.video.currentTime=0});b.evaluator.setFunction(b.id+".currentTime",function(a){b.video.currentTime=parseFloat(a);return 0});b.video.addEventListener("timeupdate",function(a){b.evaluator.setVariable(b.id+".currentTime",b.video.currentTime)})};a.extend(a.Video,a.Control);a.Video.prototype.init=function(){this.video.style.left=this.x+"px";this.video.style.top=this.y+"px";this.update()};var k;a.Video.prototype.update=function(){c=
this.evaluator;k=0<c.evalExpression(this.drawif);0<c.evalExpression(this.drawif)?this.video.style.display="block":(this.video.style.display="none",k!==this.oldDrawIf&&this.video.pause());this.oldDrawIf=k;this.updatePositionAndSize()};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k;a.TextArea=function(c,f){this.font="Monospaced,PLAIN,12";a.Control.call(this,c,f);this.region="interior";this.tabindex=++this.parent.tabindex;if(this.answer){this.answer.match("krypto_")&&
(this.answer=(new a.Krypto).decode(this.answer.substring(7)));var b=this.parent.lessonParser.parseText(this.answer)}this.containerControl=document.createElement("div");this.textArea=document.createElement("div");this.textAreaAnswer=document.createElement("div");this.showButton=document.createElement("div");this.activeCover=document.createElement("div");this.containerControl.appendChild(this.textArea);this.containerControl.appendChild(this.textAreaAnswer);this.containerControl.appendChild(this.showButton);
this.containerControl.appendChild(this.activeCover);this.addControlContainer(this.containerControl);this.showAnswer=!1;this.text=void 0==this.text||"simpleText"==this.text.type?this.rawText||"":this.text.hasFormula?this.rawText:this.text.toHTML();b&&"simpleText"!=b.type&&(this.answer=this.text.hasFormula?"":b.toHTML());this.evaluator.setVariable(this.id,this.text);this.drawButton();this.registerMouseAndTouchEvents();this.init()};a.extend(a.TextArea,a.Control);a.TextArea.prototype.init=function(){k=
this.answer?28:8;c=this.evaluator;var e;e=this.text.match(/<span/)?this.text:this.text.replace(/\\n/g,"<br/>");this.containerControl.setAttribute("class","DescartesTextAreaContainer");this.containerControl.setAttribute("style","width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");this.containerControl.style.display=0<c.evalExpression(this.drawif)?"block":"none";this.containerControl.setAttribute("spellcheck","false");this.textArea.setAttribute("class",
"DescartesTextAreaContainer");this.textArea.setAttribute("style","width: "+(this.w-8)+"px; height: "+(this.h-k)+"px; left: 4px; top: 4px; background-color: white; text-align: left; font: "+a.convertFont(this.font)+";");this.textArea.setAttribute("contenteditable","true");this.textArea.innerHTML="<span style='position: relative; top: 10px; left: 10px; white-space: nowrap;' >"+e+"</span>";this.textAreaAnswer.setAttribute("class","DescartesTextAreaContainer");this.textAreaAnswer.setAttribute("style",
"width: "+(this.w-8)+"px; height: "+(this.h-k)+"px; left: 4px; top: 4px; background-color: white; text-align: left; font: "+a.convertFont(this.font)+";");this.textAreaAnswer.style.display=this.showAnswer?"block":"none";this.textAreaAnswer.innerHTML="<span style='position: relative; top: 10px; left: 10px; white-space: nowrap;'>"+this.answer+"</span>";this.showButton.setAttribute("style","width: 20px; height: 16px; position: absolute; bottom: 4px; right: 4px; cursor: pointer;");this.showButton.style.backgroundImage=
"url("+this.imageUnPush+")";this.showButton.style.display=this.answer?"block":"none";this.showButton.innerHTML="<span style='position: relative; top: 2px; text-align: center; font: 9px Arial'> S </span>";this.activeCover.setAttribute("style","position: absolute; width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px;");this.update()};a.TextArea.prototype.drawButton=function(){var c=document.createElement("canvas");c.setAttribute("width",20);c.setAttribute("height",16);var f=
c.getContext("2d");this.canvas=c;this.ctx=f;this.createGradient(20,16);f.lineWidth=1;f.fillStyle="white";f.fillRect(0,0,20,16);f.fillStyle=this.linearGradient;f.fillRect(0,0,20,16);a.drawLine(f,19,0,19,16,"rgba(0,0,0,"+128/255+")");a.drawLine(f,0,0,0,16,"rgba(0,0,0,"+24/255+")");a.drawLine(f,1,0,1,16,"rgba(0,0,0,"+8/255+")");this.imageUnPush=c.toDataURL();f.fillStyle="white";f.fillRect(0,0,20,16);f.fillStyle=this.linearGradient;f.fillRect(0,0,20,16);a.drawLine(f,0,0,0,14,"gray");a.drawLine(f,0,0,
19,0,"gray");f.fillStyle="rgba(0, 0, 0,"+24/255+")";f.fillRect(0,0,this.w,this.h);this.imagePush=c.toDataURL()};a.TextArea.prototype.update=function(){c=this.evaluator;this.activeIfValue=0<c.evalExpression(this.activeif);this.drawIfValue=0<c.evalExpression(this.drawif);var a;a=this.text.match(/<span/)?this.rawText:this.text;c.setVariable(this.id,a);this.activeCover.style.display=this.activeIfValue?"none":"block";this.containerControl.style.display=this.drawIfValue?"block":"none";this.updatePositionAndSize()};
a.TextArea.prototype.registerMouseAndTouchEvents=function(){function a(b){b.preventDefault();c.showButton.style.backgroundImage="url("+c.imageUnPush+")"}var c=this;this.showButton.addEventListener("mousedown",function(a){a.preventDefault();c.showAnswer=!c.showAnswer;c.textAreaAnswer.style.display=c.showAnswer?"block":"none";c.showButton.childNodes[0].childNodes[0].textContent=c.showAnswer?"T":"S";c.showButton.style.backgroundImage="url("+c.imagePush+")"});this.showButton.addEventListener("mouseup",
a);this.showButton.addEventListener("mouseout",a)};a.TextArea.prototype.getScreenshot=function(){var a=document.createElement("canvas");a.setAttribute("width",this.w);a.setAttribute("height",this.h);var c=a.getContext("2d");c.fillStyle="white";c.strokeStyle="black";c.lineWidth=1;c.fillRect(0,0,this.w,this.h);c.strokeRect(0,0,this.w,this.h);return a};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=2*Math.PI,k,e,f,b,g,t,d,r,p;a.GraphicControl=function(b,d){e=b.evaluator.parser;
this.text=this.spaceID="";this.size=e.parse("4");this.font="Monospaced,PLAIN,12";this.image=new Image;this.image.onload=function(){this.ready=1};this.imageSrc="";a.Control.call(this,b,d);this.touchId=null;this.font=a.convertFont(this.font);if(this.constraintExpr){this.constraint=e.parse(this.constraintExpr);"(expr)"==this.constraint.type&&(this.constraint=e.parse(this.constraintExpr.substring(1,this.constraintExpr.length-1)));if("compOperator"==this.constraint.type){var c=this.constraint.childs[0],
g=this.constraint.childs[1];"identifier"!=c.type||"y"!=c.value||g.contains("y")?"identifier"!=c.type||"x"!=c.value||g.contains("x")?this.newt=new a.R2Newton(this.evaluator,this.constraint):(this.evalConstraint=this.evalConstraintY,this.constraint=g):(this.evalConstraint=this.evalConstraintX,this.constraint=g)}else this.constraint=null;r=new a.R2(0,0)}this.container=this.getContainer();this.mouseCacher=document.createElement("div");this.mouseCacher.setAttribute("class","DescartesGraphicControl");this.mouseCacher.setAttribute("id",
this.id);this.mouseCacher.setAttribute("dragged",!0);this.mouseCacher.setAttribute("tabindex","-1");this.ctx=this.space.ctx;this.container.appendChild(this.mouseCacher);this.registerMouseAndTouchEvents();this.xString=this.id+".x";this.yString=this.id+".y";this.activoString=this.id+".activo";this.activeString=this.id+".active";""!==this.space.id&&2!==b.version?(this.mxString=this.space.id+".mouse_x",this.myString=this.space.id+".mouse_y",this.mclickedString=this.space.id+".mouse_clicked",this.mclicizquierdoString=
this.space.id+".clic_izquierdo"):(this.mxString="mouse_x",this.myString="mouse_y",this.mclickedString="mouse_clicked",this.mclicizquierdoString="clic_izquierdo");this.init()};a.GraphicControl.prototype.init=function(){k=this.evaluator;p=a.hasTouchSupport;var b=k.evalExpression(this.expresion);this.x=b[0][0];this.y=b[0][1];k.setVariable(this.xString,this.x);k.setVariable(this.yString,this.y);this.mouseCacher.setAttribute("style","cursor: pointer; background-color: rgba(255, 255, 255, 0); z-index: "+
this.zIndex+";");""==this.imageSrc||this.imageSrc.toLowerCase().match(/vacio.gif$/)?(this.width=2*k.evalExpression(this.size),this.height=2*k.evalExpression(this.size),this._w=p&&48>this.width?48:this.width,this._h=p&&48>this.height?48:this.height,this.mouseCacher.style.borderRadius=parseInt(Math.min(this._w,this._h)/2)+"px"):(this.image=this.parent.getImage(this.imageSrc),this.width=this.image.width,this.height=this.image.height,this._w=Math.max(this.width,32),this._h=Math.max(this.height,32));this.mouseCacher.style.width=
this._w+"px";this.mouseCacher.style.height=this._h+"px";this.mouseCacher.style.left=parseInt(this.space.getAbsoluteX(this.x)-this._w/2)+"px";this.mouseCacher.style.top=parseInt(this.space.getAbsoluteY(this.y)-this._h/2)+"px";k.setVariable(this.activoString,0);k.setVariable(this.activeString,0);this.setImage=!1;this.update()};a.GraphicControl.prototype.update=function(){k=this.evaluator;this.activeIfValue=0<k.evalExpression(this.activeif);this.drawIfValue=0<k.evalExpression(this.drawif);this.x=k.getVariable(this.xString);
this.y=k.getVariable(this.yString);f=this.space.getAbsoluteX(this.x);b=this.space.getAbsoluteY(this.y);this.mouseCacher.style.display=this.activeIfValue?"block":"none";this.mouseCacher.style.left=parseInt(f-this._w/2)+"px";this.mouseCacher.style.top=parseInt(b-this._h/2)+"px";this.constraint&&this.evalConstraint();this.draw()};a.GraphicControl.prototype.draw=function(){k=this.evaluator;this.drawIfValue&&(t=this.ctx,d=this.space.backgroundCtx,f=parseInt(this.space.getAbsoluteX(this.x))+.5,b=parseInt(this.space.getAbsoluteY(this.y))+
.5,""!=this.text&&this.drawText(f,b),this.image.ready?(this.image.complete&&!this.setImage&&t.drawImage(this.image,parseInt(f-this.image.width/2),parseInt(b-this.image.height/2)),this.trace&&(d.save(),d.translate(f,b),d.scale(parseInt(this.image.width/2),parseInt(this.image.height/2)),d.beginPath(),d.arc(0,0,1,0,c,!1),d.restore(),d.lineWidth=1,d.strokeStyle=this.trace.getColor(),d.stroke())):(t.beginPath(),t.arc(f,b,parseInt(this.width/2),0,c,!1),t.fillStyle=this.colorInt.getColor(),t.fill(),t.lineWidth=
1,t.strokeStyle=this.color.getColor(),t.stroke(),this.active&&(t.beginPath(),t.arc(f,b,parseInt(this.width/2)-2,0,c,!1),t.strokeStyle=this.colorInt.borderColor(),t.stroke()),this.trace&&(d.lineWidth=1,d.strokeStyle=this.trace.getColor(),d.beginPath(),d.arc(f,b,parseInt(this.width/2),0,c,!1),d.stroke())))};a.GraphicControl.prototype.evalConstraint=function(){r.set(this.x,this.y);g=this.newt.findZero(r,1/this.space.scale,!0);this.x=g.x;this.y=g.y;this.evaluator.setVariable(this.xString,this.x);this.evaluator.setVariable(this.yString,
this.y)};a.GraphicControl.prototype.evalConstraintX=function(){var a=this.evaluator.getVariable("x");this.evaluator.setVariable("x",this.x);this.y=this.evaluator.evalExpression(this.constraint);this.evaluator.setVariable(this.xString,this.x);this.evaluator.setVariable(this.yString,this.y);this.evaluator.setVariable("x",a)};a.GraphicControl.prototype.evalConstraintY=function(){var a=this.evaluator.getVariable("y");this.evaluator.setVariable("y",this.y);this.x=this.evaluator.evalExpression(this.constraint);
this.evaluator.setVariable(this.xString,this.x);this.evaluator.setVariable(this.yString,this.y);this.evaluator.setVariable("y",a)};a.GraphicControl.prototype.drawText=function(a,b){t=this.ctx;k=this.evaluator;"simpleText"==this.text.type?(t.fillStyle=this.color.getColor(),t.font=this.font,t.textBaseline="alphabetic",t.fillText(this.text.toString(k.evalExpression(this.decimals),this.fixed),parseInt(a+1+this.width/2),parseInt(b-1-this.height/2))):(t.fillStyle=this.color.getColor(),t.strokeStyle=this.color.getColor(),
t.textBaseline="alphabetic",this.text.draw(t,parseInt(a+1+this.width/2),parseInt(b-1-this.height/2),this.decimals,this.fixed,"start",!0,this.color.getColor()))};a.GraphicControl.prototype.getContainer=function(){for(var a=this.parent.spaces,b,d=0,c=a.length;d<c;d++)if(b=a[d],b.id==this.spaceID)return b.addCtr(this),this.zIndex=b.zIndex,this.space=b,b.graphicControlContainer;a[0].addCtr(this);this.zIndex=a[0].zIndex;this.space=a[0];return a[0].graphicControlContainer};a.GraphicControl.prototype.deactivate=
function(){this.active=!1;this.evaluator.setVariable(this.activoString,0);this.evaluator.setVariable(this.activeString,0);this.evaluator.setVariable(this.mclicizquierdoString,0)};a.GraphicControl.prototype.registerMouseAndTouchEvents=function(){function b(a){document.body.focus();a.preventDefault();a.stopPropagation();e.touchId=null;e.evaluator.setVariable(e.mclickedString,1);e.evaluator.setVariable(e.mclicizquierdoString,1);if(e.activeIfValue||e.active)e.click=!1,window.removeEventListener("touchmove",
d,!1),window.removeEventListener("touchend",b,!1),window.removeEventListener("mouseup",b,!1),window.removeEventListener("mousemove",d,!1),g=e.getCursorPosition(a),e.posX=e.prePos.x-(e.posAnte.x-g.x),e.posY=e.prePos.y-(e.posAnte.y-g.y),e.evaluator.setVariable(e.xString,e.space.getRelativeX(e.posX)),e.evaluator.setVariable(e.yString,e.space.getRelativeY(e.posY)),e.evaluator.setVariable(e.mxString,e.space.getRelativeX(g.x)),e.evaluator.setVariable(e.myString,e.space.getRelativeY(g.y)),e.parent.update(),
e.mouseCacher.style.left=e.space.getAbsoluteX(e.x)-e._w/2+"px",e.mouseCacher.style.top=e.space.getAbsoluteY(e.y)-e._h/2+"px";e.parent.deactivateGraphiControls()}function d(a){a.preventDefault();a.touchId=e.touchId;e.evaluator.setVariable(e.mclickedString,0);e.evaluator.setVariable(e.mclicizquierdoString,0);g=e.getCursorPosition(a);e.posX=e.prePos.x-(e.posAnte.x-g.x);e.posY=e.prePos.y-(e.posAnte.y-g.y);e.evaluator.setVariable(e.xString,e.space.getRelativeX(e.posX));e.evaluator.setVariable(e.yString,
e.space.getRelativeY(e.posY));e.evaluator.setVariable(e.mxString,e.space.getRelativeX(g.x));e.evaluator.setVariable(e.myString,e.space.getRelativeY(g.y));10<Date.now()-c&&(e.parent.updateControls(),e.parent.update(),c=Date.now())}var c=0,e=this;this.active=this.over=this.click=!1;this.mouseCacher.oncontextmenu=function(){return!1};this.mouseCacher.addEventListener("touchstart",function(a){document.body.focus();a.preventDefault();e.activeIfValue&&(e.parent.deactivateGraphiControls(),e.click=!0,e.active=
!0,e.evaluator.setVariable(e.activoString,1),e.evaluator.setVariable(e.activeString,1),e.evaluator.setVariable(e.mclickedString,0),e.evaluator.setVariable(e.mclicizquierdoString,0),e.posAnte=e.getCursorPosition(a),e.prePos={x:e.space.getAbsoluteX(e.x),y:e.space.getAbsoluteY(e.y)},e.evaluator.setVariable(e.mxString,e.space.getRelativeX(e.posAnte.x)),e.evaluator.setVariable(e.myString,e.space.getRelativeY(e.posAnte.y)),e.parent.update(),window.addEventListener("touchmove",d),window.addEventListener("touchend",
b))});this.mouseCacher.addEventListener("mousedown",function(c){document.body.focus();c.preventDefault();e.whichButton=a.whichButton(c);"L"==e.whichButton&&e.activeIfValue&&e.over&&(e.parent.deactivateGraphiControls(),e.click=!0,e.active=!0,e.evaluator.setVariable(e.activoString,1),e.evaluator.setVariable(e.activeString,1),e.evaluator.setVariable(e.mclickedString,0),e.evaluator.setVariable(e.mclicizquierdoString,0),e.posAnte=e.getCursorPosition(c),e.prePos={x:e.space.getAbsoluteX(e.x),y:e.space.getAbsoluteY(e.y)},
e.evaluator.setVariable(e.mxString,e.space.getRelativeX(e.posAnte.x)),e.evaluator.setVariable(e.myString,e.space.getRelativeY(e.posAnte.y)),e.parent.update(),window.addEventListener("mouseup",b),window.addEventListener("mousemove",d))});this.mouseCacher.addEventListener("mouseover",function(a){e.over=!0});this.mouseCacher.addEventListener("mouseout",function(a){e.over=!1;e.click=!1});var g};a.GraphicControl.prototype.getCursorPosition=function(a){if(a.touches){var b;if(a.touchId)for(d=0,e=a.touches.length;d<
e;d++){if(a.touches[d].identifier==a.touchId){b=a.touches[d];break}}else for(var d=0,e=a.touches.length;d<e;d++)if(a.target==a.touches[d].target){b=a.touches[d];this.touchId=b.identifier;break}mouseX=b.pageX;mouseY=b.pageY}else void 0!=a.pageX&&void 0!=a.pageY?(mouseX=a.pageX,mouseY=a.pageY):(mouseX=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,mouseY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);return{x:mouseX-(this.space.offsetLeft+document.body.scrollLeft),
y:mouseY-(this.space.offsetTop+document.body.scrollTop)}};return a}(descartesJS||{}),descartesJS=function(a,c){var k,e,f,b,g,t,d,r,p,m;if(a.loadLib)return a;var q,u,n,h,v,l,w,y,C=/[\w-//]*(\.png|\.jpg|\.gif|\.svg)/gi,D,z,F,H,I,A,G,B,K,E,x,L,J,M,N,O,S,T,Q,R,P;a.LessonParser=function(b){this.parent=b;this.parser=b.evaluator.parser;this.RTFparser=new a.RTFParser(b.evaluator)};a.LessonParser.prototype.parseButtonsConfig=function(a){var b={rowsNorth:0,rowsSouth:0,widthEast:125,widthWest:125,height:23};
a=this.split(a);for(var d=0,e=a.length;d<e;d++)switch(n=a[d][0],h=a[d][1],u=c[n],u){case "rowsNorth":case "rowsSouth":case "widthEast":case "widthWest":case "height":b[u]=parseInt(h);break;case "about":case "config":case "init":case "clear":b[u]="true"===c[h];break;default:console.log("----- attributo de space no identificado: <"+n+"> valor: <"+h+"> -----")}return b};a.LessonParser.prototype.parseSpace=function(b){v={};b=this.split(b);for(var d=0,e=b.length;d<e;d++)switch(n=b[d][0],h=b[d][1],u=c[n],
u){case "type":case "id":case "cID":case "file":v[u]=h;break;case "fixed":case "numbers":case "sensitive_to_mouse_movements":case "R3":case "split":v[u]="true"===c[h];break;case "bg_display":case "render":v[u]=c[h];break;case "net":case "net10":case "axes":case "text":v[u]=""!=h?"false"===c[h]?"":new a.Color(h,this.parent.evaluator):"";break;case "x_axis":case "y_axis":v[u]="false"===c[h]?"":h;break;case "O.x":v.OxExpr=h;break;case "O.y":v.OyExpr=h;break;case "image":v.imageSrc=h;break;case "x":q=
h;q="%"===q[q.length-1]?(this.parent.container.width*parseFloat(q)/100).toString():h;v.xExpr=this.parser.parse(q);break;case "y":q=h;q="%"===q[q.length-1]?(this.parent.container.height*parseFloat(q)/100).toString():h;v.yExpr=this.parser.parse(q);break;case "width":q=h.trim();"%"===q[q.length-1]?(v.wExpr=q,q=this.parent.container.width*parseFloat(q)/100):(q=parseFloat(h),q!=h&&(q=this.parent.container.width,v._w_=h.trim()));v.w=q;break;case "height":q=h.trim();"%"===q[q.length-1]?(v.hExpr=q,q=this.parent.container.height*
parseFloat(q)/100):(q=parseFloat(h),q!=h&&(q=this.parent.container.height,v._h_=h.trim()));v.h=q;break;case "drawif":""!=h&&(v.drawif=this.parser.parse(h));break;case "scale":q=parseFloat(h);isNaN(q)&&(q=48);v.scale=q;break;case "background":v.background=new a.Color(h,this.parent.evaluator);break;default:console.log("----- attributo de space no identificado: <"+n+"> valor: <"+h+"> -----")}switch(v.type){case "R2":return new a.Space2D(this.parent,v);case "R3":return new a.Space3D(this.parent,v);case "AP":return new a.SpaceAP(this.parent,
v);case "HTMLIFrame":return new a.SpaceHTML_IFrame(this.parent,v);default:return new a.Space2D(this.parent,v)}};a.LessonParser.prototype.parseControl=function(b){l={type:"numeric"};b=this.split(b);for(var d=0,e=b.length;d<e;d++)switch(n=b[d][0],h=b[d][1],u=c[n],u){case "id":case "name":case "parameter":case "tooltip":case "tooltipFont":case "Explanation":case "ExplanationFont":case "cID":case "options":case "font":case "file":case "answer":l[u]=h;break;case "gui":case "region":case "action":case "msg_pos":case "poster":l[u]=
c[h];break;case "fixed":case "visible":case "discrete":case "onlyText":case "evaluate":case "autoplay":case "loop":case "controls":l[u]="true"===c[h];break;case "color":case "colorInt":case "trace":l[u]=new a.Color(h,this.parent.evaluator);break;case "font_size":case "drawif":case "activeif":case "decimals":case "min":case "max":case "size":""!=h&&(l[u]=this.parser.parse(h));break;case "constraint":l.constraintExpr=h;break;case "image":l.imageSrc=h;break;case "space":l.spaceID=h;break;case "type":l.type=
c[h.trim()];break;case "expresion":l.expresion=this.parser.parse(h.replace(")(",","));break;case "bold":"false"!=c[h]&&(l.bold="bold");break;case "italics":"false"!=c[h]&&(l.italics="italic");break;case "underlined":"false"!=c[h]&&(l.underlined=!0);break;case "value":var g=h.replace(/&squot;/g,"'");g.match(/^\|/)&&(g="'"+g.substring(1),g.match(/\|$/)&&(g=g.substring(0,g.length-1)+"'"));l.valueExpr=this.parser.parse(g);l.valueExprString=g;break;case "incr":0!=h&&(l.incr=this.parser.parse(h));break;
case "exponentialif":l.exponentialif=parseFloat(h);break;case "text":l.rawText=h;for(var g=this.parseText(h),f=0,p=g.length;f<p;f++)g[f]=this.parser.parse(g[f],!1);l.text=g;break;default:f=n.indexOf(".");g=c[n.substring(0,f)];f=c[n.substring(f+1)];if("parameter"===g&&"font"===f){l.parameterFont=h;break}else if("Explanation"===g&&"font"===f){l.ExplanationFont=h;break}else if("tooltip"===g&&"font"===f){l.tooltipFont=h;break}console.log("----- attributo de control no identificado: <"+n+"> valor: <"+
h+"> -----")}if("numeric"===l.type)switch(l.gui){case "spinner":return new a.Spinner(this.parent,l);case "button":return new a.Button(this.parent,l);case "textfield":return new a.TextField(this.parent,l);case "menu":return new a.Menu(this.parent,l);case "scrollbar":return new a.Scrollbar(this.parent,l);default:return new a.Spinner(this.parent,l)}else{if("video"===l.type)return new a.Video(this.parent,l);if("audio"===l.type)return new a.Audio(this.parent,l);if("graphic"===l.type)return new a.GraphicControl(this.parent,
l);if("text"===l.type)return new a.TextArea(this.parent,l)}};a.LessonParser.prototype.parseGraphic=function(b,d,e,g){w={rotateExp:g,parameter:"t"};b=this.split(b);g=0;for(var f=b.length;g<f;g++)if(n=b[g][0],h=b[g][1],u=c[n],""!=h)switch(u){case "type":case "align":w[u]=c[h];break;case "background":case "abs_coord":case "visible":case "editable":case "fixed":case "vectors":w[u]="true"===c[h];break;case "color":case "fill":case "fillP":case "fillM":case "arrow":case "trace":w[u]="false"===c[h]?"":new a.Color(h,
this.parent.evaluator);break;case "family":case "parameter":case "info":case "font":case "name":case "init":case "end":w[u]=h;break;case "drawif":case "width":case "decimals":case "size":case "spear":case "center":case "radius":case "opacity":case "inirot":case "inipos":case "range":""!=h&&(w[u]=this.parser.parse(h));break;case "space":w.spaceID=h;break;case "expresion":""!=h&&("macro"!=w.type?(w.expresion=this.parser.parse(h),w.expresionString=h):w.expresion=h);break;case "text":w.text=this.parseText(h);
break;case "file":var p=h.replace(/&squot;/g,"'");"["===p.charAt(0)&&"]"===p.charAt(p.length-1)&&(p=p.substring(1,p.length-1));p.match(C)&&(p="'"+p+"'");w.file=this.parser.parse(p);break;case "border":""!=h&&"false"!=c[h]&&(w.border=new a.Color(h,this.parent.evaluator));break;default:if(void 0!=w.family&&n.substring(0,w.family.length+1)===w.family+"."){switch(c[n.substring(w.family.length+1)]){case "interval":""!=h&&(w.family_interval=this.parser.parse(h));break;case "steps":""!=h&&(w.family_steps=
this.parser.parse(h))}break}if(void 0!=w.parameter&&n.match(w.parameter+".")){w.parameter!==n.substring(0,n.indexOf(w.parameter)+w.parameter.length)&&(w.parameter=n.substring(0,n.indexOf(w.parameter)+w.parameter.length));switch(c[n.substring(w.parameter.length+1)]){case "interval":""!=h&&(w.parameter_interval=this.parser.parse(h));break;case "steps":""!=h&&(w.parameter_steps=this.parser.parse(h))}break}console.log("----- attributo del graphic no identificado: <"+n+"> valor: <"+h+"> -----")}d&&(w.abs_coord=
d);e&&(w.background=e);switch(w.type){case "text":return new a.Text(this.parent,w);case "image":return new a.Image(this.parent,w);case "point":return new a.Point(this.parent,w);case "polygon":return new a.Polygon(this.parent,w);case "arc":return new a.Arc(this.parent,w);case "segment":return new a.Segment(this.parent,w);case "arrow":return new a.Arrow(this.parent,w);case "macro":return new a.Macro(this.parent,w);case "curve":return new a.Curve(this.parent,w);case "equation":return new a.Equation(this.parent,
w);case "sequence":return new a.Sequence(this.parent,w);case "fill":return new a.Fill(this.parent,w)}};a.LessonParser.prototype.parse3DGraphic=function(b,d,e,g){w={rotateExp:g,parameter:"t"};b=this.split(b);d=0;for(e=b.length;d<e;d++)switch(n=b[d][0],h=b[d][1],u=c[n],u){case "type":case "model":w[u]=c[h];break;case "background":case "fixed":case "edges":w[u]="true"===c[h];break;case "color":case "backcolor":w[u]=new a.Color(h,this.parent.evaluator);break;case "type":case "model":w[u]=c[h];break;case "background":case "fixed":case "edges":case "split":w[u]=
"true"===c[h];break;case "color":case "backcolor":w[u]=new a.Color(h,this.parent.evaluator);break;case "drawif":case "width":case "length":case "height":case "decimals":case "Nu":case "Nv":case "inipos":case "endpos":""!=h&&(w[u]=this.parser.parse(h));break;case "family":case "parameter":case "font":case "name":case "inirot":case "endrot":w[u]=h;break;case "space":w.spaceID=h;break;case "expresion":"macro"!=w.type&&"curve"!=w.type&&"surface"!=w.type?(w.expresion=this.parser.parse(h),w.expresionString=
h):w.expresion=h.replace(/\\n/g," ").replace(/;/g," ");break;case "text":g=this.parseText(h);for(var f=0,p=g.length;f<p;f++)g[f]=this.parser.parse(g[f],!1);w.text=g;break;case "file":g=h.replace(/&squot;/g,"'");"["===g.charAt(0)&&"]"===g.charAt(g.length-1)&&(g=g.substring(1,g.length-1));g.match(/./)&&(g="'"+g+"'");w.file=this.parser.parse(g);break;case "drawif":case "width":case "length":case "decimals":case "Nu":case "Nv":case "inirot":case "endrot":case "inipos":case "endpos":""!=h&&(w[u]=this.parser.parse(h));
break;case "family":case "parameter":case "font":case "name":w[u]=h;break;case "space":w.spaceID=h;break;case "expresion":"macro"!=w.type&&"curve"!=w.type&&"surface"!=w.type?(w.expresion=this.parser.parse(h),w.expresionString=h):w.expresion=h;break;case "text":g=this.parseText(h);f=0;for(p=g.length;f<p;f++)g[f]=this.parser.parse(g[f],!1);w.text=g;break;case "file":g=h.replace(/&squot;/g,"'");"["===g.charAt(0)&&"]"===g.charAt(g.length-1)&&(g=g.substring(1,g.length-1));g.match(/./)&&(g="'"+g+"'");w.file=
this.parser.parse(g);break;default:if(void 0!==w.family&&n.substring(0,w.family.length+1)===w.family+"."){"interval"===c[n.substring(w.family.length+1)]?""!=h&&(w.family_interval=this.parser.parse(h)):""!=h&&(w.family_steps=this.parser.parse(h));break}console.log("----- attributo del graphic3D no identificado: <"+n+"> valor: <"+h+"> -----")}switch(w.type){case "point":return new a.Point3D(this.parent,w);case "segment":return new a.Segment3D(this.parent,w);case "polygon":return new a.Polygon3D(this.parent,
w);case "curve":return new a.Curve3D(this.parent,w);case "triangle":return new a.Triangle3D(this.parent,w);case "face":return new a.Face3D(this.parent,w);case "polireg":return new a.Polireg3D(this.parent,w);case "surface":return new a.Surface3D(this.parent,w);case "text":return new a.Text3D(this.parent,w);case "cube":case "box":case "tetrahedron":case "octahedron":case "sphere":case "dodecahedron":case "icosahedron":case "ellipsoid":case "cone":case "cylinder":case "mesh":return new a.OtherGeometry(this.parent,
w);case "macro":return new a.Macro3D(this.parent,w)}};a.LessonParser.prototype.parseAuxiliar=function(b){y={};b=this.split(b);for(var d=0,e=b.length;d<e;d++)b[d][1]=b[d][1].replace(/&squot;/g,"'");d=0;for(e=b.length;d<e;d++)switch(n=b[d][0],h=b[d][1],u=c[n],u){case "id":case "file":case "init":case "doExpr":case "whileExpr":case "range":case "local":case "expresion":case "condition":case "parameter":y[u]=h.replace(/&squot;/g,"'");break;case "editable":case "constant":case "array":case "matrix":case "algorithm":case "event":case "sequence":y[u]=
"true"===c[h];break;case "size":case "rows":case "columns":y[u]=this.parser.parse(h);break;case "evaluate":case "execution":case "msg_pos":case "action":y[u]=c[h];break;case "type":y[u]=c[h];break;case "x":case "y":case "width":case "height":y[u]=this.parser.parse(h);break;default:var g=n.indexOf("."),f=c[n.substring(0,g)],g=c[n.substring(g+1)];if("parameter"===f&&"font"===g){y.parameterFont=h;break}console.log("----- attributo de auxiliar no identificado: <"+n+"> valor: <"+h+"> -----")}y.sequence?
new a.Function(this.parent,y):y.constant?(b=new a.Constant(this.parent,y),y.evaluate&&"always"===y.evaluate&&this.parent.auxiliaries.push(b)):y.algorithm&&y.evaluate?(b=new a.Algorithm(this.parent,y),this.parent.auxiliaries.push(b)):y.array&&!y.matrix&&")"!=y.id.charAt(y.id.length-1)?(b=new a.Vector(this.parent,y),y.evaluate&&"always"===y.evaluate&&this.parent.auxiliaries.push(b)):y.matrix&&")"!=y.id.charAt(y.id.length-1)?(b=new a.Matrix(this.parent,y),y.evaluate&&"always"===y.evaluate&&this.parent.auxiliaries.push(b)):
y.event&&")"!=y.id.charAt(y.id.length-1)?this.parent.events.push(new a.Event(this.parent,y)):")"===y.id.charAt(y.id.length-1)?new a.Function(this.parent,y):new a.Variable(this.parent,y)};a.LessonParser.prototype.parseAction=function(b){D=b.action;z=b.parent;F=b.parameter;if(D)switch(D){case "message":return new a.Message(z,F);case "calculate":return new a.Calculate(z,F);case "openURL":return new a.OpenURL(z,F);case "openScene":return new a.OpenScene(z,F);case "about":return new a.About(z,F);case "config":return new a.Config(z,
F);case "init":return new a.Init(z,F);case "clear":return new a.Clear(z,F);case "animate":return new a.Animate(z,F);case "initAnimation":return new a.InitAnimation(z,F);case "playAudio":return new a.PlayAudio(z,F);default:console.log("----- Accion no soportada aun: <"+D+"> -----")}else return{execute:function(){}}};a.LessonParser.prototype.parseAnimation=function(b){var d={};b=this.split(b);for(var e=0,g=b.length;e<g;e++)switch(n=b[e][0],h=b[e][1],u=c[n],u){case "id":case "delay":case "init":case "doExpr":case "whileExpr":d[u]=
h.replace(/&squot;/g,"'");break;case "controls":case "auto":case "loop":case "algorithm":case "evaluate":d[u]="true"===c[h];break;default:console.log("----- attributo de la animacion no identificado: <"+n+">  <"+h+"> -----")}return new a.Animation(this.parent,d)};a.LessonParser.prototype.parsePleca=function(c,l){c=this.split(c);e=k="";f=0;b="#536891";g="white";t="left";d="";r="SansSerif,BOLD,20";p="SansSerif,PLAIN,18";m=void 0;for(var q=0,u=c.length;q<u;q++)switch(n=c[q][0],h=c[q][1],n){case "title":k=
h;break;case "subtitle":e=h;break;case "subtitlines":f=h;break;case "bgcolor":""!=h&&(b=(new a.Color(h,this.parent.evaluator)).getColor());break;case "fgcolor":""!=h&&(g=(new a.Color(h,this.parent.evaluator)).getColor());break;case "align":""!=h&&(t=h);break;case "titleimage":d=h;break;case "titlefont":r=""!=h?a.convertFont(h):a.convertFont(r);break;case "subtitlefont":p=""!=h?a.convertFont(h):a.convertFont(p);break;default:console.log("----- attributo de la pleca no identificado: <"+n+">  <"+h+"> -----")}if(""===
k&&""===e)return document.createElement("div");E=p.substring(0,p.indexOf("px"));E=E.substring(E.lastIndexOf(" "));""!=d&&(x=this.parent.getImage(d),L=x.height);m=document.createElement("div");m.setAttribute("id","descartesPleca");L?(m.setAttribute("style","position:absolute;left:0;top:0;text-align:"+t+";width:"+(l-30)+"px;height:"+(L-16)+"px;background:"+b+";color:"+g+";padding-top:8px;padding-bottom:8px;padding-left:15px;padding-right:15px;margin:0;overflow:hidden;z-index:100;"),x.setAttribute("style",
"position: absolute;left:0;top:0;z-index:-1;width:100%;height:100%;"),m.appendChild(x)):m.setAttribute("style","position:absolute;left:0;top:0;text-align:"+t+";width:"+(l-30)+"px;background:"+b+";color:"+g+";padding-top:12px;padding-bottom:12px;padding-left:15px;padding-right:15px;margin:0;z-index:100;");J=document.createElement("div");J.setAttribute("style","padding:0;margin:0;font:"+r+";overflow:hidden;white-space:nowrap;");J.innerHTML=k;M=document.createElement("div");if(1===parseInt(f)){Q=0;N=
document.createElement("div");N.innerHTML=e;document.body.appendChild(N);S=E;do S-=Q,N.setAttribute("style","padding:0;margin:0;font:"+p+";font-size:"+S+"px;width:"+(l-30)+"px;line-height:"+S+"px;"),O=N.offsetHeight,T=O/S,Q=1;while(1<T&&8<S);document.body.removeChild(N);M.setAttribute("style","padding:0;margin:0;font:"+p+";font-size:"+S+"px;line-height: 110%;overflow:hidden;white-space:nowrap;")}else M.setAttribute("style","padding:0;margin:0;font:"+p+";line-height:110%;");M.innerHTML=e;m.appendChild(J);
m.appendChild(M);m.imageHeight=L;return m};a.LessonParser.prototype.split=function(a){if("string"!=typeof a)return[];a=(a||"").replace(/\\'/g,"\u2019");H=[];A=I=0;G=!1;B=0;for(K=!1;I<a.length;)" "!==a.charAt(I)||G||I++," "===a.charAt(I)||G||(G=!0,B=I),"="!==a.charAt(I)||"'"!==a.charAt(I+1)||K||(K=!0,H[A]=[a.substring(B,I)],B=I+2,I+=2),K&&"'"===a.charAt(I)&&(G=K=!1,H[A].push(a.substring(B,I)),A++),"="!==a.charAt(I)||"'"===a.charAt(I+1)||K||(H[A]=[a.substring(B,I)],B=I+1,I++,R=a.substring(I).indexOf("="),
-1===R?P=R=a.length:(R+=I,P=a.substring(I,R).lastIndexOf(" "),P=-1===P?a.length:P+I),H[A].push(a.substring(B,P)),A++,G=!1,I=P),I++;return H};a.LessonParser.prototype.parseText=function(b){b=b||"";return b.match(/^\{\\rtf1/)?this.RTFparser.parse(b.substring(10)):new a.SimpleText(this.parent,b)};return a}(descartesJS||{},babel),descartesJS=function(a){function c(a,b){n=[];n.type="matrix";n.rows=a;n.cols=b;var d;v=0;for(l=b;v<l;v++){d=[];h=0;for(w=a;h<w;h++)d.push(0);n[v]=d}return n}function k(a,b){q=
a.rows;u=a.cols;n=c(q,u);var d;for(v=0;v<q;v++)for(h=0;h<u;h++){for(l=d=0;l<u;l++)d+=a[l][v]*b[h][l];n[h][v]=d}return n}function e(a,b,d){for(var e=c(d.length-1,d.length-1),g=0,f=e.length;g<f;g++)for(var h=0;h<f;h++)e[g][h]=g<a?h<b?d[g][h]:d[g][h+1]:g<b?d[g+1][h]:d[g+1][h+1];return e}function f(a){if(1<a.cols){for(var b=0,d=1,c=0,g=a.cols;c<g;c++)b+=d*a[0][c]*f(e(0,c,a)),d=-d;return b}return a[0][0]}if(a.loadLib)return a;var b,g={},t=Math.floor,d,r,p,m;a.fullDecimals=!1;a.Node=function(a,b){this.sep=
"";this.type=a;this.value=b;this.parent=null;this.childs=[]};a.Node.prototype.getRoot=function(){return null===this.parent?this:this.parent.getRoot()};a.Node.prototype.addChild=function(a){a.parent=this;this.childs.push(a)};a.Node.prototype.replaceLastChild=function(a){d=this.childs.length-1;lastChild=this.childs[d];lastChild.parent=null;this.childs[d]=a;a.parent=this;return a};a.Node.prototype.contains=function(a){if(this.value===a)return!0;for(var b=0,d=this.childs.length;b<d;b++)if(this.childs[b].contains(a))return!0;
return!1};a.Node.prototype.equalToMinus=function(){return"compOperator"===this.type?(this.type="operator",this.value="-",p=new a.Node("compOperator","=="),m=new a.Node("number","0"),p.addChild(this),p.addChild(m),r=this.getRoot(),r.setAllEvaluateFunction(),r):this};a.Node.prototype.setAllEvaluateFunction=function(){this.setEvaluateFunction();for(var a=0,b=this.childs.length;a<b;a++)this.childs[a].setAllEvaluateFunction()};a.Node.prototype.setEvaluateFunction=function(){if("number"===this.type)this.evaluate=
function(a){return parseFloat(this.value)};else if("string"===this.type)this.evaluate=function(a){return this.value};else if("identifier"===this.type&&0===this.childs.length)if("rnd"==this.value)this.evaluate=function(a){return Math.random()};else{var a;this.evaluate=function(b,d){a=b.variables[this.value];if("object"===typeof a&&void 0==a.length)return a.evaluate(b);void 0==a&&(d||b.matrices[this.value]?a=b.matrices[this.value]:b.vectors[this.value]&&(a=b.vectors[this.value]));return void 0!==a?
a:0}}else if("identifier"===this.type&&"square_bracket"===this.childs[0].type&&1===this.childs[0].childs.length){var d,p;this.evaluate=function(a){d=this.childs[0].childs[0].evaluate(a);try{return p=a.vectors[this.value][0>d?0:t(d)],void 0!==p?p:0}catch(b){return 0}}}else if("identifier"===this.type&&"square_bracket"===this.childs[0].type&&1<this.childs[0].childs.length){var l,r;this.evaluate=function(a){l=this.childs[0].childs[0].evaluate(a);r=this.childs[0].childs[1].evaluate(a);try{return p=a.matrices[this.value][0>
l?0:t(l)][0>r?0:t(r)],void 0!==p?p:0}catch(b){return 0}}}else if("identifier"===this.type&&"parentheses"===this.childs[0].type){var m,w,A;this.evaluate=function(a){m=[];for(var d=0,e=this.childs[0].childs.length;d<e;d++)m[d]=this.childs[0].childs[d].evaluate(a);if("_Eval_"===this.value){b=0<m.length?m[0]:0;if("number"==typeof b)return"NaN";void 0==g[b]&&(w=b.match(/:=/g)?!0:!1,g[b]=a.parser.parse(b,w));A=a.evalExpression(g[b]);return void 0!=A?A:NaN}return a.functions[this.value].apply(a,m)}}else if("operator"===
this.type)"+"===this.value?this.evaluate=function(a){var b=this.childs[0].evaluate(a,!0);a=this.childs[1].evaluate(a,!0);if("matrix"!==b.type||"matrix"!==a.type)return b+a;q=b.rows;u=b.cols;n=c(q,u);for(v=0;v<q;v++)for(h=0;h<u;h++)n[h][v]=b[h][v]+a[h][v];return n}:"-"===this.value?this.evaluate=function(a){var b=this.childs[0].evaluate(a,!0);a=this.childs[1].evaluate(a,!0);if("matrix"!==b.type||"matrix"!==a.type)return b-a;q=b.rows;u=b.cols;n=c(q,u);for(v=0;v<q;v++)for(h=0;h<u;h++)n[h][v]=b[h][v]-
a[h][v];return n}:"*"===this.value?this.evaluate=function(a){var b=this.childs[0].evaluate(a,!0);a=this.childs[1].evaluate(a,!0);return"matrix"!==b.type||"matrix"!==a.type?b*a:k(b,a)}:"/"===this.value?this.evaluate=function(a){var b=this.childs[0].evaluate(a,!0);a=this.childs[1].evaluate(a,!0);if("matrix"!==b.type||"matrix"!==a.type)return b/a;var d=c(a.length,a.length),g=f(a);if(0===g)a=0;else{var g=1/g,h;if(1<a.length)for(var p=0,l=a.length;p<l;p++){h=g;for(var r=0;r<l;r++)d[r][p]=h*f(e(p,r,a)),
h=-h;g=-g}else d[0][0]=g;a=d}b=0===a?c(b.rows,b.cols):k(b,a);return b}:"%"===this.value?this.evaluate=function(a){var b=this.childs[0].evaluate(a);a=this.childs[1].evaluate(a);return b-t(b/a)*a}:"^"===this.value&&(this.evaluate=function(a){return Math.pow(this.childs[0].evaluate(a),this.childs[1].evaluate(a))});else if("compOperator"===this.type)"<"===this.value?this.evaluate=function(a){return(this.childs[0].evaluate(a)<this.childs[1].evaluate(a))+0}:"<="===this.value?this.evaluate=function(a){return(this.childs[0].evaluate(a)<=
this.childs[1].evaluate(a))+0}:">"===this.value?this.evaluate=function(a){return(this.childs[0].evaluate(a)>this.childs[1].evaluate(a))+0}:">="===this.value?this.evaluate=function(a){return(this.childs[0].evaluate(a)>=this.childs[1].evaluate(a))+0}:"=="===this.value?this.evaluate=function(a){return(this.childs[0].evaluate(a)===this.childs[1].evaluate(a))+0}:"!="===this.value&&(this.evaluate=function(a){return(this.childs[0].evaluate(a)!==this.childs[1].evaluate(a))+0});else if("boolOperator"===this.type)"&"===
this.value?this.evaluate=function(a){return this.childs[0].evaluate(a)?this.childs[1].evaluate(a)?1:0:0}:"|"===this.value?this.evaluate=function(a){return this.childs[0].evaluate(a)?1:this.childs[1].evaluate(a)?1:0}:"!"===this.value&&(this.evaluate=function(a){return!this.childs[0].evaluate(a)+0});else if("conditional"===this.type)this.evaluate=function(a){return 0<this.childs[0].evaluate(a)?this.childs[1].evaluate(a):this.childs[2].evaluate(a)};else if("sign"===this.type)this.evaluate="sign+"===
this.value?function(a){return this.childs[0].evaluate(a)}:function(a){return-this.childs[0].evaluate(a)};else if("parentheses"===this.type)this.evaluate=function(a,b){return this.childs[0].evaluate(a,b)};else if("(expr)"===this.type||"[expr]"===this.type)this.evaluate=function(a){var b=this.childs.length,d=[],e;if(1===b&&1===this.childs[0].childs.length&&"(expr)"===this.type)d=this.childs[0].childs[0].evaluate(a);else for(var c=0;c<b;c++){e=[];for(var g=0,f=this.childs[c].childs.length;g<f;g++)e.push(this.childs[c].childs[g].evaluate(a));
d[c]=e}return d};else if("asign"===this.type){var G,B,K,E,x,L;this.evaluate=function(a){G=this.childs[0];B=this.childs[1];1===G.childs.length&&"square_bracket"===G.childs[0].type?(d=G.childs[0].childs,1===d.length?(K=d[0].evaluate(a),K=0>K?0:t(K),a.vectors[G.value][K]=B.evaluate(a)):2===d.length&&(E=d[0].evaluate(a),x=d[1].evaluate(a),E=0>E?0:t(E),x=0>x?0:t(x),a.matrices[G.value][E]||(a.matrices[G.value][E]=[]),a.matrices[G.value][E][x]=B.evaluate(a))):(L=B.evaluate(a),L.type?a.matrices[G.value]=
L:"object"!==typeof a.variables[G.value]&&(a.variables[G.value]=L))}}};var q,u,n,h,v,l,w;a.Node.prototype.toString=function(){var a="tipo: "+this.type+", valor: "+this.value+"\n";this.sep="   "+(this.parent?this.parent.sep:"");for(var b=0,d=this.childs.length;b<d;b++)a+=this.sep+this.childs[b].toString();return a};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b,g,t,d,r,p=/^\s+/,m=/^[a-zA-Z_\u00C0-\u021B\u0391-\u03C9]+[a-zA-Z_0-9\u00C0-\u021B\u0391-\u03C9]*([.]*[0-9a-zA-Z_\u00C0-\u021B\u0391-\u03C9]+[0-9]*)*/,
q=/^[0-9]+[.][0-9]+|^[.][0-9]+|^[0-9]+/,u=/^==|^!=|^<=|^<|^>=|^>|^#/,n=/^\!|^\~|^\&\&|^\&|^\|\||^\|/,h=/^=|^:=/,v=/^[\?\:]/,l=/^[\+\-\*\/\%\^\u2212\u00b7\u00D7\u00F7]/,w=/^\[|^\]/,y=/^\(|^\)/,C=/^,/,D=/^;/,z=/\|/g,F=/\|\*/g,H=/\*\|/g;a.Tokenizer=function(){};a.Tokenizer.prototype.tokenize=function(a){function B(a,b,e){k.push({type:a,value:b});g=g.slice(e);f+=e;d++;r=a}if(c=a){a=a.replace(/\\u(\S+) /g,function(a,b){return String.fromCharCode(parseInt(b,16))});a=a.replace(/\&sup(.+);/g,"^ $1 ");a=a.replace(/&squot;/g,
"'");a.match(/\=\|\*/g)&&(a=a.replace(F,"'").replace(H,"'"));a.match(/\=\|/g)&&(a=a.replace(z,"'"));var A=a.trim();"|"==A.charAt(0)&&"|"==A.charAt(A.length-1)&&(a=A.replace(z,"'"))}k=[];e=!1;f=0;g=a;d=0;for(r="";a&&f<a.length;)if(e=f,"'"==g[0]){for(t=1;"'"!=g[t];)if(t<g.length)t++;else{console.log(">Error, unknown symbol: ["+g+"], in the string <<"+c+">>");return}b=g.substring(1,t);B("string",b,b.length+2)}else if(p.test(g))b=g.match(p),g=g.slice(b[0].length),f+=b[0].length,d++;else if(l.test(g))b=
g.match(l),b[0]=b[0].replace(/\u00F7/g,"/").replace(/\u2212/g,"-").replace(/\u00b7/g,"*").replace(/\u00D7/g,"*"),B("operator",b[0],b[0].length);else if(m.test(g))b=g.match(m),"number"===r&&k.push({type:"operator",value:"*"}),B("identifier",b[0],b[0].length);else if(q.test(g))b=g.match(q),B("number",b[0],b[0].length);else if(u.test(g))b=g.match(u),tempVal=b[0],"#"==tempVal&&(tempVal="!="),B("compOperator",tempVal,b[0].length);else if(n.test(g))b=g.match(n),tempVal=b[0],"||"==tempVal?tempVal="|":"&&"==
tempVal?tempVal="&":"~"==tempVal&&(tempVal="!"),B("boolOperator",tempVal,b[0].length);else if(h.test(g)&&!/^==/.test(g))b=g.match(h),B("asign",b[0],b[0].length);else if(v.test(g))b=g.match(v),B("conditional",b[0],b[0].length);else if(w.test(g))b=g.match(w),B("square_bracket",b[0],b[0].length);else if(y.test(g))b=g.match(y),"("==b&&"number"===r&&k.push({type:"operator",value:"*"}),B("parentheses",b[0],b[0].length);else if(C.test(g))b=g.match(C),B("separator",b[0],b[0].length);else if(178===g.charCodeAt(0))k.push({type:"operator",
value:"^"}),B("number",2,1);else if(179===g.charCodeAt(0))k.push({type:"operator",value:"^"}),B("number",3,1);else if(D.test(g))b=g.match(D),B("final_of_expresion",b[0],b[0].length);else if(e==f){console.log("Error, simbolo no conocido: ["+g+"], en la cadena <<"+c+">>");return}return k};var I,A=/rnd|pi|e|Infinity|-Infinity|sqr|sqrt|ra\u00edz|exp|log|log10|abs|ent|sgn|ind|sin|sen|cos|tan|cot|sec|csc|sinh|senh|cosh|tanh|coth|sech|csch|asin|asen|acos|atan|min|max/;a.Tokenizer.prototype.flatTokens=function(a,
b){a=a||[];b=b||"";I="";for(var d=0,e=a.length;d<e;d++)I="string"==a[d].type?I+"&squot;"+a[d].value+"&squot;":"identifier"!=a[d].type||a[d].value.match(A)?I+a[d].value:I+b+a[d].value;return I};return a}(descartesJS||{}),descartesJS=function(a){function c(a){return isNaN(parseFloat(a))?a.replace(/^\s|\s$/g,"").replace(/^'|'$/g,""):parseFloat(a)==a?parseFloat(a):a.replace(/^\s|\s$/g,"").replace(/^'|'$/g,"")}if(a.loadLib)return a;a.Parser=function(b){this.evaluator=b;this.tokenizer=new a.Tokenizer;this.vectors=
{};this.matrices={};this.variables={};this.functions={};this.definitions={};this.registerDefaultValues();this.registerExternalValues&&this.registerExternalValues()};a.Parser.prototype.setDefinition=function(a,b){this.definitions[a]=b};a.Parser.prototype.getDefinition=function(a){return this.definitions[a]};a.Parser.prototype.setVariable=function(a,b){this.variables[a]=b};a.Parser.prototype.getVariable=function(a,b){b&&(this.variables[a]=void 0!==this.variables[a]?this.variables[a]:void 0);return this.variables[a]};
a.Parser.prototype.setVector=function(a,b,d){this.vectors[a][b]=d};a.Parser.prototype.getVector=function(a){this.vectors.hasOwnProperty(a)||(this.vectors[a]=[0,0,0]);return this.vectors[a]};a.Parser.prototype.setMatrix=function(a,b,d,e){this.matrices[a][b][d]=e};a.Parser.prototype.getMatrix=function(a){this.matrices.hasOwnProperty(a)||(this.matrices[a]=[[0,0,0],[0,0,0],[0,0,0]]);return this.matrices[a]};a.Parser.prototype.setFunction=function(a,b){this.functions[a]=b};a.Parser.prototype.getFunction=
function(a){this.functions.hasOwnProperty(a)||(this.functions[a]=function(){return 0});return this.functions[a]};var k,e,f,b,g,t,d,r,p,m,q,u;a.Parser.prototype.parse=function(c,h){(f=this.tokenizer.tokenize(c))||(f=[]);b=null;h=!h||!1;k=r=d=t=0;for(e=f.length;k<e;k++){p=f[k];m=p.value;q=p.type;if("identifier"===q)if(k+1<e&&"parentheses"===f[k+1].type&&"("===f[k+1].value)this.getFunction(m);else if(k+1<e&&"square_bracket"===f[k+1].type&&"["===f[k+1].value)f[k+3]&&"square_bracket"===f[k+3].type&&"]"===
f[k+3].value?this.getVector(m):this.getMatrix(m);else{var v=m.match(/(\w*)\.mouse_x/)||m.match(/(\w*)\.mouse_y/)||m.match(/(\w*)\.mouse_pressed/)||m.match(/(\w*)\.mouse_clicked/)||m.match(/(\w*)\.clic_izquierdo/);v&&(this.variables[v[1]+".DESCARTESJS_no_fixed"]=1);this.getVariable(m,!0)}"asign"===q&&h&&(q="compOperator",m="==");if("asign"===q)if(g=new a.Node(q,m),null!=b)if("identifier"===b.type)b.parent&&b.parent.replaceLastChild(g),g.addChild(b),b=g,h=!0;else if("square_bracket"===b.type)g.addChild(b.parent),
b=g,h=!0;else{g.type="compOperator";g.value="==";for(h=!0;b.parent&&this.getPrecedence(b.parent.value)>=this.getPrecedence(g.value);)b=b.parent;b.parent&&b.parent.replaceLastChild(g);g.addChild(b);b=g}else{console.log("Error1: en la expresion <<"+c+">>, en el token {valor: "+m+", tipo: "+q+"}");break}else if("parentheses"===q&&"("===m||"square_bracket"===q&&"["===m)if(g=new a.Node(q,m),"("===m&&t++,"["===m&&d++,null===b)"("===m&&(new a.Node("(expr)","(expr)")).addChild(g),"["===m&&(new a.Node("[expr]",
"[expr]")).addChild(g),b=g;else if("operator"===b.type||"boolOperator"===b.type||"compOperator"===b.type||"conditional"===b.type||"asign"===b.type)b.addChild(g),b=g;else if("sign"===b.type)b.addChild(g),b=g;else if("parentheses"===b.type&&"("===b.value)b.addChild(g),b=g;else if("square_bracket"===b.type&&"["===b.value)b.addChild(g),b=g;else if("parentheses"===b.type&&"()"===b.value)b.parent.addChild(g),b=g;else if("square_bracket"===b.type&&"[]"===b.value)b.parent.addChild(g),b=g;else if("identifier"===
b.type)b.addChild(g),b=g;else{console.log("Error2: en la expresion <<"+c+">>, en el token ["+k+"] {valor: "+m+", tipo: "+q+"}");break}else if("parentheses"===q&&")"===m)if(t--,null===b)console.log("Error3: en la expresion <<"+c+">>, en el token (valor:"+m+", tipo:"+q);else{for(;b&&b.parent&&("("!=b.value||"("==b.value&&"parentheses"!=b.type);)b=b.parent;if(b&&"("===b.value)b.value="()";else{console.log("Error4: en la expresion <<"+c+">>, en el token {valor: "+m+", tipo: "+q+"}");break}}else if("square_bracket"===
q&&"]"===m)if(d--,null===b)console.log("Error5: en la expresion <<"+c+">>, en el token (valor:"+m+", tipo:"+q);else{for(;b&&b.parent&&("["!=b.value||"["==b.value&&"square_bracket"!=b.type);)b=b.parent;if(b&&"["===b.value)b.value="[]";else{console.log("Error6: en la expresion <<"+c+">>, en el token {valor: "+m+", tipo: "+q+"}");break}}else if("number"===q||"string"===q||"identifier"===q)if(g=new a.Node(q,m),null===b)b=g;else if("operator"===b.type||"compOperator"===b.type||"boolOperator"===b.type||
"parentheses"===b.type&&"("===b.value||"square_bracket"===b.type&&"["===b.value||"sign"===b.type||"conditional"===b.type||"asign"===b.type)b.addChild(g),b=g;else{console.log("Error7: en la expresion <<"+c+">>, en el token {valor: "+m+", tipo: "+q+"}");break}else if("operator"===q||"compOperator"===q||"boolOperator"===q)if(g=new a.Node(q,m),null===b)if("-"===m||"+"===m)g.type="sign",g.value="sign"+m,b=g;else if("!"===m)b=g;else{console.log("Error8: en la expresion <<"+c+">>, en el token {valor: "+
m+", tipo: "+q+"}");break}else if("operator"===b.type||"compOperator"===b.type||"boolOperator"===b.type||"asign"===b.type||"conditional"===b.type||"square_bracket"===b.type&&"["===b.value&&("-"===m||"+"===m||"!"===m)||"parentheses"===b.type&&"("===b.value&&("-"===m||"+"===m||"!"===m)){if("-"===m||"+"===m)g.type="sign",g.value="sign"+m;b.addChild(g);b=g}else if("number"===b.type||"parentheses"===b.type&&"()"===b.value||"square_bracket"===b.type&&"[]"===b.value||"string"===b.type||"identifier"===b.type||
"conditional"===b.type||"asign"===b.type){for(;b.parent&&this.getPrecedence(b.parent.value)>=this.getPrecedence(g.value);)b=b.parent;b.parent&&b.parent.replaceLastChild(g);g.addChild(b);b=g}else{console.log("Error9: en la expresion <<"+c+">>, en el token {valor: "+m+", tipo: "+q+"}");break}else if("conditional"===q)if(g=new a.Node(q,m),null!=b)if("?"===g.value){for(r++;b.parent&&this.getPrecedence(b.parent.value)>this.getPrecedence(g.value);)b=b.parent;b.parent&&b.parent.replaceLastChild(g);g.addChild(b);
b=g}else{for(r--;b&&b.parent&&("?"!=b.value||"?"==b.value&&"conditional"!=b.type);)b=b.parent;if(b&&"?"===b.value)b.value="?:";else{console.log("Error10: en la expresion <<"+c+">>, en el token {valor: "+m+", tipo: "+q+"}");break}}else{console.log("Error11: en la expresion <<"+c+">>, en el token {valor: "+m+", tipo: "+q+"}");break}else if("separator"===q)if(null!=b)for(;b.parent&&"("!=b.value&&"["!=b.value;)b=b.parent;else{console.log("Error12: en la expresion <<"+c+">>, en el token {valor: "+m+", tipo: "+
q+"}");break}else{console.log("Error13: en la expresion <<"+c+">>, en el token {valor: "+m+", tipo: "+q+"}");break}}0<t&&alert("Error, faltan parentesis por cerrar: "+c);0>t&&alert("Error, faltan parentesis por abrir: "+c);0<d&&alert("Error, faltan square bracketss por cerrar: "+c);0>d&&alert("Error, faltan square bracketss por abrir: "+c);0!=r&&alert("Error, condicional incompleta: "+c);(u=b?b.getRoot():null)&&u.setAllEvaluateFunction();return u};a.Parser.prototype.getPrecedence=function(a){switch(a){case "=":return 1;
case ":=":return 1;case "(":return 2;case "[":return 2;case "?":return 2;case ":":return 3;case "?:":return 3;case "|":return 6;case "&":return 7;case "<":return 5;case "<=":return 5;case ">":return 5;case ">=":return 5;case "==":return 5;case "!=":return 5;case "+":return 6;case "-":return 6;case "/":return 7;case "*":return 7;case "sign-":return 7;case "sign+":return 7;case "!":return 8;case "%":return 8;case "^":return 9;default:return 9}};a.Parser.prototype.registerDefaultValues=function(){function b(a,
d){for(var e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}var d=this;d.variables.rnd=Math.random;d.variables.pi=d.variables["\u03c0"]=a.returnValue(Math.PI);d.variables.e=a.returnValue(Math.E);d.variables.Infinity=Infinity;d.variables["-Infinity"]=-Infinity;d.variables.isTouch=d.variables["esT\u00e1ctil"]=a.hasTouchSupport?1:0;d.functions.sqr=function(a){return a*a};d.functions.sqrt=d.functions["ra\u00edz"]=Math.sqrt;d.functions.exp=Math.exp;d.functions.log=Math.log;d.functions.log10=function(a){return Math.log(a)/
Math.log(10)};d.functions.abs=Math.abs;d.functions.ent=Math.floor;d.functions.sgn=function(a){return 0<a?1:0>a?-1:0};d.functions.ind=function(a){return a?1:0};d.functions.sin=d.functions.sen=Math.sin;d.functions.cos=Math.cos;d.functions.tan=Math.tan;d.functions.cot=function(a){return 1/Math.tan(a)};d.functions.sec=function(a){return 1/Math.cos(a)};d.functions.csc=function(a){return 1/Math.sin(a)};d.functions.sinh=d.functions.senh=function(a){return(Math.exp(a)-Math.exp(-a))/2};d.functions.cosh=function(a){return(Math.exp(a)+
Math.exp(-a))/2};d.functions.tanh=function(a){return(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))};d.functions.coth=function(a){return 1/d.functions.tanh(a)};d.functions.sech=function(a){return 1/d.functions.cosh(a)};d.functions.csch=function(a){return 1/d.functions.sinh(a)};d.functions.asin=d.functions.asen=Math.asin;d.functions.acos=Math.acos;d.functions.atan=Math.atan;d.functions.min=Math.min;d.functions.max=Math.max;d.functions._Num_=function(a){return"number"==typeof a?"NaN":parseFloat(a)==
a?parseFloat(a):"NaN"};d.functions._Trace_=d.functions._Print_=function(){console.log.apply(console,arguments);return 0};d.functions._Stop_Audios_=function(){d.evaluator.parent.stopAudios()};d.functions.esCorrecto=function(b,e,c){return a.esCorrecto(b,e,d.evaluator,c)};d.functions.escorrecto=function(b,e,c){return a.escorrecto(b,e,d.evaluator,c)};window.parent!==window&&(d.functions["parent.set"]=function(a,b){window.parent.postMessage({type:"set",name:a,value:b},"*");return 0},d.functions["parent.update"]=
function(){window.parent.postMessage({type:"update"},"*");return 0},d.functions["parent.exec"]=function(a,b){window.parent.postMessage({type:"exec",name:a,value:b},"*");return 0});d.functions._NumToStr_=d.functions._NumACadena_=function(a,b){a=isNaN(parseFloat(a))?0:parseFloat(a);return a.toFixed(parseInt(b||0))};d.functions._charAt_=d.functions._letraEn_=function(a,b){a=(a||"").toString();b=isNaN(parseInt(b))?0:parseInt(b);return a.charAt(b)};d.functions._substring_=d.functions._subcadena_=function(a,
b,d){a=(a||"").toString();b=isNaN(parseInt(b))?0:parseInt(b);d=isNaN(parseInt(d))?0:parseInt(d);return 0<=b&&0<=d?a.substring(b,d):0>b&&0<=d?a.substring(d):0>d&&0<=b?a.substring(b):""};d.functions._length_=d.functions._longitud_=function(a){a=(a||"").toString();return a.length};d.functions._indexOf_=d.functions["_\u00edndiceDe_"]=function(a,b){a=(a||"").toString();b=(b||"").toString();return a.indexOf(b)};this.functions._Load_=function(b){var d="";b&&(d=(d=document.getElementById(b))&&"descartes/archivo"==
d.type?d.text:a.openExternalFile(b));return d||""};this.functions._GetValues_=function(a,b){var d=this.functions._Load_(a).replace(/&brvbar;/g,String.fromCharCode("166"));return this.functions._ExecBlock_(d,b)};this.functions._GetMatrix_=function(a,b){var d=this.functions._Load_(a).replace(/&brvbar;/g,String.fromCharCode("166"));return this.functions._StrToMatrix_(d,b)};this.functions._MatrixToStr_=function(a){var b=this.matrices[a];if(b){for(var d="<"+a+">\\n",e=this.getVariable(a+".columnas_usadas")||
b.rows||0,c=this.getVariable(a+".filas_usadas")||b.cols||0,g,f=0;f<e;f++){for(var p=0;p<c;p++)g=b[f][p],void 0!==g&&("string"==typeof g&&(g="'"+g+"'"),d+=g+(p<c-1?" \u00a6 ":""));d=d.replace(/(\u00A6 )$/g,"")+"\\n"}return d+("</"+a+">")}return""};this.functions._StrToMatrix_=function(a,b){var e=[],g=!1;e.type="matrix";if(a){a=a.replace(/\r|\\r/g,"").split(/\n|\\n/);for(var f=0,p=a.length;f<p;f++)a[f].match("<"+b+">")?(g=a[f].trim().split("<"+b+">"),2==g.length&&""!=g[1]&&e.push(g[1].split(String.fromCharCode("166")).map(c)),
g=!0):a[f].match("</"+b+">")?(g=a[f].trim().split("</"+b+">"),2==g.length&&""!=g[0]&&e.push(g[0].split(String.fromCharCode("166")).map(c)),g=!1):g&&e.push(a[f].split(String.fromCharCode("166")).map(c));d.matrices[b]=e;d.setVariable(b+".filas",e[0].length);d.setVariable(b+".columnas",e.length)}return"OK"};this.functions._GetVector_=function(a,b){var d=this.functions._Load_(a);return this.functions._StrToVector_(d,b)};this.functions._VectorToStr_=function(a){var b=this.vectors[a];if(b){for(var d="<"+
a+">\\n",e=this.getVariable(a+".long_usada")||b._size_||0,c,g=0;g<e;g++)c=b[g],void 0!==c?("number"==typeof c&&(c=parseFloat(c)),d+=c+"\\n"):d+="0\\n";return d+("</"+a+">")}return""};this.functions._StrToVector_=function(a,b){var e=[],g=!1;e.type="vector";if(a){a=a.replace(/\r|\\r/g,"").split(/\n|\\n/);for(var f=0,p=a.length;f<p;f++)a[f].match("<"+b+">")?g=!0:a[f].match("</"+b+">")?g=!1:g&&e.push(c(a[f]));e._size_=e.length;d.vectors[b]=e;d.setVariable(b+".long",e.length);d.setVariable(b+".long_usada",
e.length)}return"OK"};this.functions._ExecStr_=function(a){return this.functions._ExecBlock_(a,"")};this.functions._ExecBlock_=function(a,b){var e=[],c=""==b;if(a){a=a.replace(/\r|\\r/g,"").split(/\n|\\n/);for(var g=0,f=a.length;g<f;g++)a[g].match("<"+b+">")?(c=a[g].trim().split("<"+b+">"),2==c.length&&""!=c[1]&&(e=e.concat(c[1].split(String.fromCharCode("166")))),c=!0):a[g].match("</"+b+">")?(c=a[g].trim().split("</"+b+">"),2==c.length&&""!=c[0]&&(e=e.concat(c[0].split(String.fromCharCode("166")))),
c=!1):c&&(e=e.concat(a[g].split(String.fromCharCode("166"))));g=0;for(f=e.length;g<f;g++)c=e[g].split("="),c[0]=c[0].trim(),2==c.length&&""!=c[0]&&(isNaN(parseFloat(c[1]))?d.setVariable(c[0],c[1].replace(/^\s|\s$/g,"").replace(/^'|'$/g,"")):d.setVariable(c[0],parseFloat(c[1])))}return 0};var e=document.createElement("a");e.setAttribute("target","_blank");var g,f=null;this.functions._Save_=function(a,b){document.body.appendChild(e);g=new Blob(["\ufeff",b.replace(/\\n/g,"\n").replace(/\\q/g,"'").replace(/\\r/g,
"")],{type:"text/plain"});e.setAttribute("download",a);e.setAttribute("href",window.URL.createObjectURL(g));null==f&&(e.click(),f=!0,setTimeout(function(){f=null},1E3));document.body.removeChild(e);return 0};var p,r,k,m,q=document.createElement("input");q.setAttribute("type","file");onHandleFileSelect=function(b){p=b.target.files;r=new FileReader;r.onload=function(b){a.addExternalFileContent(p[0].name,b.target.result);d.setVariable(k,p[0].name);d.getFunction(m)&&(d.getFunction(m).apply(d.evaluator,
[]),d.evaluator.parent.update())};0<p.length&&r.readAsText(p[0])};q.addEventListener("change",onHandleFileSelect);this.functions._Open_=function(a,b){k=a;m=b;q.click();return 0};var t,u,A=document.createElement("input");A.setAttribute("type","file");onHandleFileSelect2=function(a){a.stopPropagation();a.preventDefault();t=a.target.files;u=new FileReader;u.onload=function(a){var e={};try{e=JSON.parse(a.target.result)}catch(c){}e.variables&&b(d.variables,e.variables);e.vectors&&b(d.vectors,e.vectors);
e.matrices&&b(d.matrices,e.matrices);d.evaluator.parent.update()};0<t.length&&u.readAsText(t[0])};A.removeEventListener("change",onHandleFileSelect2);A.addEventListener("change",onHandleFileSelect2);this.functions._AnchoDeCadena_=this.functions._strWidth_=function(b,d,e,c){return a.getTextWidth(b,a.convertFont(d+","+e+","+c))};this.functions._Rojo_=this.functions._Red_=function(b){return(new a.Color(b)).r/255};this.functions._Verde_=this.functions._Green_=function(b){return(new a.Color(b)).g/255};
this.functions._Azul_=this.functions._Blue_=function(b){return(new a.Color(b)).b/255}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=Math.floor;a.Evaluator=function(c){this.parent=c;this.parser=new a.Parser(this);this.variables=this.parser.variables;this.functions=this.parser.functions;this.vectors=this.parser.vectors;this.matrices=this.parser.matrices;this.definitions=this.parser.definitions};a.Evaluator.prototype.setDefinition=function(a,e){this.definitions[a]=e};
a.Evaluator.prototype.getDefinition=function(a){return this.definitions[a]};a.Evaluator.prototype.setVariable=function(a,e){this.variables[a]=e};a.Evaluator.prototype.getVariable=function(a){return this.variables[a]};a.Evaluator.prototype.setVector=function(a,e,f){e=0>e?0:c(e);this.vectors[a][e]=f};a.Evaluator.prototype.getVector=function(a,e){e=0>e?0:c(e);return this.vectors[a][e]};a.Evaluator.prototype.setMatrix=function(a,e,f,b){e=0>e?0:c(e);f=0>f?0:c(f);this.matrices[a][e][f]=b};a.Evaluator.prototype.getMatrix=
function(a,e,f){e=0>e?0:c(e);f=0>f?0:c(f);return this.matrices[a][e][f]};a.Evaluator.prototype.setFunction=function(a,e){this.functions[a]=e};a.Evaluator.prototype.getFunction=function(a){return this.functions[a]};a.Evaluator.prototype.evalExpression=function(a){return a?a.evaluate(this):0};a.externalEvaluator=new a.Evaluator;return a}(descartesJS||{}),descartesJS=function(a){function c(a){for(var b="",e,g=0;g<a.children.length;g++)if(e=a.children[g],"text"===e.nodeType)b+=e.value.replace(/\[/g,"\\left[").replace(/\]/g,
"\\right]").replace(/_/g,"\\_").replace(/ /g,"\\;").replace(/</g,"&lt;").replace(/>/g,"&gt;");else if("mathSymbol"===e.nodeType)b+=e.value.replace(/\(/g,"\\left(").replace(/\)/g,"\\right)");else if("superIndex"===e.nodeType)b+="^{"+c(e)+"}";else if("subIndex"===e.nodeType)b+="_{"+c(e)+"}";else if("fraction"===e.nodeType)b+="\\frac{"+c(e.children[0])+"}{"+c(e.children[1])+"}";else if("radical"===e.nodeType)b+="\\sqrt["+c(e.children[0])+"]{"+c(e.children[1])+"}";else if("sum"===e.nodeType)b+="\\sum_{"+
c(e.children[0])+"}^{"+c(e.children[1])+"}{"+c(e.children[2])+"}";else if("integral"===e.nodeType)b+="\\int_{"+c(e.children[0])+"}^{"+c(e.children[1])+"}{"+c(e.children[2])+"}";else if("limit"===e.nodeType)b+="\\lim_{"+c(e.children[0])+" \\to "+c(e.children[1])+"}{"+c(e.children[2])+"}";else if("matrix"===e.nodeType){for(var b=b+"\\begin{bmatrix}",f=0;f<e.rows;f++){for(var k=0;k<e.columns;k++)b+=c(e.children[k+f*e.columns])+" &";b=b.substring(0,b.length-2)+"\\\\"}b+="\\end{bmatrix}"}else if("defparts"===
e.nodeType){b+="\\begin{cases}";for(f=0;f<e.parts;f++)b+=c(e.children[f])+" \\\\";b+="\\end{cases}"}else console.log("<<",a.children[g].nodeType,">>");return b}if(a.loadLib)return a;var k=2,e=!1,f;a.RTFNode=function(a,b,e,c){this.evaluator=a;this.type="rtfNode";this.value=b;this.nodeType=e;this.style=c;this.styleString=c.toString();this.color=c.textColor;this.underline=c.textUnderline;this.overline=c.textOverline;this.parent=null;this.children=[];switch(this.nodeType){case "textBlock":this.draw=this.drawTextBlock;
break;case "textLineBlock":this.draw=this.drawTextLineBlock;break;case "formula":this.draw=this.drawFormula;break;case "superIndex":this.draw=this.drawSuperIndex;break;case "subIndex":this.draw=this.drawSubIndex;break;case "dynamicText":this.draw=this.drawDynamicText;this.decimal_symbol=this.evaluator.parent.decimal_symbol;break;case "fraction":this.draw=this.drawFraction;break;case "numerator":case "denominator":this.draw=this.drawNumDen;break;case "radical":this.draw=this.drawRadical;break;case "limit":this.draw=
this.drawLimit;break;case "integral":this.draw=this.drawIntegral;break;case "sum":this.draw=this.drawSum;break;case "matrix":this.draw=this.drawMatrix;break;case "defparts":this.draw=this.drawDefparts;break;case "text":case "newLine":this.draw=this.drawText;break;case "hyperlink":this.draw=this.drawHyperlink;break;case "mathSymbol":this.draw=this.drawMathSymbol;break;case "index":case "radicand":case "from":case "to":case "what":case "element":this.draw=this.drawGenericBlock;break;case "componentNumCtrl":this.draw=
this.drawComponentNumCtrl;break;case "componentSpace":this.draw=this.drawComponentSpace}};a.RTFNode.prototype.getRoot=function(){return null==this.parent?this:this.parent.getRoot()};a.RTFNode.prototype.addChild=function(a){a.parent=this;this.children.push(a)};var b=0,g=0,t=0;a.RTFNode.prototype.getTextMetrics=function(){if("textBlock"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);for(var d=0,c=this.children.length;d<c;d++)this.children[d].getTextMetrics()}else if("textLineBlock"==
this.nodeType)this.spaceWidth=a.getTextWidth(" ",this.styleString),this.getBlockMetric();else if("newLine"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);var f=a.getFontMetrics(this.styleString);this.baseline=f.baseline;this.descent=f.descent;this.ascent=f.ascent;this.w=0;this.h=f.h}else if("text"==this.nodeType||"dynamicText"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);f=a.getFontMetrics(this.styleString);this.baseline=f.baseline;this.descent=f.descent;
this.ascent=f.ascent;var d=this.value,m;"string"!=typeof this.value&&(c=void 0==this.decimals?k:this.evaluator.evalExpression(this.decimals),m=void 0==this.fixed?e:this.fixed,d=this.evaluator.evalExpression(this.value,c,m),parseFloat(d).toString()===d.toString()&&(d=m?parseFloat(d).toFixed(c):a.removeNeedlessDecimals(parseFloat(d).toFixed(c)),d=(""+d).replace(".",this.decimal_symbol)),d+=" ");this.w=a.getTextWidth(d,this.styleString);this.h=f.h}else if("formula"==this.nodeType)this.spaceWidth=a.getTextWidth(" ",
this.styleString),this.getBlockMetric();else if("hyperlink"===this.nodeType){d=a.getFontMetrics(this.styleString);this.baseline=d.baseline;this.descent=d.descent;this.ascent=d.ascent;this.w=a.getTextWidth(this.value,this.styleString);this.h=d.h;this.clickCacher=document.createElement("div");this.clickCacher.setAttribute("style","position: absolute; width: "+this.w+"px; height: "+this.h+"px; cursor: pointer;");var q=new a.OpenURL(this.evaluator.parent,this.URL),u=this;this.clickCacher.addEventListener("click",
function(a){u.click=!0;q.actionExec()})}else if("superIndex"==this.nodeType)this.spaceWidth=a.getTextWidth(" ",this.styleString),c=b,f=g,m=t,d=a.getFontMetrics(this.styleString),this.getBlockMetric(),0>this.h&&(this.ascent=d.ascent,this.descent=d.descent,this.h=this.ascent+this.descent,this.w=1.5*this.spaceWidth),d=m/2-f+this.h,this.superIndexPos=d-this.ascent,this.ascent=d,this.descent=f,this.baseline=this.ascent,this.h=this.ascent+this.descent;else if("subIndex"==this.nodeType)this.spaceWidth=a.getTextWidth(" ",
this.styleString),c=b,f=g,m=t,d=a.getFontMetrics(this.styleString),this.getBlockMetric(),0>this.h&&(this.ascent=d.ascent,this.descent=d.descent,this.h=this.ascent+this.descent,this.w=1.5*this.spaceWidth),this.subIndexPos=f+1,this.ascent=c,this.descent=this.subIndexPos+this.descent,this.baseline=this.ascent,this.h=this.ascent+this.descent;else if("fraction"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);var n=this.children[0],h=this.children[1],d=a.getFontMetrics(n.styleString);
n.getBlockMetric();h.getBlockMetric();c=b;f=g;m=t;0>n.h&&(n.h=d.h,n.w=this.spaceWidth);0>h.h&&(h.h=d.h,h.w=this.spaceWidth);this.h=n.h+h.h-1;this.ascent=n.h+Math.round(m/2)-f;this.descent=this.h-this.ascent;this.baseline=this.ascent;this.w=Math.max(n.w,h.w)+this.spaceWidth+8}else if("radical"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);f=this.children[0].style.clone();if(1===this.children.length)this.children[1]=new a.RTFNode(this.evaluator," ","radicand",f),this.children[1].addChild(this.children[0]),
this.children[0]=new a.RTFNode(this.evaluator," ","index",f);else if("index"!==this.children[0].nodeType||"radicand"!==this.children[1].nodeType){m=new a.RTFNode(this.evaluator,"","radicand",f);d=0;for(c=this.children.length;d<c;d++)m.addChild(this.children[d]);this.children=[];this.children[0]=new a.RTFNode(this.evaluator,"","index",f);this.children[1]=m}d=this.children[0];c=this.children[1];0>=d.children.length&&(f=this.style.clone(),f.fontSize=parseInt(f.fontSize-.2*f.fontSize),d.addChild(new a.RTFNode(this.evaluator,
" ","text",f)));0>=c.children.length&&c.addChild(new a.RTFNode(this.evaluator," ","text",this.style.clone()));d.getBlockMetric();c.getBlockMetric();this.ascent=c.h/2<d.h?c.h/2+d.h+2-c.descent:c.ascent+4;this.descent=c.descent;this.baseline=this.ascent;this.h=this.ascent+this.descent;this.w=d.w+c.w+4*this.spaceWidth}else if("sum"==this.nodeType)this.spaceWidth=a.getTextWidth(" ",this.styleString),c=b,f=g,m=t,f=this.children[0],c=this.children[1],m=this.children[2],f.getBlockMetric(),c.getBlockMetric(),
m.getBlockMetric(),-1==f.ascent&&(n=a.getFontMetrics(f.styleString),f.ascent=n.ascent,f.descent=n.descent,f.h=n.h),-1==c.ascent&&(n=a.getFontMetrics(c.styleString),c.ascent=n.ascent,c.descent=n.descent,c.h=n.h),d=a.getFontMetrics(this.styleString),this.ascent=d.h+c.h>m.ascent?d.h-d.descent+c.h:m.ascent,this.descent=f.h>m.descent?f.h+d.descent:m.descent,this.baseline=this.ascent,this.h=this.ascent+this.descent,d=this.style.clone(),d.fontType="Times New Roman",d.Bold="bold",d=d.toString(),d=a.getTextWidth(String.fromCharCode(8721),
d),this.w=Math.max(f.w,c.w,d)+Math.max(m.w,this.spaceWidth)+this.spaceWidth;else if("integral"==this.nodeType)this.spaceWidth=a.getTextWidth(" ",this.styleString),c=b,f=g,m=t,f=this.children[0],c=this.children[1],m=this.children[2],f.getBlockMetric(),c.getBlockMetric(),m.getBlockMetric(),-1==f.ascent&&(n=a.getFontMetrics(f.styleString),f.ascent=n.ascent,f.descent=n.descent,f.h=n.h),-1==c.ascent&&(n=a.getFontMetrics(c.styleString),c.ascent=n.ascent,c.descent=n.descent,c.h=n.h),d=a.getFontMetrics(this.styleString),
this.ascent=d.h+c.h>m.ascent?d.h-d.descent+c.h:m.ascent,this.descent=f.h>m.descent?f.h+d.descent:m.descent,this.baseline=this.ascent,this.h=this.ascent+this.descent,d=this.style.clone(),d.fontSize*=1.5,d.fontType="Times New Roman",d.Bold="bold",d=d.toString(),d=a.getTextWidth(String.fromCharCode(8747),d),this.w=Math.max(f.w,c.w,d)+Math.max(m.w,this.spaceWidth)+2*this.spaceWidth;else if("limit"==this.nodeType)this.spaceWidth=a.getTextWidth(" ",this.styleString),c=b,f=g,m=t,f=this.children[0],c=this.children[1],
m=this.children[2],d=a.getFontMetrics(this.styleString),f.getBlockMetric(),c.getBlockMetric(),m.getBlockMetric(),-1==f.ascent&&(n=a.getFontMetrics(f.styleString),f.ascent=n.ascent,f.descent=n.descent,f.h=n.h),-1==c.ascent&&(n=a.getFontMetrics(c.styleString),c.ascent=n.ascent,c.descent=n.descent,c.h=n.h),-1==m.ascent&&(n=a.getFontMetrics(m.styleString),m.ascent=n.ascent,m.descent=n.descent,m.h=n.h),this.ascent=m.ascent,this.descent=Math.max(d.h,m.descent),this.baseline=this.ascent,this.h=this.ascent+
this.descent,d=a.getTextWidth(" "+String.fromCharCode(8594),this.styleString),0==f.w&&(f.w=this.spaceWidth),0==c.w&&(c.w=this.spaceWidth),0==m.w&&(m.w=this.spaceWidth),this.w=c.w+f.w+m.w+d+this.spaceWidth;else if("matrix"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);d=a.getFontMetrics(this.styleString);c=b;f=g;m=t;m=d.ascent;for(var n=d.descent,h=d.h,v=this.spaceWidth,l,w,d=0,c=this.children.length;d<c;d++)this.children[d].getBlockMetric(),l=this.children[d].h,w=this.children[d].w,
h<l&&(h=l,m=this.children[d].ascent,n=this.children[d].descent),v<w&&(v=w);this.childWidth=v+2*this.spaceWidth;this.childHeight=h;this.childAscent=m;this.childDescent=n;this.h=this.rows*h;this.ascent=this.h/2;this.descent=this.h/2;this.w=this.columns*this.childWidth+this.spaceWidth}else if("defparts"==this.nodeType){this.spaceWidth=a.getTextWidth(" ",this.styleString);d=a.getFontMetrics(this.styleString);c=b;f=g;m=t;m=d.ascent;n=d.descent;h=d.h;v=this.spaceWidth;d=0;for(c=this.children.length;d<c;d++)this.children[d].getBlockMetric(),
l=this.children[d].h,w=this.children[d].w,h<l&&(h=l,m=this.children[d].ascent,n=this.children[d].descent),v<w&&(v=w);this.childWidth=v+2*this.spaceWidth;this.childHeight=h;this.childAscent=m;this.childDescent=n;this.h=this.parts*h;this.ascent=this.h/2+f;this.descent=this.h-this.ascent;this.w=v+this.spaceWidth/2}else"mathSymbol"==this.nodeType?(this.spaceWidth=a.getTextWidth(" ",this.styleString),f=a.getFontMetrics(this.styleString),this.baseline=f.baseline,this.descent=f.descent,this.ascent=f.ascent,
this.w=a.getTextWidth(this.value,this.styleString)+this.spaceWidth,this.h=f.h):"componentNumCtrl"==this.nodeType?(this.spaceWidth=a.getTextWidth(" ",this.styleString),f=a.getFontMetrics(this.styleString),this.componentNumCtrl=this.evaluator.parent.getControlByCId(this.value),this.baseline=f.baseline-2,this.descent=f.descent-2,this.ascent=f.ascent+2,this.h=this.componentNumCtrl.h||1,this.w=this.componentNumCtrl.w||1):"componentSpace"==this.nodeType?(this.spaceWidth=a.getTextWidth(" ",this.styleString),
this.componentSpace=this.evaluator.parent.getSpaceByCId(this.value),this.h=this.ascent=this.descent=this.baseline=0,this.w=this.componentSpace.w):console.log("Element i=unknown",this.nodeType)};a.RTFNode.prototype.getBlockMetric=function(){this.w=0;for(var a=-1,e=-1,c,f=0,k=this.children.length;f<k;f++){c=this.children[f];c.getTextMetrics();childAscent=c.ascent;childDescent=c.descent;this.w+=c.w;var u=childDescent;c=c.h;b=childAscent;g=u;t=c;e<childAscent&&(e=childAscent);a<childDescent&&(a=childDescent)}this.ascent=
e;this.descent=a;this.baseline=this.ascent;this.h=this.ascent+this.descent};a.RTFNode.prototype.drawTextBlock=function(a,b,c,g,t,u,n,h){f=h;this.stableWidth||(k=g,e=t,this.getTextMetrics());n=n?-this.children[0].ascent:0;t=g=0;for(u=this.children.length;t<u;t++)0<t&&(g+=this.children[t-1].h),this.children[t].draw(a,b+0,c+n+g)};a.RTFNode.prototype.drawTextLineBlock=function(a,b,e){for(var c=0,g=0,k=this.children.length;g<k;g++)a.strokeStyle=f,a.fillStyle=f,0<g&&(c+=this.children[g-1].w,"formula"==
this.children[g-1].nodeType&&(c+=2*this.children[g-1].spaceWidth)),this.children[g].draw(a,b+c,e+this.baseline)};a.RTFNode.prototype.drawFormula=function(a,b,e){for(var c=0,g=0,f=this.children.length;g<f;g++)0<g&&(c+=this.children[g-1].w),this.children[g].draw(a,b+this.spaceWidth+c,e)};a.RTFNode.prototype.drawText=function(a,b,e){null!=this.color&&(a.fillStyle=this.color);a.font=this.styleString;a.textAlign="start";a.textBaseline="alphabetic";a.fillText(this.value,b-1,e);if(this.underline){var c=
"bold"==this.style.textBold,g=c?1:.5;a.lineWidth=c?2:1;null!=this.color&&(a.strokeStyle=this.color);a.beginPath();a.moveTo(b-1,parseInt(e+this.descent/2)+g);a.lineTo(b-1+this.w,parseInt(e+this.descent/2)+g);a.stroke()}this.overline&&(g=(c="bold"==this.style.textBold)?2:1.5,a.lineWidth=c?2:1,null!=this.color&&(a.strokeStyle=this.color),a.beginPath(),a.moveTo(b-1,parseInt(e-this.ascent)+g),a.lineTo(b-1+this.w,parseInt(e-this.ascent)+g),a.stroke())};a.RTFNode.prototype.drawDynamicText=function(b,c,g){var f=
Math.floor(.5*this.spaceWidth),t=void 0==this.decimals?k:this.evaluator.evalExpression(this.decimals),u=void 0==this.fixed?e:this.fixed,n=this.evaluator.evalExpression(this.value);parseFloat(n).toString()===n.toString()&&(n=u?parseFloat(n).toFixed(t):a.removeNeedlessDecimals(parseFloat(n).toFixed(t)),n=(""+n).replace(".",this.decimal_symbol));null!=this.color&&(b.fillStyle=this.color);b.font=this.styleString;b.textAlign="start";b.textBaseline="alphabetic";this.w=a.getTextWidth(n,this.styleString);
b.fillText(n,f+c,g);this.underline&&(u=(t="bold"==this.style.textBold)?1:.5,b.lineWidth=t?2:1,null!=this.color&&(b.strokeStyle=this.color),b.beginPath(),b.moveTo(f+c-1,parseInt(g+this.descent/2)+u),b.lineTo(f+c-1+this.w,parseInt(g+this.descent/2)+u),b.stroke());this.overline&&(u=(t="bold"==this.style.textBold)?2:1.5,b.lineWidth=t?2:1,null!=this.color&&(b.strokeStyle=this.color),b.beginPath(),b.moveTo(f+c-1,parseInt(g-this.ascent)+u),b.lineTo(f+c-1+this.w,parseInt(g-this.ascent)+u),b.stroke());this.w+=
2*f};a.RTFNode.prototype.drawHyperlink=function(a,b,c){this.clickCacher.parentNode||(a.canvas.nextSibling.className?a.canvas.parentNode.insertBefore(this.clickCacher,a.canvas.nextSibling.nextSibling):a.canvas.parentNode.insertBefore(this.clickCacher,a.canvas.nextSibling),this.clickCacher.style.left=b-2+"px",this.clickCacher.style.top=c-this.ascent-2+"px");a.save();this.click?(a.fillStyle="red",a.strokeStyle="red"):(a.fillStyle="blue",a.strokeStyle="blue");a.font=this.styleStr;a.textAlign="start";
a.textBaseline="alphabetic";a.fillText(this.value,b-1,c);var e="bold"==this.style.textBold,g=e?1:.5;a.lineWidth=e?2:1;a.beginPath();a.moveTo(b-1,Math.ceil(c+this.descent/2)+g-2);a.lineTo(b-1+this.w,Math.ceil(c+this.descent/2)+g-2);a.stroke();a.restore()};a.RTFNode.prototype.drawRadical=function(a,b,c){var e=Math.floor(this.spaceWidth);this.children[0].draw(a,b,Math.floor(c+this.children[1].descent-this.children[1].h/2-this.children[0].descent));this.children[1].draw(a,b+1.5*e+this.children[0].w,c);
a.lineWidth=1;null!=this.color&&(a.strokeStyle=this.color);a.beginPath();a.moveTo(b,Math.floor(c+this.children[1].descent-this.children[1].h/2));a.lineTo(b+this.children[0].w,Math.floor(c+this.children[1].descent-this.children[1].h/2));a.lineTo(b+this.children[0].w+.5*e,c+this.children[1].descent);a.lineTo(b+this.children[0].w+1*e,c-this.children[1].ascent);a.lineTo(b+this.children[0].w+2*e+this.children[1].w,c-this.children[1].ascent);a.stroke()};a.RTFNode.prototype.drawFraction=function(a,b,c){this.children[0].draw(a,
b+(this.w-this.children[0].w)/2,c-this.ascent);this.children[1].draw(a,b+(this.w-this.children[1].w)/2,c-this.ascent+this.children[0].h-1);var e=Math.floor(.5*this.spaceWidth);a.lineWidth=1;null!=this.color&&(a.strokeStyle=this.color);a.beginPath();a.moveTo(b+e,parseInt(c-this.ascent+this.children[0].h)-.5);a.lineTo(b-e+this.w-1,parseInt(c-this.ascent+this.children[0].h)-.5);a.stroke()};a.RTFNode.prototype.drawNumDen=function(a,b,c){for(var e=0,g=0,f=this.children.length;g<f;g++)0<g&&(e+=this.children[g-
1].w),this.children[g].draw(a,b+e,c+this.baseline)};a.RTFNode.prototype.drawSubIndex=function(a,b,c){for(var e=0,g=0,f=this.children.length;g<f;g++)0<g&&(e+=this.children[g-1].w),this.children[g].draw(a,b+e,c+this.subIndexPos)};a.RTFNode.prototype.drawSuperIndex=function(a,b,c){for(var e=0,g=0,f=this.children.length;g<f;g++)0<g&&(e+=this.children[g-1].w),this.children[g].draw(a,b+e,c-this.superIndexPos)};a.RTFNode.prototype.drawLimit=function(b,c,e){var g=a.getFontMetrics(this.styleString),f=" "+
String.fromCharCode(8594),k=a.getTextWidth(f,this.styleString);this.children[0].draw(b,c,e+g.descent+this.children[0].ascent);this.children[1].draw(b,c+this.children[0].w+k,e+g.descent+this.children[1].ascent);this.children[2].draw(b,c+k+this.children[0].w+this.children[1].w,e);null!=this.color&&(b.fillStyle=this.color);b.font=this.styleString;b.textAlign="start";b.textBaseline="alphabetic";b.fillText("l\u00edm",c+this.children[0].w,e);b.fillText(f,c+this.children[0].w,e+g.descent+this.children[0].ascent)};
a.RTFNode.prototype.drawIntegral=function(b,c,e){var g=this.style.clone();g.fontSize*=1.5;g.fontType="Times New Roman";g.Bold="bold";var g=g.toString(),f=a.getTextWidth(String.fromCharCode(8747),g),k=a.getFontMetrics(g),n=Math.max(this.children[0].w,this.children[1].w,Math.floor(1.5*f));this.children[0].draw(b,c+f,e+k.descent+this.children[0].ascent);this.children[1].draw(b,c+f+this.spaceWidth/2,e-this.ascent+this.children[1].ascent);this.children[2].draw(b,c+n+f,e);null!=this.color&&(b.fillStyle=
this.color);b.font=g;b.textAlign="start";b.textBaseline="alphabetic";b.fillText(String.fromCharCode(8747),c,e+k.descent/2)};a.RTFNode.prototype.drawSum=function(b,c,e){var g=this.style.clone();g.fontType="Times New Roman";g.Bold="bold";var g=g.toString(),f=a.getTextWidth(String.fromCharCode(8721),g),k=a.getFontMetrics(this.styleString),n=Math.max(this.children[0].w,this.children[1].w,f);this.children[0].draw(b,c+(n-this.children[0].w)/2,e+k.descent+this.children[0].ascent);this.children[1].draw(b,
c+(n-this.children[1].w)/2,e-k.ascent-this.children[1].descent);this.children[2].draw(b,c+n,e);null!=this.color&&(b.fillStyle=this.color);b.font=g;b.textAlign="start";b.textBaseline="alphabetic";b.fillText(String.fromCharCode(8721),c+Math.floor((n-f)/2),e-5)};a.RTFNode.prototype.drawMatrix=function(a,b,c){for(var e,g,f=0,k=this.children.length;f<k;f++)e=f%this.columns,g=Math.floor(f/this.columns),this.children[f].draw(a,2*this.spaceWidth+b+e*this.childWidth,c-this.ascent+this.childAscent+g*this.childHeight);
a.lineWidth=1;null!=this.color&&(a.strokeStyle=this.color);a.beginPath();a.moveTo(Math.floor(b+this.spaceWidth)+.5,c-this.ascent+.5);a.lineTo(Math.floor(b+this.spaceWidth/2)+.5,c-this.ascent+.5);a.lineTo(Math.floor(b+this.spaceWidth/2)+.5,c+this.descent+.5);a.lineTo(Math.floor(b+this.spaceWidth)+.5,c+this.descent+.5);a.moveTo(Math.floor(b+this.w-this.spaceWidth)-.5,c-this.ascent+.5);a.lineTo(Math.floor(b+this.w-this.spaceWidth/2)-.5,c-this.ascent+.5);a.lineTo(Math.floor(b+this.w-this.spaceWidth/2)-
.5,c+this.descent+.5);a.lineTo(Math.floor(b+this.w-this.spaceWidth)-.5,c+this.descent+.5);a.stroke()};a.RTFNode.prototype.drawDefparts=function(a,b,c){for(var e=0,g=this.children.length;e<g;e++)this.children[e].draw(a,b+3*this.spaceWidth,c-this.ascent+this.childAscent+e%this.parts*this.childHeight);a.lineWidth=1;null!=this.color&&(a.strokeStyle=this.color);a.beginPath();a.moveTo(parseInt(b+2*this.spaceWidth)+.5,c-this.ascent+.5);a.lineTo(parseInt(b+2*this.spaceWidth)-4.5,c-this.ascent+4.5);a.lineTo(parseInt(b+
2*this.spaceWidth)-4.5,c+this.descent-this.h/2-4.5);a.lineTo(b-.5,c+this.descent-this.h/2);a.lineTo(parseInt(b+2*this.spaceWidth)-4.5,c+this.descent-this.h/2+4.5);a.lineTo(parseInt(b+2*this.spaceWidth)-4.5,c+this.descent-4.5);a.lineTo(parseInt(b+2*this.spaceWidth)+.5,c+this.descent+.5);a.stroke()};a.RTFNode.prototype.drawMathSymbol=function(a,b,c){a.lineWidth=1;null!=this.color&&(a.strokeStyle=this.color,a.fillStyle=this.color);a.beginPath();"("==this.value?(a.font=this.styleString,a.textAlign="start",
a.textBaseline="alphabetic",a.fillText("(",b,c)):")"==this.value?(a.font=this.styleString,a.textAlign="start",a.textBaseline="alphabetic",a.fillText(")",b+this.spaceWidth,c)):(a.font=this.styleString,a.textAlign="center",a.textBaseline="alphabetic",a.fillText(this.value,b+this.w/2,c))};a.RTFNode.prototype.drawGenericBlock=function(a,b,c){for(var e=0,g=0,f=this.children.length;g<f;g++)0<g&&(e+=this.children[g-1].w),this.children[g].draw(a,b+e,c)};a.RTFNode.prototype.drawComponentNumCtrl=function(a,
b,c){this.parent.getTextMetrics();this.componentNumCtrl.expresion=this.evaluator.parser.parse("("+b+","+(c-this.ascent)+","+this.componentNumCtrl.w+","+this.componentNumCtrl.h+")")};a.RTFNode.prototype.drawComponentSpace=function(a,b,c){this.getTextMetrics();this.componentSpace.xExpr=this.evaluator.parser.parse(b+"");this.componentSpace.yExpr=this.evaluator.parser.parse(c-this.parent.ascent+"")};a.RTFNode.prototype.draw=function(a,b,c){console.log(">>> Dibujo desconocido ",this.nodeType)};a.RTFNode.prototype.toHTML=
function(a){var b="";if("textLineBlock"===this.nodeType||"textBlock"===this.nodeType)for(var e=0,g=this.children.length;e<g;e++)b+=this.children[e].toHTML(a);else"text"===this.nodeType?b="<span "+this.style.toCSS()+">"+this.value.replace(/ {2}/g,"&nbsp;&nbsp;").replace(/&nbsp; /g,"&nbsp;")+"</span>":"newLine"===this.nodeType?b="<span "+this.style.toCSS()+">"+this.value+"<br /></span>":"hyperlink"===this.nodeType?b="<span "+this.style.toCSS()+"> <a target='_blank' href='"+this.URL+"'>"+this.value+
"</a></span>":"formula"===this.nodeType?b="<span "+this.style.toCSS()+"> \\( \\displaystyle "+c(this)+"\\) </span>":"componentSpace"===this.nodeType?(a.spaces.push({cID:"cID_"+this.value,value:this.componentSpace}),b="<div style='display:inline-block; vertical-align:top; width:"+this.componentSpace.w+"px; height:0px;' id='cID_"+this.value+"'></div>"):"componentNumCtrl"===this.nodeType?(a.ctrs.push({cID:"cID_"+this.value,value:this.componentNumCtrl}),b="<div style='display:inline-block; vertical-align:middle; width:"+
this.componentNumCtrl.w+"px; height:"+this.componentNumCtrl.h+"px;' id='cID_"+this.value+"'></div>"):console.log(">>>",this,"<<<");return b};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c=String.fromCharCode,k,e,f,b,g,t,d,r,p,m,q,u;a.RTFTokenizer=function(){};a.RTFTokenizer.prototype.tokenize=function(a){if(a)a=a.replace(/\&gt;/g,">").replace(/\&lt;/g,"<").replace(/\&quote;/g,"''").replace(/\&squot;/g,"'").replace(/\\rquote /g,"'").replace(/\\endash /g,"-").replace(/\n/g,
" ").replace(/\r/g,"").replace(/\\uc(\d+) /g,"").replace(/\\uc(\d+)/g,"");else return[];k=[];e=a.length;k=[];f="";g=b=0;d=a.charAt(0);r=!1;for(p="text";b<e;)t=d,d=a.charAt(b+1),r?"\\"===d||"{"===d||"}"===d||" "===d||";"===d?(r=!1,f+=t," "===d?(b++,d=a.charAt(b+1),u=!0):u=!1,(m=f.match(/^\'([0-9a-f]{2})/))?(q="","text"===p&&(q=k.pop().value),f=q+=c(parseInt(m[1],16))+f.substring(3)):(m=f.match(/^u[0-9]+/))?(q="","text"===p&&(q=k.pop().value),f=q+=c(m[0].substring(1))):("{"===f||"}"===f||"\\"==t?(k.push({type:"text",
value:f+(u?" ":"")}),p="text"):(k.push({type:"controlWord",value:f}),p="controlWord"),f="")):"{"==t||"}"==t||"\\"==t?(r=!1,k.push({type:"text",value:t}),p="text"):f+=t:"\\"===t?(r=!0,""!==f&&(k.push({type:"text",value:f}),p="text"),f=""):"{"===t?(g++,""!==f&&k.push({type:"text",value:f}),f="",k.push({type:"openBlock",value:g}),p="openBlock"):"}"===t?(""!==f&&k.push({type:"text",value:f}),f="",k.push({type:"closeBlock",value:g}),p="closeBlock",g--):f+=t,b++;""!==f&&k.push({type:"text",value:f});return k};
return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b,g,t,d,r,p,m,q,u,n,h,v,l,w,y,C,D,z,F,H,I,A,G,B,K,E;a.RTFParser=function(b){this.evaluator=b;this.tokenizer=new a.RTFTokenizer};a.RTFParser.prototype.parse=function(x){x=c=this.tokenizer.tokenize(x);for(var L=[],J=!1,M=!1,N=[],O=0,S=x.length;O<S;O++)if("openBlock"==x[O].type&&N.push(x[O].value),"closeBlock"==x[O].type&&(N.pop(),0>=N.length&&(J=!1)),"controlWord"!=x[O].type||"expr"!=x[O].value&&"decimals"!=x[O].value||
(M=!0),"controlWord"==x[O].type&&"mjaformula"==x[O].value&&(J=!0),"text"==x[O].type&&J&&!M){for(var T=0,Q=x[O].value,R="",P=0,ba=Q.length;P<ba;P++)if("("==Q.charAt(P)||")"==Q.charAt(P)||"+"==Q.charAt(P)||"-"==Q.charAt(P)||"*"==Q.charAt(P)||"="==Q.charAt(P))R=Q.substring(T,P),""!=R&&L.push({type:"text",value:R}),L.push({type:Q.charAt(P),value:Q.charAt(P)}),T=P+1;R=Q.substring(T,P);""!=R&&L.push({type:"text",value:R})}else L.push(x[O]),"text"==x[O].type&&M&&(M=!1);c=L;k={};f=2;if("openBlock"==c[0].type&&
"fonttbl"==c[1].value){for(e=c[0].value;"closeBlock"!=c[f].type&&c[f].value!=e;)k[c[f].value]=c[f+2].value.substring(0,c[f+2].value.length-1),f+=3;f++}b={};g=0;if("openBlock"==c[f].type&&"colortbl"==c[f+1].value){e=c[f++].value;for(f++;"closeBlock"!=c[f].type&&c[f].value!=e;)t=parseInt(c[f++].value.substring(3)).toString(16),d=parseInt(c[f++].value.substring(5)).toString(16),r=parseInt(c[f++].value.substring(4)).toString(16),";"===c[f].value&&f++,b[g++]="#"+(2>t.length?"0"+t:t)+(2>d.length?"0"+d:
d)+(2>r.length?"0"+r:r);f++}p=new a.RTFNode(this.evaluator,"","textBlock","",!1,"");m=new a.RTFNode(this.evaluator,"","textLineBlock","",!1,"");p.addChild(m);n=u=q=null;C=y=w=l=v=h=!1;D=[new a.FontStyle(20,"Arial","","",!1,!1,null)];z=D[0];F=!0;I=H=-1;A=[];E=K=B=G=!1;x=f;for(L=c.length;x<L;x++)if("controlWord"==c[x].type&&k[c[x].value])z.fontType=k[c[x].value];else if("controlWord"==c[x].type&&c[x].value.match(/^fs(\d+)/))z.fontSize=parseInt(c[x].value.match(/^fs(\d+)/)[1]/2);else if("controlWord"==
c[x].type&&"b"==c[x].value)z.textBold="bold";else if("controlWord"==c[x].type&&"b0"==c[x].value)z.textBold="";else if("controlWord"==c[x].type&&"i"==c[x].value)z.textItalic="oblique";else if("controlWord"==c[x].type&&"i0"==c[x].value)z.textItalic="";else if("controlWord"==c[x].type&&"ul"==c[x].value)z.textUnderline=!0;else if("controlWord"==c[x].type&&"ulnone"==c[x].value)z.textUnderline=!1;else if("controlWord"==c[x].type&&"ol"==c[x].value)z.textOverline=!0;else if("controlWord"==c[x].type&&"olnone"==
c[x].value)z.textOverline=!1;else if("controlWord"==c[x].type&&c[x].value.match(/^cf(\d+)/))z.textColor=b[parseInt(c[x].value.substring(2))],0<A.length&&(A[A.length-1].style.textColor=z.textColor);else if("openBlock"==c[x].type)H=c[x].value,z=z.clone(),D.push(z),A.push(null);else if("closeBlock"==c[x].type)c[x].value==I&&(I=-1,h=!1,m=m.parent),D.pop(),z=D[D.length-1],A.pop();else if("controlWord"==c[x].type&&"par"==c[x].value){m.addChild(new a.RTFNode(this.evaluator,"","newLine",z.clone()));p=new a.RTFNode(this.evaluator,
"","textLineBlock",z.clone());if("textBlock"!=m.nodeType)for(m=m.parent;"textBlock"!=m.nodeType;)m=m.parent;m.addChild(p);m=p}else if("controlWord"==c[x].type&&"mjaformula"==c[x].value)G=!0,I=H,h=!0,p=new a.RTFNode(this.evaluator,"","formula",z.clone()),m.addChild(p),m=p,A[A.length-1]=p;else if("controlWord"==c[x].type&&("fraction"==c[x].value||"radicand"==c[x].value||"radical"==c[x].value||"what"==c[x].value||"sum"==c[x].value||"integral"==c[x].value||"limit"==c[x].value))J=A[A.length-2].style.clone(),
p=new a.RTFNode(this.evaluator,"",c[x].value,J),A[A.length-2].addChild(p),A[A.length-1]=p;else if("controlWord"==c[x].type&&"index"==c[x].value||"to"==c[x].value||"from"==c[x].value)J=A[A.length-2].style.clone(),J.fontSize=parseInt(J.fontSize-.2*J.fontSize),8>J.fontSize&&(J.fontSize=8),p=new a.RTFNode(this.evaluator,"",c[x].value,J),A[A.length-2].addChild(p),A[A.length-1]=p;else if("controlWord"==c[x].type&&("num"==c[x].value||"den"==c[x].value))J=A[A.length-2].style.clone(),J.fontSize=Math.round(J.fontSize-
.1*J.fontSize),8>J.fontSize&&(J.fontSize=8),"num"==c[x].value?p=new a.RTFNode(this.evaluator,"","numerator",J):"den"==c[x].value&&(p=new a.RTFNode(this.evaluator,"","denominator",J)),A[A.length-2].addChild(p),A[A.length-1]=p;else if("controlWord"==c[x].type&&("subix"==c[x].value||"supix"==c[x].value))J=A[A.length-2].style.clone(),J.fontSize=Math.floor(J.fontSize-J.fontSize/3),8>J.fontSize&&(J.fontSize=8),"subix"==c[x].value?p=new a.RTFNode(this.evaluator,"","subIndex",J):"supix"==c[x].value&&(p=new a.RTFNode(this.evaluator,
"","superIndex",J)),p.originalStyle=A[A.length-2].style.clone(),A[A.length-2].addChild(p),A[A.length-1]=p;else if("controlWord"==c[x].type&&("defparts"==c[x].value||"matrix"==c[x].value||"element"==c[x].value))J=A[A.length-2].style.clone(),p=new a.RTFNode(this.evaluator,"",c[x].value,J),A[A.length-2].addChild(p),A[A.length-1]=p,"defparts"==c[x].value?n=p:"matrix"==c[x].value&&(u=p);else if("controlWord"==c[x].type&&"parts"==c[x].value)C=!0;else if("text"==c[x].type&&C)n.parts=parseInt(c[x].value),
C=!1;else if("controlWord"==c[x].type&&"rows"==c[x].value)w=!0;else if("text"==c[x].type&&w)u.rows=parseInt(c[x].value),w=!1;else if("controlWord"==c[x].type&&"columns"==c[x].value)y=!0;else if("text"==c[x].type&&y)u.columns=parseInt(c[x].value),y=!1;else if("controlWord"==c[x].type&&"expr"==c[x].value)F=!1,v=!0;else if("controlWord"==c[x].type&&"decimals"==c[x].value)l=!0;else if("text"==c[x].type&&l)q.decimals=this.evaluator.parser.parse(c[x].value+""),l=!1;else if("controlWord"==c[x].type&&"fixed1"==
c[x].value)q.fixed=!0;else if("controlWord"==c[x].type&&"fixed0"==c[x].value)q.fixed=!1;else if("controlWord"!=c[x].type||"component"!=c[x].value)if("controlWord"==c[x].type&&"NumCtrl"==c[x].value)B=!0;else if("controlWord"==c[x].type&&"Space"==c[x].value)K=!0;else if("controlWord"==c[x].type&&"hyperlink"==c[x].value)E=!0;else if("text"==c[x].type&&E){textContent=c[x].value.split("|")[0];J=z.clone();p=new a.RTFNode(this.evaluator,textContent,"hyperlink",J);p.URL=c[x].value.split("|")[1];if("textLineBlock"!=
m.nodeType)for(m=m.parent;"textLineBlock"!=m.nodeType;)m=m.parent;m.addChild(p);E=!1}else if("text"==c[x].type&&B)p=new a.RTFNode(this.evaluator,c[x].value,"componentNumCtrl",z.clone()),m.addChild(p),B=!1;else if("text"==c[x].type&&K)p=new a.RTFNode(this.evaluator,c[x].value,"componentSpace",z.clone()),m.addChild(p),K=!1;else if("text"==c[x].type&&v)J=A[A.length-2].style.clone(),textContent=this.evaluator.parser.parse(c[x].value),p=new a.RTFNode(this.evaluator,textContent,"dynamicText",J),A[A.length-
2].addChild(p),q=A[A.length-1]=p,v=!1;else if("text"==c[x].type&&!v&&!h){textContent=c[x].value;p=new a.RTFNode(this.evaluator,textContent,"text",z.clone());if("textLineBlock"!=m.nodeType)for(m=m.parent;"textLineBlock"!=m.nodeType;)m=m.parent;m.addChild(p)}else if("text"==c[x].type&&!v&&h)textContent=c[x].value,p=new a.RTFNode(this.evaluator,textContent,"text",A[A.length-1].style.clone()),A[A.length-1].addChild(p);else if("("==c[x].type||")"==c[x].type)J=A[A.length-1].style.clone(),J.textItalic="",
p=new a.RTFNode(this.evaluator,c[x].type,"mathSymbol",J),A[A.length-1].addChild(p);else if("+"==c[x].type||"-"==c[x].type||"*"==c[x].type||"="==c[x].type)p=new a.RTFNode(this.evaluator,c[x].type,"mathSymbol",A[A.length-1].style.clone()),A[A.length-1].addChild(p);if(null!=m){var V=m.getRoot();V.stableWidth=F;V.getTextMetrics();V.hasFormula=G}return V};a.FontStyle=function(a,b,d,c,e,g,f){this.fontSize=a;this.fontType=b;this.textItalic=d;this.textBold=c;this.textUnderline=e;this.textOverline=g;this.textColor=
f};a.FontStyle.prototype.toString=function(){"arial"==this.fontType.toLowerCase()?this.fontType="descartesJS_sansserif,Arial,Helvetica,Sans-serif":this.fontType.toLowerCase().match("times")?this.fontType="descartesJS_serif,'Times New Roman',Times,serif":this.fontType.toLowerCase().match("courier")&&(this.fontType="descartesJS_monospace,'Courier New',Courier,Monospace");return(this.textBold+" "+this.textItalic+" "+this.fontSize+"px "+this.fontType).trim()};a.FontStyle.prototype.toCSS=function(){var a=
'style="font-size:'+this.fontSize+"px; font-family:"+this.fontType+"; ";this.textUnderline&&!this.textOverline&&(a+="text-decoration: underline; ");!this.textUnderline&&this.textOverline&&(a+="text-decoration: overline; ");this.textUnderline&&this.textOverline&&(a+="text-decoration: underline overline; ");this.textBold&&!this.textItalic&&(a+="font-style: normal; font-weight: bold; ");!this.textBold&&this.textItalic&&(a+="font-style: italic; font-weight: normal; ");this.textBold&&this.textItalic&&
(a+="font-style: italic; font-weight: bold; ");this.textBold||this.textItalic||(a+="font-style: normal; font-weight: normal; ");this.textColor&&(a+="color: "+this.textColor+"; ");return a+'"'};a.FontStyle.prototype.clone=function(){return new a.FontStyle(this.fontSize,this.fontType,this.textItalic,this.textBold,this.textUnderline,this.textOverline,this.textColor)};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b,g,t,d,r,p,m,q,u,n;a.Space=function(b,d){this.parent=
b;k=this.evaluator=this.parent.evaluator;e=k.parser;this.id="";this.values=d;this.type="R2";this.xExpr=e.parse("0");this.yExpr=e.parse("0");this.w=parseInt(b.container.width);this.h=parseInt(b.container.height);this.drawif=e.parse("1");this.fixed=2!=b.version?!1:!0;this.scale=48;this.Oy=this.Ox=0;this.image=new Image;this.image.onload=function(){this.ready=1};this.imageSrc="";this.bg_display="topleft";this.background="descinst.com.mja.descartes.DescartesJS.class"===b.code||b.arquimedes?new a.Color("f0f8fa"):
new a.Color("ffffff");this.net=2!=b.version?new a.Color("c0c0c0"):"";this.net10=2!=b.version?new a.Color("808080"):"";this.axes=2!=b.version?new a.Color("808080"):"";this.text=new a.Color("ffafaf");this.numbers=!1;this.x_axis=2!=b.version?"":" ";this.y_axis=2!=b.version?"":" ";this.sensitive_to_mouse_movements=!1;this.cID="";this.mouse_y=this.mouse_x=0;this.ctrs=[];this.graphicsCtr=[];this.graphics=[];this.backgroundGraphics=[];this.zIndex=b.zIndex;this.plecaHeight=b.plecaHeight||0;this.displaceRegionNorth=
b.displaceRegionNorth||0;this.displaceRegionWest=b.displaceRegionWest||0;for(var c in d)d.hasOwnProperty(c)&&(this[c]=d[c]);this.init()};a.Space.prototype.init=function(){c=this.parent;k=this.evaluator;f=this.id;this.displaceRegionNorth=c.displaceRegionNorth||0;this.displaceRegionWest=c.displaceRegionWest||0;void 0!=this.wExpr&&(this.w=(parseInt(c.container.width)-this.displaceRegionWest)*parseFloat(this.wExpr)/100);void 0!=this.hExpr&&(this.h=(parseInt(c.container.height)-this.displaceRegionNorth)*
parseFloat(this.hExpr)/100);t=parseInt(c.container.height);d=parseInt(c.container.width);this.x=k.evalExpression(this.xExpr)+this.displaceRegionWest;this.y=k.evalExpression(this.yExpr)+this.plecaHeight+this.displaceRegionNorth;this.container&&(this.container.style.left=this.x+"px",this.container.style.top=this.y+"px");0<=this.y?(b=t-this.y,this.h>b&&(this.h=b)):(b=this.h+this.y,this.h=b>=t?t:b);0<=this.x?(g=d-this.x,this.w>g&&(this.w=g)):(g=this.w+this.x,this.w=g>=d?d:g);""==this.imageSrc&&this.imageSrc.trim().toLowerCase().match(/vacio.gif$/)||
(this.image=c.getImage(this.imageSrc));this.OxExpr&&(p=this.OxExpr,"%"===p[p.length-1]?this.Ox=this.w*parseFloat(p)/100:(r=parseFloat(p),r!=p&&(r=0),this.Ox=r));this.OyExpr&&(m=this.OyExpr,"%"===m[m.length-1]?this.Oy=this.h*parseFloat(m)/100:(r=parseFloat(m),r!=m&&(r=0),this.Oy=r));""!==this.id&&2!==c.version?(k.setVariable(f+"._w",this.w),k.setVariable(f+"._h",this.h),k.setVariable(f+".escala",this.scale),k.setVariable(f+".Ox",this.Ox),k.setVariable(f+".Oy",this.Oy),k.setVariable(f+".mouse_x",0),
k.setVariable(f+".mouse_y",0),k.setVariable(f+".mouse_pressed",0),k.setVariable(f+".mouse_clicked",0),k.setVariable(f+".clic_izquierdo",0)):(r=k.getVariable("_w"),void 0===r&&(r=this.w),k.setVariable("_w",r),r=k.getVariable("_h"),void 0===r&&(r=this.h),k.setVariable("_h",r),r=k.getVariable("escala"),void 0===r&&(r=this.scale),k.setVariable("escala",r),r=k.getVariable("Ox"),void 0===r&&(r=this.Ox),k.setVariable("Ox",r),r=k.getVariable("Oy"),void 0===r&&(r=this.Oy),k.setVariable("Oy",r),k.setVariable("mouse_x",
0),k.setVariable("mouse_y",0),k.setVariable("mouse_pressed",0),k.setVariable("mouse_clicked",0),k.setVariable("clic_izquierdo",0),""===this.x_axis&&""===this.y_axis&&2==c.version&&(this.axes=""));this.w_2=this.w/2;this.h_2=this.h/2};a.Space.prototype.addCtr=function(a){"graphic"===a.type?this.graphicsCtr.push(a):this.ctrs.push(a)};a.Space.prototype.addGraph=function(a,b){"R2"==this.type&&b||"R3"==this.type&&!b||(a.background&&"R3"!==this.type?this.backgroundGraphics.push(a):this.graphics.push(a))};
a.Space.prototype.clearClick=function(){this.evaluator.setVariable(this.mclickedString,0);this.evaluator.setVariable(this.mclicizquierdoString,0)};a.Space.prototype.getRelativeX=function(a){return(parseInt(a)-this.w_2-this.Ox)/this.scale};a.Space.prototype.getRelativeY=function(a){return(-parseInt(a)+this.h_2+this.Oy)/this.scale};a.Space.prototype.getAbsoluteX=function(a){return a*this.scale+this.w_2+this.Ox};a.Space.prototype.getAbsoluteY=function(a){return-a*this.scale+this.h_2+this.Oy};a.Space.prototype.findOffset=
function(){q=this.container;this.offsetTop=this.offsetLeft=0;this.container&&this.container.style&&(u=this.container.style.display);this.container.style.display="block";if(q.getBoundingClientRect){var a=q.getBoundingClientRect();this.offsetLeft=a.left;this.offsetTop=a.top}else for(;q;)q.tagName&&"html"!==q.tagName.toLowerCase()?(this.offsetLeft+=q.offsetLeft||0,this.offsetTop+=q.offsetTop||0,q=q.parentNode):q=null;this.container&&this.container.style&&(this.container.style.display=u)};a.Space.prototype.getCursorPosition=
function(b){this.findOffset();n=a.getCursorPosition(b);return{x:n.x-((document.documentElement&&document.documentElement.scrollLeft||document.body.scrollLeft)+this.offsetLeft),y:n.y-((document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop)+this.offsetTop)}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c;a.SpaceExternal=function(a){c=this;c.parent=a;c.width=228;c.vSpace=25;c.container=document.createElement("div");c.container.setAttribute("style",
"box-sizing:border-box;border-style:ridge;border-width:5px;border-color:gray;box-shadow:#000 0 0 25px 5px;overflow-y:scroll;overflow-x:hidden;position:fixed;left:0;top:0;z-index:10000;width:"+(c.width+27)+"px;height:460px;background-color:#63b4fb");c.moveManipulator=document.createElement("div");c.moveManipulator.setAttribute("style"," position:absolute;left:0;top:0;width:"+(c.width+27)+"px;height:"+c.vSpace+"px;line-height:"+c.vSpace+"px;background-color:#ddd;cursor:move;padding-left:75px;font-family:Sans-Serif;font-size:18px;");
c.moveManipulator.innerHTML="Descartes";c.container.appendChild(c.moveManipulator);c.ctrs=[]};a.SpaceExternal.prototype.init=function(){function c(b){f.newPosition=a.getCursorPosition(b);f.container.style.left=f.initialPosition.x+(f.newPosition.x-f.oldPosition.x)+"px";f.container.style.top=f.initialPosition.y+(f.newPosition.y-f.oldPosition.y)+"px"}function e(a){a.preventDefault();f.findOffset();document.body.removeEventListener("mousemove",c);document.body.removeEventListener("mouseup",e)}document.body.appendChild(this.container);
var f=this,b=f.parent.evaluator.parser,g;g=0;for(var t=f.ctrs.length;g<t;g++)f.ctrs[g].expresion=b.parse("(0,"+(f.vSpace+23+35*g)+","+f.width+",35)"),f.ctrs[g].update();f.numCtr=t;g="espa\u00f1ol"==f.language?"cr\u00e9ditos":"english"==f.language?"about":"cr\u00e9ditos";g=new a.Button(f.parent,{region:"external",name:g,font_size:b.parse("15"),expresion:b.parse("(0,"+f.vSpace+","+f.width/2+",25)")});g.actionExec={execute:a.showAbout};g.update();(new a.Button(f.parent,{region:"external",name:"config",
font_size:b.parse("15"),action:"config",expresion:b.parse("("+f.width/2+","+f.vSpace+","+f.width/2+",25)")})).update();g="espa\u00f1ol"==f.language?"inicio":"english"==f.language?"init":"inicio";(new a.Button(f.parent,{region:"external",name:g,font_size:b.parse("15"),action:"init",expresion:b.parse("(0,"+(f.vSpace+23+35*t)+","+f.width/2+",25)")})).update();g="espa\u00f1ol"==f.language?"limpiar":"english"==f.language?"clear":"limpiar";(new a.Button(f.parent,{region:"external",name:g,font_size:b.parse("15"),
action:"clear",expresion:b.parse("("+f.width/2+","+(f.vSpace+23+35*t)+","+f.width/2+",25)")})).update();g="espa\u00f1ol"==f.language?"cerrar":"close";b=new a.Button(f.parent,{region:"external",name:g,font_size:b.parse("15"),expresion:b.parse("("+f.width/4+","+(f.vSpace+46+35*t)+","+f.width/2+",25)")});b.update();b.canvas.addEventListener("click",function(a){f.hide()});f.setPositionAndSize();f.moveManipulator.addEventListener("mousedown",function(b){b.preventDefault();f.oldPosition=a.getCursorPosition(b);
f.initialPosition={x:f.container.offsetLeft,y:f.container.offsetTop};document.body.addEventListener("mousemove",c);document.body.addEventListener("mouseup",e)});f.findOffset();f.hide()};a.SpaceExternal.prototype.addCtr=function(a){this.ctrs.push(a)};a.SpaceExternal.prototype.show=function(){this.setPositionAndSize();this.container.style.display="block"};a.SpaceExternal.prototype.hide=function(){this.container.style.display="none"};a.SpaceExternal.prototype.setPositionAndSize=function(){var a=this.vSpace+
46+35*this.numCtr+25+10;this.container.style.left=Math.max(parseInt(window.innerWidth-this.width)/2,0)+"px";this.container.style.top="5px";this.container.style.height=window.innerHeight<this.vSpace+75?this.vSpace+75+"px":a>window.innerHeight-10?window.innerHeight-10:a+"px"};a.SpaceExternal.prototype.findOffset=function(){tmpContainer=this.container;this.offsetTop=this.offsetLeft=0;this.container&&this.container.style&&(tmpDisplay=this.container.style.display);this.container.style.display="block";
if(tmpContainer.getBoundingClientRect){var a=tmpContainer.getBoundingClientRect();this.offsetLeft=a.left;this.offsetTop=a.top}else for(;tmpContainer;)tmpContainer.tagName&&"html"!==tmpContainer.tagName.toLowerCase()?(this.offsetLeft+=tmpContainer.offsetLeft||0,this.offsetTop+=tmpContainer.offsetTop||0,tmpContainer=tmpContainer.parentNode):tmpContainer=null;this.container&&this.container.style&&(this.container.style.display=tmpDisplay);for(var a=0,c=this.ctrs.length;a<c;a++)this.ctrs[a].findOffset&&
this.ctrs[a].findOffset()};return a}(descartesJS||{}),descartesJS=function(a){var c,k;if(a.loadLib)return a;var e=Math.floor,f=Math.round,b=2*Math.PI,g=a.convertFont("SansSerif,PLAIN,12"),t=a.convertFont("Monospaced,PLAIN,12"),d,r,p,m,q,u,n,h,v,l,w,y,C,D,z,F,H,I,A,G,B,K,E,x,L,J,M,N;a.Space2D=function(b,c){a.Space.call(this,b,c);d=this;d._ratio=5E6<d.w*a._ratio*d.h*a._ratio?1:a._ratio;d.backgroundCanvas=document.createElement("canvas");d.backgroundCanvas.setAttribute("id",d.id+"_background");d.backgroundCanvas.width=
d.w*d._ratio;d.backgroundCanvas.height=d.h*d._ratio;d.backgroundCanvas.style.width=d.w+"px";d.backgroundCanvas.style.height=d.h+"px";d.backgroundCtx=d.backgroundCanvas.getContext("2d");d.canvas=document.createElement("canvas");d.canvas.setAttribute("id",d.id+"_canvas");d.canvas.width=d.w*d._ratio;d.canvas.height=d.h*d._ratio;d.canvas.setAttribute("class","DescartesSpace2DCanvas");d.canvas.setAttribute("style","z-index: "+d.zIndex+"; width:"+d.w+"px; height:"+d.h+"px;");d.ctx=d.canvas.getContext("2d");
d.graphicControlContainer=document.createElement("div");d.graphicControlContainer.setAttribute("id",d.id+"_graphicControls");d.graphicControlContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: "+d.zIndex+";");d.numericalControlContainer=document.createElement("div");d.numericalControlContainer.setAttribute("id",d.id+"_numericalControls");d.numericalControlContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: "+d.zIndex+";");d.container=document.createElement("div");
d.container.setAttribute("id",d.id);d.container.setAttribute("class","DescartesSpace2DContainer");d.container.setAttribute("style","left: "+d.x+"px; top: "+d.y+"px; z-index: "+d.zIndex+";");d.parent.arquimedes&&"#f0f8fa"===d.background.getColor()&&(d.container.style.border="1px solid #b8c4c8");d.container.appendChild(d.backgroundCanvas);d.container.appendChild(d.canvas);d.container.appendChild(d.graphicControlContainer);d.container.appendChild(d.numericalControlContainer);b.container.insertBefore(d.container,
b.loader);d.parent.images[d.id+".image"]=d.canvas;d.parent.images[d.id+".image"].ready=1;d.parent.images[d.id+".image"].complete=!0;d.evaluator.setVariable(d.id+".image",d.id+".image");d.parent.images[d.id+".back"]=d.backgroundCanvas;d.parent.images[d.id+".back"].ready=1;d.parent.images[d.id+".back"].complete=!0;d.evaluator.setVariable(d.id+".back",d.id+".back");""!==d.id&&2!==b.version?(d.OxString=d.id+".Ox",d.OyString=d.id+".Oy",d.scaleString=d.id+".escala",d.wString=d.id+"._w",d.hString=d.id+"._h",
d.mxString=d.id+".mouse_x",d.myString=d.id+".mouse_y",d.mpressedString=d.id+".mouse_pressed",d.mclickedString=d.id+".mouse_clicked",d.mclicizquierdoString=d.id+".clic_izquierdo",d.kpressedString=d.id+".key_pressed",d.kvalueString=d.id+".key_value"):(d.OxString="Ox",d.OyString="Oy",d.scaleString="escala",d.wString="_w",d.hString="_h",d.mxString="mouse_x",d.myString="mouse_y",d.mpressedString="mouse_pressed",d.mclickedString="mouse_clicked",d.mclicizquierdoString="clic_izquierdo",d.kpressedString="key_pressed",
d.kvalueString="key_value");d.click=0;"descartesJS_scenario"!==d.id?d.registerMouseAndTouchEvents():d.canvas.oncontextmenu=function(a){return!1}};a.extend(a.Space2D,a.Space);a.Space2D.prototype.init=function(){d=this;d.uber.init.call(d);d.canvas&&(d.backgroundCanvas.width=d.w*d._ratio,d.backgroundCanvas.height=d.h*d._ratio,d.backgroundCanvas.style.width=d.w+"px",d.backgroundCanvas.style.height=d.h+"px",d.canvas.width=d.w*d._ratio,d.canvas.height=d.h*d._ratio,d.canvas.style.width=d.w+"px",d.canvas.style.height=
d.h+"px");d.container&&d.findOffset()};a.Space2D.prototype.update=function(a){d=this;r=d.evaluator;p=d.parent;r.setVariable(d.wString,d.w);r.setVariable(d.hString,d.h);d.drawIfValue=0<r.evalExpression(d.drawif);if(d.drawIfValue){q=d.x!==r.evalExpression(d.xExpr)+d.displaceRegionWest;u=d.y!==r.evalExpression(d.yExpr)+p.plecaHeight+d.displaceRegionNorth;d.spaceChange=a||q||u||d.drawBefore!==d.drawIfValue||d.Ox!==r.getVariable(d.OxString)||d.Oy!==r.getVariable(d.OyString)||d.scale!==r.getVariable(d.scaleString)||
d.backColor!==d.background.getColor();d.x=q?r.evalExpression(d.xExpr)+d.displaceRegionWest:d.x;d.y=u?r.evalExpression(d.yExpr)+p.plecaHeight+d.displaceRegionNorth:d.y;d.Ox=r.getVariable(d.OxString);d.Oy=r.getVariable(d.OyString);d.scale=r.getVariable(d.scaleString);d.drawBefore=d.drawIfValue;1E-6>d.scale?(d.scale=1E-6,r.setVariable(d.scaleString,1E-6)):1E6<d.scale&&(d.scale=1E6,r.setVariable(d.scaleString,1E6));if(q||u)d.container.style.left=d.x+"px",d.container.style.top=d.y+"px",d.findOffset();
d.container.style.display="block";d.drawTrace=!d.spaceChange&&(!d.fixed&&!d.click||d.fixed);d.spaceChange&&(d.backgroundCtx.setTransform(d._ratio,0,0,d._ratio,0,0),d.drawBackground(),d.backgroundCtx.setTransform(1,0,0,1,0,0));d.ctx.setTransform(d._ratio,0,0,d._ratio,0,0);d.draw();d.ctx.setTransform(1,0,0,1,0,0)}else d.container.style.display="none"};a.Space2D.prototype.drawBackground=function(){r=this.evaluator;m=this.backgroundCtx;m.clearRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height);
this.backColor=this.background.getColor();m.fillStyle=this.backColor;m.fillRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height);this.image&&""!=this.image.src&&this.image.ready&&this.image.complete&&("topleft"===this.bg_display?m.drawImage(this.image,0,0):"stretch"===this.bg_display?m.drawImage(this.image,0,0,this.w,this.h):"patch"===this.bg_display?(m.fillStyle=m.createPattern(this.image,"repeat"),m.fillRect(0,0,this.canvas.width,this.canvas.height)):"imgcenter"===this.bg_display&&
m.drawImage(this.image,(this.w-this.image.width)/2,(this.h-this.image.height)/2));h=this.scale;v=0;for(l=0>this.w+this.h?0:this.w+this.h;h>l;)h/=10,v++;for(;h<l/10;)h*=10;m.lineWidth=1;""!==this.net&&(m.strokeStyle=this.net.getColor(),this.drawMarks(m,h/10,-1));if(2!==this.parent.version&&""!==this.net10||2===this.parent.version&&""!==this.net&&""!==this.net10)m.strokeStyle=this.net10.getColor(),this.drawMarks(m,h,-1);if(""!==this.axes){m.strokeStyle=this.axes.getColor();m.beginPath();if(""!==this.x_axis||
2!==this.parent.version)m.moveTo(0,e(this.h/2+this.Oy)+.5),m.lineTo(this.w,e(this.h/2+this.Oy)+.5);if(""!==this.y_axis||2!==this.parent.version)m.moveTo(e(this.w/2+this.Ox)+.5,0),m.lineTo(e(this.w/2+this.Ox)+.5,this.h);m.stroke();this.drawMarks(m,h,4);this.drawMarks(m,h/2,2);this.drawMarks(m,h/10,1)}if(""!==this.x_axis||""!==this.y_axis)m.fillStyle=""!==this.axes?this.axes.getColor():"black",m.font=g,m.textAlign="right",m.textBaseline="alphabetic",m.fillText(this.x_axis,e(this.w)-2,e(this.h/2+this.Oy)+
12),m.fillText(this.y_axis,e(this.w/2+this.Ox)-2,12);this.numbers&&""!=this.axes&&(m.fillStyle=this.axes.getColor(),m.font=g,m.textAlign="start",m.textBaseline="bottom",h>(this.w+this.h)/2?this.drawNumbers(m,h/5,h<=this.scale?v+1:v):h>(this.w+this.h)/4?this.drawNumbers(m,h/2,h<=this.scale?v+1:v):this.drawNumbers(m,h,v));for(var a=0,b=this.backgroundGraphics.length;a<b;a++)this.backgroundGraphics[a].draw()};a.Space2D.prototype.draw=function(){m=this.ctx;m.clearRect(0,0,this.canvas.width,this.canvas.height);
for(var a=0,d=this.graphics.length;a<d;a++)n=this.graphics[a],""!==n.trace&&this.drawTrace&&n.drawTrace(),n.draw();a=0;for(d=this.graphicsCtr.length;a<d;a++)this.graphicsCtr[a].draw();""!=this.text&&this.click&&"L"===this.whichButton&&(m.fillStyle=this.text.getColor(),m.strokeStyle=m.fillStyle,m.lineWidth=1,m.font=t,m.textAlign="center",m.textBaseline="alphabetic",B=1>=this.scale?this.mouse_x.toFixed(0):this.mouse_x.toFixed(this.scale.toString().length),K=1>=this.scale?this.mouse_y.toFixed(0):this.mouse_y.toFixed(this.scale.toString().length),
E="("+B+","+K+")",x=e(m.measureText(E).width/2),L=this.getAbsoluteX(this.mouse_x),J=this.getAbsoluteY(this.mouse_y),M=e(L),N=e(J-10),M+x>this.w?M=this.w-x:0>M-x&&(M=x),N+1>this.h?N=this.h:0>N-14&&(N=15),m.fillText(E,M,N),m.beginPath(),m.arc(L,J,2.5,0,b,!0),m.stroke())};a.Space2D.prototype.drawMarks=function(a,b,d){w=this.w;y=this.h;H=0;I=w;A=0;G=y;z=e(w/2+this.Ox);F=e(y/2+this.Oy);0<=d&&(H=z-d,I=z+d,A=F-d,G=F+d);a.beginPath();for(d=-f(z/b);(C=z+f(d*b))<w;d++)a.moveTo(C+.5,A+.5),a.lineTo(C+.5,G+.5);
for(d=-f(F/b);(D=F+f(d*b))<y;d++)a.moveTo(H+.5,D+.5),a.lineTo(I+.5,D+.5);a.stroke()};a.Space2D.prototype.drawNumbers=function(a,b,d){w=this.w;y=this.h;z=e(w/2+this.Ox);F=e(y/2+this.Oy);for(d=-f(z/b);(C=z+f(d*b))<w;d++)a.fillText(parseFloat((d*b/this.scale).toFixed(4)),C+1,F-2);for(d=-f(F/b);(D=F+f(d*b))<y;d++)0!==parseFloat(-d*b/this.scale)&&a.fillText(parseFloat((-d*b/this.scale).toFixed(4)),z+5,D+5)};a.Space2D.prototype.registerMouseAndTouchEvents=function(){function b(a){window.focus();if(h.evaluator.variables[h.id+
".DESCARTESJS_no_fixed"]||!h.fixed||h.sensitive_to_mouse_movements)h.click=0,h.evaluator.setVariable(h.mpressedString,0),h.evaluator.setVariable(h.mclickedString,1),h.evaluator.setVariable(h.mclicizquierdoString,1),window.removeEventListener("touchmove",l),window.removeEventListener("touchend",b),a.stopPropagation(),a.preventDefault(),h.parent.update()}function d(b){window.focus();b.stopPropagation();b.preventDefault();h.click=0;h.evaluator.setVariable(h.mpressedString,0);h.evaluator.setVariable(h.mclickedString,
1);h.evaluator.setVariable(h.mclicizquierdoString,1);"R"===h.whichButton&&(window.removeEventListener("mousemove",f),h.clickPosForZoom==h.clickPosForZoomNew&&a.showConfig&&(h.parent.externalSpace.show(),h.clickPosForZoom=!1,h.clickPosForZoomNew=!0));window.removeEventListener("mousemove",l);window.removeEventListener("mouseup",d);h.parent.deactivateGraphiControls();h.parent.update()}function g(a){h.posAnte=h.getCursorPosition(a);h.mouse_x=h.getRelativeX(h.posAnte.x);h.mouse_y=h.getRelativeY(h.posAnte.y);
h.evaluator.setVariable(h.mxString,h.mouse_x);h.evaluator.setVariable(h.myString,h.mouse_y);h.evaluator.setVariable(h.mclickedString,0);h.evaluator.setVariable(h.mclicizquierdoString,0);h.parent.update()}function f(a){a.preventDefault();h.clickPosForZoomNew=h.getCursorPosition(a).y;h.evaluator.setVariable(h.scaleString,h.tempScale+h.tempScale/45*((h.clickPosForZoom-h.clickPosForZoomNew)/10));h.parent.update()}function l(a){a.preventDefault();a.stopPropagation();h.fixed||(h.posNext=h.getCursorPosition(a),
c=e(h.posAnte.x-h.posNext.x),k=e(h.posAnte.y-h.posNext.y),h.evaluator.setVariable(h.OxString,h.Ox-c),h.evaluator.setVariable(h.OyString,h.Oy-k),h.posAnte.x-=c,h.posAnte.y-=k);g(a)}var h=this;h.clickPosForZoom=null;h.clickPosForZoomNew=null;h.canvas.oncontextmenu=function(a){return!1};this.sensitive_to_mouse_movements&&this.canvas.addEventListener("touchmove",g);this.canvas.addEventListener("touchstart",function(a){window.focus();if(h.evaluator.variables[h.id+".DESCARTESJS_no_fixed"]||!h.fixed||h.sensitive_to_mouse_movements)h.parent.clearClick(),
h.click=1,h.evaluator.setVariable(h.mpressedString,1),h.evaluator.setVariable(h.mclickedString,0),h.evaluator.setVariable(h.mclicizquierdoString,0),h.parent.deactivateGraphiControls(),g(a),window.addEventListener("touchmove",l),window.addEventListener("touchend",b),a.stopPropagation(),a.preventDefault()});this.sensitive_to_mouse_movements&&this.canvas.addEventListener("mousemove",g);this.canvas.addEventListener("mousedown",function(b){window.focus();b.stopPropagation();b.preventDefault();h.parent.clearClick();
h.click=1;h.parent.deactivateGraphiControls();h.whichButton=a.whichButton(b);"R"===h.whichButton?(window.addEventListener("mouseup",d),h.clickPosForZoom=h.getCursorPosition(b).y,h.clickPosForZoomNew=h.clickPosForZoom,h.fixed||(h.tempScale=h.scale,window.addEventListener("mousemove",f))):"L"===h.whichButton&&(h.evaluator.setVariable(h.mpressedString,1),h.evaluator.setVariable(h.mclickedString,0),h.evaluator.setVariable(h.mclicizquierdoString,0),g(b),window.addEventListener("mousemove",l),window.addEventListener("mouseup",
d))});document.addEventListener("visibilitychange",function(a){d(a)})};return a}(descartesJS||{}),descartesJS=function(a){var c,k,e;function f(a,b){return b.depth-a.depth}function b(b,d){na=a.subtract3D(b,a.scalarProduct3D(d,a.dotProduct3D(b,d)));ha=a.add3D(b,a.scalarProduct3D(na,-2));ia=a.norm3D(ha);return 0!==ia?a.scalarProduct3D(ha,1/ia):a.scalarProduct3D(b,-1)}if(a.loadLib)return a;var g=Math.floor,t=Math.round,d=Math.max,r=Math.cos,p=Math.sin,m=Math.sqrt,q=15*Math.PI/180,u=Math.cos(q),n=Math.sin(q),
h,v,l,w,y,C,D,z,F,H,I,A,G,B,K,E,x,L,J,M,N,O,S=[],T,Q,R,P,ba,V,na,ha,ia;a.Space3D=function(b,d){a.Space.call(this,b,d);l=this;l.backgroundCanvas=document.createElement("canvas");l.backgroundCanvas.setAttribute("id",l.id+"_background");l.backgroundCanvas.setAttribute("width",l.w+"px");l.backgroundCanvas.setAttribute("height",l.h+"px");l.canvas=document.createElement("canvas");l.canvas.setAttribute("id",l.id+"_canvas");l.canvas.setAttribute("width",l.w+"px");l.canvas.setAttribute("height",l.h+"px");
l.canvas.setAttribute("class","DescartesSpace3DCanvas");l.canvas.setAttribute("style","z-index: "+l.zIndex+";");l.ctx=l.canvas.getContext("2d");l.graphicControlContainer=document.createElement("div");l.graphicControlContainer.setAttribute("id",l.id+"_graphicControls");l.graphicControlContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: "+l.zIndex+";");l.numericalControlContainer=document.createElement("div");l.numericalControlContainer.setAttribute("id",l.id+"_numericalControls");
l.numericalControlContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: "+l.zIndex+";");l.container=document.createElement("div");l.container.setAttribute("id",l.id);l.container.setAttribute("class","DescartesSpace3DContainer");l.container.setAttribute("style","left: "+l.x+"px; top: "+l.y+"px; z-index: "+l.zIndex+";");l.container.appendChild(l.backgroundCanvas);l.container.appendChild(l.canvas);l.container.appendChild(l.graphicControlContainer);l.container.appendChild(l.numericalControlContainer);
b.container.insertBefore(l.container,b.loader);l.eye={x:0,y:0,z:0};l.lights=[{x:50,y:50,z:70},{x:50,y:-50,z:30},{x:20,y:0,z:-80},{x:0,y:0,z:0}];for(var c=0,e=l.lights.length;c<e;c++)l.lights[c]=a.normalize3D(l.lights[c]);l.light3={x:0,y:0,z:0};l.intensity=[.4,.5,.3,0];l.userIntensity=0;l.dim=1;l.tmpIntensity=[];l.OxStr=l.id+".Ox";l.OyStr=l.id+".Oy";l.scaleStr=l.id+".escala";l.wStr=l.id+"._w";l.hStr=l.id+"._h";l.obsStr=l.id+".observador";l.rotZStr=l.id+".rot.z";l.rotYStr=l.id+".rot.y";l.userI_Dim_Str=
l.id+".userIlum.dim";l.userI_I_Str=l.id+".userIlum.I";l.userI_x_Str=l.id+".userIlum.x";l.userI_y_Str=l.id+".userIlum.y";l.userI_z_Str=l.id+".userIlum.z";l.new3D_Str=l.id+"._3Dnew_";l.xO_Str=l.id+".xO";l.yO_Str=l.id+".yO";l.zO_Str=l.id+".zO";l.AO_Str=l.id+".AO";l.BO_Str=l.id+".BO";l.CO_Str=l.id+".CO";l.zoom_Str=l.id+".zoom";l.evaluator.setVariable(l.rotZStr,0);l.evaluator.setVariable(l.rotYStr,0);l.evaluator.setVariable(l.userI_Dim_Str,l.dim);l.evaluator.setVariable(l.userI_I_Str,l.userIntensity);
l.evaluator.setVariable(l.userI_x_Str,0);l.evaluator.setVariable(l.userI_y_Str,0);l.evaluator.setVariable(l.userI_z_Str,0);l.registerMouseAndTouchEvents()};a.extend(a.Space3D,a.Space);a.Space3D.prototype.init=function(a){l=this;l.uber.init.call(l);l.canvas&&(l.canvas.setAttribute("width",l.w+"px"),l.canvas.setAttribute("height",l.h+"px"));l.container&&l.findOffset();l.w_2=l.w/2;l.h_2=l.h/2;l.w_plus_h=l.w+l.h;l.oldMouse={x:0,y:0}};a.Space3D.prototype.update=function(a){l=this;h=l.evaluator;v=l.parent;
l.new3D=0<h.getVariable(l.new3D_Str);h.setVariable(l.wStr,l.w);h.setVariable(l.hStr,l.h);l.drawIfValue=0<h.evalExpression(l.drawif);if(l.drawIfValue){z=l.x!==h.evalExpression(l.xExpr)+l.displaceRegionWest;F=l.y!==h.evalExpression(l.yExpr)+v.plecaHeight+l.displaceRegionNorth;l.spaceChange=a||z||F||l.drawBefore!==l.drawIfValue||l.Ox!==h.getVariable(l.OxStr)||l.Oy!==h.getVariable(l.OyStr)||l.scale!==h.getVariable(l.scaleStr);l.x=z?h.evalExpression(l.xExpr)+l.displaceRegionWest:l.x;l.y=F?h.evalExpression(l.yExpr)+
v.plecaHeight+l.displaceRegionNorth:l.y;l.Ox=h.getVariable(l.OxStr);l.Oy=h.getVariable(l.OyStr);l.scale=h.getVariable(l.scaleStr);l.drawBefore=l.drawIfValue;if(a||void 0==l.observer){var b;a=0;for(var c=l.parent.controls.length;a<c;a++)l.parent.controls[a].id===l.obsStr&&(b=!0);l.observer=b?h.getVariable(l.obsStr)||2.5*l.w_plus_h:2.5*l.w_plus_h;l.observer=d(l.observer,.25*l.w_plus_h);h.setVariable(l.obsStr,l.observer)}l.new3D?(void 0==h.getVariable(l.xO_Str)&&h.setVariable(l.xO_Str,l.observer/l.scale*
u),void 0==h.getVariable(l.yO_Str)&&h.setVariable(l.yO_Str,0),void 0==h.getVariable(l.zO_Str)&&h.setVariable(l.zO_Str,l.observer/l.scale*n),void 0==h.getVariable(l.AO_Str)&&h.setVariable(l.AO_Str,0),void 0==h.getVariable(l.BO_Str)&&h.setVariable(l.BO_Str,345),void 0==h.getVariable(l.CO_Str)&&h.setVariable(l.CO_Str,0),l.xO=h.getVariable(l.xO_Str),l.yO=h.getVariable(l.yO_Str),l.zO=h.getVariable(l.zO_Str),l.AO=h.getVariable(l.AO_Str),l.BO=h.getVariable(l.BO_Str),l.CO=h.getVariable(l.CO_Str),l.zoom=h.getVariable(l.zoom_Str),
l.eye={x:parseFloat(h.getVariable(l.xO_Str)),y:parseFloat(h.getVariable(l.yO_Str)),z:parseFloat(h.getVariable(l.zO_Str))}):(l.eye={x:l.observer/l.scale*u,y:0,z:l.observer/l.scale*n},l.D=l.scale*l.eye.x/u,l.XE=t(l.scale*l.eye.y+.5),l.YE=t(l.scale*l.eye.z+.5),l.observer=d(h.getVariable(l.obsStr),.25*l.w_plus_h),l.observer!=h.getVariable(l.obsStr)&&(h.setVariable(l.obsStr,l.observer),l.parent.updateControls()));1E-6>l.scale?(l.scale=1E-6,h.setVariable(l.scaleStr,1E-6)):1E6<l.scale&&(l.scale=1E6,h.setVariable(l.scaleStr,
1E6));if(z||F)l.container.style.left=l.x+"px",l.container.style.top=l.y+"px",l.findOffset();l.container.style.display="block";l.dim=h.getVariable(l.userI_Dim_Str);l.userIntensity=h.getVariable(l.userI_I_Str);l.light3={x:parseInt(h.getVariable(l.userI_x_Str)),y:parseInt(h.getVariable(l.userI_y_Str)),z:parseInt(h.getVariable(l.userI_z_Str))};l.updateCamera();l.draw()}else l.container.style.display="none"};a.Space3D.prototype.draw=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);
this.ctx.fillStyle=this.background.getColor();this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);this.image&&""!=this.image.src&&this.image.ready&&this.image.complete&&("topleft"===this.bg_display?this.ctx.drawImage(this.image,0,0):"stretch"===this.bg_display?this.ctx.drawImage(this.image,0,0,this.w,this.h):"patch"===this.bg_display?(this.ctx.fillStyle=ctx.createPattern(this.image,"repeat"),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)):"center"===this.bg_display&&this.ctx.drawImage(this.image,
(this.w-this.image.width)/2,(this.h-this.image.height)/2));for(var a=0,b=this.graphics.length;a<b;a++)this.graphics[a].update();this.primitives=[];a=0;for(b=this.graphics.length;a<b;a++){w=this.graphics[a];if(w.split||this.split)for(var d=a+1;d<b;d++)y=this.graphics[d],(y.split||this.split)&&w.splitFace(y);this.primitives=this.primitives.concat(w.primitives||[])}C=this.primitives;D=C.length;for(a=0;a<D;a++)C[a].computeDepth(this);if("painter"===this.render)this.drawPainter(C);else for(C=C.sort(f),
a=0;a<D;a++)C[a].passDraw&&C[a].draw(this.ctx,this);a=0;for(b=this.graphicsCtr.length;a<b;a++)this.graphicsCtr[a].draw()};var U;a.renderNode=function(a){this.value=a;this.front=this.back=null};a.renderNode.prototype.inOrder=function(){var a=[];this.back&&(a=a.concat(this.back.inOrder()));a.push(this.value);this.front&&(a=a.concat(this.front.inOrder()));return a};a.Space3D.prototype.buildTree=function(b){if(0===b.length)return null;var d,c=[],e=[];U=b.shift();for(var g=0,f=b.length;g<f;g++){d=null;
for(var h=0,l=b[g].spaceVertices.length;h<l;h++)whereIs=2<U.spaceVertices.length?this.inPlane2(U.spaceVertices[0],U.normal,b[g].spaceVertices[h]):0,whereIs=0<U.direction?-whereIs:whereIs,null===d?0>whereIs?d="front":0<whereIs&&(d="back"):0>whereIs?"back"===d&&(d="cross"):0<whereIs&&"front"===d&&(d="cross");if("back"===d)c.push(b[g]);else if("front"===d)e.push(b[g]);else if(null==d)c.push(b[g]);else{d=null;h=0;for(l=U.spaceVertices.length;h<l;h++)whereIs=2<b[g].spaceVertices.length?this.inPlane2(b[g].spaceVertices[0],
b[g].normal,U.spaceVertices[h]):-1,whereIs=0<b[g].direction?-whereIs:whereIs,null===d?0>whereIs?d="front":0<whereIs&&(d="back"):0>whereIs?"back"===d&&(d="cross"):0<whereIs&&"front"===d&&(d="cross");"front"===d?c.push(b[g]):e.push(b[g])}}b=new a.renderNode(U);b.back=this.buildTree(c);b.front=this.buildTree(e);return b};a.Space3D.prototype.drawPainter=function(a){if(a=this.buildTree(a)){a=a.inOrder();for(var b=0;b<a.length;b++)a[b].passDraw&&a[b].draw(this.ctx,this)}};a.Space3D.prototype.inPlane=function(a,
b,d,c){return parseFloat(((c.x-a.x)*(b.y-a.y)*(d.z-a.z)+(c.y-a.y)*(b.z-a.z)*(d.x-a.x)+(c.z-a.z)*(b.x-a.x)*(d.y-a.y)-(c.z-a.z)*(b.y-a.y)*(d.x-a.x)-(c.y-a.y)*(b.x-a.x)*(d.z-a.z)-(c.x-a.x)*(b.z-a.z)*(d.y-a.y)).toFixed(8))};a.Space3D.prototype.inPlane2=function(a,b,d){return parseFloat((b.x*(d.x-a.x)+b.y*(d.y-a.y)+b.z*(d.z-a.z)).originalToFixed(8))};a.Space3D.prototype.updateCamera=function(){l=this;l.new3D?(l.D=l.scale*l.eye.x/u,l.XE=t(l.scale*l.eye.y+.5),l.YE=t(l.scale*l.eye.z+.5)):(l.D=l.observer,
l.eye.x=l.D/l.scale,l.eye.y=l.XE/l.scale,l.eye.z=l.YE/l.scale)};a.Space3D.prototype.rotateVertex=function(b){E=a.degToRad(l.evaluator.getVariable(l.rotZStr));x=r(E);L=p(E);c=b.x*x-b.y*L;k=b.x*L+b.y*x;e=b.z;E=a.degToRad(l.evaluator.getVariable(l.rotYStr));x=r(E);L=p(E);return{x:e*L+c*x,y:k,z:e*x-c*L}};var oa,ja,W,X,pa,ka,ca,Y,qa,la,Z,aa,ra,sa,ta,ua,va,wa,xa,ya,za,da,ea,fa,ga,Aa,Ba,ma;a.Space3D.prototype.project=function(a){l=this;if(l.new3D){A=l.eye.x-a.x;G=l.eye.y-a.y;B=l.eye.z-a.z;var b=m(A*A+G*
G+B*B);K=-a.x/b||0;oa=l.AO%360;ja=oa*Math.PI/180;W=Math.cos(ja);X=Math.sin(ja);pa=l.BO%360;ka=pa*Math.PI/180;ca=Math.cos(ka);Y=Math.sin(ka);qa=l.CO%360;la=qa*Math.PI/180;Z=Math.cos(la);aa=Math.sin(la);ra=ca*W;sa=-Z*ca*X-aa*Y;ta=-aa*ca*X+Z*Y;ua=X;va=Z*W;wa=aa*W;xa=-Y*W;ya=Z*Y*X-aa*W;za=aa*Y*X+Z*W;da=-l.eye.x+a.x;ea=-l.eye.y+a.y;fa=-l.eye.z+a.z;ga=ra*da+ua*ea+xa*fa;Aa=sa*da+va*ea+ya*fa;Ba=ta*da+wa*ea+za*fa;ma=parseFloat(l.evaluator.getVariable(l.zoom_Str));return{x:this.getAbsoluteX(-ma*Aa/ga),y:this.getAbsoluteY(-ma*
Ba/ga),z:0<ga?-b:b}}A=l.eye.x-a.x;G=l.eye.y-a.y;B=l.eye.z-a.z;b=m(A*A+G*G+B*B);K=-a.x/b||0;A=this.w_2+this.Ox+l.scale*(a.y+K*(l.eye.y-a.y));G=this.h_2+this.Oy-l.scale*(a.z+K*(l.eye.z-a.z));return{x:A,y:G,z:b}};a.Space3D.prototype.computeColor=function(d,c,e){d.match("rgba")?d=a.RGBAToHexColor(d):d.match("#")&&(d=new a.Color(d.substring(1)));P=a.subtract3D(this.eye,c.average);ba=a.norm3D(P);V=a.scalarProduct3D(P,1/ba);this.lights[3]=a.subtract3D(this.light3,c.average);O=a.norm3D(this.lights[3]);for(var f=
0,h=this.intensity.length-1;f<h;f++)S[f]=this.intensity[f]*this.dim;S[3]=this.userIntensity*this.userIntensity/O||0;T=e?this.dim/2:this.dim/4;Q=0;R=0<=c.direction?c.normal:a.scalarProduct3D(c.normal,-1);f=0;for(h=this.lights.length;f<h;f++)e?(Q=Math.max(0,a.dotProduct3D(b(this.lights[f],R),V)),Q*=Q*Q):Q=Math.max(0,a.dotProduct3D(this.lights[f],R)),T+=S[f]*Q;T=Math.min(T,1);J=g(d.r*T);M=g(d.g*T);N=g(d.b*T);return"rgba("+J+","+M+","+N+","+d.a+")"};a.Space3D.prototype.registerMouseAndTouchEvents=function(){function b(a){document.body.focus();
f.click=0;f.evaluator.setVariable(f.id+".mouse_pressed",0);window.removeEventListener("touchmove",g,!1);window.removeEventListener("touchend",b,!1);a.preventDefault()}function d(b){document.body.focus();f.click=0;f.evaluator.setVariable(f.id+".mouse_pressed",0);b.preventDefault();"R"===f.whichButton&&(window.removeEventListener("mousemove",e,!1),f.clickPosForZoom==f.clickPosForZoomNew&&a.showConfig&&f.parent.externalSpace.show());window.removeEventListener("mousemove",g,!1);window.removeEventListener("mouseup",
d,!1)}function c(a){f.posAnte=f.getCursorPosition(a);f.mouse_x=f.getRelativeX(f.posAnte.x);f.mouse_y=f.getRelativeY(f.posAnte.y);f.evaluator.setVariable(f.id+".mouse_x",f.mouse_x);f.evaluator.setVariable(f.id+".mouse_y",f.mouse_y);70<Date.now()-h&&(f.parent.update(),h=Date.now())}function e(a){a.preventDefault();f.clickPosForZoomNew=f.getCursorPosition(a).y;f.evaluator.setVariable(f.scaleStr,f.tempScale+f.tempScale/45*((f.clickPosForZoom-f.clickPosForZoomNew)/10));f.clickPosForObserverNew=f.getCursorPosition(a).x;
f.evaluator.setVariable(f.obsStr,f.tempObserver-2.5*(f.clickPosForObserver-f.clickPosForObserverNew));f.parent.update()}function g(b){if(!f.fixed&&f.click){H=parseInt(50*(f.oldMouse.x-f.mouse_x));I=parseInt(50*(f.oldMouse.y-f.mouse_y));if(H!==f.disp.x||I!==f.disp.y)f.alpha=a.degToRad(f.evaluator.getVariable(f.rotZStr)),f.beta=a.degToRad(-f.evaluator.getVariable(f.rotYStr)),f.alpha=t(a.radToDeg(f.alpha)-H),f.beta=t(a.radToDeg(f.beta)-I),f.evaluator.setVariable(f.rotZStr,f.alpha),f.evaluator.setVariable(f.rotYStr,
-f.beta),f.disp.x=H,f.disp.y=I,f.oldMouse.x=f.getRelativeX(f.posAnte.x),f.oldMouse.y=f.getRelativeY(f.posAnte.y);c(b);b.preventDefault()}}var f=this,h=0;this.canvas.oncontextmenu=function(){return!1};this.canvas.addEventListener("touchstart",function(a){document.body.focus();f.click=1;f.evaluator.setVariable(f.id+".mouse_pressed",1);f.parent.deactivateGraphiControls();f.posAnte=f.getCursorPosition(a);f.oldMouse.x=f.getRelativeX(f.posAnte.x);f.oldMouse.y=f.getRelativeY(f.posAnte.y);c(a);window.addEventListener("touchmove",
g);window.addEventListener("touchend",b);a.preventDefault()});this.canvas.addEventListener("mousedown",function(b){document.body.focus();f.click=1;f.parent.deactivateGraphiControls();f.whichButton=a.whichButton(b);"R"===f.whichButton?(window.addEventListener("mouseup",d),f.clickPosForObserver=f.getCursorPosition(b).x,f.clickPosForObserverNew=f.clickPosForObserver,f.clickPosForZoom=f.getCursorPosition(b).y,f.clickPosForZoomNew=f.clickPosForZoom,f.fixed||(f.tempScale=f.scale,f.tempObserver=f.observer,
window.addEventListener("mousemove",e))):"L"==f.whichButton&&(f.evaluator.setVariable(f.id+".mouse_pressed",1),f.posAnte=f.getCursorPosition(b),f.oldMouse.x=f.getRelativeX(f.posAnte.x),f.oldMouse.y=f.getRelativeY(f.posAnte.y),c(b),window.addEventListener("mousemove",g),window.addEventListener("mouseup",d));b.preventDefault()});this.disp={x:0,y:0}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c;a.SpaceAP=function(k,e){a.Space.call(this,k,e);this.exportarVars=this.importarVars=
null;c=k.evaluator;this.file.match(/^\[/)&&this.file.match(/\]$/)?this.file=c.parser.parse(this.file.substring(1,this.file.length-1)):this.file.match(/^\'/)&&this.file.match(/\'$/)?this.file=c.parser.parse(this.file):this.file=c.parser.parse("'"+this.file+"'");this.oldFile=c.evalExpression(this.file);this.initFile()};a.extend(a.SpaceAP,a.Space);a.SpaceAP.prototype.initFile=function(){this.firstUpdate=!0;var c;if(this.oldFile){var e=document.getElementById(this.oldFile);c=e&&"descartes/spaceApFile"==
e.type?e.text:a.openExternalFile(this.oldFile);null!=c&&(c=c.split("\n"))}if(c&&c.toString().match(/<applet/gi)){for(var e="",f=!1,b=0,g=c.length;b<g&&(c[b].match("<applet")&&(f=!0),f&&(e+=c[b]),!c[b].match("</applet"));b++);b=document.createElement("div");b.innerHTML=e;b.firstChild.setAttribute("width",this.w);b.firstChild.setAttribute("height",this.h);e=this.descApp?this.descApp.container:null;this.descApp=new a.DescartesApp(b.firstChild);this.descApp.container.setAttribute("class","DescartesAppContainer");
this.descApp.container.setAttribute("style","position: absolute; overflow: hidden; background-color: "+this.background+"; width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+";");e?this.parent.container.replaceChild(this.descApp.container,e):this.parent.container.insertBefore(this.descApp.container,this.parent.loader);e=this.descApp.spaces;b=0;for(g=e.length;b<g;b++)e[b].findOffset();this.descApp.container.style.display=0<this.evaluator.evalExpression(this.drawif)?
"block":"none";var t=this;this.descApp.update=function(){this.updateAuxiliaries();this.updateEvents();this.updateControls();this.updateSpaces();t.exportar()}}else e=this.descApp?this.descApp.container:null,this.descApp={},this.descApp.container=document.createElement("div"),this.descApp.container.setAttribute("class","DescartesAppContainer"),b="position: absolute; overflow: hidden; background-color: "+this.background+"; width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+
"px; z-index: "+this.zIndex+";",this.image&&("topleft"==this.bg_display?b+="background-image: url("+this.imageSrc+"); background-repeat:no-repeat;":"stretch"==this.bg_display?b+="background-image: url("+this.imageSrc+"); background-repeat:no-repeat; background-size: 100% 100%;":"patch"==this.bg_display?b+="background-image: url("+this.imageSrc+");":"imgcenter"==this.bg_display&&(b+="background-image: url("+this.imageSrc+"); background-repeat:no-repeat; background-position: center center;")),this.descApp.container.setAttribute("style",
b),e?this.parent.container.replaceChild(this.descApp.container,e):this.parent.container.insertBefore(this.descApp.container,this.parent.loader),this.descApp.container.style.display=0<this.evaluator.evalExpression(this.drawif)?"block":"none"};a.SpaceAP.prototype.update=function(){var a=this.evaluator.evalExpression(this.file);if(this.oldFile!=a)this.oldFile=a,this.initFile();else{var a=this.x!=this.evaluator.evalExpression(this.xExpr),c=this.y!=this.evaluator.evalExpression(this.yExpr)+this.plecaHeight;
this.x=a?this.evaluator.evalExpression(this.xExpr):this.x;this.y=c?this.evaluator.evalExpression(this.yExpr)+this.plecaHeight:this.y;a&&(this.descApp.container.style.left=this.x+"px");c&&(this.descApp.container.style.top=this.y+"px");if(a||c)for(var a=this.descApp.spaces,c=0,f=a.length;c<f;c++)a[c].findOffset();this.descApp.container.style.display=0<this.evaluator.evalExpression(this.drawif)?"block":"none";if(this.firstUpdate&&(this.firstUpdate=!1,null==this.importarVars)){this.importarVars=[];for(var b in this.evaluator.variables)this.evaluator.variables.hasOwnProperty(b)&&
b.match(/^public./)&&this.importarVars.push({varName:b,value:this.evaluator.getVariable(b)})}this.importar()}};a.SpaceAP.prototype.importar=function(){for(var a,c=!1,f=0,b=this.importarVars.length;f<b;f++)a=this.evaluator.getVariable(this.importarVars[f].varName),a!=this.importarVars[f].value&&(this.importarVars[f].value=a,this.descApp.evaluator.setVariable(this.importarVars[f].varName,this.importarVars[f].value),c=!0);c&&this.descApp.update()};a.SpaceAP.prototype.exportar=function(){};return a}(descartesJS||
{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e,f,b;a.SpaceHTML_IFrame=function(b,c){a.Space.call(this,b,c);var d=this.parent.evaluator;if(void 0!=this._w_){var e=d.parser.parse(this._w_);this._w_="number"!=e.type?e:void 0}void 0!=this._h_&&(e=d.parser.parse(this._h_),this._h_="number"!=e.type?e:void 0);this.isFirefox=window.navigator.userAgent.toLowerCase().match(/firefox/);this.file=this.file?this.file.trim():"";this.file.match(/^\[/)&&this.file.match(/\]$/)?this.file=d.parser.parse(this.file.substring(1,
this.file.length-1)):this.file.match(/^\'/)&&this.file.match(/\'$/)?this.file=d.parser.parse(this.file):this.file=d.parser.parse("'"+this.file+"'");this.oldFile=d.evalExpression(this.file);this.MyIFrame=document.createElement("iframe");0!=this.oldFile&&this.MyIFrame.setAttribute("src",this.oldFile);this.MyIFrame.setAttribute("marginheight",0);this.MyIFrame.setAttribute("marginwidth",0);this.MyIFrame.setAttribute("frameborder",0);this.MyIFrame.setAttribute("scrolling","auto");this.MyIFrame.setAttribute("style",
"position: static; left: 0px; top: 0px;");this.container=document.createElement("div");this.container.setAttribute("id",this.id);this.container.setAttribute("style",(a.isIOS?"overflow: scroll; -webkit-overflow-scrolling: touch; overflow-scrolling: touch; ":"")+"position: absolute; width: "+this.w+"px; height: "+this.h+"px; left: "+this.x+"px; top: "+this.y+"px; z-index: "+this.zIndex+"; background-repeat: no-repeat; background-position: center; ");this.container.appendChild(this.MyIFrame);this.imageSrc&&
(this.container.style.backgroundImage="url("+this.imageSrc+")");this.parent.container.insertBefore(this.container,this.parent.loader);var f=this;this.MyIFrame.onload=function(a){var b=this;f.evaluator.setFunction(f.id+".set",function(a,d){b.contentWindow.postMessage({type:"set",name:a,value:d},"*");return 0});f.evaluator.setFunction(f.id+".update",function(){b.contentWindow.postMessage({type:"update"},"*");return 0});f.evaluator.setFunction(f.id+".exec",function(a,d){b.contentWindow.postMessage({type:"exec",
name:a,value:d},"*");return 0});f.ImReady=!f.isFirefox;f.isFirefox||(f.container.style.visibility="visible",f.container.style.opacity="1",f.container.style.zIndex=f.zIndex,f.container.style.display=f.drawIfValue?"block":"none");f.MyIFrame.style.visibility="visible";f.container.style.backgroundImage=""};this.update=this.iframeUpdate;this.evaluator.setVariable(this.id+"._scroll",0)};a.extend(a.SpaceHTML_IFrame,a.Space);a.SpaceHTML_IFrame.prototype.init=function(){b=this;b.uber.init.call(b);b.MyIFrame&&
(b.MyIFrame.style.width=b.w+"px",b.MyIFrame.style.height=b.h+"px",b.MyIFrame.style.left=b.x+"px",b.MyIFrame.style.top=b.y+"px")};a.SpaceHTML_IFrame.prototype.iframeUpdate=function(a){c=this.evaluator;this.drawIfValue=0<c.evalExpression(this.drawif);this.ImReady?this.container.style.display=this.drawIfValue?"block":"none":(this.container.style.visibility=this.drawIfValue?"visible":"hidden",this.container.style.opacity=this.drawIfValue?"1":"0",this.container.style.zIndex=this.drawIfValue?this.zIndex:
-1E3);this.drawIfValue?this.MyIFrame.contentWindow.focus():this.MyIFrame.contentWindow.blur();if(this.drawIfValue){a&&(this.y=this.x=Infinity);k=this.x!==c.evalExpression(this.xExpr)+this.displaceRegionWest;e=this.y!==c.evalExpression(this.yExpr)+this.parent.plecaHeight+this.displaceRegionNorth;this.x=k?c.evalExpression(this.xExpr)+this.displaceRegionWest:this.x;this.y=e?c.evalExpression(this.yExpr)+this.parent.plecaHeight+this.displaceRegionNorth:this.y;void 0!=this._w_&&(a=c.evalExpression(this._w_),
this.w!==a&&(this.container.style.width=a+"px",this.MyIFrame.style.width=a+"px",this.w=a));void 0!=this._h_&&(a=c.evalExpression(this._h_),this.h!==a&&(this.container.style.height=a+"px",this.MyIFrame.style.height=a+"px",this.h=a));if(k||e)this.container.style.left=this.x+"px",this.container.style.top=this.y+"px";f=c.evalExpression(this.file);f!==this.oldFile&&(this.ImReady=!1,this.isFirefox||(this.container.style.display="block",this.container.style.visibility=this.drawIfValue?"visible":"hidden",
this.container.style.opacity=this.drawIfValue?"1":"0",this.container.style.zIndex=this.drawIfValue?this.zIndex:-1E3),this.imageSrc&&(this.container.style.backgroundImage="url("+this.imageSrc+")"),this.MyIFrame.style.visibility="hidden",this.oldFile=f,this.MyIFrame.contentWindow.location.replace(f));this.scrollVar=c.getVariable(this.id+"._scroll");1==this.scrollVar?(this.MyIFrame.setAttribute("scrolling","yes"),this.MyIFrame.style.overflow=""):-1==this.scrollVar?(this.MyIFrame.setAttribute("scrolling",
"no"),this.MyIFrame.style.overflow="hidden"):(this.MyIFrame.setAttribute("scrolling","auto"),this.MyIFrame.style.overflow="")}};return a}(descartesJS||{}),descartesJS=function(a){if(a.loadLib)return a;var c,k,e;a.DescartesLoader=function(a){this.children=a.children;this.lessonParser=a.lessonParser;this.images=a.images;this.images.length=a.images.length;this.audios=a.audios;this.audios.length=a.audios.length;this.arquimedes=a.arquimedes;this.descartesApp=a;var c=a.image_loader?a.image_loader:f(a.loader.width,
a.loader.height);this.imageLoader=document.createElement("div");this.imageLoader.width=a.width;this.imageLoader.height=a.height;this.imageLoader.setAttribute("class","DescartesLoaderImage");this.imageLoader.setAttribute("style","background-image: url("+c+"); background-size:cover; width: "+a.width+"px; height: "+a.height+"px;");a.loader.appendChild(this.imageLoader);this.loaderBar=document.createElement("canvas");this.loaderBar.width=a.width;this.loaderBar.height=a.height;this.loaderBar.setAttribute("class",
"DescartesLoaderBar");this.loaderBar.setAttribute("style","width: "+a.width+"px; height:"+a.height+"px;");this.loaderBar.ctx=this.loaderBar.getContext("2d");a.loader.appendChild(this.loaderBar);this.barWidth=80;this.barHeight=Math.floor(a.loader.height/70);var e=this;this.timer=setInterval(function(){e.drawLoaderBar(e.loaderBar.ctx,a.width,a.height)},10);a.firstRun=!1;this.initPreloader()};a.DescartesLoader.prototype.initPreloader=function(){var b=this.children,c=this.images,e=this.audios,d=/[\w\.\-//]*(\.png|\.jpg|\.gif|\.svg)/gi,
f=/[\w\.\-//]*(\.ogg|\.oga|\.mp3|\.wav)/gi;this.arquimedes&&(c["lib/DescartesCCLicense.png"]=a.getCreativeCommonsLicenseImage(),c["lib/DescartesCCLicense.png"].addEventListener("load",function(){this.ready=1}),c["lib/DescartesCCLicense.png"].addEventListener("error",function(){this.errorload=1}));var k,m,q,u,n,h;q=0;for(n=b.length;q<n;q++)if("rtf"!==b[q].name){if(b[q].value.match(/'macro'|'makro'/g)){u="";var v;k=this.lessonParser.split(b[q].value);m=0;for(h=k.length;m<h;m++)"expresion"===babel[k[m][0]]&&
(u=k[m][1]);u&&((v=document.getElementById(u))&&"descartes/macro"==v.type?v=v.text:(v=a.openExternalFile(u))&&!v.match(/tipo_de_macro/g)&&(v=null));if(v&&(k=v.match(d)))for(u=0,h=k.length;u<h;u++)m=k[u],m.toLowerCase().match(/vacio.gif$/)||""==m.substring(0,m.length-4)||(c[m]=new Image,c[m].addEventListener("load",function(){this.ready=1}),c[m].addEventListener("error",function(){this.errorload=1}),c[m].src=m)}if(k=b[q].value.match(d))for(u=0,h=k.length;u<h;u++)m=k[u],m.toLowerCase().match(/vacio.gif$/)||
""==m.substring(0,m.length-4)||(c[m]=new Image,c[m].addEventListener("load",function(){this.ready=1}),c[m].addEventListener("error",function(){this.errorload=1}),c[m].src=m);if(k=b[q].value.match(f))for(u=0,m=k.length;u<m;u++)this.initAudio(k[u])}for(var l in c)c.hasOwnProperty(l)&&this.images.length++;for(l in e)e.hasOwnProperty(l)&&this.audios.length++;var w=this,y=this.images.length+this.audios.length;this.sep=2*(this.barWidth-2)/y;var C=function(){w.readys=0;for(var a in c)c.hasOwnProperty(a)&&
(c[a].ready||c[a].errorload)&&w.readys++;for(a in w.audios)e.hasOwnProperty(a)&&(e[a].ready||e[a].errorload)&&w.readys++;w.readys!=y?setTimeout(C,30):(clearTimeout(w.timer),w.descartesApp.initBuildApp())};C()};a.DescartesLoader.prototype.initAudio=function(b){var c=this.audios;c[b]=new Audio(b);c[b].filename=b;var e=function(){this.ready=1},d=function(){this.canPlayType("audio/"+this.filename.substring(this.filename.length-3))||"mp3"!=this.filename.substring(this.filename.length-3)?(console.log("El archivo '"+
b+"' no puede ser reproducido"),this.errorload=1):(c[b]=new Audio(this.filename.replace("mp3","ogg")),c[b].filename=this.filename.replace("mp3","ogg"),c[b].addEventListener("canplaythrough",e),c[b].addEventListener("load",e),c[b].addEventListener("error",d),c[b].load())};c[b].addEventListener("canplaythrough",e);c[b].addEventListener("load",e);c[b].addEventListener("error",d);a.hasTouchSupport?(c[b].load(),c[b].play(),setTimeout(function(){c[b].pause()},20),c[b].ready=1):c[b].load()};a.DescartesLoader.prototype.drawLoaderBar=
function(a,f,t){k=this.barWidth;e=this.barHeight;a.translate(f/2,(t-65*c)/2+90*c);a.scale(c,c);a.strokeRect(-k,-e,2*k,e);a.fillStyle="#888";a.fillRect(-k+2,-e+2,2*(k-2),e-4);a.fillStyle="#1f358d";a.fillRect(-k+2,-e+2,this.readys*this.sep,e-4);a.setTransform(1,0,0,1,0,0)};var f=function(b,e){var f=document.createElement("canvas"),d=5E6<b*a._ratio*e*a._ratio?1:a._ratio;f.width=b*d;f.height=e*d;f.style.width=b+"px";f.style.height=e+"px";var k=f.getContext("2d");k.save();k.setTransform(d,0,0,d,0,0);k.strokeStyle=
k.fillStyle="#1f358d";k.lineCap="round";k.lineWidth=2;k.beginPath();c=b<e?b/360:e/195;c=2.5<c?2.5:c;k.translate((b-120*c)/2,(e-65*c)/2);k.scale(c,c);k.moveTo(3,25);k.lineTo(3,1);k.lineTo(21,1);k.bezierCurveTo(33,1,41,15,41,25);k.stroke();k.beginPath();k.moveTo(1,63);k.lineTo(1,64);k.moveTo(5,62);k.lineTo(5,64);k.moveTo(9,61);k.lineTo(9,64);k.moveTo(13,60);k.lineTo(13,64);k.moveTo(17,58);k.lineTo(17,64);k.moveTo(21,56);k.lineTo(21,64);k.moveTo(25,53);k.lineTo(25,64);k.moveTo(29,50);k.lineTo(29,64);
k.moveTo(33,46);k.lineTo(33,64);k.moveTo(37,41);k.lineTo(37,64);k.moveTo(41,32);k.lineTo(41,64);k.stroke();k.font="20px descartesJS_sansserif, Arial, Helvetica, Sans-serif";k.fillText("escartes",45,33);k.fillText("JS",98,64);k.restore();return f.toDataURL()};return a}(descartesJS||{}),descartesJS=function(a){function c(a,b){for(var c=0,e=this[a].length;c<e;c++)this[a][c].update(b)}function k(a){for(var b="[",c=0,t=a.length;c<t;c++)a[c]instanceof Array?b+=k(a[c]):(e=a[c],"undefined"!=typeof e&&e||
(e=0),"string"==typeof e&&(e="'"+e+"'"),b+=e),c<t-1&&(b+=",");return b+"]"}if(a.loadLib)return a;a.DescartesApp=function(c){this.animation={playing:!1,stop:function(){}};this.applet=c;this.parentContainer=c.parentNode;this.width=parseFloat(c.getAttribute("width"));this.height=parseFloat(c.getAttribute("height"));this.decimal_symbol=".";this.decimal_symbol_regexp=new RegExp("\\"+this.decimal_symbol,"g");this.language="espa\u00f1ol";this.children=c.querySelectorAll("param");a.creativeCommonsLicense=
!0;for(var b=0,e=this.children.length;b<e;b++)"CreativeCommonsLicense"===this.children[b].name&&(a.creativeCommonsLicense="no"===this.children[b].value?!1:!0);this.code=c.getAttribute("code");this.saveState=[];this.images={};this.images.length=-1;this.audios={};this.audios.length=-1;this.firstRun=!0;this.init()};a.DescartesApp.prototype.init=function(){this.stop();this.evaluator=new a.Evaluator(this);this.lessonParser=new a.LessonParser(this);this.arquimedes=/DescartesWeb2_0|Arquimedes|Discurso/i.test(this.code);
this.licenseA=a.creativeCommonsLicense?"{\\rtf1\\uc0{\\fonttbl\\f0\\fcharset0 Arial;\\f1\\fcharset0 Arial;\\f2\\fcharset0 Arial;\\f3\\fcharset0 Arial;\\f4\\fcharset0 Arial;}{\\f0\\fs34 __________________________________________________________________________________\\par \\fs22                                        Los contenidos de esta unidad did\u00e1ctica interactiva est\u00e1n bajo una {\\*\\hyperlink licencia Creative Commons|http://creativecommons.org/licenses/by-nc-sa/4.0/}, si no se indica lo contrario.\\par                                        La unidad did\u00e1ctica fue creada con Arqu\u00edmedes, que es un producto de c\u00f3digo abierto, {\\*\\hyperlink Creditos|http://arquimedes.matem.unam.mx/Descartes5/creditos/conCCL.html}\\par }":
"";for(var c=this.children,b,e=0,k=0,d=a.creativeCommonsLicense?90:0,r=0,p=c.length;r<p;r++)b=c[r],"rtf_height"==b.name&&(e=parseInt(b.value)||this.height),"Buttons"==babel[b.name]&&(this.buttonsConfig=this.lessonParser.parseButtonsConfig(b.value),k=this.buttonsConfig.height),"image_loader"==b.name&&(this.image_loader=b.value),"expand"==b.name&&(this.expand=b.value),"docBase"==b.name&&(this.docBase=b.value,b=document.createElement("base"),b.setAttribute("id","descartesJS_base"),b.setAttribute("href",
this.docBase),document.head.appendChild(b));this.expand&&"cover"==this.expand&&(this.width=window.innerWidth,this.height=window.innerHeight);this.arquimedes&&e&&(this.height=e+k+d);this.spaces=[];this.externalSpace&&document.body.removeChild(this.externalSpace.container);this.externalSpace=new a.SpaceExternal(this);this.northSpace={container:document.createElement("div"),controls:[]};this.southSpace={container:document.createElement("div"),controls:[]};this.eastSpace={container:document.createElement("div"),
controls:[]};this.westSpace={container:document.createElement("div"),controls:[]};this.editableRegion={container:document.createElement("div"),textFields:[]};a.Editor&&(this.editor=new a.Editor(this));this.controls=[];this.auxiliaries=[];this.events=[];this.cacheVars={};this.getVarsNames={};this.numIframes=this.plecaHeight=this.tabindex=this.zIndex=0;void 0!=this.container&&this.parentContainer.removeChild(this.container);this.container=document.createElement("div");this.loader=document.createElement("div");
this.parentContainer.appendChild(this.container);this.container.width=this.width;this.container.height=this.height;this.container.setAttribute("class","DescartesAppContainer");this.container.setAttribute("style","width:"+this.width+"px; height:"+this.height+"px;");this.container.appendChild(this.loader);this.loader.width=this.width;this.loader.height=this.height;this.loader.setAttribute("class","DescartesLoader");this.loader.setAttribute("style","width:"+this.width+"px; height:"+this.height+"px; z-index:1000;");
this.image_loader&&(this.loader.style.backgroundColor="rgba(0,0,0,0)");this.firstRun?this.descartesLoader=new a.DescartesLoader(this):this.initBuildApp()};a.DescartesApp.prototype.initBuildApp=function(){a.showConfig=!0;for(var c=this.children,b=this.lessonParser,e=[],k=[],d=[],r=[],p=[],m=[],q,u=0,n=c.length;u<n;u++)if(q=c[u],"editable"==babel[q.name]&&(a.showConfig="false"==babel[q.value]?!1:!0),"language"==babel[q.name]&&(this.language=q.value),"pleca"==q.name)q=b.parsePleca(q.value,this.width),
this.container.insertBefore(q,this.loader),this.plecaHeight=q.imageHeight?q.imageHeight:q.offsetHeight;else if("Buttons"==babel[q.name])this.buttonsConfig=b.parseButtonsConfig(q.value);else if("decimal_symbol"==babel[q.name])this.decimal_symbol=q.value,this.decimal_symbol_regexp=new RegExp("\\"+this.decimal_symbol,"g");else if("version"==babel[q.name])this.version=parseInt(q.value);else if("language"==babel[q.name])this.language=q.value;else if("rtf"==q.name){var h=(this.width-780)/2,v=parseInt(this.height)-
this.plecaHeight-this.buttonsConfig.height-45;r.push("space='descartesJS_scenario' type='text' expresion='[10,20]' background='yes' text='"+q.value.replace(/'/g,"&squot;")+"'");r.push("space='descartesJS_scenario' type='text' expresion='["+h+","+(v-25)+"]' background='yes' text='"+this.licenseA+"'");a.creativeCommonsLicense&&r.push("space='descartesJS_scenario' type='image' expresion='["+(h+15)+","+v+"]' background='yes' abs_coord='yes' file='lib/DescartesCCLicense.png'")}else"E"==q.name.charAt(0)?
(/'HTMLIFrame'/.test(q.value)&&this.numIframes++,e.push(q.value)):"C"==q.name.charAt(0)&&"_"==q.name.charAt(1)?k.push(q.value):"A"==q.name.charAt(0)&&"_"==q.name.charAt(1)?d.push(q.value):"G"==q.name.charAt(0)?r.push(q.value):"S"==q.name.charAt(0)?p.push(q.value):"Animation"==babel[q.name]&&m.push(q.value);this.scenarioRegion={container:document.createElement("div"),scroll:0};this.scenarioRegion.container.setAttribute("id","descartesJS_Scenario_Region");this.scenarioRegion.scenarioSpace=this.lessonParser.parseSpace("tipo='R2' id='descartesJS_scenario' fondo='blanco' x='0' y='0' fijo='yes' red='no' red10='no' ejes='no' text='no' ancho='"+
this.width+"' alto='"+this.height+"'");this.scenarioRegion.container.appendChild(this.scenarioRegion.scenarioSpace.container);this.arquimedes&&(this.container.appendChild(this.scenarioRegion.container),this.spaces.push(this.scenarioRegion.scenarioSpace));u=0;for(n=e.length;u<n;u++)c=b.parseSpace(e[u]),this.arquimedes&&this.scenarioRegion.container.appendChild(c.container),this.spaces.push(c),this.zIndex++;u=0;for(n=r.length;u<n;u++)if(e=b.parseGraphic(r[u]))e.visible&&(this.editableRegionVisible=
!0),e.space.addGraph(e);u=0;for(n=p.length;u<n;u++)(e=b.parse3DGraphic(p[u]))&&e.space.addGraph(e,!0);u=0;for(n=k.length;u<n;u++)this.controls.push(b.parseControl(k[u]));u=0;for(n=d.length;u<n;u++)b.parseAuxiliar(d[u]);u=0;for(n=m.length;u<n;u++)this.animation=b.parseAnimation(m[u]);this.configRegions();this.updateAuxiliaries();this.updateAuxiliaries();u=0;for(n=this.controls.length;u<n;u++)this.controls[u].init();this.updateControls();this.updateSpaces(!0);var l=this;this.numIframes?setTimeout(function(){l.finishInit()},
200*this.numIframes):this.finishInit()};a.DescartesApp.prototype.finishInit=function(){this.evaluator.setVariable("decimalSymbol",this.decimal_symbol);this.update();this.loader.style.display="none";window.parent!==window&&(this.parentContainer.style.margin="0px",this.parentContainer.style.padding="0px",window.parent.postMessage({type:"reportSize",href:window.location.href,width:this.width,height:this.height},"*"),window.parent.postMessage({type:"ready",value:window.location.href},"*"),a.onResize());
window.opener&&window.opener.postMessage({type:"isResizeNeeded",href:window.location.href},"*");this.externalSpace.init();if(this.arquimedes&&window.hasOwnProperty("MathJax")&&MathJax){var c=this.scenarioRegion.scenarioSpace.container.style.left,b=this.scenarioRegion.scenarioSpace.container.style.top,e=document.createElement("div");e.setAttribute("style","position:relative; left:"+c+"; top:"+b+"; text-align:left; margin:0; padding:18px 0 0 18px;");c={ctrs:[],spaces:[]};e.innerHTML=this.scenarioRegion.scenarioSpace.backgroundGraphics[0].text.toHTML(c);
this.scenarioRegion.scenarioSpace.container.style.visibility="hidden";this.scenarioRegion.scenarioSpace.container.style.display="none";this.scenarioRegion.container.replaceChild(e,this.scenarioRegion.scenarioSpace.container);this.scenarioRegion.container.style.background="#fff";this.container.style.height="100%";this.scenarioRegion.container.style.height="100%";this.container.style.overflow="visible";b=document.createElement("div");b.setAttribute("style","padding-bottom:25px;");b.innerHTML="<br/> <hr style='border-width:2px;'>";
var k=document.createElement("a");k.setAttribute("href","https://creativecommons.org/licenses/by-nc-sa/4.0/");k.setAttribute("target","_blank");b.appendChild(k);var d=a.getCreativeCommonsLicenseImage();d.setAttribute("style","position:absolute; left:30px; padding-top:4px;");k.appendChild(d);k=document.createElement("div");k.setAttribute("style","display:inline-block; width:100%; text-align:left;");k.innerHTML=this.scenarioRegion.scenarioSpace.backgroundGraphics[1].text.toHTML();k.removeChild(k.firstChild);
k.removeChild(k.firstChild);b.appendChild(k);e.appendChild(b);for(b=0;b<c.spaces.length;b++)k=c.spaces[b],k.value.container&&(e=document.getElementById(k.cID),d=k.value.container.style.border,d=""!=d?"border:"+d+";":"",k.value.container.setAttribute("style",d),e.appendChild(k.value.container));for(b=0;b<c.ctrs.length;b++)if(k=c.ctrs[b],d=k.value.containerControl||k.value.container)e=document.getElementById(k.cID),d.setAttribute("style","width:"+k.value.w+"px; height:"+k.value.h+"px;"),e.appendChild(d);
MathJax.Hub.Queue(["Typeset",MathJax.Hub])}};a.DescartesApp.prototype.adjustSize=function(){document.body.style.margin="0px";document.body.style.padding="0px";this.parentContainer.style.margin="0px";this.parentContainer.style.padding="0px";var c=parseInt(this.width)+30,b=parseInt(this.height)+90;window.moveTo((parseInt(screen.width)-c)/2,(parseInt(screen.height)-b)/2);window.resizeTo(c,b);a.onResize()};a.DescartesApp.prototype.adjustDimensions=function(){var a,b,c;if(void 0==this.init_w||void 0==
this.init_h)this.init_w=parseInt(this.container.style.width),this.init_h=parseInt(this.container.style.height);b=parseInt(this.parentContainer.offsetWidth);a=this.init_w;c=b/a;a>b?(this.parentContainer!=document.body&&(this.parentContainer.style.height=this.init_h*c+"px"),this.percent=c,this.container.style.webkitTransform=this.container.style.MozTransform="scale("+c+")",this.container.style.webkitTransformOrigin=this.container.style.MozTransformOrigin="top left"):(this.parentContainer!=document.body&&
(this.parentContainer.style.height="auto"),this.percent=1,this.container.style.webkitTransform=this.container.style.MozTransform="",this.container.style.webkitTransformOrigin=this.container.style.MozTransformOrigin="")};a.DescartesApp.prototype.configRegions=function(){var c=this.evaluator.parser,b=this.buttonsConfig,e=this.container;if(2!=this.version)var k="15",d=100,r=100,p=100,m=100;else k="14",d=63,r=50,p=44,m=53;var q=0,u=0,n=0,h=n=0,v=0,l=0,w=0,y=0,l=this.northSpace.controls,C=this.southSpace.controls,
D=this.eastSpace.controls,z=this.westSpace.controls;if(0<b.rowsNorth||0<l.length||b.about||b.config){0>=b.rowsNorth?(q=b.height,b.rowsNorth=1):q=b.height*b.rowsNorth;v=this.northSpace.container;v.setAttribute("id","descartesJS_northRegion");v.setAttribute("style","width:"+e.width+"px; height:"+q+"px; background:#c0c0c0; position:absolute; left:0px; top: "+this.plecaHeight+"px; z-index:100;");e.insertBefore(v,this.loader);var v=e.width,F=0;b.about?(F=d,v-=F):d=0;b.config&&(v-=r);for(var H=Math.ceil(l.length/
b.rowsNorth),I=v/H,n=0,A=l.length;n<A;n++)l[n].expresion=c.parse("("+(F+n%H*I)+","+b.height*Math.floor(n/H)+","+I+","+b.height+")"),l[n].drawif=c.parse("1"),l[n].init();b.about&&(n="espa\u00f1ol"==this.language?"cr\u00e9ditos":"english"==this.language?"about":"cr\u00e9ditos",n=new a.Button(this,{region:"north",name:n,font_size:c.parse(k),expresion:c.parse("(0, 0, "+d+", "+q+")")}),n.actionExec={execute:a.showAbout},n.update());b.config&&(new a.Button(this,{region:"north",name:"config",font_size:c.parse(k),
action:"config",expresion:c.parse("("+(v+d)+", 0, "+r+", "+q+")")})).update()}if(0<b.rowsSouth||0<C.length||b.init||b.clear){0>=b.rowsSouth?(u=b.height,b.rowsSouth=1):u=b.height*b.rowsSouth;l=e.width;F=0;b.init?(F=p,l-=F):p=0;b.clear&&(l-=m);v=this.southSpace.container;v.setAttribute("id","descartesJS_southRegion");v.setAttribute("style","width:"+e.width+"px; height:"+u+"px; background:#c0c0c0; position:absolute; left: 0px; top:"+(e.height-u)+"px; z-index:100;");e.insertBefore(v,this.loader);H=Math.ceil(C.length/
b.rowsSouth);I=l/H;n=0;for(A=C.length;n<A;n++)C[n].expresion=c.parse("("+(F+n%H*I)+","+b.height*Math.floor(n/H)+","+I+","+b.height+")"),C[n].drawif=c.parse("1"),C[n].init();b.init&&(n="espa\u00f1ol"==this.language?"inicio":"english"==this.language?"init":"inicio",(new a.Button(this,{region:"south",name:n,font_size:c.parse(k),action:"init",expresion:c.parse("(0, 0, "+p+", "+u+")")})).update());b.clear&&(n="espa\u00f1ol"==this.language?"limpiar":"english"==this.language?"clear":"limpiar",(new a.Button(this,
{region:"south",name:n,font_size:c.parse(k),action:"clear",expresion:c.parse("("+(l+p)+", 0, "+m+", "+u+")")})).update())}if(0<D.length)for(n=e.height-q-u,w=b.widthEast,v=this.eastSpace.container,v.setAttribute("id","descartesJS_eastRegion"),v.setAttribute("style","width:"+w+"px; height:"+n+"px; background:#c0c0c0; position:absolute; left:"+(e.width-w)+"px; top:"+q+"px; z-index:100;"),e.insertBefore(v,this.loader),n=0,A=D.length;n<A;n++)D[n].expresion=c.parse("(0,"+b.height*n+","+w+","+b.height+")"),
D[n].drawif=c.parse("1"),D[n].init();if(0<z.length)for(n=e.height-q-u,y=b.widthWest,v=this.westSpace.container,v.setAttribute("id","descartesJS_westRegion"),v.setAttribute("style","width: "+y+"px; height: "+n+"px; background: #c0c0c0; position: absolute; left: 0px; top: "+q+"px; z-index: 100;"),e.insertBefore(v,this.loader),n=0,A=z.length;n<A;n++)z[n].expresion=c.parse("(0,"+b.height*n+","+y+","+b.height+")"),z[n].drawif=c.parse("1"),z[n].init();if(this.editableRegionVisible)for(h=b.height,v=this.editableRegion.container,
v.setAttribute("id","descartesJS_editableRegion"),v.setAttribute("style","width:"+e.width+"px; height:"+h+"px; position:absolute; left:0px; top:"+(e.height-u-b.height)+"px; z-index:100; background:#c0c0c0; overflow:hidden;"),e.insertBefore(v,this.loader),c=this.editableRegion.textFields,b=e.width/c.length,k=a.getFieldFontSize(h),n=0,A=c.length;n<A;n++)"div"==c[n].type?(v.appendChild(c[n].container),c[n].container.setAttribute("style","font-family:descartesJS_sansserif,Arial,Sans-serif;width:"+(b-
4)+"px;height:"+h+"px;position:absolute;left:"+n*b+"px;top:0;"),d=c[n].container.firstChild,d.setAttribute("style","font-family:descartesJS_sansserif,Arial,Sans-serif;font-size:"+k+"px;padding-top:0%;background-color:#e0e4e8;position:absolute;left:0;top:0;height:"+h+"px;text-align:center;line-height:"+h+"px;"),r=d.offsetWidth,d.style.width=r+"px",d.firstChild.textContent=d.firstChild.textContent.substring(3,d.firstChild.textContent.length-3),c[n].container.lastChild.setAttribute("style","font-family:descartesJS_monospace,'Courier New',Monospace;font-size:"+
k+"px;width:"+(b-r)+"px;height:"+h+"px;position:absolute;left:"+r+"px;top:0;border:2px groove white;")):(v.appendChild(c[n]),c[n].setAttribute("style","font-family:descartesJS_monospace,'Courier New',Monospace;font-size:"+k+"px;width:"+b+"px;height:"+h+"px;position:absolute;left:"+n*b+"px;top:0;border:2px groove white;"));this.displaceRegionNorth=q;this.displaceRegionWest=y;e.width-=w;e.height=e.height-u-h;n=0;for(A=this.spaces.length;n<A;n++)this.spaces[n].init()};a.DescartesApp.prototype.update=
function(){this.updateAuxiliaries();this.updateControls();this.updateEvents();this.updateControls();this.updateSpaces()};a.DescartesApp.prototype.clearClick=function(){for(var a=0,b=this.spaces.length;a<b;a++)this.spaces[a].clearClick()};a.DescartesApp.prototype.deactivateGraphiControls=function(){for(var a,b=0,c=this.controls.length;b<c;b++)a=this.controls[b],"graphic"==a.type&&a.deactivate()};a.DescartesApp.prototype.updateAuxiliaries=function(){c.apply(this,["auxiliaries"])};a.DescartesApp.prototype.updateEvents=
function(){c.apply(this,["events"])};a.DescartesApp.prototype.updateControls=function(){c.apply(this,["controls"])};a.DescartesApp.prototype.updateSpaces=function(a){c.apply(this,["spaces",a])};a.DescartesApp.prototype.clear=function(){for(var a=0,b=this.spaces.length;a<b;a++)this.spaces[a].spaceChange=!0,this.spaces[a].drawBackground&&this.spaces[a].drawBackground()};a.DescartesApp.prototype.play=function(){this.animation&&this.animation.play()};a.DescartesApp.prototype.stop=function(){this.animation&&
this.animation.stop()};a.DescartesApp.prototype.reinitAnimation=function(){this.animation&&this.animation.reinit()};a.DescartesApp.prototype.stopAudios=function(){this.stop();for(var a in this.audios)this.audios.hasOwnProperty(a)&&this.audios[a].pause&&(this.audios[a].pause(),this.audios[a].currentTime=0)};a.DescartesApp.prototype.getImage=function(a){var b=this.images;if(a)return b[a]||(b[a]=new Image,b[a].addEventListener("load",function(){this.ready=1}),b[a].addEventListener("error",function(){this.ready=
0;this.errorload=1}),b[a].src=a),b[a]};a.DescartesApp.prototype.getAudio=function(a){var b=this.audios;if(a){if(!b[a]){var c=a.lastIndexOf("."),c=-1===c?a.lenght:c;a.substring(0,c);b[a]=new Audio(a);var e=function(a){this.ready=1};b[a].addEventListener("canplaythrough",e);var d=function(c){this.canPlayType("audio/"+a.substring(a.length-3))||"mp3"!=a.substring(a.length-3)?(console.log("El archivo '"+a+"' no puede ser reproducido"),this.errorload=1):(b[a]=new Audio(a.replace("mp3","ogg")),b[a].addEventListener("canplaythrough",
e),b[a].addEventListener("load",e),b[a].addEventListener("error",d),b[a].load())};b[a].addEventListener("error",d);b[a].play();setTimeout(function(){b[a].pause()},15)}return b[a]}return new Audio};a.DescartesApp.prototype.getControlByCId=function(a){for(var b,c=0,e=this.controls.length;c<e;c++)if(b=this.controls[c],b.cID==a)return b;return{update:function(){},w:0}};a.DescartesApp.prototype.getControlById=function(a){for(var b,c=0,e=this.controls.length;c<e;c++)if(b=this.controls[c],b.id==a)return b;
return{update:function(){}}};a.DescartesApp.prototype.getSpaceByCId=function(a){for(var b,c=0,e=this.spaces.length;c<e;c++)if(b=this.spaces[c],b.cID==a)return b;return{update:function(){},w:0}};a.DescartesApp.prototype.getSpaceById=function(a){for(var b,c=0,e=this.spaces.length;c<e;c++)if(b=this.spaces[c],b.id==a)return b;return{update:function(){},w:0}};var e;a.DescartesApp.prototype.getState=function(){var a,b="",c=this.evaluator.variables,e;for(e in c)c.hasOwnProperty(e)&&(a=c[e],"string"==typeof a&&
(a="'"+a+"'"),void 0!=a&&"rnd"!=e&&"pi"!=e&&"e"!=e&&"Infinity"!=e&&"-Infinity"!=e&&"object"!=typeof a&&(b=""!=b?b+"\n"+e+"="+a:e+"="+a));var c=this.evaluator.vectors,d;for(d in c)c.hasOwnProperty(d)&&(a=c[d],b=b+"\n"+d+"="+k(a));d=this.evaluator.matrices;for(var r in d)d.hasOwnProperty(r)&&(a=d[r],b=b+"\n"+r+"="+k(a));return b};a.DescartesApp.prototype.setState=function(a,b){for(var c=a.split("\n"),e,d,k=0,p=c.length;k<p;k++)e=c[k].split("="),2<=e.length&&(d=eval(e[1]),-1!=e[1].indexOf("[[")?(this.evaluator.matrices[e[0]]=
d,this.evaluator.matrices[e[0]].rows=d.length,this.evaluator.matrices[e[0]].cols=d[0].length):-1!=e[1].indexOf("[")?(this.evaluator.vectors[e[0]]=d,this.evaluator.variables[e[0]+".long"]=d.length):this.evaluator.variables[e[0]]=d);b||this.update()};a.DescartesApp.prototype.getEvaluation=function(){for(var a=0,b=0,c="",e=0,d=this.controls.length;e<d;e++)"textfield"==this.controls[e].gui&&this.controls[e].evaluate&&(a++,b+=this.controls[e].ok,this.controls[e].value=""==this.controls[e].value?"''":this.controls[e].value,
c+=" \\n "+this.controls[e].id+"="+this.controls[e].value+"|"+this.controls[e].ok);return"questions="+a+" \\n correct="+b+" \\n wrong="+(a-b)+c};a.DescartesApp.prototype.showSolution=function(){for(var a=this.controls,b=0,c=a.length;b<c;b++)"textfield"==a[b].gui&&a[b].evaluate&&a[b].changeValue(a[b].getFirstAnswer());this.update()};a.DescartesApp.prototype.showAnswer=function(){for(var a=0,b=this.saveState.length;a<b;a++)this.evaluator.evalExpression(this.saveState[a]);this.update()};return a}(descartesJS||
{}),descartesJS=function(a){function c(){var a=document.getElementById("StyleDescartesApps");a&&a.parentNode.removeChild(a);a=document.createElement("style");a.id="StyleDescartesApps";a.type="text/css";a.setAttribute("rel","stylesheet");a.innerHTML="applet.DescartesJS {display:none;} applet {display:none;} ajs.DescartesJS {display:none;} ajs {display:none;}";document.head.appendChild(a)}function k(b){b=document.createElement("div");b.innerHTML='<div style="visibility:hidden;font-size:12px"><div style="font-family:descartesJS_serif;"><span>_</span><span style="font-weight:bold;">_</span><span style="font-style:italic;">_</span><span style="font-weight:bold;font-style:italic;">_</span></div><div style="font-family:descartesJS_sansserif;"><span>_</span><span style="font-weight:bold;">_</span><span style="font-style:italic;">_</span><span style="font-weight:bold;font-style:italic;">_</span></div><div style="font-family:descartesJS_monospace;"><span>_</span><span style="font-weight:bold;">_</span><span style="font-style:italic;">_</span><span style="font-weight:bold;font-style:italic;">_</span></div><div style="font-family:descartesJS_extra;"><span>_</span><span style="font-weight:bold;">_</span><span style="font-style:italic;">_</span><span style="font-weight:bold;font-style:italic;">_</span></div></div>';
document.body.appendChild(b);a.getFeatures();if(a.hasCanvasSupport){window.scrollTo(0,10);for(var c=document.querySelectorAll(".DescartesAppContainer"),d=0,e=c.length;d<e;d++)c[d].parentNode.removeChild(c[d]);for(var d=document.querySelectorAll("applet, ajs"),f=/Descartes|DescartesJS|descinst.DescartesWeb2_0.class|Arquimedes|Discurso/i,c=[],k=0,q=d.length;k<q;k++)e=d[k],f.test(e.getAttribute("code")||"")&&c.push(e);d=0;for(e=c.length;d<e;d++)a.apps.push(new a.DescartesApp(c[d])),c[d].className="DescartesJS";
window.addEventListener("resize",a.onResize);window.scrollTo(0,0)}else document.getElementById("StyleDescartesApps").innerHTML="applet.DescartesJS {display:block;} applet {display:block;} ajs.DescartesJS {display:block;} ajs {display:block;}";document.body.removeChild(b)}if(a.loadLib)return a;a.apps=[];a.getDescartesApps=function(){return a.apps};window.hasOwnProperty("debugDescartesJS")&&debugDescartesJS||c();a.onResize=function(b){for(var c=0,d=a.apps.length;c<d;c++){b=a.apps[c].spaces;for(var e=
0,f=b.length;e<f;e++)b[e].findOffset()}};a.receiveMessage=function(b){if(0<a.apps.length){var c=b.data;c&&("set"===c.type?"string"==typeof c.value||"number"==typeof c.value?a.apps[0].evaluator.setVariable(c.name,c.value):c.value&&void 0!=c.value.rows?a.apps[0].evaluator.matrices[c.name]=c.value:a.apps[0].evaluator.vectors[c.name]=c.value:"update"===c.type?a.apps[0].update():"exec"===c.type?(b=a.apps[0].evaluator.getFunction(c.name),c=c.value.toString().split(","),b&&b.apply(a.apps[0].evaluator,c)):
"isResizeNeeded"===c.type?b.source.postMessage({type:"doResize"},"*"):"doResize"===c.type&&0<a.apps.length&&a.apps[0].adjustSize())}};if(void 0==a.loadLib){a.loadLib=!0;window.addEventListener("load",k);window.addEventListener("message",a.receiveMessage);for(var e=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd"],f=0,b=e.length;f<b;f++)window.addEventListener(e[f],function(b){a.onResize(b)})}return a}(descartesJS||{});
